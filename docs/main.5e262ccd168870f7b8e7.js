!function(){var t={8781:function(t,e,n){"use strict";var r=n(9483),i=n.n(r),o=n(8947),a=n(1436);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n(8594),n(5666);var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._element=document.getElementById(e),this._element||console.error("Could not find element with id ".concat(e)),this.hide()}var e,n;return e=t,(n=[{key:"clear",value:function(){for(;this._element.hasChildNodes();)this._element.removeChild(this._element.firstChild)}},{key:"show",value:function(){this._element.classList.remove("hidden")}},{key:"hide",value:function(){this._element.classList.add("hidden")}},{key:"setVisible",value:function(t){this._element.classList.toggle("hidden",!t)}},{key:"isVisible",value:function(){return!this._element.classList.contains("hidden")}}])&&s(e.prototype,n),t}(),c=500,l=1024,h=768;function f(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var p=function(){function t(e,n,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=n,this.width=r,this.height=i}var e,n,r;return e=t,r=[{key:"Empty",value:function(){return new t(0,0,0,0)}}],(n=[{key:"minX",get:function(){return this.x}},{key:"minY",get:function(){return this.y}},{key:"maxX",get:function(){return this.x+this.width}},{key:"maxY",get:function(){return this.y+this.height}},{key:"isEmpty",value:function(){return this.width<=0||this.height<=0}}])&&f(e.prototype,n),r&&f(e,r),t}();function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;d(this,t),this.x=e,this.y=n}var e,n;return e=t,(n=[{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return this.x=t,this.y=e,this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"clamp",value:function(t,e,n,r){return this.x=S(t,n,this.x),this.y=S(e,r,this.y),this}},{key:"invert",value:function(){return this.x*=-1,this.y*=-1,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divideScalar",value:function(t){if(0===t)this.x=0,this.y=0;else{var e=1/t;this.x*=e,this.y*=e}return this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceToSq",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSq(t))}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}}])&&A(e.prototype,n),t}();function y(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function v(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){y(o,r,i,a,s,"next",t)}function s(t){y(o,r,i,a,s,"throw",t)}a(void 0)}))}}function g(t){return b.apply(this,arguments)}function b(){return(b=v(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=document.createElement("input");n.type="file",n.accept=e,n.onchange=function(){if(0!=n.files.length){var e=n.files[0];t(e),n.remove()}},n.click()})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(){return null!=window.PointerEvent}function w(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];console.log(t,n)}function _(t,e){var n,r,i,o,a,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function u(t){t.preventDefault(),t.stopPropagation(),e.call(t.target,t)}function l(e){if(s||e.preventDefault(),!(i||e.touches.length>1)){var u=e.changedTouches[0];i=!0,u.identifier,a=!1,n=u.pageX,r=u.pageY,o=e.timeStamp,t.classList.add("down"),t.addEventListener("touchmove",h,{passive:s}),t.addEventListener("touchend",f)}}function h(e){if(s||e.preventDefault(),i){var u=e.changedTouches[0];document.elementFromPoint(u.pageX,u.pageY)!=e.target&&(i=!1,t.classList.remove("down")),(a||e.timeStamp<o+c)&&s&&(Math.abs(u.pageX-n)>30||Math.abs(u.pageY-r)>30)&&(i=!1,t.classList.remove("down")),e.timeStamp<o+c&&(Math.abs(u.pageX-n)>2||Math.abs(u.pageY-r)>2)&&(a=!0)}}function f(n){n.preventDefault(),t.removeEventListener("touchmove",h),t.removeEventListener("touchend",f),t.classList.remove("down"),i&&(i=!1,e.call(n.target,n))}t.addEventListener("touchstart",l,{passive:s}),t.addEventListener("mouseup",u)}function k(t,e){var n,r=this,i=!1;function o(t){i=!1,n=setTimeout((function(){e.call(r,t),i=!0}),1e3)}function a(e){i?(e.stopImmediatePropagation(),t.classList.remove("down"),i=!1):clearTimeout(n)}t.addEventListener("touchstart",o,{passive:!0}),t.addEventListener("touchend",a),t.addEventListener("mousedown",o),t.addEventListener("mouseup",a)}function x(t,e,n){return t*(1-n)+e*n}function S(t,e,n){return Math.min(e,Math.max(t,n))}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n(7107),n(7147);var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(s,(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));var e,n,r,o,a=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=E(r);if(o){var n=E(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function s(){var t,e;I(this,s);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return B(e,(t=e=a.call.apply(a,[this].concat(r)),e._imageStore=i().createInstance({name:"ImageStore"}),t))}return e=s,(n=[{key:"getItem",value:function(t){return this._imageStore.getItem(t)}},{key:"setItem",value:function(t,e){return this._imageStore.setItem(t,e)}},{key:"removeItem",value:function(t){return this._imageStore.removeItem(t)}},{key:"keys",value:function(){return this._imageStore.keys()}},{key:"iterate",value:function(t){return this._imageStore.iterate(t)}},{key:"clear",value:function(){return this._imageStore.clear()}}])&&O(e.prototype,n),s}(),T=n(5733),L=n.n(T);function j(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function U(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function z(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){U(o,r,i,a,s,"next",t)}function s(t){U(o,r,i,a,s,"throw",t)}a(void 0)}))}}function M(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var J=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.loadFileMeta()}var e,n,r,i,o,a,s,u,c,l,h,f,p,d;return e=t,(n=[{key:"adapter",get:function(){return this._adapter||(this._adapter=new R,this.migrate()),this._adapter}},{key:"urls",get:function(){return this._urls||(this._urls={}),this._urls}},{key:"GetFileChangeDate",value:(d=z(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e in this._fileMeta)){t.next=2;break}return t.abrupt("return",this._fileMeta[e].changeDate);case 2:return t.next=4,this.ContainsImage(e);case 4:if(!t.sent){t.next=8;break}return n=Date.now(),this.SetFileChangeDate(e,n),t.abrupt("return",n);case 8:return t.abrupt("return",0);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return d.apply(this,arguments)})},{key:"ContainsImage",value:(p=z(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.keys();case 2:return n=t.sent,t.abrupt("return",n.includes(e));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return p.apply(this,arguments)})},{key:"SetFileChangeDate",value:(f=z(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._fileMeta[e]={changeDate:n},t.next=3,this.adapter.setItem("file-meta",this._fileMeta);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e){return f.apply(this,arguments)})},{key:"loadImage",value:(h=z(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadImageUrl(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:if((r=new Image).id=e,r.src=n,null==r.decode){t.next=12;break}return t.next=11,r.decode();case 11:return t.abrupt("return",r);case 12:return t.abrupt("return",new Promise((function(t){r.onload=function(){return t(r)}})));case 13:case"end":return t.stop()}}),t,this)}))),function(t){return h.apply(this,arguments)})},{key:"loadImageUrl",value:(l=z(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e in this.urls)){t.next=2;break}return t.abrupt("return",this.urls[e]);case 2:return t.next=4,this.loadBlob(e);case 4:if(n=t.sent){t.next=7;break}return t.abrupt("return",null);case 7:return r=URL.createObjectURL(n),this.urls[e]=r,t.abrupt("return",r);case 10:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"loadBlob",value:function(t){return this.adapter.getItem(t)}},{key:"saveImage",value:(c=z(regeneratorRuntime.mark((function t(e,n){var r,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:Date.now(),t.prev=1,t.next=4,this.adapter.setItem(e,n);case 4:return t.next=6,this.SetFileChangeDate(e,r);case 6:t.next=10;break;case 8:t.prev=8,t.t0=t.catch(1);case 10:e in this.urls&&URL.revokeObjectURL(this.urls[e]),this.urls[e]=URL.createObjectURL(n),this.dispatchChangeEvent("save",e);case 13:case"end":return t.stop()}}),t,this,[[1,8]])}))),function(t,e){return c.apply(this,arguments)})},{key:"deleteImage",value:function(t){var e=this;return this.adapter.removeItem(t).then((function(){t in e.urls&&(URL.revokeObjectURL(e.urls[t]),delete e.urls[t]),e.dispatchChangeEvent("delete",t)}))}},{key:"keys",value:(u=z(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.keys();case 2:return e=t.sent,t.abrupt("return",e.filter((function(t){return"file-meta"!=t})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"addChangeListener",value:function(t){this._changeListeners=this._changeListeners||[],this._changeListeners.push(t)}},{key:"dispatchChangeEvent",value:function(t,e){var n,r=j(this._changeListeners);try{for(r.s();!(n=r.n()).done;)(0,n.value)(t,e)}catch(t){r.e(t)}finally{r.f()}}},{key:"clear",value:function(){this.adapter.clear()}},{key:"generateBackupArchive",value:(s=z(regeneratorRuntime.mark((function t(){var e,n,r,i,o,a,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,t.next=3,this.keys();case 3:n=t.sent,r=new(L()),i=j(n),t.prev=6,i.s();case 8:if((o=i.n()).done){t.next=22;break}return a=o.value,t.next=12,this.loadImageUrl(a);case 12:return s=t.sent,t.next=15,fetch(s).then((function(t){return t.blob()}));case 15:if(u=t.sent){t.next=18;break}return t.abrupt("continue",20);case 18:r.file(a,u),e+=1;case 20:t.next=8;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),i.e(t.t0);case 27:return t.prev=27,i.f(),t.finish(27);case 30:if(0!=e){t.next=32;break}return t.abrupt("return");case 32:return t.abrupt("return",r.generateAsync({type:"blob"}));case 33:case"end":return t.stop()}}),t,this,[[6,24,27,30]])}))),function(){return s.apply(this,arguments)})},{key:"importBackupArchive",value:(a=z(regeneratorRuntime.mark((function t(e){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L().loadAsync(e);case 2:t.sent.forEach(function(){var t=z(regeneratorRuntime.mark((function t(e,r){var i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.async("arraybuffer");case 2:i=t.sent,o=new Blob([i],{type:"image/png"}),n.saveImage(r.name,o);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"migrate",value:(o=z(regeneratorRuntime.mark((function t(){var e,n,r,i,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=!1,t.next=3,this.keys();case 3:n=t.sent,r=j(n),t.prev=5,r.s();case 7:if((i=r.n()).done){t.next=25;break}if((o=i.value).startsWith("image")||o.startsWith("Shape")){t.next=11;break}return t.abrupt("continue",23);case 11:if(!o.endsWith(".png")){t.next=13;break}return t.abrupt("continue",23);case 13:return a=o.replace("Shape","shape")+".png",t.next=16,this.adapter.getItem(o);case 16:return s=t.sent,t.next=19,this.adapter.setItem(a,s);case 19:return t.next=21,this.adapter.removeItem(o);case 21:console.log("Migrated ".concat(o," to ").concat(a,".")),e=!0;case 23:t.next=7;break;case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(5),r.e(t.t0);case 30:return t.prev=30,r.f(),t.finish(30);case 33:e&&location.reload();case 34:case"end":return t.stop()}}),t,this,[[5,27,30,33]])}))),function(){return o.apply(this,arguments)})},{key:"getStorageUsed",value:(i=z(regeneratorRuntime.mark((function t(){var e,n,r,i,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,t.next=3,this.keys();case 3:n=t.sent,r=j(n),t.prev=5,r.s();case 7:if((i=r.n()).done){t.next=20;break}return o=i.value,t.next=11,this.loadImageUrl(o);case 11:return a=t.sent,t.next=14,fetch(a).then((function(t){return t.blob()}));case 14:if(s=t.sent){t.next=17;break}return t.abrupt("continue",18);case 17:e+=s.size;case 18:t.next=7;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t.catch(5),r.e(t.t0);case 25:return t.prev=25,r.f(),t.finish(25);case 28:return t.abrupt("return",e);case 29:case"end":return t.stop()}}),t,this,[[5,22,25,28]])}))),function(){return i.apply(this,arguments)})},{key:"loadFileMeta",value:(r=z(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.adapter.getItem("file-meta");case 2:if(t.t1=e=t.sent,t.t0=null!==t.t1,!t.t0){t.next=6;break}t.t0=void 0!==e;case 6:if(!t.t0){t.next=10;break}t.t2=e,t.next=11;break;case 10:t.t2={};case 11:this._fileMeta=t.t2;case 12:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}])&&M(e.prototype,n),t}());function G(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var W=function(){function t(e,n,r){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var o=document.createElement("div");this._element=o,o.id=n,o.classList.add("thumbnail"),this._element.style.opacity="0",_(o,(function(){r&&r(n)}),!0),J.addChangeListener((function(t,e){"save"==t&&e==i.id&&i.loadImage()})),e.appendChild(o),this.loadImage()}var e,n;return e=t,(n=[{key:"id",get:function(){return this._element.id}},{key:"imageUrl",set:function(t){this._imageUrl=t,this._element.style.opacity="1",this.updateBackgroundImages()}},{key:"overlayUrl",set:function(t){this._overlayUrl=t,this.updateBackgroundImages()}},{key:"remove",value:function(){this._element.remove()}},{key:"isHidden",value:function(){return null===this._element.offsetParent}},{key:"loadImage",value:function(){var t=this;J.loadImageUrl(this.id).then((function(e){t.imageUrl=e})),J.loadImageUrl("overlay-"+this.id).then((function(e){t.overlayUrl=e}))}},{key:"updateBackgroundImages",value:function(){var t=[];this._overlayUrl&&t.push("url(".concat(this._overlayUrl,")")),this._imageUrl&&t.push("url(".concat(this._imageUrl,")")),this._element.style.backgroundImage=t.join(",")}}])&&G(e.prototype,n),t}();function Y(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(t,e,n){return(F="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=N(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function V(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=N(r);if(i){var n=N(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return V(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),_((n=o.call(this,t))._element.getElementsByClassName("button settings")[0],(function(){return e()})),n}return e=a,(n=[{key:"show",value:function(){F(N(a.prototype),"show",this).call(this),this.updateImages()}},{key:"updateImages",value:function(){var t=this;if(!this._thumbnails){this._thumbnails=[];for(var e=0;e<32;e++){var n="image".concat((""+(e+1)).padStart(2,"0"),".png"),r=new W(this._element,n,(function(e){return t.onImageSelected(e)}));this._thumbnails.push(r)}}}}])&&Y(e.prototype,n),a}(u);function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function K(t,e){return(K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}(s,t);var e,n,r,i,o,a=(i=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$(i);if(o){var n=$(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Z(this,t)});function s(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=a.call(this,t))._options=e,n._optionElements=[],n._selectedIndex=0,n.createOptions(),n.show(),n.collapse(),n}return e=s,r=[{key:"collapseAll",value:function(){s._expandedPalette&&s._expandedPalette.collapse()}}],(n=[{key:"selectedIndex",get:function(){return this._selectedIndex},set:function(t){this._selectedIndex=Math.max(0,Math.min(this._options.length-1,t)),this.updateSelectedOptionElement(this._selectedElement,this.selectedOption)}},{key:"selectedOption",get:function(){return this._options[this._selectedIndex]},set:function(t){var e=this._options.indexOf(t);-1!==e&&(this.selectedIndex=e)}},{key:"isCollapsed",get:function(){return this._element.classList.contains("collapsed")}},{key:"createOptions",value:function(){this.addSelectedOption(),this.addOptionElements()}},{key:"recreateOptions",value:function(){this.clear(),this.createOptions()}},{key:"collapse",value:function(){this._element.classList.add("collapsed"),s._expandedPalette==this&&(s._expandedPalette=null)}},{key:"expand",value:function(){s.collapseAll(),this._element.classList.remove("collapsed"),s._expandedPalette=this}},{key:"toggle",value:function(){this.isCollapsed?this.expand():this.collapse()}},{key:"addOption",value:function(t){this._options.push(t),this.addOptionElement(this._options.length-1,t),this.updateOptionsWidth()}},{key:"removeOption",value:function(t){this._options.splice(t,1),this._optionElements[t].remove(),this._optionElements.splice(t,1),this.recreateOptions()}},{key:"addSelectedOption",value:function(){var t=this,e=document.createElement("div");e.classList.add("option"),this._selectedElement=e,_(e,(function(){return t.toggle()})),this.updateSelectedOptionElement(e,this.selectedOption),this._element.appendChild(e)}},{key:"addOptionElements",value:function(){var t=document.createElement("div");t.classList.add("options"),this._optionsElement=t,this.addArrowElement();var e,n=0,r=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this._options);try{for(r.s();!(e=r.n()).done;){var i=e.value;this.addOptionElement(n,i),n++}}catch(t){r.e(t)}finally{r.f()}this.updateOptionsWidth(),this._element.appendChild(t)}},{key:"updateOptionsWidth",value:function(){this._optionsElement.style.width=1.25*Math.min(8,this._options.length)+"em"}},{key:"addArrowElement",value:function(){var t=document.createElement("div");t.classList.add("arrow"),this._optionsElement.appendChild(t)}},{key:"addOptionElement",value:function(t,e){var n=this,r=document.createElement("div");r.classList.add("option"),r.dataset.index="".concat(t),k(r,(function(r){return n.optionLongClicked(r,e,t)})),_(r,(function(r){return n.optionClicked(r,e,t)})),this.updateOptionElement(r,e),this._optionsElement.appendChild(r),this._optionElements[t]=r}},{key:"optionClicked",value:function(t,e,n){this.selectedIndex=n,this.collapse(),this.onSelectionChanged&&this.onSelectionChanged(e,n)}},{key:"optionLongClicked",value:function(t,e,n){}},{key:"updateOptionElement",value:function(t,e){}},{key:"updateSelectedOptionElement",value:function(t,e){this.updateOptionElement(t,e)}}])&&X(e.prototype,n),r&&X(e,r),s}(u);function et(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function nt(t,e){return(nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function it(t){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ot=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nt(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=it(r);if(i){var n=it(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return rt(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t,["#000000","#222034","#45283c","#663931","#8f563b","#df7126","#d9a066","#eec39a","#fbf236","#99e550","#6abe30","#37946e","#4b692f","#524b24","#323c39","#3f3f74","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffffff","#9badb7","#847e87","#696a6a","#595652","#76428a","#ac3232","#d95763","#d77bba","#8f974a","#8a6f30"])).selectedIndex=15,e}return e=a,(n=[{key:"color",get:function(){return this.selectedOption},set:function(t){this.selectedOption=t}},{key:"updateOptionElement",value:function(t,e){t.style.background=e}}])&&et(e.prototype,n),a}(tt);function at(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function st(t,e){return(st=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ut(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ct(t){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var lt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&st(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ct(r);if(i){var n=ct(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ut(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t,[2,8,24,40],!0)).selectedIndex=1,e}return e=a,(n=[{key:"size",get:function(){return this.selectedOption},set:function(t){this.selectedOption=t}},{key:"updateOptionElement",value:function(t,e){var n=e/40;t.innerHTML='<div class="line-width" style="width:'+n+'em"></div>'}}])&&at(e.prototype,n),a}(tt);function ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var ft=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._painter=e,this._buttonElement=document.getElementById(n)}var e,n;return e=t,(n=[{key:"color",get:function(){return this._painter.color}},{key:"opacity",get:function(){return this._painter.opacity}},{key:"lineWidth",get:function(){return this._painter.lineWidth}},{key:"createBufferCtx",value:function(){var e=document.createElement("canvas");e.id="buffer",e.width=this._painter.width,e.height=this._painter.height,t._bufferCtx=e.getContext("2d",{alpha:!0}),t._bufferCtx.imageSmoothingQuality="high",t._bufferCtx.imageSmoothingEnabled=!0}},{key:"getBufferCtx",value:function(){return null==t._bufferCtx&&this.createBufferCtx(),t._bufferCtx}},{key:"enable",value:function(){this._buttonElement.classList.add("selected")}},{key:"disable",value:function(){this._buttonElement.classList.remove("selected")}},{key:"down",value:function(t){}},{key:"move",value:function(t){}},{key:"up",value:function(t){}},{key:"pressureChanged",value:function(){}},{key:"tick",value:function(t){}},{key:"keyDown",value:function(t){}}])&&ht(e.prototype,n),t}();function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function At(t,e){return(At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function mt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=yt(r);if(i){var n=yt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return mt(this,t)});function a(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"darken";return pt(this,a),(n=o.call(this,t,e))._operation=r,n.createBrushCtx(),n}return e=a,(n=[{key:"createBrushCtx",value:function(){var t=document.createElement("canvas");t.id="brush",t.width=64,t.height=64,this._brushCtx=t.getContext("2d",{alpha:!0}),this._brushCtx.imageSmoothingQuality="high",this._brushCtx.imageSmoothingEnabled=!0}},{key:"down",value:function(t){this._painter.captureAutoMask(t.position.clone().round()),this._points=[t.position];var e=this.getWidth(t.pressure,t.speed);this._widths=[e],this._startIndex=0;var n=this._painter.baseLayer.ctx;n.fillStyle=this.color,n.strokeStyle=this.color,this._painter.baseLayer.ctx.globalCompositeOperation=this._operation,this.requestDrawPath()}},{key:"up",value:function(){this._painter.recordHistoryState()}},{key:"tick",value:function(t){this._drawPathRequested&&(this.drawPath(),this._drawPathRequested=!1)}},{key:"requestDrawPath",value:function(){this._drawPathRequested=!0}},{key:"drawPath",value:function(){if(0!=this._points.length){var t=this._painter.baseLayer.ctx;this.drawConnectedLines(t,this._points.slice(this._startIndex),this._widths.slice(this._startIndex)),this._startIndex=Math.max(0,this._points.length-1)}}},{key:"drawConnectedLines",value:function(t,e,n){var r=e.length;if(0!=r){t.lineCap="round",t.lineJoin="round";var i=e[0],o=n[0]*this.lineWidth;1==r&&(t.beginPath(),t.arc(i.x,i.y,.5*o,0,2*Math.PI),t.fill());for(var a=1;a<r;a++)t.beginPath(),t.lineWidth=n[a]*this.lineWidth,t.lineTo(e[a-1].x,e[a-1].y),t.lineTo(e[a].x,e[a].y),t.stroke()}}},{key:"drawBrush",value:function(t,e,n,r){var i=.5*r;e-=i,n-=i,t.drawImage(this._brushCtx.canvas,e,n,r,r)}},{key:"move",value:function(t){var e=this.interpolatePoints(t.position);this._points=this._points.concat(e);var n=e.length,r=this.getWidth(t.pressure,t.speed),i=this._widths[this._widths.length-1],o=2*n;r=S(i-o,i+o,r);for(var a=0;a<n;a++)this._widths.push(x(i,r,a/n));this.requestDrawPath()}},{key:"interpolatePoints",value:function(t){var e=Math.max(4,.1*this.lineWidth),n=[];if(0!=this._points.length){var r=this._points[this._points.length-1],i=t,o=r.distanceTo(i);if(o<e)return n;var a=r;if(this._points.length>1){var s=this._points[this._points.length-2],u=r.clone().subtract(s).normalize();a=r.clone().add(u.clone().multiplyScalar(.3*o))}for(var c=e/o,l=c;l<=1;l+=c){var h=this.pointOnQuadraticCurve(r,a,i,l);n.push(h)}return n}}},{key:"pointOnQuadraticCurve",value:function(t,e,n,r){var i=(1-r)*(1-r),o=2*r*(1-r),a=r*r;return new m(t.x*i+e.x*o+n.x*a,t.y*i+e.y*o+n.y*a)}},{key:"pressureChanged",value:function(){this.requestDrawPath()}},{key:"getWidth",value:function(t,e){return t/S(1,2,e)}},{key:"applyAutoMask",value:function(){if(this._painter.autoMaskCtx){var t=this.getBufferCtx();t.globalCompositeOperation="destination-in",t.drawImage(this._painter.autoMaskCtx.canvas,0,0),t.globalCompositeOperation="source-over"}}}])&&dt(e.prototype,n),a}(ft);function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ct(t,e){return(Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var kt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_t(r);if(i){var n=_t(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return wt(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t,[],!0))._shapeIds={},e.selectedIndex=0,J.keys().then((function(t){var n,r=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(t.filter((function(t){return t.startsWith("shape")})));try{for(r.s();!(n=r.n()).done;){var i=n.value;e.addShapeFromImageId(i)}}catch(t){r.e(t)}finally{r.f()}})),J.addChangeListener((function(t,n){"save"==t&&n.startsWith("shape")&&e.addShapeFromImageId(n)})),e}return e=a,(n=[{key:"stamp",get:function(){return this.selectedOption}},{key:"addShapeFromImageId",value:function(t){var e=this;J.loadImageUrl(t).then((function(n){e._shapeIds[n]=t,e.addOption(n)}))}},{key:"optionLongClicked",value:function(t,e,n){this.deleteShape(n)}},{key:"updateOptionElement",value:function(t,e){t.style.backgroundImage='url("'.concat(e,'")')}},{key:"updateSelectedOptionElement",value:function(t,e){t.innerHTML='<i class="fas fa-shapes"></i>'}},{key:"deleteShape",value:function(t){var e=this,n=this._options[t],r=this._shapeIds[n];r&&J.deleteImage(r).then((function(){delete e._shapeIds[n],e.removeOption(t),e.selectedIndex==t&&(e.selectedIndex=t)}))}}])&&bt(e.prototype,n),a}(tt);function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var St=function(){function t(e,n,r,i,o,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._startScale=1,this._startRotation=0,this._position=new m(0,0),this._scale=1,this._rotation=0,this._lastTouchStartTime=0,this._pointers=[],this._element=document.createElement(n),this._element.id=r,this._element.classList.add("layer"),this._index=0,this._width=a,this._height=s,this._element.width=a,this._element.height=s,this._element.style.width="".concat(a,"em"),this._element.style.height="".concat(s,"em"),this._element.style.pointerEvents="none",e.appendChild(this._element),this.transform(new m(i,o),1,0),this.bindEventListeners()}var e,n;return e=t,(n=[{key:"id",get:function(){return this._element.id}},{key:"index",get:function(){return this._index},set:function(t){this._index=t,this.transform(this.position,this.scale,this.rotation)}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"position",get:function(){return this._position}},{key:"rotation",get:function(){return this._rotation}},{key:"scale",get:function(){return this._scale}},{key:"floating",get:function(){return this._element.classList.contains("floating")},set:function(t){this._element.classList.toggle("floating",t),this._element.style.pointerEvents=t?"auto":"none",t?this.addEventListeners():this.removeEventListeners()}},{key:"remove",value:function(){this._element.remove()}},{key:"resize",value:function(t,e){var n=this.position.x+.5*(this.width-t),r=this.position.y+.5*(this.height-e);this.setPositionAndSize(n,r,t,e)}},{key:"setPositionAndSize",value:function(t,e,n,r){this._width=n,this._height=r,this._element.width=n,this._element.height=r,this._element.style.width="".concat(n,"em"),this._element.style.height="".concat(r,"em"),this.transform(new m(t,e),this.scale,this.rotation)}},{key:"drawToCanvas",value:function(t){t.save();var e=this._position.x+.5*this.width,n=this._position.y+.5*this.height;t.setTransform(this._scale,0,0,this._scale,e,n),t.rotate(this._rotation),t.translate(-.5*this.width,-.5*this.height),t.drawImage(this._element,0,0),t.restore()}},{key:"addEventListeners",value:function(){this._element.addEventListener("click",this.preventDefault),C()?(this._element.addEventListener("touchstart",this.preventDefault),this._element.addEventListener("pointerdown",this.pointerDown)):this._element.addEventListener("touchstart",this.touchStart)}},{key:"removeEventListeners",value:function(){this._element.removeEventListener("click",this.preventDefault),C()?(this._element.removeEventListener("touchstart",this.preventDefault),this._element.removeEventListener("pointerdown",this.pointerDown)):this._element.removeEventListener("touchstart",this.touchStart)}},{key:"preventDefault",value:function(t){t.preventDefault()}},{key:"doubleTap",value:function(t){this.onDoubleTap&&this.onDoubleTap(t)}},{key:"pointerDown",value:function(t){if(t.preventDefault(),this._element.setPointerCapture(t.pointerId),this.addPointerEvent(t),1===this._pointers.length)if(t.timeStamp<this._lastTouchStartTime+400&&this.doubleTap(t),this._lastTouchStartTime=t.timeStamp,this._element.addEventListener("pointermove",this.pointerMove),this._element.addEventListener("pointerup",this.pointerUp),this._pinchCenter=new m(this._position.x+.5*this.width,this._position.y+.5*this.height),t.altKey){var e=this.clientToPixel(this._pointers[0]),n=this._pinchCenter.clone().multiplyScalar(2).subtract(e);this.pinchStart(e,n)}else this.dragStart(this.clientToPixel(this._pointers[0]));2===this._pointers.length&&this.pinchStart(this.clientToPixel(this._pointers[0]),this.clientToPixel(this._pointers[1]))}},{key:"addPointerEvent",value:function(t){var e=this._pointers.findIndex((function(e){return e.pointerId==t.pointerId}));e<0?this._pointers.push(t):this._pointers[e]=t}},{key:"removePointerEvent",value:function(t){var e=this._pointers.findIndex((function(e){return e.pointerId==t.pointerId}));e>=0&&this._pointers.splice(e,1)}},{key:"pointerMove",value:function(t){t.preventDefault(),this.addPointerEvent(t),this.move(this._pointers,t.altKey)}},{key:"pointerUp",value:function(t){t.preventDefault(),this._element.releasePointerCapture(t.pointerId),this.removePointerEvent(t),1==this._pointers.length&&this.dragStart(this.clientToPixel(this._pointers[0])),0==this._pointers.length&&(this._element.removeEventListener("pointermove",this.pointerMove),this._element.removeEventListener("pointerup",this.pointerUp))}},{key:"touchStart",value:function(t){if(t.preventDefault(),1===t.touches.length)if(t.timeStamp<this._lastTouchStartTime+400&&this.doubleTap(t),this._lastTouchStartTime=t.timeStamp,this._element.addEventListener("touchmove",this.touchMove),this._element.addEventListener("touchend",this.touchEnd),this._pinchCenter=new m(this._position.x+.5*this.width,this._position.y+.5*this.height),t.altKey){var e=this.clientToPixel(t.touches[0]),n=this._pinchCenter.clone().multiplyScalar(2).subtract(e);this.pinchStart(e,n)}else this.dragStart(this.clientToPixel(t.touches[0]));2===t.touches.length&&this.pinchStart(this.clientToPixel(t.touches[0]),this.clientToPixel(t.touches[1]))}},{key:"touchMove",value:function(t){t.preventDefault(),this.move(t.touches,t.altKey)}},{key:"move",value:function(t,e){if(1===t.length)if(e){var n=this.clientToPixel(t[0]),r=this._pinchCenter.clone().multiplyScalar(2).subtract(n);this.pinchMove(n,r)}else this.dragMove(this.clientToPixel(t[0]));2===t.length&&this.pinchMove(this.clientToPixel(t[0]),this.clientToPixel(t[1]))}},{key:"touchEnd",value:function(t){t.preventDefault(),this._element.removeEventListener("touchmove",this.touchMove),this._element.addEventListener("touchend",this.touchEnd)}},{key:"transform",value:function(t,e,n){this._position=t,this._rotation=n,this._scale=e;var r=this._index;this._element.style.transform="translate(".concat(t.x,"em, ").concat(t.y,"em) rotate(").concat(n,"rad) scale(").concat(e,") translateZ(").concat(r,"px)"),this._element.style.outlineWidth="".concat(2/e,"em"),this._element.style.outlineOffset="-".concat(2/e,"em")}},{key:"bindEventListeners",value:function(){this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this)}},{key:"dragStart",value:function(t){this._localDragPosition=t.clone().subtract(this.position)}},{key:"dragMove",value:function(t){t.subtract(this._localDragPosition),this.transform(t,this._scale,this._rotation)}},{key:"pinchStart",value:function(t,e){var n=t.clone().add(e).multiplyScalar(.5);this._pinchStartDist=t.distanceTo(e),this._pinchStartRotation=Math.atan2(t.y-n.y,t.x-n.x),this._startRotation=this._rotation,this._startScale=this._scale}},{key:"pinchMove",value:function(t,e){var n=t.clone().add(e).multiplyScalar(.5),r=t.distanceTo(e),i=Math.atan2(t.y-n.y,t.x-n.x)-this._pinchStartRotation,o=this._startScale*(r/this._pinchStartDist);o=S(.1,10,o);var a=t.clone().add(e).multiplyScalar(.5);a.x-=.5*this.width,a.y-=.5*this.height;var s=this._startRotation+i;this.transform(a,o,s)}},{key:"clientToPixel",value:function(t){var e=this._element.parentElement.getBoundingClientRect(),n=e.height>e.width,r=(t.clientX-e.left)/e.width,i=(t.clientY-e.top)/e.height;return new m((n?1-i:r)*l,(n?r:i)*h)}}])&&xt(e.prototype,n),t}();function It(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ot(t,e){return(Ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Pt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Bt(t){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Et=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ot(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bt(r);if(i){var n=Bt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Pt(this,t)});function a(t,e,n,r,i,s){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(u=o.call(this,t,"canvas",e,n,r,i,s))._ctx=u.canvas.getContext("2d",{alpha:!0}),u._ctx.imageSmoothingQuality="high",u._ctx.imageSmoothingEnabled=true,u}return e=a,(n=[{key:"canvas",get:function(){return this._element}},{key:"ctx",get:function(){return this._ctx}},{key:"getData",value:function(){return this._ctx.getImageData(0,0,this.width,this.height)}},{key:"putData",value:function(t){this._ctx.putImageData(t,0,0)}},{key:"drawImage",value:function(t,e){var n=e||{x:0,y:0,width:this.width,height:this.height},r=n.x,i=n.y,o=n.width,a=n.height;this._ctx.drawImage(t,r,i,o,a)}},{key:"clear",value:function(t){var e=t||{x:0,y:0,width:this.width,height:this.height},n=e.x,r=e.y,i=e.width,o=e.height;this._ctx.clearRect(n,r,i,o)}}])&&It(e.prototype,n),a}(St);function Rt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Lt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=jt(r);if(i){var n=jt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Lt(this,t)});function a(t,e,n,r,i,s){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(u=o.call(this,t,"img",e,n,r,i,s))._element.onload=function(){u.resize(u.image.naturalWidth,u.image.naturalHeight)},u}return e=a,(n=[{key:"image",get:function(){return this._element}}])&&Rt(e.prototype,n),a}(St),Ut=n(3162);function zt(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Jt(t,e,n){return(Jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yt(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function Gt(t,e){return(Gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Yt(t){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gt(t,e)}(u,t);var e,n,r,i,o,a,s=(o=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yt(o);if(a){var n=Yt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Wt(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(n=s.call(this,t,e)).selectionLayerId="selection-layer",n._selection=p.Empty(),n._deleteButton=document.getElementById("selection-delete-button"),_(n._deleteButton,(function(){return n.clearSelection()})),n._stampButton=document.getElementById("selection-stamp-button"),_(n._stampButton,(function(){return n.paintSelectionToCanvas()})),n._saveButton=document.getElementById("selection-save-button"),_(n._saveButton,(function(){return n.saveSelectionAsNewStamp()})),n._downloadButton=document.getElementById("selection-download-button"),_(n._downloadButton,(function(){n.selectionLayer.canvas.toBlob((function(t){return(0,Ut.saveAs)(t,"image.png")}))})),n.hasFloatingSelection=!1,n._position=new m(0,0),n}return e=u,(n=[{key:"selectionLayer",get:function(){return this._painter.getLayer(this.selectionLayerId)}},{key:"selection",get:function(){return this._selection}},{key:"hasFloatingSelection",get:function(){return this._hasFloatingSelection},set:function(t){this._hasFloatingSelection=t,this.toggleFloatingSelectionButtons(t)}},{key:"isInShapesPalette",get:function(){return this._isInShapesPalette},set:function(t){this._isInShapesPalette=t,this._saveButton.classList.toggle("disabled",t)}},{key:"toggleFloatingSelectionButtons",value:function(t){this._deleteButton.classList.toggle("hidden",!t),this._stampButton.classList.toggle("hidden",!t),this._downloadButton.classList.toggle("hidden",!t),this._saveButton.classList.toggle("hidden",!t)}},{key:"enable",value:function(){Jt(Yt(u.prototype),"enable",this).call(this),this.createSelectionLayer(),this.hasFloatingSelection=!1,this.isInShapesPalette=!1}},{key:"disable",value:function(){Jt(Yt(u.prototype),"disable",this).call(this),this.paintSelectionToCanvas(),this.destroySelectionLayer(),this.hasFloatingSelection=!1}},{key:"down",value:function(t){this._position=this.getClampedPosition(t),this.startNewSelection()}},{key:"move",value:function(t){this._position=this.getClampedPosition(t),this.requestDrawSelectionOutline()}},{key:"up",value:function(t){this.cutSelection()}},{key:"startNewSelection",value:function(){this.paintSelectionToCanvas(),this.selectionLayer.setPositionAndSize(0,0,this._painter.width,this._painter.height),this.selectionLayer.transform(new m(0,0),1,0),this.selectionLayer.floating=!1,this.hasFloatingSelection=!1,this.isInShapesPalette=!1,this._startPosition=this._position;var t=this.selectionLayer.ctx;t.setTransform(1,0,0,1,0,0),t.strokeStyle="black",t.lineCap="round",t.lineJoin="round",t.lineWidth=2,t.setLineDash([5,5]),this.requestDrawSelectionOutline()}},{key:"getClampedPosition",value:function(t){return t.position.round().clamp(0,0,this._painter.width-1,this._painter.height-1)}},{key:"tick",value:function(t){this._drawSelectionOutlineRequested&&(this.updateSelectionAndDrawOutline(),this._drawSelectionOutlineRequested=!1)}},{key:"keyDown",value:function(t){switch(t.code){case"Backspace":this.clearSelection()}}},{key:"clearSelection",value:function(){this.selectionLayer.clear(),this.startNewSelection()}},{key:"setImage",value:function(t){this.hasFloatingSelection=!0,this.selectionLayer.resize(t.width,t.height),this.selectionLayer.floating=!0,this.selectionLayer.drawImage(t),this.isInShapesPalette=!0}},{key:"setImageUrl",value:(r=regeneratorRuntime.mark((function t(e){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new Image).src=e,t.abrupt("return",new Promise((function(t){n.onload=function(){r.setImage(n),t(n)}})));case 3:case"end":return t.stop()}}),t)})),i=function(){var t=this,e=arguments;return new Promise((function(n,i){var o=r.apply(t,e);function a(t){zt(o,n,i,a,s,"next",t)}function s(t){zt(o,n,i,a,s,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"requestDrawSelectionOutline",value:function(){this._drawSelectionOutlineRequested=!0}},{key:"updateSelectionAndDrawOutline",value:function(){if(!this.hasFloatingSelection){this.selectionLayer.clear();var t=this.selectionLayer.ctx,e=Math.min(this._startPosition.x,this._position.x),n=Math.min(this._startPosition.y,this._position.y),r=Math.abs(this._startPosition.x-this._position.x),i=Math.abs(this._startPosition.y-this._position.y);this._selection=new p(e,n,r,i),t.strokeRect(e,n,r,i)}}},{key:"destroySelectionLayer",value:function(){this._painter.removeLayer(this.selectionLayer)}},{key:"createSelectionLayer",value:function(){var t=this;this.selectionLayer||(this._painter.addCanvasLayer(this.selectionLayerId,0,0,this._painter.width,this._painter.height,!1),this.selectionLayer.onDoubleTap=function(e){e.altKey?t.saveSelectionAsNewStamp():t.paintSelectionToCanvas()})}},{key:"cutSelection",value:function(){if(this.selectionLayer.clear(),this._selection=function(t,e){var n=e.x,r=e.y,i=e.width,o=e.height;if(i<=0||o<=0)return p.Empty();for(var a=t.getImageData(n,r,i,o).data,s=i,u=0,c=o,l=0,h=0;h<o;h++)for(var f=0;f<i;f++)a[4*(f+h*i)+3]&&(s=f<s?f:s,u=f>u?f:u,c=h<c?h:c,l=h>l?h:l);return n+=s,r+=c,i=Math.max(0,u-s+1),o=Math.max(0,l-c+1),new p(n,r,i,o)}(this._painter.baseLayer.ctx,this.selection),!this.selection.isEmpty()){this.hasFloatingSelection=!0;var t=this.selection,e=t.x,n=t.y,r=t.width,i=t.height;this.selectionLayer.setPositionAndSize(e,n,r,i),this.selectionLayer.floating=!0,this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas,e,n,r,i,0,0,r,i),this._painter.baseLayer.clear(this.selection),this._painter.recordHistoryState()}}},{key:"paintSelectionToCanvas",value:function(){this.hasFloatingSelection&&(this._painter.baseLayer.ctx.globalCompositeOperation="source-over",this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx),this._painter.recordHistoryState())}},{key:"saveSelectionAsNewStamp",value:function(){var t=this;J.keys().then((function(e){if(e.filter((function(t){return t.startsWith("Shape")})).length>=64)console.log("Cannot save selection as shape because there are already too many in storage.");else{var n="shape".concat(Date.now(),".png");console.log("Saving selection as: ".concat(n)),t.selectionLayer.canvas.toBlob((function(t){return J.saveImage(n,t)})),t.isInShapesPalette=!0}}))}},{key:"selectAll",value:function(){this.startNewSelection(),this._selection=new p(0,0,this._painter.width,this._painter.height),this.cutSelection()}}])&&Mt(e.prototype,n),u}(ft);function qt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vt(t,e){return(Vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ht(t){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Vt(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ht(r);if(i){var n=Ht(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Nt(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t)).show(),e}return e=a,(n=[{key:"flip",value:function(){(this._element.classList.contains("left")||this._element.classList.contains("right"))&&(this._element.classList.toggle("left"),this._element.classList.toggle("right")),(this._element.classList.contains("top")||this._element.classList.contains("bottom"))&&(this._element.classList.toggle("top"),this._element.classList.toggle("bottom"))}}])&&qt(e.prototype,n),a}(u);function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Kt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._states=[],this._position=-1}var e,n;return e=t,(n=[{key:"canUndo",get:function(){return this._position>0}},{key:"canRedo",get:function(){return this._position<this._states.length-1}},{key:"recordState",value:function(t){9==this._position&&(this._states.shift(),this._position--),this._states.splice(this._position+1,this._states.length-this._position+1),this._position++,this._states[this._position]=t}},{key:"undo",value:function(){return this.canUndo?(this._position--,this._states[this._position]):null}},{key:"redo",value:function(){return this.canRedo?(this._position++,this._states[this._position]):null}},{key:"getCurrentState",value:function(){return this._position>-1&&this._position<this._states.length?this._states[this._position]:null}},{key:"clear",value:function(){this._states=[],this._position=-1}}])&&Xt(e.prototype,n),t}();function Zt(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function $t(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Zt(o,r,i,a,s,"next",t)}function s(t){Zt(o,r,i,a,s,"throw",t)}a(void 0)}))}}function te(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ee(t,e,n){return(ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=oe(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function ne(t,e){return(ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function re(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?ie(t):e}function ie(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function oe(t){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ne(t,e)}(u,t);var e,n,r,i,o,a,s=(o=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=oe(o);if(a){var n=oe(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return re(this,t)});function u(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),n=s.call(this,t),se.call(ie(n)),n._history=new Kt,n._sheet=document.getElementById("sheet"),n.width=l,n.height=h,w("Setting PaintView size to ".concat(n.width," x ").concat(n.height)),n.addCanvasLayer("base-layer",0,0,n.width,n.height,!1),n.addEventListeners(),n.createButtons(e),n.createToolbar(),n.createPalettes(),n.createTools(),n}return e=u,r=[{key:"findTouch",value:function(t,e){for(var n=0;n<t.length;n++)if(t[n].identifier==e)return t[n];return null}}],(n=[{key:"color",get:function(){return this._color}},{key:"stamp",get:function(){return this._stamp}},{key:"opacity",get:function(){return this._opacity}},{key:"lineWidth",get:function(){return this._lineWidth}},{key:"autoMaskCtx",get:function(){return this._autoMaskCtx}},{key:"baseLayer",get:function(){return this._layers["base-layer"]}},{key:"overlayLayer",get:function(){return this._layers["overlay-layer"]}},{key:"getLayer",value:function(t){return this._layers[t]}},{key:"createButtons",value:function(t){var e=this;_(this._element.getElementsByClassName("button back")[0],(function(){return t()})),this._undoButton=document.getElementById("undo-button"),_(this._undoButton,(function(){return e.undo()})),this._redoButton=document.getElementById("redo-button"),_(this._redoButton,(function(){return e.redo()})),this._importImageButton=document.getElementById("import-image-button"),_(this._importImageButton,$t(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g("image/*");case 2:return n=t.sent,e.setTool(e.selectionTool),r=URL.createObjectURL(n),t.next=7,e.selectionTool.setImageUrl(r);case 7:URL.revokeObjectURL(r);case 8:case"end":return t.stop()}}),t)}))))}},{key:"addLayer",value:function(t){return t.index=Object.keys(this._layers).length,this._layers[t.id]=t,t}},{key:"addImageLayer",value:function(t,e,n,r,i,o){var a=new Dt(this._sheet,t,e,n,r,i);return a.floating=o,this.addLayer(a),a}},{key:"addCanvasLayer",value:function(t,e,n,r,i,o){var a=new Et(this._sheet,t,e,n,r,i);return a.floating=o,this.addLayer(a),a}},{key:"removeLayer",value:function(t){t&&(t.remove(),delete this._layers[t.id])}},{key:"createOverlay",value:function(){this.overlayLayer||this.addLayer(new Dt(this._sheet,"overlay-layer",0,0,this.width,this.height))}},{key:"removeOverlay",value:function(){this.removeLayer(this.overlayLayer)}},{key:"setOverlay",value:(i=$t(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J.loadImageUrl(e);case 2:if(n=t.sent){t.next=6;break}return this.removeOverlay(),t.abrupt("return");case 6:this.createOverlay(),this.overlayLayer.image.src=n;case 8:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"createTools",value:function(){var t=this,e=document.getElementById("tool-pen");k(e,(function(){return t.fill()})),_(e,(function(){return t.setTool(t.markerTool)}));var n=document.getElementById("tool-eraser");k(n,(function(){return t.clear(!0)})),_(n,(function(){return t.setTool(t.eraserTool)}));var r=document.getElementById("tool-selection");_(r,(function(){return t.setTool(t.selectionTool)})),k(r,(function(){t.setTool(t.selectionTool),t.selectionTool.selectAll()})),this._tools=[],this.markerTool=this.addTool(new vt(this,"tool-pen","darken")),this.eraserTool=this.addTool(new vt(this,"tool-eraser","destination-out")),this.selectionTool=this.addTool(new Ft(this,"tool-selection")),this.setTool(this.markerTool)}},{key:"addTool",value:function(t){return this._tools.push(t),t}},{key:"createToolbar",value:function(){this._mainToolbar=new Qt("main-toolbar"),this._contextToolbar=new Qt("context-toolbar")}},{key:"createPalettes",value:function(){var t=this;this._sizePalette=new lt("size-palette"),this._sizePalette.onSelectionChanged=function(e){t._lineWidth=e},this._lineWidth=this._sizePalette.size,this._colorPalette=new ot("color-palette"),this._colorPalette.onSelectionChanged=function(e){return t._color=e},this._color=this._colorPalette.color,this._shapePalette=new kt("stamp-palette"),this._shapePalette.onSelectionChanged=function(e){t._stamp=e,t.setTool(t.selectionTool),t.selectionTool.setImageUrl(t.stamp)},this._stamp=this._shapePalette.stamp,this._opacity=1}},{key:"setTool",value:function(t){this._currentTool!=t&&(this._currentTool&&this._currentTool.disable(),this._currentTool=t,this._currentTool&&this._currentTool.enable(),this._colorPalette.setVisible(this._currentTool==this.markerTool),this._sizePalette.setVisible(this._currentTool==this.markerTool||this._currentTool==this.eraserTool))}},{key:"addEventListeners",value:function(){var t=this,e=this.baseLayer.canvas;e.style.pointerEvents="auto",document.addEventListener("keydown",(function(e){return t.keyDown(e)})),e.addEventListener("click",(function(t){return t.preventDefault()})),null!=window.PointerEvent?(e.addEventListener("touchstart",(function(t){t.cancelable&&t.preventDefault()})),e.addEventListener("pointerdown",(function(e){return t.pointerDown(e)})),e.addEventListener("pointermove",(function(e){return t.pointerMove(e)})),e.addEventListener("pointerup",(function(e){return t.pointerUp(e)})),e.addEventListener("pointercancel",(function(t){return t.preventDefault()}))):(e.addEventListener("touchstart",(function(e){return t.touchStart(e)})),e.addEventListener("touchmove",(function(e){return t.touchMove(e)})),e.addEventListener("touchend",(function(e){return t.touchEnd(e)})),e.addEventListener("touchcancel",(function(t){return t.preventDefault()})))}},{key:"getPointerEventPosition",value:function(t){var e=t.target.getBoundingClientRect(),n=e.height>e.width,r=(t.clientX-e.left)/e.width,i=(t.clientY-e.top)/e.height,o=(n?1-i:r)*this.width,a=(n?r:i)*this.height;return new m(o,a)}},{key:"getTouchEventPosition",value:function(t){var e=this.baseLayer.canvas.getBoundingClientRect(),n=e.height>e.width,r=(t.clientX-e.left)/e.width,i=(t.clientY-e.top)/e.height,o=(n?1-i:r)*this.width,a=(n?r:i)*this.height;return new m(o,a)}},{key:"keyDown",value:function(t){this.isVisible()&&(t.code,this._currentTool&&this._currentTool.keyDown(t))}},{key:"pointerDown",value:function(t){t.preventDefault(),t.isPrimary&&1===t.buttons&&(t.target.setPointerCapture(t.pointerId),this._currentTouchId=t.pointerId,this.down({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:this.screenToSheet(new m(t.width,t.height)),pressure:this.getNormalizedPointerPressure(t),speed:1,isPressed:!0}))}},{key:"pointerMove",value:function(t){t.preventDefault(),t.isPrimary&&1===t.buttons&&this.move({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:this.screenToSheet(new m(t.width,t.height)),pressure:this.getNormalizedPointerPressure(t),speed:1,isPressed:!0})}},{key:"getNormalizedPointerPressure",value:function(t){return"pen"==t.pointerType?S(.5,2,4*t.pressure):1}},{key:"getNormalizedTouchPressure",value:function(t){return"stylus"==t.touchType?S(.5,2,4*t.force):1}},{key:"pointerUp",value:function(t){t.preventDefault(),t.isPrimary&&(t.target.releasePointerCapture(t.pointerId),this.up({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:new m(t.width,t.height),pressure:1,speed:1,isPressed:!1}),this._currentTouchId=0)}},{key:"pressureChanged",value:function(t){}},{key:"touchStart",value:function(t){if(t.preventDefault(),0===this._currentTouchId){var e=t.targetTouches[0];this._currentTouchId=e.identifier,this.down({timeStamp:t.timeStamp,position:this.getTouchEventPosition(e),radius:this.screenToSheet(new m(e.radiusX,e.radiusY)),pressure:this.getNormalizedTouchPressure(e),speed:1,isPressed:!0})}}},{key:"touchMove",value:function(t){t.preventDefault();var e=u.findTouch(t.targetTouches,this._currentTouchId);null!=e&&(console.log(e.force),this.move({timeStamp:t.timeStamp,position:this.getTouchEventPosition(e),radius:this.screenToSheet(new m(e.radiusX,e.radiusY)),pressure:this.getNormalizedTouchPressure(e),speed:1,isPressed:!0}))}},{key:"touchEnd",value:function(t){t.preventDefault(),null==u.findTouch(t.targetTouches,this._currentTouchId)&&(this.up({timeStamp:t.timeStamp,position:new m(0,0),radius:new m(0,0),pressure:1,speed:1,isPressed:!1}),this._currentTouchId=0)}},{key:"move",value:function(t){if(this._currentTool){var e=this._lastPointerData.position.distanceTo(t.position);if(!(e<=1)){this._lastPointerData=this._lastPointerData||t;var n=e/(t.timeStamp-this._lastPointerData.timeStamp);t.speed=x(this._lastPointerData.speed,n,.2),this._lastPointerData=t,this._currentTool.move(t)}}}},{key:"down",value:function(t){tt.collapseAll(),this._currentTool&&(this._lastPointerData=t,this._currentTool.down(t))}},{key:"up",value:function(t){this._currentTool&&(this._lastPointerData=t,this._currentTool.up(t))}},{key:"clear",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.baseLayer.clear(),t&&this.recordHistoryState()}},{key:"fill",value:function(){this.baseLayer.ctx.fillStyle=this.color,this.baseLayer.ctx.fillRect(0,0,this.width,this.height),this.recordHistoryState()}},{key:"ResetHistory",value:function(){this._history.clear(),this.recordHistoryState(),this.updateUndoButtons()}},{key:"recordHistoryState",value:function(){this._history.recordState(this.baseLayer.getData()),this.updateUndoButtons(),this.setDirty()}},{key:"updateUndoButtons",value:function(){this._undoButton.classList.toggle("disabled",!this._history.canUndo),this._redoButton.classList.toggle("disabled",!this._history.canRedo)}},{key:"undo",value:function(){this._history.canUndo&&(this.baseLayer.putData(this._history.undo()),this.updateUndoButtons(),this.setDirty())}},{key:"redo",value:function(){this._history.canRedo&&(this.baseLayer.putData(this._history.redo()),this.updateUndoButtons(),this.setDirty())}},{key:"restoreCurrentHistoryState",value:function(){this.baseLayer.putData(this._history.getCurrentState())}},{key:"loadImage",value:function(t){var e=this;return J.loadImage(t).then((function(n){e._imageId=t,e.clear(),n&&e.baseLayer.drawImage(n),e.setOverlay("overlay-"+t),e.ResetHistory(),e._isDirty=!1}))}},{key:"saveImage",value:function(){var t=this;w("Saving image"),this.baseLayer.canvas.toBlob((function(e){return J.saveImage(t._imageId,e)})),this._isDirty=!1,this._lastSaveTimestamp=Date.now()}},{key:"setDirty",value:function(){this._isDirty=!0}},{key:"show",value:function(){var t=this;ee(oe(u.prototype),"show",this).call(this),this._currentTouchId=0,this._autoMaskCaptured=!1,window.requestAnimationFrame((function(e){return t.tick(e)})),this._currentTool.enable()}},{key:"hide",value:function(){tt.collapseAll(),this._currentTool&&this._currentTool.disable(),this._layers&&this.saveImage(),this._history&&this._history.clear(),ee(oe(u.prototype),"hide",this).call(this)}},{key:"tick",value:function(t){var e=this;if(this.isVisible()){window.requestAnimationFrame((function(t){return e.tick(t)}));var n=t-this._tickTimeStamp;this._tickTimeStamp=t,this._currentTool&&(this._currentTool.tick(n),this._lastPointerData&&this._lastPointerData.isPressed)||this._isDirty&&Date.now()>this._lastSaveTimestamp+5e3&&this.saveImage()}}},{key:"captureAutoMask",value:function(t){}},{key:"processOverlay",value:function(t){for(var e=t.getImageData(0,0,this.width,this.height),n=e.data,r=n.length-1;r>=0;r--)n[r]=n[r]>64?255:0;t.putImageData(e,0,0)}},{key:"screenToSheet",value:function(t){return new m(t.x/screen.width*l,t.y/screen.height*h)}}])&&te(e.prototype,n),r&&te(e,r),u}(u),se=function(){this.scaleFactor=1,this._currentTouchId=0,this._layers={},this._lastSaveTimestamp=0};function ue(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ce(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ce(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ce(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function le(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function he(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){le(o,r,i,a,s,"next",t)}function s(t){le(o,r,i,a,s,"throw",t)}a(void 0)}))}}function fe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pe=new(function(){function t(){var e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._host=null!==(e=localStorage.getItem("server-url"))&&void 0!==e?e:"http://localhost:3000",this._userId=null!==(n=localStorage.getItem("user-id"))&&void 0!==n?n:""}var e,n,r,i,o,a,s,u,c;return e=t,(n=[{key:"host",get:function(){return this._host},set:function(t){this._host=t,localStorage.setItem("server-url",t)}},{key:"userId",get:function(){return this._userId},set:function(t){this._userId=t,localStorage.setItem("user-id",t)}},{key:"sync",value:(c=he(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.userId){t.next=3;break}return console.error("Cannot sync without user id."),t.abrupt("return");case 3:return t.next=5,this.downloadDefaultAssets();case 5:return t.next=7,this.uploadUserContent();case 7:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"uploadUserContent",value:(u=he(regeneratorRuntime.mark((function t(){var e,n,r,i,o,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.createDirectory(this.host,this.userId),t.next=3,J.keys();case 3:e=t.sent,n=ue(e),t.prev=5,n.s();case 7:if((r=n.n()).done){t.next=22;break}return i=r.value,t.next=11,J.loadImageUrl(i);case 11:return o=t.sent,t.next=14,fetch(o).then((function(t){return t.blob()}));case 14:if(a=t.sent){t.next=17;break}return t.abrupt("continue",20);case 17:s=this.userId+"/"+i,console.log("posting: "+s),this.postImage(this.host,a,s);case 20:t.next=7;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(5),n.e(t.t0);case 27:return t.prev=27,n.f(),t.finish(27);case 30:case"end":return t.stop()}}),t,this,[[5,24,27,30]])}))),function(){return u.apply(this,arguments)})},{key:"downloadDefaultAssets",value:(s=he(regeneratorRuntime.mark((function t(){var e,n,r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPathInfo(this.host,"default");case 2:if((e=t.sent).ok){t.next=6;break}return console.log("Could not download default assets."),t.abrupt("return");case 6:return t.next=8,e.json();case 8:n=t.sent,r=ue(n),t.prev=10,r.s();case 12:if((i=r.n()).done){t.next=22;break}if((o=i.value).isFile){t.next=16;break}return t.abrupt("continue",20);case 16:if(o.name.endsWith(".png")){t.next=18;break}return t.abrupt("continue",20);case 18:console.log("getting default asset: "+o.name),this.downloadImage("default/"+o.name,o.name);case 20:t.next=12;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(10),r.e(t.t0);case 27:return t.prev=27,r.f(),t.finish(27);case 30:case"end":return t.stop()}}),t,this,[[10,24,27,30]])}))),function(){return s.apply(this,arguments)})},{key:"downloadImage",value:(a=he(regeneratorRuntime.mark((function t(e,n){var r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.host+"/"+e,t.next=3,fetch(r);case 3:if(!(i=t.sent).ok){t.next=9;break}return t.next=7,i.blob();case 7:(o=t.sent)&&J.saveImage(n,o);case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"getPathInfo",value:(o=he(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e+"/"+n+"?type=json",t.abrupt("return",fetch(r));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return o.apply(this,arguments)})},{key:"createDirectory",value:(i=he(regeneratorRuntime.mark((function t(e,n){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e+"/"+n+"?create=directory",t.abrupt("return",fetch(r,{method:"POST"}));case 2:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"postImage",value:(r=he(regeneratorRuntime.mark((function t(e,n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e+"/"+r,t.abrupt("return",fetch(i,{method:"PUT",headers:{Accept:"image/png","Content-Type":"image/png"},body:n}));case 2:case"end":return t.stop()}}),t)}))),function(t,e,n){return r.apply(this,arguments)})}])&&fe(e.prototype,n),t}()),de=n(8475);function Ae(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ye(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function ve(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){ye(o,r,i,a,s,"next",t)}function s(t){ye(o,r,i,a,s,"throw",t)}a(void 0)}))}}function ge(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var be=new(function(){function t(){var e,n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._isAuthorized=!1,this.SYNC_BOTH=0,this.SYNC_UPLOAD=1,this.SYNC_DOWNLOAD=2,this._userId=null!==(e=localStorage.getItem("user-id"))&&void 0!==e?e:"";var r=this.getAccessTokenFromUrl();r?this.authorize(r):i().getItem("dropbox-token").then((function(t){t&&n.authorize(t)}))}var e,n,r,o,a,s,u,c;return e=t,(n=[{key:"isAuthorized",get:function(){return this._isAuthorized}},{key:"dbx",get:function(){return this._dbx}},{key:"userId",get:function(){return this._userId},set:function(t){this._userId=t,localStorage.setItem("user-id",t)}},{key:"getAuthenticationUrl",value:function(){return new de.DropboxAuth({clientId:"dyfw7wk3nb2utzo"}).getAuthenticationUrl(location.href)}},{key:"sync",value:(c=ve(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isAuthorized&&this.userId){t.next=2;break}return t.abrupt("return");case 2:return console.log("Sync default content:"),t.next=5,this.syncFolder("default",this.SYNC_DOWNLOAD);case 5:return console.log("Sync user content:"),t.next=8,this.syncFolder(this.userId,this.SYNC_BOTH);case 8:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"syncFolder",value:(u=ve(regeneratorRuntime.mark((function t(e){var n,r,i,o,a,s,u,c,l,h,f,p=this,d=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:this.SYNC_BOTH,t.prev=1,t.next=4,this.listFolder(e);case 4:if(!(r=t.sent)||n!=this.SYNC_DOWNLOAD&&n!=this.SYNC_BOTH){t.next=36;break}i=Ae(r),t.prev=7,i.s();case 9:if((o=i.n()).done){t.next=28;break}if(a=o.value,console.log(a.name),"file"==a[".tag"]){t.next=14;break}return t.abrupt("continue",26);case 14:if(a.name.endsWith(".png")){t.next=16;break}return t.abrupt("continue",26);case 16:return s=a.name,u=new Date(a.server_modified).getTime(),t.next=20,J.GetFileChangeDate(s);case 20:if(t.t0=t.sent,t.t1=u,!(t.t0>=t.t1)){t.next=24;break}return t.abrupt("continue",26);case 24:console.log("getting "+s),this.downloadImage(a.path_lower,s,u);case 26:t.next=9;break;case 28:t.next=33;break;case 30:t.prev=30,t.t2=t.catch(7),i.e(t.t2);case 33:return t.prev=33,i.f(),t.finish(33);case 36:if(n!=this.SYNC_UPLOAD&&n!=this.SYNC_BOTH){t.next=62;break}if(r){t.next=40;break}return t.next=40,this.createDirectory(e);case 40:return t.next=42,J.keys();case 42:c=t.sent,l=Ae(c),t.prev=44,f=regeneratorRuntime.mark((function t(){var n,i,o,a,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=h.value,!(i=null==r?void 0:r.find((function(t){return t.name==n})))){t.next=10;break}return o=new Date(i.server_modified).getTime(),t.t0=o,t.next=7,J.GetFileChangeDate(n);case 7:if(t.t1=t.sent,!(t.t0>=t.t1)){t.next=10;break}return t.abrupt("return","continue");case 10:return t.next=12,J.loadImageUrl(n);case 12:return a=t.sent,t.next=15,fetch(a).then((function(t){return t.blob()}));case 15:if(s=t.sent){t.next=18;break}return t.abrupt("return","continue");case 18:return u="/"+e+"/"+n,console.log("posting: "+u),t.next=22,p.postImage(s,u);case 22:case"end":return t.stop()}}),t)})),l.s();case 47:if((h=l.n()).done){t.next=54;break}return t.delegateYield(f(),"t3",49);case 49:if("continue"!==t.t3){t.next=52;break}return t.abrupt("continue",52);case 52:t.next=47;break;case 54:t.next=59;break;case 56:t.prev=56,t.t4=t.catch(44),l.e(t.t4);case 59:return t.prev=59,l.f(),t.finish(59);case 62:t.next=67;break;case 64:t.prev=64,t.t5=t.catch(1),console.log(t.t5);case 67:case"end":return t.stop()}}),t,this,[[1,64],[7,30,33,36],[44,56,59,62]])}))),function(t){return u.apply(this,arguments)})},{key:"listFolder",value:(s=ve(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.dbx.filesListFolder({path:"/"+e});case 3:return n=t.sent,t.abrupt("return",n.result.entries);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return s.apply(this,arguments)})},{key:"downloadImage",value:(a=ve(regeneratorRuntime.mark((function t(e,n,r){var i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dbx.filesDownload({path:e});case 2:200==(i=t.sent).status&&(o=i.result.fileBlob)&&J.saveImage(n,o,r);case 4:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return a.apply(this,arguments)})},{key:"postImage",value:(o=ve(regeneratorRuntime.mark((function t(e,n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dbx.filesUpload({path:n,contents:e,mode:{".tag":"overwrite"}}));case 1:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"createDirectory",value:(r=ve(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dbx.filesCreateFolderV2({path:"/"+e}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"getAccessTokenFromUrl",value:function(){return this.parseQueryString(window.location.hash).access_token}},{key:"parseQueryString",value:function(t){var e=Object.create(null);return"string"!=typeof t?e:(t=t.trim().replace(/^(\?|#|&)/,""))?(t.split("&").forEach((function(t){var n=t.replace(/\+/g," ").split("="),r=n.shift(),i=n.length>0?n.join("="):void 0;r=decodeURIComponent(r),i=void 0===i?null:decodeURIComponent(i),void 0===e[r]?e[r]=i:Array.isArray(e[r])?e[r].push(i):e[r]=[e[r],i]})),e):e}},{key:"authorize",value:function(t){this._isAuthorized=!!t,this.isAuthorized&&(this._dbx=new de.Dropbox({accessToken:t}),i().setItem("dropbox-token",t))}},{key:"unauthorize",value:function(){var t=this;this.isAuthorized&&this.dbx.authTokenRevoke().then((function(){t._isAuthorized=!1,i().removeItem("dropbox-token")}))}}])&&ge(e.prototype,n),t}());function Ce(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function we(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Ce(o,r,i,a,s,"next",t)}function s(t){Ce(o,r,i,a,s,"throw",t)}a(void 0)}))}}function _e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ke(t,e,n){return(ke="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ie(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function xe(t,e){return(xe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Se(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Ie(t){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Oe=n(8966),Pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xe(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ie(r);if(i){var n=Ie(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Se(this,t)});function a(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),_((n=o.call(this,t))._element.querySelector(".button.back"),(function(){return e()})),n._hostElement=n._element.querySelector("#server-url"),n._hostElement.onblur=function(){return pe.host=n._hostElement.value},n._userIdElement=n._element.querySelector("#user-id"),n._userIdElement.onblur=function(){return be.userId=n._userIdElement.value},n._connectButton=n._element.querySelector(".button.connect"),_(n._connectButton,(function(){location.href=be.getAuthenticationUrl()})),n._disconnectButton=n._element.querySelector(".button.disconnect"),_(n._disconnectButton,(function(){be.unauthorize(),n.updateButtons()})),n._syncButton=n._element.querySelector(".button.sync"),_(n._syncButton,we(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",be.sync());case 1:case"end":return t.stop()}}),t)})))),_(n._element.querySelector(".button.export"),we(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,J.generateBackupArchive();case 2:e=t.sent,(0,Ut.saveAs)(e,"web-paint-backup.zip");case 4:case"end":return t.stop()}}),t)})))),_(n._element.querySelector(".button.import"),we(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=J,t.next=3,g(".zip");case 3:t.t1=t.sent,t.t0.importBackupArchive.call(t.t0,t.t1),n.updateInfo();case 6:case"end":return t.stop()}}),t)})))),_(n._element.querySelector(".button.clear"),(function(){confirm("Really clear all iamges?")&&(J.clear(),location.reload())})),Oe.connect(document.getElementById("log"),{},!0,!0,!0),n}return e=a,(n=[{key:"updateButtons",value:function(){console.log(be.isAuthorized),this._connectButton.classList.toggle("hidden",be.isAuthorized),this._disconnectButton.classList.toggle("hidden",!be.isAuthorized),this._syncButton.classList.toggle("disabled",!be.isAuthorized)}},{key:"show",value:function(){ke(Ie(a.prototype),"show",this).call(this),this.updateInfo(),this.updateButtons()}},{key:"updateInfo",value:function(){var t=document.getElementById("info");t.innerText="Version: ".concat("1.0.0"),J.getStorageUsed().then((function(e){t.innerText+="\rStorage used: ".concat(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 Bytes";var n=1024,r=e<0?0:e,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(t)/Math.log(n));return parseFloat((t/Math.pow(n,o)).toFixed(r))+" "+i[o]}(e,1))})),this._hostElement.value=pe.host,this._userIdElement.value=be.userId}}])&&_e(e.prototype,n),a}(u);function Be(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Ee(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Be(o,r,i,a,s,"next",t)}function s(t){Be(o,r,i,a,s,"throw",t)}a(void 0)}))}}function Re(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n(920),n(1466),o.vI.add(a.mRB),o.vz.watch();var Te=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._settingsView=new Pe("settings",(function(){e.openView(e._bookView)})),this._sheet=document.getElementById("sheet"),window.addEventListener("resize",(function(t){e.OnResize()})),this.OnResize(),this._bookView=new H("book",Ee(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.openView(e._settingsView);case 1:case"end":return t.stop()}}),t)})))),this._bookView.onImageSelected=function(t){e._paintView.loadImage(t).then((function(){e.openView(e._paintView)}))},this._paintView=new ae("paint",(function(){e.openView(e._bookView)})),this.openView(this._bookView)}var e,n,r;return e=t,r=[{key:"preventOverScroll",value:function(){document.ontouchmove=function(t){t.preventDefault()}}}],(n=[{key:"getIOSVersion",value:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||"0",10)]}}},{key:"OnResize",value:function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,n=t<e,r=t>1024,i=Math.max(t,e),o=Math.min(t,e),a=i/l,s=o/h,u=r?Math.min(a,s):Math.max(a,s);this._sheet.style.fontSize="".concat(u,"px"),this._sheet.style.left="".concat(n?.5*(t-u*l):0,"px")}},{key:"openView",value:function(t){this._activeView&&this._activeView.hide(),this._activeView=t,this._activeView.show()}}])&&Re(e.prototype,n),r&&Re(e,r),t}();document.addEventListener("DOMContentLoaded",(function(){window.app=new Te,window.localForage=i()}))},4583:function(t,e,n){"use strict";var r=n(4015),i=n.n(r),o=n(3645),a=n.n(o)()(i());a.push([t.id,'*{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:none}textarea{-webkit-user-select:initial}html,body{margin:0;width:100%;height:100%;position:fixed;font-size:40px}@media(max-width: 400px),(max-height: 400px){html,body{font-size:28px}}body{-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5rem}body,input,textarea{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5rem}.button{width:1.5rem;height:1.5rem;line-height:1.5rem;text-align:center;font-size:.75rem;border-radius:30%;cursor:pointer;background:rgba(255,255,255,.5);color:#000;transition:transform .25s}.button.down{transform:scale(0.9)}.button i{line-height:1.5rem}.button .fa-stack{height:1em;width:1em}.button .fa-stack.fa-fw{width:1.25em}#dropbox-button{border-radius:3px;background-color:#007ee5;border:none;color:#fff;font-size:16px;padding:10px 15px;text-decoration:none;height:24px}.view{display:flex;position:fixed;width:100%;height:100%;background:#bbb;overflow:hidden}.dropbox-auth{align-items:center;justify-content:center}.view.book{flex-wrap:wrap;align-content:flex-start;justify-content:center;overflow-y:auto;-webkit-overflow-scrolling:touch}.view.book,.view.book *{touch-action:pan-y}.view.settings{font-size:.5rem;padding:.5rem 2.5rem;display:block;box-sizing:border-box;padding-right:52%;line-height:1.4em}.view.settings input{font-size:.5rem;line-height:1em;border:none;width:100%;border-radius:.5em;box-sizing:border-box;padding:.5em;-webkit-user-select:initial}.view.settings .button.text{width:auto;border-radius:.5em;padding:0 .5em;margin-bottom:.5em;text-align:left}.view.settings label{display:block;text-transform:uppercase;color:gray}.view.settings #log{width:50vw;background:#272727;color:#c7c7c7;overflow:scroll;-webkit-overflow-scrolling:touch;touch-action:pan-y;height:100vh;padding:0;font-family:monospace;font-size:12px;position:fixed;top:0;right:0;margin:0;line-height:20px}#log li{border-bottom:#444 solid 1px;padding:0 1em}.thumbnail{margin:.3rem;color:#ccc;background:#fff;border-radius:.1rem;font-size:5.6rem;width:1em;height:.75em;background-size:contain;cursor:pointer;transition:opacity 1s}.thumbnail.down{transform:scale(0.9)}.paint{align-items:center}.paint #sheet{font-size:1px;width:1024em;height:768em;margin:auto;overflow:auto;position:fixed;object-fit:contain;left:0;top:0;bottom:0;right:0}.layer{position:absolute;left:0;top:0;background:none}#base-layer{background:#fff}.layer.floating{outline:2px dashed #000}#stamp-layer{opacity:.2}@media(orientation: portrait){.paint #sheet{transform:rotate(-90deg);overflow-x:hidden}}.button.back{position:absolute;top:.25rem;left:.25rem;z-index:100}.button.settings{position:absolute;right:.25rem;top:.25rem;z-index:100}.button a{width:100%;height:100%;display:block;color:#000}.button#stamp-button{font-size:1.25rem;position:absolute;top:.25rem;right:.25rem;width:2rem;height:2rem;z-index:100;line-height:1.85rem}.toolbar{display:flex;background:#d3d3d3;border-radius:.5rem;z-index:100;position:absolute}.toolbar.left{flex-direction:column;left:.25rem;top:50%;transform:translateY(-50%)}.toolbar.right{flex-direction:column;right:.25rem;top:50%;transform:translateY(-50%)}.toolbar.top{flex-direction:row;left:50%;top:.25em;transform:translateX(-50%)}.toolbar.bottom{flex-direction:row;left:50%;bottom:.25em;transform:translateX(-50%)}.toolbar .button{background:transparent}.toolbar .spacer{width:1.5em;height:1.5em}.palette{position:relative;transition:transform .25s;display:inline-block;float:left;text-align:center;z-index:100}.palette .option i{font-size:.75em}.palette .options{position:absolute;display:flex;flex-wrap:wrap;background:#d3d3d3;border-radius:.5rem;padding:.25rem;transition:transform .15s;top:2.25rem;left:50%;transform:translateX(-50%)}.palette .option{width:1em;height:1em;line-height:.75em;display:inline-block;margin:.25em;float:left;transition:transform .25s;background-size:contain;background-repeat:no-repeat;background-position:center}.palette .options .option{margin:.125em}.palette .option:active{transform:scale(0.9)}.palette .options .arrow{position:absolute;width:0;height:0;font-size:.25rem;top:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-bottom:2em solid #d3d3d3;border-top:none}.toolbar.left .palette .options{left:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.left .palette .options .arrow{top:initial;left:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-right:2em solid #d3d3d3}.toolbar.right .palette .options{left:initial;right:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.right .palette .options .arrow{left:initial;top:initial;right:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-left:2em solid #d3d3d3;border-right:0}.toolbar.bottom .palette .options{left:50%;top:initial;bottom:2.25rem;transform:translateX(-50%)}.toolbar.bottom .palette .options .arrow{top:initial;bottom:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-top:2em solid #d3d3d3;border-bottom:none}.palette.collapsed:active{transform:scale(0.9)}.toolbar.top .palette.collapsed .options,.toolbar.bottom .palette.collapsed .options{transform:translateX(-50%) scale(0)}.toolbar.left .palette.collapsed .options,.toolbar.right .palette.collapsed .options{transform:translateY(-50%) scale(0)}#stamp-palette.palette .options{font-size:1.5rem}@media(max-width: 400px),(max-height: 400px){#stamp-palette.palette .options{font-size:1rem}}.line-width{background:#000;height:100%;margin:auto;border-radius:.15em}#color-palette .option{border-radius:40%}.hidden{display:none !important}.disabled{opacity:.25}.selected{background:#58b0ff !important;color:#fff}',"",{version:3,sources:["webpack://./painter.css"],names:[],mappings:"AAAA,EACI,0BAAA,CACA,wBAAA,CACA,gBAAA,CACA,iBAAA,CAGJ,SACI,2BAAA,CAGJ,UAEI,QAAA,CACA,UAAA,CACA,WAAA,CACA,cAAA,CACA,cAAA,CAGJ,6CACI,UAEI,cAAA,CAAA,CAIR,KACI,yCAAA,CACA,gJAAA,CACA,kBAAA,CAGJ,oBACI,gJAAA,CACA,kBAAA,CAGJ,QACI,YAAA,CACA,aAAA,CACA,kBAAA,CACA,iBAAA,CACA,gBAAA,CACA,iBAAA,CACA,cAAA,CACA,+BAAA,CACA,UAAA,CACA,yBAAA,CAGJ,aACI,oBAAA,CAGJ,UACI,kBAAA,CAGJ,kBACI,UAAA,CACA,SAAA,CAGJ,wBACI,YAAA,CAGJ,gBACI,iBAAA,CACA,wBAAA,CACA,WAAA,CACA,UAAA,CACA,cAAA,CACA,iBAAA,CACA,oBAAA,CACA,WAAA,CAGJ,MACI,YAAA,CACA,cAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,eAAA,CAGJ,cACI,kBAAA,CACA,sBAAA,CAGJ,WACI,cAAA,CACA,wBAAA,CACA,sBAAA,CACA,eAAA,CACA,gCAAA,CAGJ,wBACI,kBAAA,CAGJ,eACI,eAAA,CACA,oBAAA,CACA,aAAA,CACA,qBAAA,CACA,iBAAA,CACA,iBAAA,CAGJ,qBACI,eAAA,CACA,eAAA,CACA,WAAA,CACA,UAAA,CACA,kBAAA,CACA,qBAAA,CACA,YAAA,CACA,2BAAA,CAGJ,4BACI,UAAA,CACA,kBAAA,CACA,cAAA,CACA,kBAAA,CACA,eAAA,CAGJ,qBACI,aAAA,CACA,wBAAA,CACA,UAAA,CAGJ,oBACI,UAAA,CACA,kBAAA,CACA,aAAA,CACA,eAAA,CACA,gCAAA,CACA,kBAAA,CACA,YAAA,CACA,SAAA,CACA,qBAAA,CACA,cAAA,CACA,cAAA,CACA,KAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CAGJ,QACI,4BAAA,CACA,aAAA,CAGJ,WACI,YAAA,CACA,UAAA,CACA,eAAA,CACA,mBAAA,CACA,gBAAA,CACA,SAAA,CACA,YAAA,CACA,uBAAA,CACA,cAAA,CACA,qBAAA,CAGJ,gBACI,oBAAA,CAGJ,OACI,kBAAA,CAGJ,cACI,aAAA,CACA,YAAA,CACA,YAAA,CACA,WAAA,CACA,aAAA,CACA,cAAA,CACA,kBAAA,CACA,MAAA,CACA,KAAA,CACA,QAAA,CACA,OAAA,CAGJ,OACI,iBAAA,CACA,MAAA,CACA,KAAA,CACA,eAAA,CAGJ,YACI,eAAA,CAGJ,gBACI,uBAAA,CAGJ,aACI,UAAA,CAGJ,8BACI,cACI,wBAAA,CACA,iBAAA,CAAA,CAKR,aACI,iBAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CAGJ,iBACI,iBAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CAGJ,UACI,UAAA,CACA,WAAA,CACA,aAAA,CACA,UAAA,CAGJ,qBACI,iBAAA,CACA,iBAAA,CACA,UAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,SACI,YAAA,CACA,kBAAA,CACA,mBAAA,CACA,WAAA,CACA,iBAAA,CAGJ,cACI,qBAAA,CACA,WAAA,CACA,OAAA,CACA,0BAAA,CAGJ,eACI,qBAAA,CACA,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,aACI,kBAAA,CACA,QAAA,CACA,SAAA,CACA,0BAAA,CAGJ,gBACI,kBAAA,CACA,QAAA,CACA,YAAA,CACA,0BAAA,CAIJ,iBAEI,sBAAA,CAGJ,iBACI,WAAA,CACA,YAAA,CAGJ,SACI,iBAAA,CACA,yBAAA,CACA,oBAAA,CACA,UAAA,CACA,iBAAA,CACA,WAAA,CAGJ,mBACI,eAAA,CAIJ,kBACI,iBAAA,CACA,YAAA,CACA,cAAA,CACA,kBAAA,CACA,mBAAA,CACA,cAAA,CACA,yBAAA,CACA,WAAA,CACA,QAAA,CACA,0BAAA,CAGJ,iBACI,SAAA,CACA,UAAA,CACA,iBAAA,CACA,oBAAA,CACA,YAAA,CACA,UAAA,CACA,yBAAA,CACA,uBAAA,CACA,2BAAA,CACA,0BAAA,CAGJ,0BACI,aAAA,CAGJ,wBACI,oBAAA,CAGJ,yBACI,iBAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CACA,QAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,+BAAA,CACA,eAAA,CAGJ,gCACI,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,uCACI,WAAA,CACA,SAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,8BAAA,CAGJ,iCACI,YAAA,CACA,aAAA,CACA,OAAA,CACA,0BAAA,CAGJ,wCACI,YAAA,CACA,WAAA,CACA,UAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,6BAAA,CACA,cAAA,CAGJ,kCACI,QAAA,CACA,WAAA,CACA,cAAA,CACA,0BAAA,CAGJ,yCACI,WAAA,CACA,WAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,4BAAA,CACA,kBAAA,CAGJ,0BACI,oBAAA,CAGJ,qFACI,mCAAA,CAGJ,qFACI,mCAAA,CAGJ,gCACI,gBAAA,CAGJ,6CACI,gCACI,cAAA,CAAA,CAIR,YACI,eAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,uBACI,iBAAA,CAGJ,QACI,uBAAA,CAGJ,UACI,WAAA,CAGJ,UACI,6BAAA,CACA,UAAA",sourcesContent:['* {\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    user-select: none;\n    touch-action: none; /* prevent pinch zoom in whole app */\n}\n\ntextarea {\n    -webkit-user-select: initial;\n}\n\nhtml,\nbody{\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    font-size: 40px;\n}\n\n@media (max-width: 400px), (max-height: 400px){\n    html,\n    body{\n        font-size: 28px;\n    }   \n}\n\nbody {\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    line-height: 1.5rem;\n}\n\nbody, input, textarea {\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    line-height: 1.5rem;\n}\n\n.button {\n    width: 1.5rem;\n    height: 1.5rem;\n    line-height: 1.5rem;\n    text-align: center;\n    font-size: 0.75rem;\n    border-radius: 30%;\n    cursor: pointer;\n    background: rgba(255, 255, 255, 0.5);\n    color: black;\n    transition: transform 0.25s;\n}\n\n.button.down {\n    transform: scale(0.9);\n}\n\n.button i{\n    line-height: 1.5rem;\n}\n\n.button .fa-stack{\n    height: 1em;\n    width: 1em;    \n}\n\n.button .fa-stack.fa-fw{\n    width: 1.25em;    \n}\n\n#dropbox-button{\n    border-radius: 3px;\n    background-color: #007ee5;\n    border: none;\n    color: #fff;\n    font-size: 16px;\n    padding: 10px 15px;\n    text-decoration: none;\n    height: 24px;\n}\n\n.view {\n    display: flex;\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    background: #BBB;\n    overflow: hidden;\n}\n\n.dropbox-auth{\n    align-items: center;\n    justify-content: center;\n}\n\n.view.book {\n    flex-wrap: wrap;\n    align-content: flex-start;\n    justify-content: center;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.view.book, .view.book * {\n    touch-action: pan-y;\n}\n\n.view.settings {\n    font-size: 0.5rem;\n    padding: 0.5rem 2.5rem;\n    display: block;\n    box-sizing: border-box;\n    padding-right: 52%;\n    line-height: 1.4em;\n}\n\n.view.settings input{\n    font-size: 0.5rem;\n    line-height: 1em;\n    border: none;\n    width: 100%;\n    border-radius: 0.5em;\n    box-sizing: border-box;\n    padding: 0.5em;\n    -webkit-user-select: initial;\n}\n\n.view.settings .button.text {\n    width: auto;\n    border-radius: 0.5em;\n    padding: 0 0.5em;\n    margin-bottom: 0.5em;\n    text-align: left;\n}\n\n.view.settings label{\n    display: block;\n    text-transform: uppercase;\n    color: grey;\n}\n\n.view.settings #log {\n    width: 50vw;\n    background: #272727;\n    color: #c7c7c7;\n    overflow: scroll;\n    -webkit-overflow-scrolling: touch;\n    touch-action: pan-y;\n    height: 100vh;\n    padding: 0;\n    font-family: monospace;\n    font-size: 12px;\n    position: fixed;\n    top: 0;\n    right: 0;\n    margin: 0;\n    line-height: 20px;\n}\n\n#log li {\n    border-bottom: #444444 solid 1px;\n    padding: 0 1em;\n}\n\n.thumbnail {\n    margin: 0.3rem;\n    color: #CCC;\n    background: white;\n    border-radius: 0.1rem;\n    font-size: 5.6rem;\n    width: 1em;\n    height: 0.75em;\n    background-size: contain;\n    cursor: pointer;\n    transition: opacity 1s;\n}\n\n.thumbnail.down {\n    transform: scale(0.9);\n}\n\n.paint{\n    align-items: center;\n}\n\n.paint #sheet {\n    font-size: 1px;\n    width: 1024em;\n    height: 768em;\n    margin: auto;\n    overflow: auto;\n    position: fixed;\n    object-fit: contain;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n}\n\n.layer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    background: none;\n}\n\n#base-layer {\n    background: white;\n}\n\n.layer.floating{\n    outline: 2px dashed black;\n}\n\n#stamp-layer{\n    opacity: 0.2;\n}\n\n@media (orientation: portrait) {\n    .paint #sheet {\n        transform: rotate(-90deg);\n        overflow-x: hidden;\n    }\n}\n\n\n.button.back {\n    position: absolute;\n    top: 0.25rem;\n    left: 0.25rem;\n    z-index: 100;\n}\n\n.button.settings {\n    position: absolute;\n    right: 0.25rem;\n    top: 0.25rem;\n    z-index: 100;\n}\n\n.button a{\n    width: 100%;\n    height: 100%;\n    display: block;\n    color: black;    \n}\n\n.button#stamp-button{\n    font-size: 1.25rem;\n    position: absolute;\n    top: 0.25rem;\n    right: 0.25rem;\n    width: 2rem;\n    height: 2rem;\n    z-index: 100;\n    line-height: 1.85rem;\n}\n\n.toolbar {\n    display: flex;\n    background: lightgray;\n    border-radius: 0.5rem;\n    z-index: 100;\n    position: absolute;\n}\n\n.toolbar.left {\n    flex-direction: column;\n    left: 0.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.right {\n    flex-direction: column;\n    right: 0.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.top {\n    flex-direction: row;\n    left: 50%;\n    top: 0.25em;\n    transform: translateX(-50%);\n}\n\n.toolbar.bottom {\n    flex-direction: row;\n    left: 50%;\n    bottom: 0.25em;\n    transform: translateX(-50%);\n}\n\n\n.toolbar .button {\n    /*display: inline-block;*/\n    background: transparent;\n}\n\n.toolbar .spacer {\n    width: 1.5em;\n    height: 1.5em;\n}\n\n.palette {\n    position: relative;\n    transition: transform 0.25s;\n    display: inline-block;\n    float: left;\n    text-align: center;\n    z-index: 100;\n}\n\n.palette .option i {\n    font-size: 0.75em;\n}\n\n/* down direction is default: */\n.palette .options{\n    position: absolute;\n    display: flex;\n    flex-wrap: wrap;\n    background: lightgray;\n    border-radius: 0.5rem;\n    padding: 0.25rem;\n    transition: transform 0.15s;\n    top: 2.25rem;\n    left: 50%;\n    transform: translateX(-50%);\n}\n\n.palette .option {\n    width: 1em;\n    height: 1em;\n    line-height: 0.75em;\n    display: inline-block;\n    margin: 0.25em;\n    float: left;\n    transition: transform 0.25s;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n}\n\n.palette .options .option {\n    margin: 0.125em;\n}\n\n.palette .option:active {\n    transform: scale(0.9);\n}\n\n.palette .options .arrow {\n    position: absolute;\n    width: 0;\n    height: 0;\n    font-size: 0.25rem;\n    top: -2em;\n    left: 50%;\n    margin-left: -1em;\n    border-left: 1em solid transparent;\n    border-right: 1em solid transparent;\n    border-bottom: 2em solid lightgray;\n    border-top: none;\n}\n\n.toolbar.left .palette .options{\n    left: 2.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.left .palette .options .arrow {\n    top: initial;\n    left: -2em;\n    top: 50%;\n    margin-top: -1em;\n    border-top: 1em solid transparent;\n    border-bottom: 1em solid transparent;\n    border-right: 2em solid lightgray;\n}\n\n.toolbar.right .palette .options{\n    left: initial;\n    right: 2.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.right .palette .options .arrow {\n    left: initial;\n    top: initial;\n    right: -2em;\n    top: 50%;\n    margin-top: -1em;\n    border-top: 1em solid transparent;\n    border-bottom: 1em solid transparent;\n    border-left: 2em solid lightgray;\n    border-right: 0;\n}\n\n.toolbar.bottom .palette .options{\n    left: 50%;\n    top: initial;\n    bottom: 2.25rem;\n    transform: translateX(-50%);\n}\n\n.toolbar.bottom .palette .options .arrow {\n    top: initial;\n    bottom: -2em;\n    left: 50%;\n    margin-left: -1em;\n    border-left: 1em solid transparent;\n    border-right: 1em solid transparent;\n    border-top: 2em solid lightgray;\n    border-bottom: none;\n}\n\n.palette.collapsed:active {\n    transform: scale(0.9);\n}\n\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\n    transform: translateX(-50%) scale(0.0);\n}\n\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\n    transform: translateY(-50%) scale(0.0);\n}\n\n#stamp-palette.palette .options{\n    font-size: 1.5rem;\n}\n\n@media (max-width: 400px), (max-height: 400px){\n    #stamp-palette.palette .options{\n        font-size: 1rem;\n    }\n}\n\n.line-width{\n    background: black;\n    height: 100%;\n    margin: auto;\n    border-radius: 0.15em;\n}\n\n#color-palette .option {\n    border-radius: 40%;\n}\n\n.hidden {\n    display: none!important;\n}\n\n.disabled {\n    opacity: 0.25;\n}\n\n.selected {\n    background: #58b0ff!important;\n    color: white;\n}\n'],sourceRoot:""}]),e.Z=a},920:function(t,e,n){"use strict";n.r(e);var r=n(3379),i=n.n(r),o=n(4583);i()(o.Z,{insert:"head",singleton:!1}),e.default=o.Z.locals||{}},3906:function(){}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={id:r,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}n.m=t,n.x=function(){},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t={179:0},e=[[8781,196]],r=function(){},i=function(i,o){for(var a,s,[u,c,l,h]=o,f=0,p=[];f<u.length;f++)s=u[f],n.o(t,s)&&t[s]&&p.push(t[s][0]),t[s]=0;for(a in c)n.o(c,a)&&(n.m[a]=c[a]);for(l&&l(n),i&&i(o);p.length;)p.shift()();return h&&e.push.apply(e,h),r()},o=self.webpackChunkweb_paint=self.webpackChunkweb_paint||[];function a(){for(var r,i=0;i<e.length;i++){for(var o=e[i],a=!0,s=1;s<o.length;s++){var u=o[s];0!==t[u]&&(a=!1)}a&&(e.splice(i--,1),r=n(n.s=o[0]))}return 0===e.length&&(n.x(),n.x=function(){}),r}o.forEach(i.bind(null,0)),o.push=i.bind(null,o.push.bind(o));var s=n.x;n.x=function(){return n.x=s||function(){},(r=a)()}}(),n.x()}();
//# sourceMappingURL=main.5e262ccd168870f7b8e7.js.map