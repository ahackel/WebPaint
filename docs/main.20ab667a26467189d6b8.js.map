{"version":3,"sources":["webpack://web-paint/./src/css/painter.css","webpack://web-paint/./src/css/painter.css?effd","webpack://web-paint/./src/ts/CanvasLayer.ts","webpack://web-paint/./src/ts/History.ts","webpack://web-paint/./src/ts/ImageLayer .ts","webpack://web-paint/./src/ts/Layer.ts","webpack://web-paint/./src/ts/Toolbar.ts","webpack://web-paint/./src/ts/app.ts","webpack://web-paint/./src/ts/config.ts","webpack://web-paint/./src/ts/math/Vector.ts","webpack://web-paint/./src/ts/palettes/ColorPalette.ts","webpack://web-paint/./src/ts/palettes/Palette.ts","webpack://web-paint/./src/ts/palettes/ShapePalette.ts","webpack://web-paint/./src/ts/palettes/SizePalette.ts","webpack://web-paint/./src/ts/storage/ImageStorage.ts","webpack://web-paint/./src/ts/storage/LocalForageAdapter.ts","webpack://web-paint/./src/ts/storage/StorageAdapter.ts","webpack://web-paint/./src/ts/tools/PenTool.ts","webpack://web-paint/./src/ts/tools/SelectionTool.ts","webpack://web-paint/./src/ts/tools/Tool.ts","webpack://web-paint/./src/ts/utils/Rect.ts","webpack://web-paint/./src/ts/utils/Utils.ts","webpack://web-paint/./src/ts/views/BookView.ts","webpack://web-paint/./src/ts/views/PaintView.ts","webpack://web-paint/./src/ts/views/SettingsView.ts","webpack://web-paint/./src/ts/views/Thumbnail.ts","webpack://web-paint/./src/ts/views/View.ts","webpack://web-paint/webpack/bootstrap","webpack://web-paint/webpack/runtime/compat get default export","webpack://web-paint/webpack/runtime/define property getters","webpack://web-paint/webpack/runtime/global","webpack://web-paint/webpack/runtime/hasOwnProperty shorthand","webpack://web-paint/webpack/runtime/make namespace object","webpack://web-paint/webpack/runtime/jsonp chunk loading","webpack://web-paint/webpack/startup"],"names":[],"mappings":"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AAkB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,sBAAsB,YAAY;AACjD;AACA;AACA;AACA,eAAe,sBAAsB,YAAY;AACjD;AACA;AACA;AACA,eAAe;;;;;;;;;;;AC/BF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,eAAe;AACf,iBAAiB,mBAAO,CAAC,oCAAU;AACnC;AACA;AACA;AACA;AACA;AACA,mBAAmB,2BAA2B;AAC9C,mBAAmB,iDAAiD;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;AC3CF;AACb;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,gCAAgC,mBAAO,CAAC,kCAAS;AACjD;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;AChBF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,iBAAiB,mBAAO,CAAC,oCAAU;AACnC,2BAA2B,mBAAO,CAAC,8CAAe;AAClD,iCAAiC,mBAAO,CAAC,8CAAe;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,MAAM;AAC7C,wCAAwC,OAAO;AAC/C;AACA;AACA;AACA;AACA;AACA,cAAc,yBAAyB;AACvC,iBAAiB,oBAAoB;AACrC;AACA;AACA;AACA;AACA,iBAAiB,oBAAoB;AACrC;AACA,kBAAkB,qBAAqB;AACvC;AACA,oBAAoB,uBAAuB;AAC3C,oBAAoB,uBAAuB;AAC3C,iBAAiB,oBAAoB;AACrC,oBAAoB,qDAAqD;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,MAAM;AAC7C,wCAAwC,OAAO;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD,WAAW,MAAM,WAAW,aAAa,SAAS,aAAa,MAAM,eAAe,MAAM;AAC/I,8CAA8C,UAAU;AACxD,gDAAgD,UAAU;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACnSF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,eAAe;AACf,eAAe,mBAAO,CAAC,4CAAc;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACpBF;AACb;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,mBAAO,CAAC,iDAAoB;AAC5B,+BAA+B,mBAAO,CAAC,uGAAmC;AAC1E,+BAA+B,mBAAO,CAAC,uGAAmC;AAC1E;AACA;AACA,mBAAO,CAAC,kEAAgB;AACxB,mCAAmC,mBAAO,CAAC,oDAAkB;AAC7D,oBAAoB,mBAAO,CAAC,sDAAmB;AAC/C,iBAAiB,mBAAO,CAAC,oCAAU;AACnC,uCAAuC,mBAAO,CAAC,4DAAsB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,iBAAiB;AACzD,oCAAoC,2EAA2E;AAC/G;AACA;AACA,yCAAyC,wBAAwB;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;ACzFY;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,uCAAuC;AAC/D,wBAAwB,wCAAwC;AAChE,wBAAwB,wCAAwC;AAChE,wBAAwB;AACxB;AACA;;;;;;;;;;;AClCa;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACpGF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,kBAAkB,mBAAO,CAAC,+CAAW;AACrC;AACA,iBAAiB,4BAA4B;AAC7C,sBAAsB,6BAA6B;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;AClCF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,eAAe;AACf,eAAe,mBAAO,CAAC,6CAAe;AACtC,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,4BAA4B;AACrD;AACA;AACA;AACA;AACA,0BAA0B,2CAA2C;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,sDAAsD;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,MAAM;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACnJF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,kBAAkB,mBAAO,CAAC,+CAAW;AACrC,uBAAuB,mBAAO,CAAC,iEAAyB;AACxD,iBAAiB,mBAAO,CAAC,qCAAW;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,iBAAiB,4BAA4B;AAC7C;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,gDAAgD,OAAO;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,eAAe;;;;;;;;;;;ACzDF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,kBAAkB,mBAAO,CAAC,+CAAW;AACrC;AACA,gBAAgB,4BAA4B;AAC5C,qBAAqB,6BAA6B;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;AChBF;AACb;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,oBAAoB;AACpB,mBAAO,CAAC,0DAAc;AACtB,6CAA6C,mBAAO,CAAC,oEAAsB;AAC3E,gCAAgC,mBAAO,CAAC,gDAAO;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsC,eAAe;AACrD,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,sBAAsB;AACvE;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,GAAG,MAAM,MAAM;AACvD;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,oBAAoB;;;;;;;;;;;AC/KP;AACb;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,sCAAsC,mBAAO,CAAC,mEAAa;AAC3D,yCAAyC,mBAAO,CAAC,4DAAkB;AACnE;AACA;AACA;AACA,iEAAiE,qBAAqB;AACtF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;AC/BF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D;AACA;AACA,eAAe;;;;;;;;;;;ACJF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,+BAA+B,mBAAO,CAAC,sCAAQ;AAC/C,iCAAiC,mBAAO,CAAC,+CAAgB;AACzD,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,cAAc;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,6BAA6B;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,WAAW;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,gBAAgB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,iBAAiB;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,QAAQ;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACvMF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,+BAA+B,mBAAO,CAAC,sCAAQ;AAC/C,iCAAiC,mBAAO,CAAC,+CAAgB;AACzD,+BAA+B,mBAAO,CAAC,6CAAe;AACtD,uBAAuB,mBAAO,CAAC,iEAAyB;AACxD,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD,iBAAiB,mBAAO,CAAC,qCAAW;AACpC,qBAAqB,mBAAO,CAAC,mEAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,0BAA0B,sDAAsD;AAChF,qBAAqB,wBAAwB;AAC7C,gCAAgC,mCAAmC;AACnE;AACA;AACA;AACA;AACA,6BAA6B,gCAAgC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,sBAAsB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+B,WAAW;AAC1C,gDAAgD,GAAG;AACnD;AACA;AACA,SAAS;AACT;AACA;AACA,mGAAmG,kBAAkB;AACrH;AACA;AACA;AACA;AACA,wCAAwC,uBAAuB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0C,iBAAiB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC;AACA,wBAAwB;AACxB,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACpQF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,4BAA4B;AAC7C;AACA,mBAAmB,8BAA8B;AACjD,qBAAqB,gCAAgC;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wDAAwD,cAAc;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB,gBAAgB;AAChB,cAAc;AACd,uBAAuB;AACvB,iBAAiB;AACjB,oBAAoB;AACpB;AACA,eAAe;;;;;;;;;;;AC3CF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,eAAe;AAC/B,gBAAgB,eAAe;AAC/B,gBAAgB,4BAA4B;AAC5C,gBAAgB,6BAA6B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACpBF;AACb;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,kBAAkB,GAAG,4BAA4B,GAAG,iBAAiB,GAAG,qBAAqB,GAAG,kBAAkB,GAAG,iBAAiB,GAAG,aAAa,GAAG,YAAY,GAAG,wBAAwB,GAAG,oBAAoB,GAAG,gBAAgB,GAAG,WAAW,GAAG,0BAA0B,GAAG,8BAA8B,GAAG,mBAAmB,GAAG,cAAc,GAAG,mBAAmB;AACnX,iBAAiB,mBAAO,CAAC,qCAAW;AACpC,+BAA+B,mBAAO,CAAC,sCAAQ;AAC/C,iCAAiC,mBAAO,CAAC,+CAAgB;AACzD,iBAAiB,mBAAO,CAAC,8DAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA,yCAAyC,cAAc;AACvD;AACA;AACA;AACA,KAAK;AACL;AACA,mBAAmB;AACnB;AACA;AACA;AACA,8BAA8B;AAC9B;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,WAAW;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS,sBAAsB;AAC/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,aAAa;AACjC,wBAAwB,YAAY;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,mBAAmB,YAAY;AAC/B,uBAAuB,eAAe;AACtC;AACA;AACA;AACA;AACA;AACA,+BAA+B,OAAO;AACtC;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,WAAW;AAC9B,uBAAuB,gBAAgB;AACvC;AACA;AACA;AACA;AACA;AACA,gCAAgC,OAAO;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;;;;;;;;;;;ACtaL;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,eAAe,mBAAO,CAAC,sCAAQ;AAC/B,iBAAiB,mBAAO,CAAC,qCAAW;AACpC,oCAAoC,mBAAO,CAAC,gDAAa;AACzD,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,gCAAgC;AACvD,oCAAoC,gCAAgC;AACpE;AACA;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACrDF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA;AACA,4CAA4C;AAC5C;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,iBAAiB;AACjB,eAAe,mBAAO,CAAC,sCAAQ;AAC/B,uCAAuC,mBAAO,CAAC,mEAA0B;AACzE,sCAAsC,mBAAO,CAAC,iEAAyB;AACvE,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD,kCAAkC,mBAAO,CAAC,mDAAkB;AAC5D,iCAAiC,mBAAO,CAAC,+CAAgB;AACzD,kBAAkB,mBAAO,CAAC,yDAAqB;AAC/C,uBAAuB,mBAAO,CAAC,iEAAyB;AACxD,iBAAiB,mBAAO,CAAC,qCAAW;AACpC,uCAAuC,mBAAO,CAAC,mEAA0B;AACzE,sCAAsC,mBAAO,CAAC,+CAAgB;AAC9D,qCAAqC,mBAAO,CAAC,+CAAgB;AAC7D,wCAAwC,mBAAO,CAAC,+DAAwB;AACxE,kBAAkB,mBAAO,CAAC,uCAAY;AACtC,kBAAkB,mBAAO,CAAC,uCAAY;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C,WAAW,KAAK,YAAY;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,oBAAoB;AACrC,iBAAiB,oBAAoB;AACrC,mBAAmB,sBAAsB;AACzC,qBAAqB,wBAAwB;AAC7C,uBAAuB,0BAA0B;AACjD,6BAA6B,qBAAqB;AAClD,qBAAqB,mCAAmC;AACxD,wBAAwB,sCAAsC;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,cAAc;AAC/E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uCAAuC,QAAQ;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;;;;;;;;;;ACvjBJ;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,+DAA+D,gBAAgB,EAAE,EAAE;AAC9G;AACA,mCAAmC,MAAM,6BAA6B,EAAE,YAAY,WAAW,EAAE;AACjG,kCAAkC,MAAM,iCAAiC,EAAE,YAAY,WAAW,EAAE;AACpG,+BAA+B,qFAAqF;AACpH;AACA,KAAK;AACL;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,eAAe,mBAAO,CAAC,sCAAQ;AAC/B,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD,uBAAuB,mBAAO,CAAC,iEAAyB;AACxD,wBAAwB;AACxB,qBAAqB,mBAAO,CAAC,6EAAkB;AAC/C,qBAAqB,mBAAO,CAAC,mEAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,iEAAiE;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,QAAQ;AAC7C;AACA,iDAAiD,6BAA6B;AAC9E,SAAS;AACT;AACA;AACA,eAAe;;;;;;;;;;;ACxEF;AACb;AACA;AACA,kCAAkC,oCAAoC,aAAa,EAAE,EAAE;AACvF,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA,yCAAyC,6BAA6B;AACtE,CAAC;AACD;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8CAA6C,CAAC,cAAc,EAAC;AAC7D,2BAA2B,mBAAO,CAAC,+CAAgB;AACnD,uBAAuB,mBAAO,CAAC,iEAAyB;AACxD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB,YAAY;AACZ;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,cAAc,yBAAyB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,6BAA6B,iBAAiB;AAC9C;AACA;AACA,6BAA6B,eAAe;AAC5C;AACA;AACA;AACA;AACA,eAAe;;;;;;;;;;;ACxFF;AACb,8CAA6C,CAAC,cAAc,EAAC;AAC7D,YAAY;AACZ;AACA;AACA;AACA;AACA,4DAA4D,GAAG;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;;;;;;;UC7BZ;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;WC5BA;WACA;WACA;WACA,cAAc,0BAA0B,EAAE;WAC1C,cAAc,eAAe;WAC7B,gCAAgC,YAAY;WAC5C;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,EAAE;WACF;WACA;WACA,CAAC,I;;;;;WCPD,6CAA6C,wDAAwD,E;;;;;WCArG;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;WCNA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA,MAAM,oBAAoB;WAC1B;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;;WAEA;WACA;WACA;;WAEA;WACA;WACA;;WAEA;WACA;WACA,eAAe,4BAA4B;WAC3C;WACA;WACA,gBAAgB,2BAA2B;WAC3C;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,kDAAkD;WAClD;WACA,E;;;;UCpFA;UACA","file":"main.20ab667a26467189d6b8.js","sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"* {\\n  -webkit-touch-callout: none;\\n  -webkit-user-select: none;\\n  user-select: none;\\n  touch-action: none;\\n  /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n  -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody {\\n  margin: 0;\\n  width: 100%;\\n  height: 100%;\\n  position: fixed;\\n  font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px) {\\n  html,\\nbody {\\n    font-size: 28px;\\n  }\\n}\\nbody {\\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\\n  font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n  line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n  font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n  line-height: 1.5rem;\\n}\\n\\n.button {\\n  width: 1.5rem;\\n  height: 1.5rem;\\n  line-height: 1.5rem;\\n  text-align: center;\\n  font-size: 0.75rem;\\n  border-radius: 30%;\\n  cursor: pointer;\\n  background: rgba(255, 255, 255, 0.5);\\n  color: black;\\n  transition: transform 0.25s;\\n}\\n\\n.button.down {\\n  transform: scale(0.9);\\n}\\n\\n.button i {\\n  line-height: 1.5rem;\\n}\\n\\n#dropbox-button {\\n  border-radius: 3px;\\n  background-color: #007ee5;\\n  border: none;\\n  color: #fff;\\n  font-size: 16px;\\n  padding: 10px 15px;\\n  text-decoration: none;\\n  height: 24px;\\n}\\n\\n.view {\\n  display: flex;\\n  position: fixed;\\n  width: 100%;\\n  height: 100%;\\n  background: #BBB;\\n  overflow: hidden;\\n}\\n\\n.dropbox-auth {\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.view.book {\\n  flex-wrap: wrap;\\n  align-content: flex-start;\\n  justify-content: center;\\n  overflow-y: auto;\\n  -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n  touch-action: pan-y;\\n}\\n\\n.view.settings {\\n  font-size: 0.5rem;\\n  padding: 2rem;\\n  display: block;\\n  box-sizing: border-box;\\n  padding-right: 52%;\\n  line-height: 1.4em;\\n}\\n\\n.view.settings .button.text {\\n  width: auto;\\n  border-radius: 0.5em;\\n  padding: 0 0.5em;\\n  margin-right: 0.5em;\\n  margin-bottom: 0.5em;\\n}\\n\\n.view.settings label {\\n  display: block;\\n  text-transform: uppercase;\\n  color: grey;\\n}\\n\\n.view.settings #log {\\n  width: 50vw;\\n  background: #272727;\\n  color: #c7c7c7;\\n  overflow: scroll;\\n  -webkit-overflow-scrolling: touch;\\n  touch-action: pan-y;\\n  height: 100vh;\\n  padding: 0;\\n  font-family: monospace;\\n  font-size: 12px;\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  margin: 0;\\n  line-height: 20px;\\n}\\n\\n#log li {\\n  border-bottom: #444444 solid 1px;\\n  padding: 0 1em;\\n}\\n\\n.thumbnail {\\n  margin: 0.3rem;\\n  color: #CCC;\\n  background: white;\\n  border-radius: 0.1rem;\\n  font-size: 5.6rem;\\n  width: 1em;\\n  height: 0.75em;\\n  background-size: contain;\\n  cursor: pointer;\\n  transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n  transform: scale(0.9);\\n}\\n\\n.paint {\\n  align-items: center;\\n}\\n\\n.paint #sheet {\\n  font-size: 1px;\\n  width: 1024em;\\n  height: 768em;\\n  margin: auto;\\n  overflow: auto;\\n  position: fixed;\\n  object-fit: contain;\\n  left: 0;\\n  top: 0;\\n  bottom: 0;\\n  right: 0;\\n}\\n\\n.layer {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  background: none;\\n}\\n\\n#base-layer {\\n  background: white;\\n}\\n\\n.layer.floating {\\n  outline: 2px dashed black;\\n}\\n\\n#stamp-layer {\\n  opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n  .paint #sheet {\\n    transform: rotate(-90deg);\\n    overflow-x: hidden;\\n  }\\n}\\n.button.back {\\n  position: absolute;\\n  top: 0.25rem;\\n  left: 0.25rem;\\n  z-index: 100;\\n}\\n\\n.button.settings {\\n  position: absolute;\\n  right: 0.25rem;\\n  top: 0.25rem;\\n  z-index: 100;\\n}\\n\\n.button a {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  color: black;\\n}\\n\\n.button#stamp-button {\\n  font-size: 1.25rem;\\n  position: absolute;\\n  top: 0.25rem;\\n  right: 0.25rem;\\n  width: 2rem;\\n  height: 2rem;\\n  z-index: 100;\\n  line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n  display: flex;\\n  background: lightgray;\\n  border-radius: 0.5rem;\\n  z-index: 100;\\n  position: absolute;\\n}\\n\\n.toolbar.left {\\n  flex-direction: column;\\n  left: 0.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n  flex-direction: column;\\n  right: 0.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n  flex-direction: row;\\n  left: 50%;\\n  top: 0.25em;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n  flex-direction: row;\\n  left: 50%;\\n  bottom: 0.25em;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar .button {\\n  /*display: inline-block;*/\\n  background: transparent;\\n}\\n\\n.toolbar .spacer {\\n  width: 1.5em;\\n  height: 1.5em;\\n}\\n\\n.palette {\\n  position: relative;\\n  transition: transform 0.25s;\\n  display: inline-block;\\n  float: left;\\n  text-align: center;\\n  z-index: 100;\\n}\\n\\n.palette .option i {\\n  font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options {\\n  position: absolute;\\n  display: flex;\\n  flex-wrap: wrap;\\n  background: lightgray;\\n  border-radius: 0.5rem;\\n  padding: 0.25rem;\\n  transition: transform 0.15s;\\n  top: 2.25rem;\\n  left: 50%;\\n  transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n  width: 1em;\\n  height: 1em;\\n  line-height: 0.75em;\\n  display: inline-block;\\n  margin: 0.25em;\\n  float: left;\\n  transition: transform 0.25s;\\n  background-size: contain;\\n  background-repeat: no-repeat;\\n  background-position: center;\\n}\\n\\n.palette .options .option {\\n  margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n  transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  font-size: 0.25rem;\\n  top: -2em;\\n  left: 50%;\\n  margin-left: -1em;\\n  border-left: 1em solid transparent;\\n  border-right: 1em solid transparent;\\n  border-bottom: 2em solid lightgray;\\n  border-top: none;\\n}\\n\\n.toolbar.left .palette .options {\\n  left: 2.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n  top: initial;\\n  left: -2em;\\n  top: 50%;\\n  margin-top: -1em;\\n  border-top: 1em solid transparent;\\n  border-bottom: 1em solid transparent;\\n  border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options {\\n  left: initial;\\n  right: 2.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n  left: initial;\\n  top: initial;\\n  right: -2em;\\n  top: 50%;\\n  margin-top: -1em;\\n  border-top: 1em solid transparent;\\n  border-bottom: 1em solid transparent;\\n  border-left: 2em solid lightgray;\\n  border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options {\\n  left: 50%;\\n  top: initial;\\n  bottom: 2.25rem;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n  top: initial;\\n  bottom: -2em;\\n  left: 50%;\\n  margin-left: -1em;\\n  border-left: 1em solid transparent;\\n  border-right: 1em solid transparent;\\n  border-top: 2em solid lightgray;\\n  border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n  transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n  transform: translateX(-50%) scale(0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n  transform: translateY(-50%) scale(0);\\n}\\n\\n#stamp-palette.palette .options {\\n  font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px) {\\n  #stamp-palette.palette .options {\\n    font-size: 1rem;\\n  }\\n}\\n.line-width {\\n  background: black;\\n  height: 100%;\\n  margin: auto;\\n  border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n  border-radius: 40%;\\n}\\n\\n.hidden {\\n  display: none !important;\\n}\\n\\n.disabled {\\n  opacity: 0.25;\\n}\\n\\n.selected {\\n  background: #58b0ff !important;\\n  color: white;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./painter.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"* {\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    user-select: none;\\n    touch-action: none; /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n    -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody{\\n    margin: 0;\\n    width: 100%;\\n    height: 100%;\\n    position: fixed;\\n    font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    html,\\n    body{\\n        font-size: 28px;\\n    }   \\n}\\n\\nbody {\\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\n.button {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    text-align: center;\\n    font-size: 0.75rem;\\n    border-radius: 30%;\\n    cursor: pointer;\\n    background: rgba(255, 255, 255, 0.5);\\n    color: black;\\n    transition: transform 0.25s;\\n}\\n\\n.button.down {\\n    transform: scale(0.9);\\n}\\n\\n.button i{\\n    line-height: 1.5rem;\\n}\\n\\n#dropbox-button{\\n    border-radius: 3px;\\n    background-color: #007ee5;\\n    border: none;\\n    color: #fff;\\n    font-size: 16px;\\n    padding: 10px 15px;\\n    text-decoration: none;\\n    height: 24px;\\n}\\n\\n.view {\\n    display: flex;\\n    position: fixed;\\n    width: 100%;\\n    height: 100%;\\n    background: #BBB;\\n    overflow: hidden;\\n}\\n\\n.dropbox-auth{\\n    align-items: center;\\n    justify-content: center;\\n}\\n\\n.view.book {\\n    flex-wrap: wrap;\\n    align-content: flex-start;\\n    justify-content: center;\\n    overflow-y: auto;\\n    -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n    touch-action: pan-y;\\n}\\n\\n.view.settings {\\n    font-size: 0.5rem;\\n    padding: 2rem;\\n    display: block;\\n    box-sizing: border-box;\\n    padding-right: 52%;\\n    line-height: 1.4em;\\n}\\n\\n.view.settings .button.text {\\n    width: auto;\\n    border-radius: 0.5em;\\n    padding: 0 0.5em;\\n    margin-right: 0.5em;\\n    margin-bottom: 0.5em;\\n}\\n\\n.view.settings label{\\n    display: block;\\n    text-transform: uppercase;\\n    color: grey;\\n}\\n\\n.view.settings #log {\\n    width: 50vw;\\n    background: #272727;\\n    color: #c7c7c7;\\n    overflow: scroll;\\n    -webkit-overflow-scrolling: touch;\\n    touch-action: pan-y;\\n    height: 100vh;\\n    padding: 0;\\n    font-family: monospace;\\n    font-size: 12px;\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    margin: 0;\\n    line-height: 20px;\\n}\\n\\n#log li {\\n    border-bottom: #444444 solid 1px;\\n    padding: 0 1em;\\n}\\n\\n.thumbnail {\\n    margin: 0.3rem;\\n    color: #CCC;\\n    background: white;\\n    border-radius: 0.1rem;\\n    font-size: 5.6rem;\\n    width: 1em;\\n    height: 0.75em;\\n    background-size: contain;\\n    cursor: pointer;\\n    transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n    transform: scale(0.9);\\n}\\n\\n.paint{\\n    align-items: center;\\n}\\n\\n.paint #sheet {\\n    font-size: 1px;\\n    width: 1024em;\\n    height: 768em;\\n    margin: auto;\\n    overflow: auto;\\n    position: fixed;\\n    object-fit: contain;\\n    left: 0;\\n    top: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.layer {\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    background: none;\\n}\\n\\n#base-layer {\\n    background: white;\\n}\\n\\n.layer.floating{\\n    outline: 2px dashed black;\\n}\\n\\n#stamp-layer{\\n    opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n    .paint #sheet {\\n        transform: rotate(-90deg);\\n        overflow-x: hidden;\\n    }\\n}\\n\\n\\n.button.back {\\n    position: absolute;\\n    top: 0.25rem;\\n    left: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button.settings {\\n    position: absolute;\\n    right: 0.25rem;\\n    top: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button a{\\n    width: 100%;\\n    height: 100%;\\n    display: block;\\n    color: black;    \\n}\\n\\n.button#stamp-button{\\n    font-size: 1.25rem;\\n    position: absolute;\\n    top: 0.25rem;\\n    right: 0.25rem;\\n    width: 2rem;\\n    height: 2rem;\\n    z-index: 100;\\n    line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n    display: flex;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    z-index: 100;\\n    position: absolute;\\n}\\n\\n.toolbar.left {\\n    flex-direction: column;\\n    left: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n    flex-direction: column;\\n    right: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n    flex-direction: row;\\n    left: 50%;\\n    top: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n    flex-direction: row;\\n    left: 50%;\\n    bottom: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n\\n.toolbar .button {\\n    /*display: inline-block;*/\\n    background: transparent;\\n}\\n\\n.toolbar .spacer {\\n    width: 1.5em;\\n    height: 1.5em;\\n}\\n\\n.palette {\\n    position: relative;\\n    transition: transform 0.25s;\\n    display: inline-block;\\n    float: left;\\n    text-align: center;\\n    z-index: 100;\\n}\\n\\n.palette .option i {\\n    font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options{\\n    position: absolute;\\n    display: flex;\\n    flex-wrap: wrap;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    padding: 0.25rem;\\n    transition: transform 0.15s;\\n    top: 2.25rem;\\n    left: 50%;\\n    transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n    width: 1em;\\n    height: 1em;\\n    line-height: 0.75em;\\n    display: inline-block;\\n    margin: 0.25em;\\n    float: left;\\n    transition: transform 0.25s;\\n    background-size: contain;\\n    background-repeat: no-repeat;\\n    background-position: center;\\n}\\n\\n.palette .options .option {\\n    margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n    transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n    position: absolute;\\n    width: 0;\\n    height: 0;\\n    font-size: 0.25rem;\\n    top: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-bottom: 2em solid lightgray;\\n    border-top: none;\\n}\\n\\n.toolbar.left .palette .options{\\n    left: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n    top: initial;\\n    left: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options{\\n    left: initial;\\n    right: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n    left: initial;\\n    top: initial;\\n    right: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-left: 2em solid lightgray;\\n    border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options{\\n    left: 50%;\\n    top: initial;\\n    bottom: 2.25rem;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n    top: initial;\\n    bottom: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-top: 2em solid lightgray;\\n    border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n    transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n    transform: translateX(-50%) scale(0.0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n    transform: translateY(-50%) scale(0.0);\\n}\\n\\n#stamp-palette.palette .options{\\n    font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    #stamp-palette.palette .options{\\n        font-size: 1rem;\\n    }\\n}\\n\\n.line-width{\\n    background: black;\\n    height: 100%;\\n    margin: auto;\\n    border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n    border-radius: 40%;\\n}\\n\\n.hidden {\\n    display: none!important;\\n}\\n\\n.disabled {\\n    opacity: 0.25;\\n}\\n\\n.selected {\\n    background: #58b0ff!important;\\n    color: white;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/resolve-url-loader/index.js!../../node_modules/sass-loader/dist/cjs.js!./painter.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = require(\"./config\");\nconst Layer_1 = __importDefault(require(\"./Layer\"));\nclass CanvasLayer extends Layer_1.default {\n    constructor(parent, id, x, y, width, height) {\n        super(parent, \"canvas\", id, x, y, width, height);\n        this._ctx = this.canvas.getContext(\"2d\", { alpha: true });\n        this._ctx.imageSmoothingQuality = \"high\";\n        this._ctx.imageSmoothingEnabled = config_1.config.imageSmoothing;\n    }\n    get canvas() { return this._element; }\n    get ctx() { return this._ctx; }\n    getData() {\n        return this._ctx.getImageData(0, 0, this.width, this.height);\n    }\n    putData(data) {\n        this._ctx.putImageData(data, 0, 0);\n    }\n    drawImage(image, rect) {\n        const { x, y, width, height } = rect || { x: 0, y: 0, width: this.width, height: this.height };\n        this._ctx.drawImage(image, x, y, width, height);\n    }\n    clear(rect) {\n        const { x, y, width, height } = rect || { x: 0, y: 0, width: this.width, height: this.height };\n        this._ctx.clearRect(x, y, width, height);\n    }\n}\nexports.default = CanvasLayer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.History = void 0;\nconst config_1 = require(\"./config\");\nclass History {\n    constructor() {\n        this._states = [];\n        this._position = -1;\n    }\n    get canUndo() { return this._position > 0; }\n    get canRedo() { return this._position < this._states.length - 1; }\n    recordState(data) {\n        if (this._position == config_1.config.maxUndoSteps - 1) {\n            this._states.shift();\n            this._position--;\n        }\n        // remove all future steps\n        this._states.splice(this._position + 1, this._states.length - this._position + 1);\n        this._position++;\n        this._states[this._position] = data;\n    }\n    undo() {\n        if (!this.canUndo) {\n            return null;\n        }\n        this._position--;\n        return this._states[this._position];\n    }\n    redo() {\n        if (!this.canRedo) {\n            return null;\n        }\n        this._position++;\n        return this._states[this._position];\n    }\n    getCurrentState() {\n        return this._position > -1 && this._position < this._states.length ? this._states[this._position] : null;\n    }\n    clear() {\n        this._states = [];\n        this._position = -1;\n    }\n}\nexports.History = History;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Layer_1 = __importDefault(require(\"./Layer\"));\nclass ImageLayer extends Layer_1.default {\n    get image() { return this._element; }\n    constructor(parent, id, x, y, width, height) {\n        super(parent, \"img\", id, x, y, width, height);\n        this._element.onload = () => {\n            // if this.image.completed\n            this.resize(this.image.naturalWidth, this.image.naturalHeight);\n        };\n    }\n}\nexports.default = ImageLayer;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = require(\"./config\");\nconst Utils = __importStar(require(\"./utils/Utils\"));\nconst Vector_1 = __importDefault(require(\"./math/Vector\"));\nclass Layer {\n    constructor(parent, tag, id, x, y, width, height) {\n        this._startScale = 1;\n        this._startRotation = 0;\n        this._position = new Vector_1.default(0, 0);\n        this._scale = 1;\n        this._rotation = 0;\n        this._lastTouchStartTime = 0;\n        this._pointers = [];\n        this._element = document.createElement(tag);\n        this._element.id = id;\n        this._element.classList.add(\"layer\");\n        this._index = 0;\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this._element.style.pointerEvents = \"none\";\n        parent.appendChild(this._element);\n        this.transform(new Vector_1.default(x, y), 1, 0);\n        this.bindEventListeners();\n    }\n    get id() { return this._element.id; }\n    get index() { return this._index; }\n    set index(v) {\n        this._index = v;\n        this.transform(this.position, this.scale, this.rotation);\n    }\n    get width() { return this._width; }\n    ;\n    get height() { return this._height; }\n    ;\n    get position() { return this._position; }\n    get rotation() { return this._rotation; }\n    get scale() { return this._scale; }\n    get floating() { return this._element.classList.contains(\"floating\"); }\n    set floating(value) {\n        this._element.classList.toggle(\"floating\", value);\n        this._element.style.pointerEvents = value ? \"auto\" : \"none\";\n        if (value) {\n            this.addEventListeners();\n        }\n        else {\n            this.removeEventListeners();\n        }\n    }\n    remove() {\n        this._element.remove();\n    }\n    resize(width, height) {\n        const x = this.position.x + 0.5 * (this.width - width);\n        const y = this.position.y + 0.5 * (this.height - height);\n        this.setPositionAndSize(x, y, width, height);\n    }\n    setPositionAndSize(x, y, width, height) {\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this.transform(new Vector_1.default(x, y), this.scale, this.rotation);\n    }\n    drawToCanvas(ctx) {\n        ctx.save();\n        let x = this._position.x + 0.5 * this.width;\n        let y = this._position.y + 0.5 * this.height;\n        ctx.setTransform(this._scale, 0, 0, this._scale, x, y);\n        ctx.rotate(this._rotation);\n        ctx.translate(-0.5 * this.width, -0.5 * this.height);\n        ctx.drawImage(this._element, 0, 0);\n        ctx.restore();\n    }\n    addEventListeners() {\n        // pinch gesture handling inspired by https://codepen.io/hanseklund/pen/izloq\n        this._element.addEventListener('click', this.preventDefault);\n        if (Utils.pointerEventsSupported()) {\n            this._element.addEventListener('touchstart', this.preventDefault);\n            this._element.addEventListener('pointerdown', this.pointerDown);\n        }\n        else {\n            this._element.addEventListener('touchstart', this.touchStart);\n        }\n    }\n    removeEventListeners() {\n        this._element.removeEventListener('click', this.preventDefault);\n        if (Utils.pointerEventsSupported()) {\n            this._element.removeEventListener('touchstart', this.preventDefault);\n            this._element.removeEventListener('pointerdown', this.pointerDown);\n        }\n        else {\n            this._element.removeEventListener('touchstart', this.touchStart);\n        }\n    }\n    preventDefault(event) {\n        event.preventDefault();\n    }\n    doubleTap(event) {\n        if (this.onDoubleTap) {\n            this.onDoubleTap(event);\n        }\n    }\n    pointerDown(event) {\n        event.preventDefault();\n        this._element.setPointerCapture(event.pointerId);\n        this.addPointerEvent(event);\n        if (this._pointers.length === 1) {\n            if (event.timeStamp < this._lastTouchStartTime + config_1.config.doubleTapDelay) {\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            this._element.addEventListener(\"pointermove\", this.pointerMove);\n            this._element.addEventListener(\"pointerup\", this.pointerUp);\n            this._pinchCenter = new Vector_1.default(this._position.x + 0.5 * this.width, this._position.y + 0.5 * this.height);\n            if (event.altKey) {\n                let p1 = this.clientToPixel(this._pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else {\n                this.dragStart(this.clientToPixel(this._pointers[0]));\n            }\n        }\n        if (this._pointers.length === 2) {\n            this.pinchStart(this.clientToPixel(this._pointers[0]), this.clientToPixel(this._pointers[1]));\n        }\n    }\n    addPointerEvent(event) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index < 0) {\n            this._pointers.push(event);\n        }\n        else {\n            this._pointers[index] = event;\n        }\n    }\n    removePointerEvent(event) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index >= 0) {\n            this._pointers.splice(index, 1);\n        }\n    }\n    pointerMove(event) {\n        event.preventDefault();\n        this.addPointerEvent(event);\n        this.move(this._pointers, event.altKey);\n    }\n    pointerUp(event) {\n        event.preventDefault();\n        this._element.releasePointerCapture(event.pointerId);\n        this.removePointerEvent(event);\n        if (this._pointers.length == 1) {\n            this.dragStart(this.clientToPixel(this._pointers[0]));\n        }\n        if (this._pointers.length == 0) {\n            this._element.removeEventListener(\"pointermove\", this.pointerMove);\n            this._element.removeEventListener(\"pointerup\", this.pointerUp);\n        }\n    }\n    touchStart(event) {\n        event.preventDefault();\n        if (event.touches.length === 1) {\n            if (event.timeStamp < this._lastTouchStartTime + config_1.config.doubleTapDelay) {\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            this._element.addEventListener('touchmove', this.touchMove);\n            this._element.addEventListener('touchend', this.touchEnd);\n            this._pinchCenter = new Vector_1.default(this._position.x + 0.5 * this.width, this._position.y + 0.5 * this.height);\n            if (event.altKey) {\n                let p1 = this.clientToPixel(event.touches[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else {\n                this.dragStart(this.clientToPixel(event.touches[0]));\n            }\n        }\n        if (event.touches.length === 2) {\n            this.pinchStart(this.clientToPixel(event.touches[0]), this.clientToPixel(event.touches[1]));\n        }\n    }\n    touchMove(event) {\n        event.preventDefault();\n        this.move(event.touches, event.altKey);\n    }\n    move(pointers, altKey) {\n        if (pointers.length === 1) {\n            if (altKey) {\n                let p1 = this.clientToPixel(pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchMove(p1, p2);\n            }\n            else {\n                this.dragMove(this.clientToPixel(pointers[0]));\n            }\n        }\n        if (pointers.length === 2) {\n            this.pinchMove(this.clientToPixel(pointers[0]), this.clientToPixel(pointers[1]));\n        }\n    }\n    touchEnd(event) {\n        event.preventDefault();\n        this._element.removeEventListener('touchmove', this.touchMove);\n        this._element.addEventListener('touchend', this.touchEnd);\n    }\n    transform(position, scale, rotation) {\n        this._position = position;\n        this._rotation = rotation;\n        this._scale = scale;\n        const index = this._index;\n        this._element.style.transform = `translate(${position.x}em, ${position.y}em) rotate(${rotation}rad) scale(${scale}) translateZ(${index}px)`;\n        this._element.style.outlineWidth = `${2 / scale}em`;\n        this._element.style.outlineOffset = `-${2 / scale}em`;\n    }\n    bindEventListeners() {\n        // TODO: Find a better way. This is ugly:\n        this.touchStart = this.touchStart.bind(this);\n        this.touchMove = this.touchMove.bind(this);\n        this.touchEnd = this.touchEnd.bind(this);\n        this.pointerDown = this.pointerDown.bind(this);\n        this.pointerMove = this.pointerMove.bind(this);\n        this.pointerUp = this.pointerUp.bind(this);\n    }\n    dragStart(position) {\n        this._localDragPosition = position.clone().subtract(this.position);\n    }\n    dragMove(position) {\n        position.subtract(this._localDragPosition);\n        this.transform(position, this._scale, this._rotation);\n    }\n    pinchStart(p1, p2) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        this._pinchStartDist = p1.distanceTo(p2);\n        this._pinchStartRotation = Math.atan2(p1.y - center.y, p1.x - center.x);\n        this._startRotation = this._rotation;\n        this._startScale = this._scale;\n    }\n    pinchMove(p1, p2) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        let distance = p1.distanceTo(p2);\n        let angle = Math.atan2(p1.y - center.y, p1.x - center.x);\n        let angleChange = angle - this._pinchStartRotation;\n        let scale = this._startScale * (distance / this._pinchStartDist);\n        scale = Utils.clamp(0.1, 10, scale);\n        let position = p1.clone().add(p2).multiplyScalar(0.5);\n        position.x -= 0.5 * this.width;\n        position.y -= 0.5 * this.height;\n        let rotation = this._startRotation + angleChange;\n        this.transform(position, scale, rotation);\n    }\n    clientToPixel(position1) {\n        let parent = this._element.parentElement;\n        let rect = parent.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (position1.clientX - rect.left) / rect.width;\n        let ny = (position1.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * config_1.config.width;\n        let y = (isPortraitOrientation ? nx : ny) * config_1.config.height;\n        return new Vector_1.default(x, y);\n    }\n}\nexports.default = Layer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Toolbar = void 0;\nconst View_1 = require(\"./views/View\");\nclass Toolbar extends View_1.View {\n    constructor(id) {\n        super(id);\n        this.show();\n    }\n    flip() {\n        if (this._element.classList.contains(\"left\") || this._element.classList.contains(\"right\")) {\n            this._element.classList.toggle(\"left\");\n            this._element.classList.toggle(\"right\");\n        }\n        if (this._element.classList.contains(\"top\") || this._element.classList.contains(\"bottom\")) {\n            this._element.classList.toggle(\"top\");\n            this._element.classList.toggle(\"bottom\");\n        }\n    }\n}\nexports.Toolbar = Toolbar;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire('../css/painter.css');\nconst fontawesome_svg_core_1 = require(\"@fortawesome/fontawesome-svg-core\");\nconst free_solid_svg_icons_1 = require(\"@fortawesome/free-solid-svg-icons\");\nfontawesome_svg_core_1.library.add(free_solid_svg_icons_1.fas);\nfontawesome_svg_core_1.dom.watch();\nrequire(\"babel-polyfill\");\nconst BookView_1 = __importDefault(require(\"./views/BookView\"));\nconst PaintView_1 = require(\"./views/PaintView\");\nconst config_1 = require(\"./config\");\nconst SettingsView_1 = __importDefault(require(\"./views/SettingsView\"));\nclass App {\n    constructor() {\n        // App.preventOverScroll();\n        //PeerToPeer.createInstance();\n        this._settingsView = new SettingsView_1.default(\"settings\", () => {\n            this.openView(this._bookView);\n        });\n        this._sheet = document.getElementById(\"sheet\");\n        window.addEventListener('resize', event => {\n            this.OnResize();\n        });\n        this.OnResize();\n        this._bookView = new BookView_1.default(\"book\", () => __awaiter(this, void 0, void 0, function* () {\n            this.openView(this._settingsView);\n        }));\n        this._bookView.onImageSelected = (id) => {\n            this._paintView.loadImage(id)\n                .then(() => {\n                this.openView(this._paintView);\n            });\n        };\n        this._paintView = new PaintView_1.PaintView(\"paint\", () => {\n            this.openView(this._bookView);\n        });\n        // Dropbox integration is not working yet:\n        // this.dropboxAuthView = new DropboxAuthView(\"dropbox-auth\");\n        // this.openView(ImageStorage.adapter.isAuthenticated ? this.bookView : this.dropboxAuthView);\n        this.openView(this._bookView);\n    }\n    getIOSVersion() {\n        if (/iP(hone|od|ad)/.test(navigator.platform)) {\n            // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n            var v = (navigator.appVersion).match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || \"0\", 10)];\n        }\n    }\n    OnResize() {\n        const docWidth = document.documentElement.clientWidth;\n        const docHeight = document.documentElement.clientHeight;\n        const portrait = docWidth < docHeight;\n        const isLargeScreen = docWidth > 1024;\n        const viewWidth = Math.max(docWidth, docHeight);\n        const viewHeight = Math.min(docWidth, docHeight);\n        const horizontalPixelSize = viewWidth / config_1.config.width;\n        const verticalPixelSize = viewHeight / config_1.config.height;\n        const virtualPixelSize = config_1.config.fullScreenCanvas && !isLargeScreen ?\n            Math.max(horizontalPixelSize, verticalPixelSize) :\n            Math.min(horizontalPixelSize, verticalPixelSize);\n        this._sheet.style.fontSize = `${virtualPixelSize}px`;\n        this._sheet.style.left = `${portrait ? 0.5 * (docWidth - virtualPixelSize * config_1.config.width) : 0}px`;\n    }\n    static preventOverScroll() {\n        document.ontouchmove = event => { event.preventDefault(); };\n    }\n    openView(view) {\n        if (this._activeView) {\n            this._activeView.hide();\n        }\n        this._activeView = view;\n        this._activeView.show();\n    }\n}\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    // @ts-ignore\n    window.app = new App();\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.config = void 0;\nconst defaultShapes = [\n    \"img/stamps/star.png\",\n    \"img/stamps/unicorn.png\",\n    \"img/stamps/snowman.png\",\n    \"img/stamps/dolphin.png\",\n    \"img/stamps/snail.png\"\n];\nexports.config = {\n    debug: true,\n    doubleTapDelay: 400,\n    longClickDelay: 1000,\n    minScrollDistance: 30,\n    maxScrollDelay: 500,\n    maxShapeCount: 64 - defaultShapes.length,\n    usePointerEvents: true,\n    fullScreenCanvas: true,\n    pixelPerfect: false,\n    imageSmoothing: true,\n    useAutoMask: false,\n    maxUndoSteps: 10,\n    saveInterval: 5000,\n    width: 1024,\n    height: 768,\n    defaultShapes: defaultShapes,\n    imageCount: 32,\n    images: {\n        \"image01.png\": { overlay: \"./img/overlays/spirit.png\" },\n        \"image02.png\": { overlay: \"./img/overlays/spirit2.png\" },\n        \"image03.png\": { overlay: \"./img/overlays/spirit3.png\" },\n        \"image04.png\": { overlay: \"./img/overlays/santa.png\" }\n    }\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Utils = __importStar(require(\"../utils/Utils\"));\nclass Vector {\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    set(x = 0, y = x) {\n        this.x = x;\n        this.y = y;\n        return this;\n    }\n    clone() {\n        return new Vector(this.x, this.y);\n    }\n    add(v) {\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    }\n    subtract(v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    }\n    round() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n    clamp(minX, minY, maxX, maxY) {\n        this.x = Utils.clamp(minX, maxX, this.x);\n        this.y = Utils.clamp(minY, maxY, this.y);\n        return this;\n    }\n    invert() {\n        this.x *= -1;\n        this.y *= -1;\n        return this;\n    }\n    ;\n    multiplyScalar(s) {\n        this.x *= s;\n        this.y *= s;\n        return this;\n    }\n    ;\n    divideScalar(s) {\n        if (s === 0) {\n            this.x = 0;\n            this.y = 0;\n        }\n        else {\n            var invScalar = 1 / s;\n            this.x *= invScalar;\n            this.y *= invScalar;\n        }\n        return this;\n    }\n    ;\n    length() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    normalize() {\n        return this.divideScalar(this.length());\n    }\n    distanceToSq(v) {\n        const dx = this.x - v.x, dy = this.y - v.y;\n        return dx * dx + dy * dy;\n    }\n    distanceTo(v) {\n        return Math.sqrt(this.distanceToSq(v));\n    }\n    lerp(v, alpha) {\n        this.x += (v.x - this.x) * alpha;\n        this.y += (v.y - this.y) * alpha;\n        return this;\n    }\n    ;\n}\nexports.default = Vector;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nclass ColorPalette extends Palette_1.Palette {\n    get color() { return this.selectedOption; }\n    set color(value) { this.selectedOption = value; }\n    constructor(id) {\n        // 16 color Mac palette\n        // https://en.wikipedia.org/wiki/List_of_software_palettes#Apple_Macintosh_default_16-color_palette\n        // let colors: string[] = [\n        //     \"#FFFFFF\", \"#f5f60d\", \"#f5650a\", \"#d50406\",\n        //     \"#f50695\", \"#330496\", \"#0306c5\", \"#0692f0\",\n        //     \"#06a606\", \"#026405\", \"#643403\", \"#946434\",\n        //     \"#b5b5b5\", \"#848484\", \"#444444\", \"#030303\",\n        // ];\n        // 32 color palette\n        // https://github.com/geoffb/dawnbringer-palettes\n        let colors = [\n            \"#000000\", \"#222034\", \"#45283c\", \"#663931\",\n            \"#8f563b\", \"#df7126\", \"#d9a066\", \"#eec39a\",\n            \"#fbf236\", \"#99e550\", \"#6abe30\", \"#37946e\",\n            \"#4b692f\", \"#524b24\", \"#323c39\", \"#3f3f74\",\n            \"#306082\", \"#5b6ee1\", \"#639bff\", \"#5fcde4\",\n            \"#cbdbfc\", \"#ffffff\", \"#9badb7\", \"#847e87\",\n            \"#696a6a\", \"#595652\", \"#76428a\", \"#ac3232\",\n            \"#d95763\", \"#d77bba\", \"#8f974a\", \"#8a6f30\",\n        ];\n        super(id, colors);\n        this.selectedIndex = 15;\n    }\n    updateOptionElement(element, option) {\n        element.style.background = option;\n    }\n}\nexports.default = ColorPalette;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Palette = void 0;\nconst View_1 = require(\"../views/View\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\n// base class for palettes\nclass Palette extends View_1.View {\n    constructor(id, options, rightAlign = false) {\n        super(id);\n        this._options = options;\n        this._optionElements = [];\n        this._selectedIndex = 0;\n        this.createOptions();\n        this.show();\n        this.collapse();\n    }\n    get selectedIndex() { return this._selectedIndex; }\n    set selectedIndex(value) {\n        this._selectedIndex = Math.max(0, Math.min(this._options.length - 1, value));\n        this.updateSelectedOptionElement(this._selectedElement, this.selectedOption);\n    }\n    get selectedOption() { return this._options[this._selectedIndex]; }\n    set selectedOption(value) {\n        let index = this._options.indexOf(value);\n        if (index === -1) {\n            return;\n        }\n        this.selectedIndex = index;\n    }\n    get isCollapsed() { return this._element.classList.contains(\"collapsed\"); }\n    static collapseAll() {\n        if (Palette._expandedPalette) {\n            Palette._expandedPalette.collapse();\n        }\n    }\n    createOptions() {\n        this.addSelectedOption();\n        this.addOptionElements();\n    }\n    recreateOptions() {\n        this.clear();\n        this.createOptions();\n    }\n    collapse() {\n        this._element.classList.add(\"collapsed\");\n        if (Palette._expandedPalette == this) {\n            Palette._expandedPalette = null;\n        }\n    }\n    expand() {\n        Palette.collapseAll();\n        this._element.classList.remove(\"collapsed\");\n        Palette._expandedPalette = this;\n    }\n    toggle() {\n        if (this.isCollapsed) {\n            this.expand();\n        }\n        else {\n            this.collapse();\n        }\n    }\n    addOption(value) {\n        this._options.push(value);\n        this.addOptionElement(this._options.length - 1, value);\n        this.updateOptionsWidth();\n    }\n    removeOption(index) {\n        this._options.splice(index, 1);\n        this._optionElements[index].remove();\n        this._optionElements.splice(index, 1);\n        // update the index assigned to each element:\n        this.recreateOptions();\n    }\n    addSelectedOption() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"option\");\n        this._selectedElement = element;\n        Utils.addClick(element, () => this.toggle());\n        this.updateSelectedOptionElement(element, this.selectedOption);\n        this._element.appendChild(element);\n    }\n    addOptionElements() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"options\");\n        this._optionsElement = element;\n        this.addArrowElement();\n        let i = 0;\n        for (let option of this._options) {\n            this.addOptionElement(i, option);\n            i++;\n        }\n        this.updateOptionsWidth();\n        this._element.appendChild(element);\n    }\n    updateOptionsWidth() {\n        this._optionsElement.style.width = Math.min(8, this._options.length) * 1.25 + \"em\";\n    }\n    addArrowElement() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"arrow\");\n        this._optionsElement.appendChild(element);\n    }\n    addOptionElement(index, option) {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"option\");\n        element.dataset.index = `${index}`;\n        Utils.addLongClick(element, event => this.optionLongClicked(event, option, index));\n        Utils.addClick(element, event => this.optionClicked(event, option, index));\n        this.updateOptionElement(element, option);\n        this._optionsElement.appendChild(element);\n        this._optionElements[index] = element;\n    }\n    optionClicked(event, option, index) {\n        this.selectedIndex = index;\n        this.collapse();\n        if (this.onSelectionChanged) {\n            this.onSelectionChanged(option, index);\n        }\n    }\n    optionLongClicked(event, option, index) {\n    }\n    updateOptionElement(element, option) {\n    }\n    updateSelectedOptionElement(element, option) {\n        this.updateOptionElement(element, option);\n    }\n}\nexports.Palette = Palette;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst config_1 = require(\"../config\");\nclass ShapePalette extends Palette_1.Palette {\n    constructor(id) {\n        super(id, config_1.config.defaultShapes, true);\n        this._shapeIds = {};\n        this.selectedIndex = 0;\n        ImageStorage_1.imageStorage.keys()\n            .then((keys) => {\n            const shapesIds = keys.filter(x => x.startsWith(\"shape\"));\n            for (let shapeId of shapesIds) {\n                this.addShapeFromImageId(shapeId);\n            }\n        });\n        ImageStorage_1.imageStorage.addChangeListener((change, id) => {\n            if (change == \"save\" && id.startsWith(\"shape\")) {\n                this.addShapeFromImageId(id);\n            }\n        });\n    }\n    get stamp() { return this.selectedOption; }\n    addShapeFromImageId(stampId) {\n        ImageStorage_1.imageStorage.loadImageUrl(stampId)\n            .then(url => {\n            this._shapeIds[url] = stampId;\n            this.addOption(url);\n        });\n    }\n    optionLongClicked(event, option, index) {\n        this.deleteShape(index);\n    }\n    updateOptionElement(element, option) {\n        element.style.backgroundImage = `url(\"${option}\")`;\n    }\n    updateSelectedOptionElement(element, option) {\n        element.innerHTML = '<i class=\"fas fa-shapes\"></i>';\n    }\n    deleteShape(index) {\n        let option = this._options[index];\n        let stampId = this._shapeIds[option];\n        if (!stampId) {\n            return;\n        }\n        ImageStorage_1.imageStorage.deleteImage(stampId)\n            .then(() => {\n            delete this._shapeIds[option];\n            this.removeOption(index);\n            if (this.selectedIndex == index) {\n                // select the following item that now has the same index\n                this.selectedIndex = index;\n            }\n        });\n    }\n}\nexports.default = ShapePalette;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nclass SizePalette extends Palette_1.Palette {\n    get size() { return this.selectedOption; }\n    set size(value) { this.selectedOption = value; }\n    constructor(id) {\n        let sizes = [2, 8, 24, 40];\n        super(id, sizes, true);\n        this.selectedIndex = 1;\n    }\n    updateOptionElement(element, option) {\n        const width = option / 40;\n        element.innerHTML = '<div class=\"line-width\" style=\"width:' + width + 'em\"></div>';\n    }\n}\nexports.default = SizePalette;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.imageStorage = void 0;\nrequire(\"whatwg-fetch\");\nconst LocalForageAdapter_1 = __importDefault(require(\"./LocalForageAdapter\"));\nconst jszip_1 = __importDefault(require(\"jszip\"));\nclass ImageStorage {\n    get adapter() {\n        if (!this._adapter) {\n            this._adapter = new LocalForageAdapter_1.default();\n            this.migrate();\n        }\n        return this._adapter;\n    }\n    get urls() {\n        if (!this._urls) {\n            this._urls = {};\n        }\n        return this._urls;\n    }\n    loadImage(id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = yield this.loadImageUrl(id);\n            if (!url) {\n                return null;\n            }\n            const img = new Image();\n            img.id = id;\n            img.src = url;\n            if (img.decode != null) {\n                yield img.decode();\n                return img;\n            }\n            return new Promise(resolve => {\n                img.onload = () => resolve(img);\n            });\n        });\n    }\n    loadImageUrl(id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (id in this.urls) {\n                return this.urls[id];\n            }\n            const blob = yield this.loadBlob(id);\n            if (!blob) {\n                return null;\n            }\n            const url = URL.createObjectURL(blob);\n            this.urls[id] = url;\n            return url;\n        });\n    }\n    loadBlob(id) {\n        return this.adapter.getItem(id);\n    }\n    saveImage(id, blob) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                yield this.adapter.setItem(id, blob);\n            }\n            catch (e) {\n            }\n            if (id in this.urls) {\n                URL.revokeObjectURL(this.urls[id]);\n            }\n            this.urls[id] = URL.createObjectURL(blob);\n            this.dispatchChangeEvent(\"save\", id);\n        });\n    }\n    deleteImage(id) {\n        return this.adapter.removeItem(id)\n            .then(() => {\n            if (id in this.urls) {\n                URL.revokeObjectURL(this.urls[id]);\n                delete this.urls[id];\n            }\n            this.dispatchChangeEvent(\"delete\", id);\n        });\n    }\n    keys() {\n        return this.adapter.keys();\n    }\n    addChangeListener(callback) {\n        this._changeListeners = this._changeListeners || [];\n        this._changeListeners.push(callback);\n    }\n    dispatchChangeEvent(change, id) {\n        for (let changeListener of this._changeListeners) {\n            changeListener(change, id);\n        }\n    }\n    clear() {\n        this.adapter.clear();\n    }\n    generateBackupArchive() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let count = 0;\n            var keys = yield this.keys();\n            var zip = new jszip_1.default();\n            for (let id of keys) {\n                const url = yield this.loadImageUrl(id);\n                const blob = yield fetch(url).then(r => r.blob());\n                if (!blob) {\n                    continue;\n                }\n                zip.file(id, blob);\n                count += 1;\n            }\n            if (count == 0) {\n                return;\n            }\n            return zip.generateAsync({ type: \"blob\" });\n        });\n    }\n    importBackupArchive(zipFile) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const zip = yield jszip_1.default.loadAsync(zipFile);\n            zip.forEach((path, file) => __awaiter(this, void 0, void 0, function* () {\n                const buffer = yield file.async(\"arraybuffer\");\n                const blob = new Blob([buffer], { \"type\": \"image/png\" });\n                this.saveImage(file.name, blob);\n            }));\n        });\n    }\n    migrate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let needsRefresh = false;\n            var keys = yield this.keys();\n            for (let id of keys) {\n                if (!id.startsWith(\"image\") && !id.startsWith(\"Shape\")) {\n                    continue;\n                }\n                if (id.endsWith(\".png\")) {\n                    continue;\n                }\n                const newId = id.replace(\"Shape\", \"shape\") + \".png\";\n                const data = yield this.adapter.getItem(id);\n                yield this.adapter.setItem(newId, data);\n                yield this.adapter.removeItem(id);\n                console.log(`Migrated ${id} to ${newId}.`);\n                needsRefresh = true;\n            }\n            if (needsRefresh) {\n                location.reload();\n            }\n        });\n    }\n    getStorageUsed() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let amount = 0;\n            var keys = yield this.keys();\n            for (let id of keys) {\n                const url = yield this.loadImageUrl(id);\n                const blob = yield fetch(url).then(r => r.blob());\n                if (!blob) {\n                    continue;\n                }\n                amount += blob.size;\n            }\n            return amount;\n        });\n    }\n}\nexports.imageStorage = new ImageStorage();\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst localforage_1 = __importDefault(require(\"localforage\"));\nconst StorageAdapter_1 = __importDefault(require(\"./StorageAdapter\"));\nclass LocalForageAdapter extends StorageAdapter_1.default {\n    constructor() {\n        super(...arguments);\n        this._imageStore = localforage_1.default.createInstance({ name: \"ImageStore\" });\n    }\n    getItem(id) {\n        return this._imageStore.getItem(id);\n    }\n    setItem(id, blob) {\n        return this._imageStore.setItem(id, blob);\n    }\n    removeItem(id) {\n        return this._imageStore.removeItem(id);\n    }\n    keys() {\n        return this._imageStore.keys();\n    }\n    iterate(param) {\n        return this._imageStore.iterate(param);\n    }\n    clear() {\n        return this._imageStore.clear();\n    }\n}\nexports.default = LocalForageAdapter;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass StorageAdapter {\n}\nexports.default = StorageAdapter;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Tool_1 = __importDefault(require(\"./Tool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\n// Paints lines with varying stroke width\nclass PenTool extends Tool_1.default {\n    constructor(painter, buttonId, operation = \"darken\") {\n        super(painter, buttonId);\n        this._operation = operation;\n        this.createBrushCtx();\n    }\n    createBrushCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"brush\";\n        brushCanvas.width = 64;\n        brushCanvas.height = 64;\n        this._brushCtx = brushCanvas.getContext(\"2d\", { alpha: true });\n        this._brushCtx.imageSmoothingQuality = \"high\";\n        this._brushCtx.imageSmoothingEnabled = true;\n    }\n    down(data) {\n        this._painter.captureAutoMask(data.position.clone().round());\n        this._points = [data.position];\n        const width = this.getWidth(data.pressure, data.speed);\n        this._widths = [width];\n        this._startIndex = 0;\n        let ctx = this._painter.baseLayer.ctx;\n        ctx.fillStyle = this.color;\n        ctx.strokeStyle = this.color;\n        // let ctx = this._brushCtx;\n        // let brushWidth = ctx.canvas.width;\n        // ctx.clearRect(0, 0, brushWidth, brushWidth);\n        // ctx.fillStyle = this.color;\n        // let radius = brushWidth * 0.5;\n        // ctx.beginPath();\n        // ctx.arc(radius, radius, radius - 1, 0, 2 * Math.PI);\n        // ctx.fill();  \n        this._painter.baseLayer.ctx.globalCompositeOperation = this._operation;\n        this.requestDrawPath();\n    }\n    up() {\n        this._painter.recordHistoryState();\n    }\n    tick(delta) {\n        if (this._drawPathRequested) {\n            this.drawPath();\n            this._drawPathRequested = false;\n        }\n    }\n    requestDrawPath() {\n        this._drawPathRequested = true;\n    }\n    drawPath() {\n        if (this._points.length == 0) {\n            return;\n        }\n        let ctx = this._painter.baseLayer.ctx;\n        this.drawConnectedLines(ctx, this._points.slice(this._startIndex), this._widths.slice(this._startIndex));\n        // if (this._points.length - this._startIndex == 1){\n        //     const p = this._points[this._startIndex];\n        //     this.drawBrush(ctx, p.x, p.y, this._widths[this._startIndex]);\n        //     return;\n        // }\n        //\n        // for (let i = this._startIndex; i < this._points.length - 1; i++) {\n        //     const p1 = this._points[i];\n        //     const p2 = this._points[i+1];\n        //    \n        //     const w1 = this._widths[i];\n        //     const w2 = this._widths[i+1];\n        //\n        //     const dist = Vector.distance(p1, p2);\n        //     const step = Math.max(1, 0.125 * Math.min(w1, w2, 64));\n        //     for (let d = 0; d <= dist; d += step){\n        //         const a = d / dist;\n        //         const p = Vector.lerp(p1, p2, a);\n        //         const w = Utils.lerp(w1, w2, a);\n        //         this.drawBrush(ctx, p.x, p.y, w);\n        //     }\n        // }\n        this._startIndex = Math.max(0, this._points.length - 1);\n    }\n    drawConnectedLines(ctx, points, widths) {\n        const pointCount = points.length;\n        if (pointCount == 0) {\n            return;\n        }\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        let start = points[0];\n        let startWidth = widths[0] * this.lineWidth;\n        if (pointCount == 1) {\n            // single dot\n            ctx.beginPath();\n            ctx.arc(start.x, start.y, 0.5 * startWidth, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n        for (let i = 1; i < pointCount; i++) {\n            ctx.beginPath();\n            ctx.lineWidth = widths[i] * this.lineWidth;\n            ctx.lineTo(points[i - 1].x, points[i - 1].y);\n            ctx.lineTo(points[i].x, points[i].y);\n            ctx.stroke();\n        }\n    }\n    drawBrush(ctx, x, y, width) {\n        let radius = width * 0.5;\n        x -= radius;\n        y -= radius;\n        // x = Math.floor(x - radius);\n        // y = Math.floor(y - radius);\n        // width = Math.ceil(width);\n        ctx.drawImage(this._brushCtx.canvas, x, y, width, width);\n    }\n    move(data) {\n        let newPoints = this.interpolatePoints(data.position);\n        this._points = this._points.concat(newPoints);\n        const numSegments = newPoints.length;\n        let width = this.getWidth(data.pressure, data.speed);\n        const lastWidth = this._widths[this._widths.length - 1];\n        const maxWidthDifferencePerSegment = 2;\n        const maxWidthDifference = maxWidthDifferencePerSegment * numSegments;\n        width = Utils.clamp(lastWidth - maxWidthDifference, lastWidth + maxWidthDifference, width);\n        for (let i = 0; i < numSegments; i++) {\n            this._widths.push(Utils.lerp(lastWidth, width, i / numSegments));\n        }\n        this.requestDrawPath();\n    }\n    interpolatePoints(newPoint) {\n        const segmentLength = Math.max(4, 0.1 * this.lineWidth);\n        const points = [];\n        if (this._points.length == 0) {\n            return;\n        }\n        const start = this._points[this._points.length - 1];\n        const end = newPoint;\n        const dist = start.distanceTo(end);\n        if (dist < segmentLength) {\n            return points;\n        }\n        let control = start;\n        if (this._points.length > 1) {\n            const previous = this._points[this._points.length - 2];\n            const tangent = start.clone().subtract(previous).normalize();\n            control = start.clone().add(tangent.clone().multiplyScalar(0.3 * dist));\n        }\n        const a = segmentLength / dist;\n        for (let i = a; i <= 1; i += a) {\n            const Vector = this.pointOnQuadraticCurve(start, control, end, i);\n            points.push(Vector);\n        }\n        return points;\n    }\n    pointOnQuadraticCurve(start, control, end, a) {\n        const f1 = (1 - a) * (1 - a);\n        const f2 = 2 * a * (1 - a);\n        const f3 = a * a;\n        return new Vector_1.default(start.x * f1 + control.x * f2 + end.x * f3, start.y * f1 + control.y * f2 + end.y * f3);\n    }\n    pressureChanged() {\n        this.requestDrawPath();\n    }\n    getWidth(pressure, speed) {\n        speed = Utils.clamp(1, 2, speed);\n        return pressure / speed; // range: 0.5 - 1\n    }\n    applyAutoMask() {\n        if (!this._painter.autoMaskCtx) {\n            return;\n        }\n        let ctx = this.getBufferCtx();\n        ctx.globalCompositeOperation = \"destination-in\";\n        ctx.drawImage(this._painter.autoMaskCtx.canvas, 0, 0);\n        ctx.globalCompositeOperation = \"source-over\";\n    }\n}\nexports.default = PenTool;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Tool_1 = __importDefault(require(\"./Tool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Rect_1 = __importDefault(require(\"../utils/Rect\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst config_1 = require(\"../config\");\nconst file_saver_1 = require(\"file-saver\");\n// Provides a floating selection the user can manipulate \nclass SelectionTool extends Tool_1.default {\n    constructor(painter, buttonId) {\n        super(painter, buttonId);\n        this.selectionLayerId = \"selection-layer\";\n        this._selection = Rect_1.default.Empty();\n        this._deleteButton = document.getElementById(\"selection-delete-button\");\n        Utils.addClick(this._deleteButton, () => this.clearSelection());\n        this._stampButton = document.getElementById(\"selection-stamp-button\");\n        Utils.addClick(this._stampButton, () => this.paintSelectionToCanvas());\n        this._saveButton = document.getElementById(\"selection-save-button\");\n        Utils.addClick(this._saveButton, () => this.saveSelectionAsNewStamp());\n        this._downloadButton = document.getElementById(\"selection-download-button\");\n        Utils.addClick(this._downloadButton, () => {\n            this.selectionLayer.canvas.toBlob(blob => file_saver_1.saveAs(blob, \"image.png\"));\n        });\n        this.hasFloatingSelection = false;\n        this._position = new Vector_1.default(0, 0);\n    }\n    get selectionLayer() { return this._painter.getLayer(this.selectionLayerId); }\n    get selection() { return this._selection; }\n    get hasFloatingSelection() { return this._hasFloatingSelection; }\n    set hasFloatingSelection(value) {\n        this._hasFloatingSelection = value;\n        this.toggleFloatingSelectionButtons(value);\n    }\n    get isInShapesPalette() { return this._isInShapesPalette; }\n    set isInShapesPalette(value) {\n        this._isInShapesPalette = value;\n        this._saveButton.classList.toggle(\"disabled\", value);\n    }\n    toggleFloatingSelectionButtons(visible) {\n        this._deleteButton.classList.toggle(\"hidden\", !visible);\n        this._stampButton.classList.toggle(\"hidden\", !visible);\n        this._downloadButton.classList.toggle(\"hidden\", !visible);\n        this._saveButton.classList.toggle(\"hidden\", !visible);\n    }\n    enable() {\n        super.enable();\n        this.createSelectionLayer();\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n    }\n    disable() {\n        super.disable();\n        this.paintSelectionToCanvas();\n        this.destroySelectionLayer();\n        this.hasFloatingSelection = false;\n    }\n    down(data) {\n        this._position = this.getClampedPosition(data);\n        this.startNewSelection();\n    }\n    move(data) {\n        this._position = this.getClampedPosition(data);\n        this.requestDrawSelectionOutline();\n    }\n    up(data) {\n        this.cutSelection();\n    }\n    startNewSelection() {\n        this.paintSelectionToCanvas();\n        this.selectionLayer.setPositionAndSize(0, 0, this._painter.width, this._painter.height);\n        this.selectionLayer.transform(new Vector_1.default(0, 0), 1, 0);\n        this.selectionLayer.floating = false;\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n        this._startPosition = this._position;\n        let ctx = this.selectionLayer.ctx;\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\n        ctx.strokeStyle = \"black\";\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        this.requestDrawSelectionOutline();\n    }\n    getClampedPosition(data) {\n        return data.position.round().clamp(0, 0, this._painter.width - 1, this._painter.height - 1);\n    }\n    tick(delta) {\n        if (this._drawSelectionOutlineRequested) {\n            this.updateSelectionAndDrawOutline();\n            this._drawSelectionOutlineRequested = false;\n        }\n    }\n    keyDown(event) {\n        switch (event.code) {\n            case 'Backspace':\n                this.clearSelection();\n                break;\n            // case 'KeyC':\n            //     if (event.metaKey){\n            //         this.copyToClipboard();\n            //     }\n            //     break;\n        }\n    }\n    clearSelection() {\n        this.selectionLayer.clear();\n        this.startNewSelection();\n    }\n    setImage(image) {\n        this.hasFloatingSelection = true;\n        this.selectionLayer.resize(image.width, image.height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.drawImage(image);\n        this.isInShapesPalette = true;\n    }\n    setImageUrl(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const img = new Image();\n            img.src = url;\n            return new Promise(resolve => {\n                img.onload = () => {\n                    this.setImage(img);\n                    resolve(img);\n                };\n            });\n        });\n    }\n    requestDrawSelectionOutline() {\n        this._drawSelectionOutlineRequested = true;\n    }\n    updateSelectionAndDrawOutline() {\n        if (this.hasFloatingSelection) {\n            return;\n        }\n        this.selectionLayer.clear();\n        let ctx = this.selectionLayer.ctx;\n        const x = Math.min(this._startPosition.x, this._position.x);\n        const y = Math.min(this._startPosition.y, this._position.y);\n        const width = Math.abs(this._startPosition.x - this._position.x);\n        const height = Math.abs(this._startPosition.y - this._position.y);\n        this._selection = new Rect_1.default(x, y, width, height);\n        ctx.strokeRect(x, y, width, height);\n    }\n    destroySelectionLayer() {\n        this._painter.removeLayer(this.selectionLayer);\n    }\n    createSelectionLayer() {\n        if (this.selectionLayer) {\n            return;\n        }\n        this._painter.addCanvasLayer(this.selectionLayerId, 0, 0, this._painter.width, this._painter.height, false);\n        this.selectionLayer.onDoubleTap = (event) => {\n            if (event.altKey) {\n                this.saveSelectionAsNewStamp();\n                return;\n            }\n            this.paintSelectionToCanvas();\n        };\n    }\n    cutSelection() {\n        this.selectionLayer.clear();\n        this._selection = Utils.getVisiblePixelFrame(this._painter.baseLayer.ctx, this.selection);\n        if (this.selection.isEmpty()) {\n            return;\n        }\n        this.hasFloatingSelection = true;\n        const { x, y, width, height } = this.selection;\n        this.selectionLayer.setPositionAndSize(x, y, width, height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas, x, y, width, height, 0, 0, width, height);\n        this._painter.baseLayer.clear(this.selection);\n        this._painter.recordHistoryState();\n    }\n    paintSelectionToCanvas() {\n        if (!this.hasFloatingSelection) {\n            return;\n        }\n        this._painter.baseLayer.ctx.globalCompositeOperation = \"source-over\";\n        this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx);\n        this._painter.recordHistoryState();\n    }\n    saveSelectionAsNewStamp() {\n        ImageStorage_1.imageStorage.keys()\n            .then((keys) => {\n            const shapesIds = keys.filter(x => x.startsWith(\"Shape\"));\n            if (shapesIds.length >= config_1.config.maxShapeCount) {\n                console.log(\"Cannot save selection as shape because there are already too many in storage.\");\n                return;\n            }\n            const id = `shape${Date.now()}.png`;\n            console.log(`Saving selection as: ${id}`);\n            this.selectionLayer.canvas.toBlob(blob => ImageStorage_1.imageStorage.saveImage(id, blob));\n            this.isInShapesPalette = true;\n        });\n    }\n    // copyToClipboard(){\n    //     this.selectionLayer.canvas.toBlob(blob => navigator.clipboard.write([new ClipboardItem({'image/png': blob})]));\n    //     console.log(\"copied selection to clipboard\");\n    // }\n    //\n    // pasteFromClipboard() {\n    //     navigator.permissions.query({name: \"clipboard-read\"})\n    //         .then(result => {\n    //             if (!(result.state == \"granted\" || result.state == \"prompt\")) {\n    //                 return;\n    //             }\n    //             navigator.clipboard.read()\n    //                 .then(data => {\n    //                     for (let i = 0; i < data.length; i++) {\n    //                         if (!data[i].types.includes(\"image/png\")){\n    //                             continue;\n    //                         }\n    //                         data[i].getType(\"image/png\")\n    //                             .then(blob => {\n    //                                 this.setImageUrl(URL.createObjectURL(blob));\n    //                             })\n    //                     }\n    //                 });\n    //         });\n    // }\n    selectAll() {\n        this.startNewSelection();\n        this._selection = new Rect_1.default(0, 0, this._painter.width, this._painter.height);\n        this.cutSelection();\n    }\n}\nexports.default = SelectionTool;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// Base class for all tools\nclass Tool {\n    constructor(painter, buttonId) {\n        this._painter = painter;\n        this._buttonElement = document.getElementById(buttonId);\n    }\n    get color() { return this._painter.color; }\n    ;\n    get opacity() { return this._painter.opacity; }\n    get lineWidth() { return this._painter.lineWidth; }\n    ;\n    // creates a context to draw the current stroke to so we can draw the complete stroke with a different\n    // operation. The buffer can be shared by different tools.\n    createBufferCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"buffer\";\n        brushCanvas.width = this._painter.width;\n        brushCanvas.height = this._painter.height;\n        Tool._bufferCtx = brushCanvas.getContext(\"2d\", { alpha: true });\n        Tool._bufferCtx.imageSmoothingQuality = \"high\";\n        Tool._bufferCtx.imageSmoothingEnabled = true;\n    }\n    getBufferCtx() {\n        if (Tool._bufferCtx == null) {\n            this.createBufferCtx();\n        }\n        return Tool._bufferCtx;\n    }\n    enable() {\n        this._buttonElement.classList.add(\"selected\");\n    }\n    disable() {\n        this._buttonElement.classList.remove(\"selected\");\n    }\n    down(data) { }\n    move(data) { }\n    up(data) { }\n    pressureChanged() { }\n    tick(delta) { }\n    keyDown(event) { }\n}\nexports.default = Tool;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Rect {\n    constructor(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    get minX() { return this.x; }\n    get minY() { return this.y; }\n    get maxX() { return this.x + this.width; }\n    get maxY() { return this.y + this.height; }\n    isEmpty() {\n        return this.width <= 0 || this.height <= 0;\n    }\n    static Empty() {\n        return new Rect(0, 0, 0, 0);\n    }\n}\nexports.default = Rect;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.dilateMask = exports.getVisiblePixelFrame = exports.floodFill = exports.stringToColor = exports.lerpCanvas = exports.lerpColor = exports.clamp = exports.lerp = exports.createNewImageId = exports.addLongClick = exports.addClick = exports.log = exports.getImageOverlayUrl = exports.pointerEventsSupported = exports.imageToBlob = exports.upload = exports.formatBytes = void 0;\nconst config_1 = require(\"../config\");\nconst Rect_1 = __importDefault(require(\"./Rect\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Pressure = require('pressure');\n// source:\n// https://stackoverflow.com/questions/15900485/correct-way-to-convert-size-in-bytes-to-kb-mb-gb-in-javascript\nfunction formatBytes(bytes, decimals = 2) {\n    if (bytes === 0)\n        return '0 Bytes';\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\nexports.formatBytes = formatBytes;\nfunction upload(accept) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n            const input = document.createElement('input');\n            input.type = \"file\";\n            input.accept = accept;\n            input.onchange = () => {\n                if (input.files.length == 0) {\n                    return;\n                }\n                let file = input.files[0];\n                resolve(file);\n                input.remove();\n            };\n            input.click();\n        });\n    });\n}\nexports.upload = upload;\nfunction imageToBlob(image) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"imageToCanvas\";\n    canvas.width = image.naturalWidth;\n    canvas.height = image.naturalHeight;\n    const ctx = canvas.getContext(\"2d\", { alpha: true });\n    ctx.drawImage(image, 0, 0);\n    return new Promise(resolve => {\n        canvas.toBlob(blob => resolve(blob));\n    });\n}\nexports.imageToBlob = imageToBlob;\nfunction pointerEventsSupported() {\n    return window.PointerEvent != null;\n}\nexports.pointerEventsSupported = pointerEventsSupported;\nfunction getImageOverlayUrl(id) {\n    var _a;\n    return (_a = config_1.config.images[id]) === null || _a === void 0 ? void 0 : _a.overlay;\n}\nexports.getImageOverlayUrl = getImageOverlayUrl;\nfunction log(message, ...optionalParams) {\n    if (!config_1.config.debug) {\n        return;\n    }\n    console.log(message, optionalParams);\n}\nexports.log = log;\nfunction addClick(element, callback, supportScrolling = false) {\n    let scrollStartX;\n    let scrollStartY;\n    let touchId;\n    let isTracking;\n    let startTimeStamp;\n    let scrolled;\n    element.addEventListener(\"touchstart\", touchStart);\n    element.addEventListener(\"mouseup\", mouseUp);\n    function mouseUp(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        callback.call(event.target, event);\n    }\n    function touchStart(event) {\n        if (!supportScrolling) {\n            event.preventDefault();\n        }\n        if (isTracking || event.touches.length > 1) {\n            return;\n        }\n        const touch = event.changedTouches[0];\n        isTracking = true;\n        touchId = touch.identifier;\n        scrolled = false;\n        scrollStartX = touch.pageX;\n        scrollStartY = touch.pageY;\n        startTimeStamp = event.timeStamp;\n        element.classList.add(\"down\");\n        element.addEventListener(\"touchmove\", touchMove);\n        element.addEventListener(\"touchend\", touchEnd);\n    }\n    function touchMove(event) {\n        if (!supportScrolling) {\n            event.preventDefault();\n        }\n        if (!isTracking) {\n            return;\n        }\n        const touch = event.changedTouches[0];\n        // user dragged out of the element:\n        if (document.elementFromPoint(touch.pageX, touch.pageY) != event.target) {\n            isTracking = false;\n            element.classList.remove(\"down\");\n        }\n        if (scrolled || event.timeStamp < startTimeStamp + config_1.config.maxScrollDelay) {\n            if (supportScrolling &&\n                (Math.abs(touch.pageX - scrollStartX) > config_1.config.minScrollDistance ||\n                    Math.abs(touch.pageY - scrollStartY) > config_1.config.minScrollDistance)) {\n                isTracking = false;\n                element.classList.remove(\"down\");\n            }\n        }\n        // After tapping and holding for a while the element does not start scrolling any more.\n        // In that case we don't want perform the scroll check above any more:\n        if (event.timeStamp < startTimeStamp + config_1.config.maxScrollDelay) {\n            if (Math.abs(touch.pageX - scrollStartX) > 2 ||\n                Math.abs(touch.pageY - scrollStartY) > 2) {\n                scrolled = true;\n            }\n        }\n    }\n    function touchEnd(event) {\n        event.preventDefault();\n        element.removeEventListener(\"touchmove\", touchMove);\n        element.removeEventListener(\"touchend\", touchEnd);\n        element.classList.remove(\"down\");\n        if (!isTracking) {\n            return;\n        }\n        isTracking = false;\n        touchId = null;\n        callback.call(event.target, event);\n    }\n}\nexports.addClick = addClick;\nfunction addLongClick(element, callback) {\n    let timer;\n    let caller = this;\n    let called = false;\n    element.addEventListener(\"touchstart\", down);\n    element.addEventListener(\"touchend\", up);\n    element.addEventListener(\"mousedown\", down);\n    element.addEventListener(\"mouseup\", up);\n    function down(event) {\n        called = false;\n        timer = setTimeout(() => {\n            callback.call(caller, event);\n            called = true;\n        }, config_1.config.longClickDelay);\n    }\n    function up(event) {\n        if (called) {\n            event.stopImmediatePropagation();\n            element.classList.remove(\"down\");\n            called = false;\n        }\n        else {\n            clearTimeout(timer);\n        }\n    }\n}\nexports.addLongClick = addLongClick;\nfunction createNewImageId() {\n    return Date.now().toString();\n}\nexports.createNewImageId = createNewImageId;\nfunction lerp(a, b, alpha) {\n    return a * (1 - alpha) + b * alpha;\n}\nexports.lerp = lerp;\nfunction clamp(lower, upper, n) {\n    return Math.min(upper, Math.max(lower, n));\n}\nexports.clamp = clamp;\nfunction lerpColor(color1, color2, alpha) {\n    if (alpha == 0) {\n        return color1;\n    }\n    if (alpha == 1) {\n        return color2;\n    }\n    const aa = (color1 & 0xff000000) >> 24;\n    const ba = (color1 & 0x00ff0000) >> 16;\n    const ga = (color1 & 0x0000ff00) >> 8;\n    const ra = (color1 & 0x000000ff);\n    const ab = (color2 & 0xff000000) >> 24;\n    const bb = (color2 & 0x00ff0000) >> 16;\n    const gb = (color2 & 0x0000ff00) >> 8;\n    const rb = (color2 & 0x000000ff);\n    const r = Math.floor(lerp(ra, rb, alpha));\n    const g = Math.floor(lerp(ga, gb, alpha));\n    const b = Math.floor(lerp(ba, bb, alpha));\n    const a = 255; //Math.floor(Utils.lerp(aa, ab, alpha));\n    return r + (g << 8) + (b << 16) + 0xFF000000;\n}\nexports.lerpColor = lerpColor;\nfunction lerpCanvas(ctxA, ctxB, ctxMask) {\n    const width = ctxA.canvas.width;\n    const height = ctxA.canvas.height;\n    const dataA = ctxA.getImageData(0, 0, width, height);\n    const dataB = ctxB.getImageData(0, 0, width, height);\n    const dataMask = ctxMask.getImageData(0, 0, width, height);\n    const a32 = new Uint8ClampedArray(dataA.data.buffer);\n    const b32 = new Uint8ClampedArray(dataB.data.buffer);\n    const m32 = new Uint8ClampedArray(dataMask.data.buffer);\n    for (let i = 0; i < width * height; i++) {\n        const a = m32[i * 4 + 3] / 255;\n        a32[i * 4 + 0] = (1 - a) * a32[i * 4 + 0] + a * b32[i * 4 + 0];\n        a32[i * 4 + 1] = (1 - a) * a32[i * 4 + 1] + a * b32[i * 4 + 1];\n        a32[i * 4 + 2] = (1 - a) * a32[i * 4 + 2] + a * b32[i * 4 + 2];\n        a32[i * 4 + 3] = (1 - a) * a32[i * 4 + 3] + a * b32[i * 4 + 3];\n    }\n    ctxA.putImageData(dataA, 0, 0);\n}\nexports.lerpCanvas = lerpCanvas;\nfunction stringToColor(h) {\n    let r = 0, g = 0, b = 0;\n    if (h.length == 4) {\n        r = parseInt(h[1] + h[1], 16);\n        g = parseInt(h[2] + h[2], 16);\n        b = parseInt(h[3] + h[3], 16);\n    }\n    else {\n        r = parseInt(h[1] + h[2], 16);\n        g = parseInt(h[3] + h[4], 16);\n        b = parseInt(h[5] + h[6], 16);\n    }\n    return 0xFF000000 + r + (g << 8) + (b << 16);\n}\nexports.stringToColor = stringToColor;\nfunction floodFill(sourceCtx, mask, startPosition, color) {\n    const threshold = 0.5;\n    const width = sourceCtx.canvas.width;\n    const height = sourceCtx.canvas.height;\n    const sourceData = sourceCtx.getImageData(0, 0, width, height);\n    const sourcePixels = sourceData.data;\n    startPosition = startPosition.clone().round();\n    const startIndex = startPosition.x + startPosition.y * width;\n    // const startR = sourcePixels[startIndex * 4];\n    // const startG = sourcePixels[startIndex * 4 + 1];\n    // const startB = sourcePixels[startIndex * 4 + 2];\n    // const startA = sourcePixels[startIndex * 4 + 3];\n    const startR = parseInt(color[1] + color[2], 16);\n    const startG = parseInt(color[3] + color[4], 16);\n    const startB = parseInt(color[5] + color[6], 16);\n    // take into account that transparent pixels appear white (due to white bg) but their rgb value is 0:\n    // const startBrightness = startA < 5 ? 255 : 0.333 * (startR + startG + startB);\n    const startBrightness = 0.333 * (startR + startG + startB);\n    // clear alpha channel:\n    for (let i = 0; i < width * height; i++) {\n        mask[i * 4 + 3] = 0;\n    }\n    // start at multiple positions around start position:\n    let stack = [];\n    stack.push(startPosition);\n    if (startPosition.x > 1) {\n        stack.push(new Vector_1.default(startPosition.x - 2, startPosition.y));\n    }\n    if (startPosition.x < width - 2) {\n        stack.push(new Vector_1.default(startPosition.x + 2, startPosition.y));\n    }\n    if (startPosition.y > 1) {\n        stack.push(new Vector_1.default(startPosition.x, startPosition.y - 2));\n    }\n    if (startPosition.y < height - 2) {\n        stack.push(new Vector_1.default(startPosition.x, startPosition.y + 2));\n    }\n    while (stack.length > 0) {\n        let pos = stack.pop();\n        if (isBorderPixel(pos.x, pos.y, false)) {\n            continue;\n        }\n        const minX = scanLeft(pos.x, pos.y);\n        const maxX = scanRight(pos.x, pos.y);\n        addToStack(minX, maxX, pos.y - 1);\n        addToStack(minX, maxX, pos.y + 1);\n    }\n    function scanLeft(x, y) {\n        let minX = x;\n        while (minX >= 0) {\n            if (isBorderPixel(minX, y, true)) {\n                break;\n            }\n            minX -= 1;\n        }\n        return minX + 1;\n    }\n    function scanRight(x, y) {\n        let maxX = x + 1;\n        while (maxX < width) {\n            if (isBorderPixel(maxX, y, true)) {\n                break;\n            }\n            maxX += 1;\n        }\n        return maxX - 1;\n    }\n    function addToStack(minX, maxX, y) {\n        if (y < 0 || y >= height) {\n            return;\n        }\n        for (let x = minX; x <= maxX; x++) {\n            if (isBorderPixel(x, y, false)) {\n                continue;\n            }\n            stack.push(new Vector_1.default(x, y));\n        }\n    }\n    function isBorderPixel(x, y, setValue) {\n        const index = (x + y * width) * 4;\n        const indexA = index + 3;\n        if (mask[indexA]) {\n            return true;\n        }\n        const r = sourcePixels[index];\n        const g = sourcePixels[index + 1];\n        const b = sourcePixels[index + 2];\n        const a = sourcePixels[index + 3];\n        //\n        // let difference = Math.max(\n        //     Math.abs(r - startR),\n        //     Math.abs(g - startG),\n        //     Math.abs(b - startB),\n        //     Math.abs(a - startA)\n        // ) / 255;\n        const brightness = 0.333 * (r + g + b);\n        if (a < 250 || brightness >= startBrightness) {\n            if (setValue) {\n                mask[indexA] = 255;\n            }\n            return false;\n        }\n        // if (difference < threshold){\n        //     if (setValue){\n        //         mask[indexA] = 255;\n        //     }\n        //     return false;\n        // }\n        // if (setValue) {\n        //     mask[indexA] = (1 - difference) * 255;\n        // }\n        return true;\n    }\n}\nexports.floodFill = floodFill;\nfunction getVisiblePixelFrame(ctx, rect) {\n    let { x, y, width, height } = rect;\n    if (width <= 0 || height <= 0) {\n        return Rect_1.default.Empty();\n    }\n    const data = ctx.getImageData(x, y, width, height);\n    const pixels = data.data;\n    let minX = width;\n    let maxX = 0;\n    let minY = height;\n    let maxY = 0;\n    for (let cy = 0; cy < height; cy++) {\n        for (let cx = 0; cx < width; cx++) {\n            if (pixels[(cx + cy * width) * 4 + 3]) {\n                minX = cx < minX ? cx : minX;\n                maxX = cx > maxX ? cx : maxX;\n                minY = cy < minY ? cy : minY;\n                maxY = cy > maxY ? cy : maxY;\n            }\n        }\n    }\n    x += minX;\n    y += minY;\n    width = Math.max(0, maxX - minX + 1);\n    height = Math.max(0, maxY - minY + 1);\n    return new Rect_1.default(x, y, width, height);\n}\nexports.getVisiblePixelFrame = getVisiblePixelFrame;\nfunction dilateMask(pixels, width, height) {\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width - 1; x++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4]) {\n                pixels[i] = 255;\n            }\n        }\n        for (let x = width - 1; x > 0; x--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4]) {\n                pixels[i] = 255;\n            }\n        }\n    }\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height - 1; y++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4 * width]) {\n                pixels[i] = 255;\n            }\n        }\n        for (let y = height - 1; y > 0; y--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4 * width]) {\n                pixels[i] = 255;\n            }\n        }\n    }\n}\nexports.dilateMask = dilateMask;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst View_1 = require(\"./View\");\nconst config_1 = require(\"../config\");\nconst Thumbnail_1 = __importDefault(require(\"./Thumbnail\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\nclass BookView extends View_1.View {\n    constructor(id, onSettingsClicked) {\n        super(id);\n        let settingsButton = this._element.getElementsByClassName(\"button settings\")[0];\n        Utils.addClick(settingsButton, () => onSettingsClicked());\n    }\n    show() {\n        super.show();\n        this.updateImages();\n        // PeerToPeer.instance.onDataReceived = (data: ArrayBuffer) => {\n        //     this._thumbnails[0].setImageSrc(URL.createObjectURL(new Blob([data])));\n        // }\n    }\n    updateImages() {\n        if (this._thumbnails) {\n            return;\n        }\n        this._thumbnails = [];\n        for (let i = 0; i < config_1.config.imageCount; i++) {\n            const imageId = `image${(\"\" + (i + 1)).padStart(2, \"0\")}.png`;\n            let thumbnail = new Thumbnail_1.default(this._element, imageId, (id) => this.onImageSelected(id));\n            this._thumbnails.push(thumbnail);\n        }\n    }\n}\nexports.default = BookView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PaintView = void 0;\nconst View_1 = require(\"./View\");\nconst ColorPalette_1 = __importDefault(require(\"../palettes/ColorPalette\"));\nconst SizePalette_1 = __importDefault(require(\"../palettes/SizePalette\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst PenTool_1 = __importDefault(require(\"../tools/PenTool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Palette_1 = require(\"../palettes/Palette\");\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst config_1 = require(\"../config\");\nconst ShapePalette_1 = __importDefault(require(\"../palettes/ShapePalette\"));\nconst CanvasLayer_1 = __importDefault(require(\"../CanvasLayer\"));\nconst ImageLayer_1 = __importDefault(require(\"../ImageLayer \"));\nconst SelectionTool_1 = __importDefault(require(\"../tools/SelectionTool\"));\nconst Toolbar_1 = require(\"../Toolbar\");\nconst History_1 = require(\"../History\");\nclass PaintView extends View_1.View {\n    constructor(id, onBackClicked) {\n        super(id);\n        this.scaleFactor = 1;\n        this._currentTouchId = 0;\n        this._layers = {};\n        this._lastSaveTimestamp = 0;\n        this._history = new History_1.History();\n        this._sheet = document.getElementById(\"sheet\");\n        this.width = config_1.config.width;\n        this.height = config_1.config.height;\n        Utils.log(`Setting PaintView size to ${this.width} x ${this.height}`);\n        this.addCanvasLayer(\"base-layer\", 0, 0, this.width, this.height, false);\n        this.addEventListeners();\n        this.createButtons(onBackClicked);\n        this.createToolbar();\n        this.createPalettes();\n        this.createTools();\n    }\n    get color() { return this._color; }\n    get stamp() { return this._stamp; }\n    get opacity() { return this._opacity; }\n    get lineWidth() { return this._lineWidth; }\n    get autoMaskCtx() { return this._autoMaskCtx; }\n    //get layers(): Layer[] { return this._layers; }\n    get baseLayer() { return this._layers[\"base-layer\"]; }\n    get overlayLayer() { return this._layers[\"overlay-layer\"]; }\n    getLayer(id) {\n        return this._layers[id];\n    }\n    createButtons(onBackClicked) {\n        let backButton = this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n        this._undoButton = document.getElementById(\"undo-button\");\n        Utils.addClick(this._undoButton, () => this.undo());\n        this._redoButton = document.getElementById(\"redo-button\");\n        Utils.addClick(this._redoButton, () => this.redo());\n        this._importImageButton = document.getElementById(\"import-image-button\");\n        Utils.addClick(this._importImageButton, () => __awaiter(this, void 0, void 0, function* () {\n            const blob = yield Utils.upload(\"image/*\");\n            this.setTool(this.selectionTool);\n            const url = URL.createObjectURL(blob);\n            yield this.selectionTool.setImageUrl(url);\n            URL.revokeObjectURL(url);\n        }));\n    }\n    addLayer(layer) {\n        layer.index = Object.keys(this._layers).length;\n        this._layers[layer.id] = layer;\n        return layer;\n    }\n    addImageLayer(id, x, y, width, height, floating) {\n        const layer = new ImageLayer_1.default(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    addCanvasLayer(id, x, y, width, height, floating) {\n        const layer = new CanvasLayer_1.default(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    removeLayer(layer) {\n        if (!layer) {\n            return;\n        }\n        layer.remove();\n        delete this._layers[layer.id];\n    }\n    createOverlay() {\n        if (this.overlayLayer) {\n            return;\n        }\n        this.addLayer(new ImageLayer_1.default(this._sheet, \"overlay-layer\", 0, 0, this.width, this.height));\n    }\n    removeOverlay() {\n        this.removeLayer(this.overlayLayer);\n    }\n    setOverlay(url) {\n        if (!url) {\n            this.removeOverlay();\n            return;\n        }\n        this.createOverlay();\n        this.overlayLayer.image.src = url;\n        //this.processOverlay(this.overlay.ctx);\n        // show processed overlay:\n        // this._overlayCtx.canvas.toBlob(blob => {\n        //     this._overlay.src = URL.createObjectURL(blob);\n        // })\n    }\n    createTools() {\n        let penButton = document.getElementById(\"tool-pen\");\n        Utils.addLongClick(penButton, () => this.fill());\n        Utils.addClick(penButton, () => this.setTool(this.markerTool));\n        let eraserButton = document.getElementById(\"tool-eraser\");\n        Utils.addLongClick(eraserButton, () => this.clear(true));\n        Utils.addClick(eraserButton, () => this.setTool(this.eraserTool));\n        let selectionButton = document.getElementById(\"tool-selection\");\n        Utils.addClick(selectionButton, () => this.setTool(this.selectionTool));\n        Utils.addLongClick(selectionButton, () => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.selectAll();\n        });\n        this._tools = [];\n        // this.brushTool = this.addTool(new PenTool(this, \"tool-\", \"source-over\"));\n        this.markerTool = this.addTool(new PenTool_1.default(this, \"tool-pen\", \"darken\"));\n        this.eraserTool = this.addTool(new PenTool_1.default(this, \"tool-eraser\", \"destination-out\"));\n        this.selectionTool = this.addTool(new SelectionTool_1.default(this, \"tool-selection\"));\n        // this.paintBucketTool = this.addTool(new PaintBucketTool(this));\n        // this._currentTool = this.brushTool;\n        this.setTool(this.markerTool);\n    }\n    addTool(tool) {\n        this._tools.push(tool);\n        return tool;\n    }\n    createToolbar() {\n        this._mainToolbar = new Toolbar_1.Toolbar(\"main-toolbar\");\n        this._contextToolbar = new Toolbar_1.Toolbar(\"context-toolbar\");\n    }\n    createPalettes() {\n        this._sizePalette = new SizePalette_1.default(\"size-palette\");\n        this._sizePalette.onSelectionChanged = (lineWidth) => {\n            this._lineWidth = lineWidth;\n        };\n        this._lineWidth = this._sizePalette.size;\n        this._colorPalette = new ColorPalette_1.default(\"color-palette\");\n        this._colorPalette.onSelectionChanged = (color) => this._color = color;\n        this._color = this._colorPalette.color;\n        this._shapePalette = new ShapePalette_1.default(\"stamp-palette\");\n        this._shapePalette.onSelectionChanged = (stamp) => {\n            this._stamp = stamp;\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImageUrl(this.stamp);\n        };\n        this._stamp = this._shapePalette.stamp;\n        this._opacity = 1;\n    }\n    setTool(tool) {\n        if (this._currentTool == tool) {\n            return;\n        }\n        if (this._currentTool) {\n            this._currentTool.disable();\n        }\n        this._currentTool = tool;\n        if (this._currentTool) {\n            this._currentTool.enable();\n        }\n        this._colorPalette.setVisible(this._currentTool == this.markerTool);\n        this._sizePalette.setVisible(this._currentTool == this.markerTool || this._currentTool == this.eraserTool);\n        // this._shapePalette.setVisible(this._currentTool == this.selectionTool);\n        // this._importImageButton.classList.toggle(\"hidden\", this._currentTool != this.selectionTool);\n    }\n    addEventListeners() {\n        let canvas = this.baseLayer.canvas;\n        canvas.style.pointerEvents = \"auto\";\n        //canvas.addEventListener('keydown', event => this.keyDown(event));\n        document.addEventListener('keydown', event => this.keyDown(event));\n        canvas.addEventListener('click', event => event.preventDefault());\n        if (config_1.config.usePointerEvents && window.PointerEvent != null) {\n            // Required to prevent pointerDown events from being choked when tapping repeatedly: \n            canvas.addEventListener('touchstart', event => {\n                if (event.cancelable) {\n                    event.preventDefault();\n                }\n            });\n            canvas.addEventListener('pointerdown', event => this.pointerDown(event));\n            canvas.addEventListener('pointermove', event => this.pointerMove(event));\n            canvas.addEventListener('pointerup', event => this.pointerUp(event));\n            canvas.addEventListener('pointercancel', event => event.preventDefault());\n        }\n        else {\n            canvas.addEventListener('touchstart', event => this.touchStart(event));\n            canvas.addEventListener('touchmove', event => this.touchMove(event));\n            canvas.addEventListener('touchend', event => this.touchEnd(event));\n            canvas.addEventListener('touchcancel', event => event.preventDefault());\n        }\n        //canvas.addEventListener('touchforcechanged', event => this.pressureChanged(<TouchEvent>event))\n        // Pressure.set(canvas, {\n        //     change: (force: number, event: Event) => this.pressureChanged(force)\n        // })\n    }\n    getPointerEventPosition(event) {\n        let target = event.target;\n        let rect = target.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (event.clientX - rect.left) / rect.width;\n        let ny = (event.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n        if (config_1.config.pixelPerfect) {\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector_1.default(x, y);\n    }\n    getTouchEventPosition(touch) {\n        let rect = this.baseLayer.canvas.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (touch.clientX - rect.left) / rect.width;\n        let ny = (touch.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n        if (config_1.config.pixelPerfect) {\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector_1.default(x, y);\n    }\n    keyDown(event) {\n        if (!this.isVisible()) {\n            return;\n        }\n        switch (event.code) {\n            // case 'KeyV':\n            //     if (event.metaKey){\n            //         this.setTool(this.selectionTool);\n            //         this.selectionTool.pasteFromClipboard();\n            //     }\n            //     break;\n        }\n        if (!this._currentTool) {\n            return;\n        }\n        this._currentTool.keyDown(event);\n    }\n    pointerDown(event) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n        let target = event.target;\n        target.setPointerCapture(event.pointerId);\n        this._currentTouchId = event.pointerId;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector_1.default(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    pointerMove(event) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector_1.default(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    getNormalizedPointerPressure(event) {\n        return event.pointerType == \"pen\" ? Utils.clamp(0.5, 2, event.pressure * 4) : 1;\n    }\n    getNormalizedTouchPressure(touch) {\n        return touch.touchType == \"stylus\" ? Utils.clamp(0.5, 2, touch.force * 4) : 1;\n    }\n    pointerUp(event) {\n        event.preventDefault();\n        if (!event.isPrimary) {\n            return;\n        }\n        let target = event.target;\n        target.releasePointerCapture(event.pointerId);\n        this.up({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: new Vector_1.default(event.width, event.height),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    pressureChanged(force) {\n        // let pressure = Utils.clamp(0.3, 1, force * 2);\n        // this._currentTool.pressure = Math.max(pressure, this._currentTool.pressure);\n        // this._currentTool.pressureChanged();\n    }\n    touchStart(event) {\n        event.preventDefault();\n        if (this._currentTouchId !== 0) {\n            return;\n        }\n        const touch = event.targetTouches[0];\n        this._currentTouchId = touch.identifier;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector_1.default(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    touchMove(event) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch == null) {\n            return;\n        }\n        console.log(touch.force);\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector_1.default(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    touchEnd(event) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch != null) {\n            // current touch is still in the list of target touches, this means it has not ended yet\n            return;\n        }\n        this.up({\n            timeStamp: event.timeStamp,\n            position: new Vector_1.default(0, 0),\n            radius: new Vector_1.default(0, 0),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    static findTouch(touches, id) {\n        for (let i = 0; i < touches.length; i++) {\n            if (touches[i].identifier == id) {\n                return touches[i];\n            }\n        }\n        return null;\n    }\n    move(data) {\n        if (!this._currentTool) {\n            return;\n        }\n        let delta = this._lastPointerData.position.distanceTo(data.position);\n        if (delta <= 1) {\n            return;\n        }\n        this._lastPointerData = this._lastPointerData || data;\n        let timeDelta = data.timeStamp - this._lastPointerData.timeStamp;\n        const speed = delta / timeDelta;\n        data.speed = Utils.lerp(this._lastPointerData.speed, speed, 0.2);\n        this._lastPointerData = data;\n        this._currentTool.move(data);\n    }\n    down(data) {\n        Palette_1.Palette.collapseAll();\n        if (!this._currentTool) {\n            return;\n        }\n        this._lastPointerData = data;\n        this._currentTool.down(data);\n    }\n    up(data) {\n        if (!this._currentTool) {\n            return;\n        }\n        this._lastPointerData = data;\n        this._currentTool.up(data);\n    }\n    clear(recordHistoryState = false) {\n        this.baseLayer.clear();\n        if (recordHistoryState) {\n            this.recordHistoryState();\n        }\n    }\n    fill() {\n        this.baseLayer.ctx.fillStyle = this.color;\n        this.baseLayer.ctx.fillRect(0, 0, this.width, this.height);\n        this.recordHistoryState();\n    }\n    ResetHistory() {\n        this._history.clear();\n        this.recordHistoryState();\n        this.updateUndoButtons();\n    }\n    recordHistoryState() {\n        this._history.recordState(this.baseLayer.getData());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    updateUndoButtons() {\n        this._undoButton.classList.toggle(\"disabled\", !this._history.canUndo);\n        this._redoButton.classList.toggle(\"disabled\", !this._history.canRedo);\n    }\n    undo() {\n        if (!this._history.canUndo) {\n            return;\n        }\n        this.baseLayer.putData(this._history.undo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    redo() {\n        if (!this._history.canRedo) {\n            return;\n        }\n        this.baseLayer.putData(this._history.redo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    restoreCurrentHistoryState() {\n        this.baseLayer.putData(this._history.getCurrentState());\n    }\n    loadImage(id) {\n        return ImageStorage_1.imageStorage.loadImage(id)\n            .then(image => {\n            this._imageId = id;\n            this.clear();\n            if (image) {\n                this.baseLayer.drawImage(image);\n            }\n            this.setOverlay(Utils.getImageOverlayUrl(id));\n            this.ResetHistory();\n            this._isDirty = false;\n        });\n    }\n    saveImage() {\n        Utils.log(\"Saving image\");\n        this.baseLayer.canvas.toBlob(blob => ImageStorage_1.imageStorage.saveImage(this._imageId, blob));\n        this._isDirty = false;\n        this._lastSaveTimestamp = Date.now();\n    }\n    setDirty() {\n        this._isDirty = true;\n    }\n    show() {\n        super.show();\n        this._currentTouchId = 0;\n        this._autoMaskCaptured = false;\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp));\n        this._currentTool.enable();\n    }\n    hide() {\n        Palette_1.Palette.collapseAll();\n        if (this._currentTool) {\n            this._currentTool.disable();\n        }\n        if (this._layers) {\n            // Always save when closing the paint view in case we forgot to set the dirty flag somewhere:\n            this.saveImage();\n        }\n        if (this._history) {\n            this._history.clear();\n        }\n        super.hide();\n    }\n    tick(timeStamp) {\n        if (!this.isVisible()) {\n            return;\n        }\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp));\n        let delta = timeStamp - this._tickTimeStamp;\n        this._tickTimeStamp = timeStamp;\n        if (this._currentTool) {\n            this._currentTool.tick(delta);\n            // never save while painting to avoid lags:\n            if (this._lastPointerData && this._lastPointerData.isPressed) {\n                return;\n            }\n        }\n        if (this._isDirty && Date.now() > this._lastSaveTimestamp + config_1.config.saveInterval) {\n            this.saveImage();\n        }\n    }\n    captureAutoMask(position) {\n        if (!config_1.config.useAutoMask) {\n            return;\n        }\n        this._autoMaskCaptured = true;\n        // if (!this.overlayLayer){\n        //     return;\n        // }\n        if (!this._autoMaskCtx) {\n            let autoMaskCanvas = document.createElement(\"canvas\");\n            autoMaskCanvas.id = \"auto-mask\";\n            autoMaskCanvas.width = this.width;\n            autoMaskCanvas.height = this.height;\n            this._autoMaskCtx = autoMaskCanvas.getContext(\"2d\", { alpha: true });\n        }\n        let imageData = this._autoMaskCtx.getImageData(0, 0, this.width, this.height);\n        // avoid expensive floodfill:\n        const index = (position.x + position.y * this.width) * 4 + 3;\n        // if (this._autoMaskCaptured && imageData.data[index] > 0){\n        //     return;\n        // }\n        Utils.log(\"capturing auto mask\");\n        Utils.floodFill(this.baseLayer.ctx, imageData.data, position, this.color);\n        Utils.dilateMask(imageData.data, this.width, this.height);\n        this._autoMaskCtx.putImageData(imageData, 0, 0);\n    }\n    processOverlay(ctx) {\n        const imageData = ctx.getImageData(0, 0, this.width, this.height);\n        const pixels = imageData.data;\n        for (let i = pixels.length - 1; i >= 0; i--) {\n            pixels[i] = pixels[i] > 64 ? 255 : 0;\n        }\n        ctx.putImageData(imageData, 0, 0);\n    }\n    screenToSheet(p) {\n        return new Vector_1.default(p.x / screen.width * config_1.config.width, p.y / screen.height * config_1.config.height);\n    }\n}\nexports.PaintView = PaintView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst View_1 = require(\"./View\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst version = \"1.0.0\"; //require('/package').version;\nvar ConsoleLogHTML = require('console-log-html');\nconst file_saver_1 = require(\"file-saver\");\nclass SettingsView extends View_1.View {\n    constructor(id, onBackClicked) {\n        super(id);\n        let backButton = this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n        let exportButton = this._element.getElementsByClassName(\"button export\")[0];\n        Utils.addClick(exportButton, () => __awaiter(this, void 0, void 0, function* () {\n            const zipBlob = yield ImageStorage_1.imageStorage.generateBackupArchive();\n            file_saver_1.saveAs(zipBlob, \"web-paint-backup.zip\");\n        }));\n        let importButton = this._element.getElementsByClassName(\"button import\")[0];\n        Utils.addClick(importButton, () => __awaiter(this, void 0, void 0, function* () {\n            ImageStorage_1.imageStorage.importBackupArchive(yield Utils.upload(\".zip\"));\n            this.updateInfo();\n        }));\n        let clearButton = this._element.getElementsByClassName(\"button clear\")[0];\n        Utils.addClick(clearButton, () => {\n            if (confirm(\"Really clear all iamges?\")) {\n                ImageStorage_1.imageStorage.clear();\n                location.reload();\n            }\n        });\n        ConsoleLogHTML.connect(document.getElementById(\"log\"), {}, true, true, true);\n    }\n    show() {\n        super.show();\n        this.updateInfo();\n    }\n    updateInfo() {\n        const info = document.getElementById(\"info\");\n        info.innerText = `Version: ${version}`;\n        ImageStorage_1.imageStorage.getStorageUsed().then(amount => {\n            info.innerText += `\\rStorage used: ${Utils.formatBytes(amount, 1)}`;\n        });\n    }\n}\nexports.default = SettingsView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nclass Thumbnail {\n    constructor(parent, id, onImageSelected) {\n        let element = document.createElement(\"div\");\n        this._element = element;\n        element.id = id;\n        element.classList.add(\"thumbnail\");\n        this._element.style.opacity = \"0\";\n        // Utils.addLongClick(element, () => {\n        //     if (!this._image || !PeerToPeer.instance || !PeerToPeer.instance.loggedIn || PeerToPeer.instance.peerList.length < 2){\n        //         return;\n        //     }\n        //\n        //     Utils.imageToBlob(this._image)\n        //         .then(blob => {\n        //             const peerName = PeerToPeer.instance.peerList[1];\n        //             PeerToPeer.instance.sendData(peerName, blob);\n        //         });\n        // });\n        Utils.addClick(element, () => {\n            if (onImageSelected) {\n                onImageSelected(id);\n            }\n        }, true);\n        ImageStorage_1.imageStorage.addChangeListener((change, id) => {\n            if (change == \"save\" && id == this.id) {\n                this.loadImage();\n            }\n        });\n        this.overlayUrl = Utils.getImageOverlayUrl(id);\n        parent.appendChild(element);\n        this.loadImage();\n    }\n    get id() { return this._element.id; }\n    set imageUrl(src) {\n        this._imageUrl = src;\n        this._element.style.opacity = \"1\";\n        this.updateBackgroundImages();\n    }\n    set overlayUrl(src) {\n        this._overlayUrl = src;\n        this.updateBackgroundImages();\n    }\n    remove() {\n        this._element.remove();\n    }\n    isHidden() {\n        return (this._element.offsetParent === null);\n    }\n    loadImage() {\n        ImageStorage_1.imageStorage.loadImageUrl(this.id)\n            .then(url => {\n            this.imageUrl = url;\n        });\n    }\n    updateBackgroundImages() {\n        let urls = [];\n        if (this._overlayUrl) {\n            urls.push(`url(${this._overlayUrl})`);\n        }\n        if (this._imageUrl) {\n            urls.push(`url(${this._imageUrl})`);\n        }\n        this._element.style.backgroundImage = urls.join(\",\");\n    }\n}\nexports.default = Thumbnail;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.View = void 0;\nclass View {\n    constructor(id) {\n        this._element = document.getElementById(id);\n        if (!this._element) {\n            console.error(`Could not find element with id ${id}`);\n        }\n        this.hide();\n    }\n    clear() {\n        while (this._element.hasChildNodes()) {\n            this._element.removeChild(this._element.firstChild);\n        }\n    }\n    show() {\n        this._element.classList.remove(\"hidden\");\n    }\n    hide() {\n        this._element.classList.add(\"hidden\");\n    }\n    setVisible(visible) {\n        this._element.classList.toggle(\"hidden\", !visible);\n    }\n    isVisible() {\n        return !this._element.classList.contains(\"hidden\");\n    }\n}\nexports.View = View;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n// It's empty as some runtime module handles the default behavior\n__webpack_require__.x = function() {};\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"main\": 0\n};\n\nvar deferredModules = [\n\t[\"./src/ts/app.ts\",\"vendors-node_modules_fortawesome_fontawesome-svg-core_index_es_js-node_modules_fortawesome_fr-3e03f6\"]\n];\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = function() {};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb_paint\"] = self[\"webpackChunkweb_paint\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = function() {};\n\t}\n\treturn result;\n}\nvar startup = __webpack_require__.x;\n__webpack_require__.x = function() {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = startup || (function() {});\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};","// run startup\n__webpack_require__.x();\n"],"sourceRoot":""}