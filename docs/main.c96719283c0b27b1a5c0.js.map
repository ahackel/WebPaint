{"version":3,"sources":["webpack://web-paint/./src/css/painter.css","webpack://web-paint/./src/css/painter.css?effd","webpack://web-paint/./src/ts/CanvasLayer.ts","webpack://web-paint/./src/ts/History.ts","webpack://web-paint/./src/ts/ImageLayer .ts","webpack://web-paint/./src/ts/Layer.ts","webpack://web-paint/./src/ts/Toolbar.ts","webpack://web-paint/./src/ts/app.ts","webpack://web-paint/./src/ts/config.ts","webpack://web-paint/./src/ts/math/Vector.ts","webpack://web-paint/./src/ts/palettes/ColorPalette.ts","webpack://web-paint/./src/ts/palettes/Palette.ts","webpack://web-paint/./src/ts/palettes/ShapePalette.ts","webpack://web-paint/./src/ts/palettes/SizePalette.ts","webpack://web-paint/./src/ts/storage/ImageStorage.ts","webpack://web-paint/./src/ts/storage/LocalForageAdapter.ts","webpack://web-paint/./src/ts/storage/StorageAdapter.ts","webpack://web-paint/./src/ts/tools/PenTool.ts","webpack://web-paint/./src/ts/tools/SelectionTool.ts","webpack://web-paint/./src/ts/tools/Tool.ts","webpack://web-paint/./src/ts/utils/Rect.ts","webpack://web-paint/./src/ts/utils/Utils.ts","webpack://web-paint/./src/ts/views/BookView.ts","webpack://web-paint/./src/ts/views/PaintView.ts","webpack://web-paint/./src/ts/views/SettingsView.ts","webpack://web-paint/./src/ts/views/Thumbnail.ts","webpack://web-paint/./src/ts/views/View.ts","webpack://web-paint/webpack/bootstrap","webpack://web-paint/webpack/runtime/compat get default export","webpack://web-paint/webpack/runtime/define property getters","webpack://web-paint/webpack/runtime/global","webpack://web-paint/webpack/runtime/hasOwnProperty shorthand","webpack://web-paint/webpack/runtime/make namespace object","webpack://web-paint/webpack/runtime/jsonp chunk loading","webpack://web-paint/webpack/startup"],"names":["___CSS_LOADER_EXPORT___","push","module","id","__importDefault","this","mod","__esModule","Object","defineProperty","exports","value","config_1","Layer_1","CanvasLayer","default","parent","x","y","width","height","super","_ctx","canvas","getContext","alpha","imageSmoothingQuality","imageSmoothingEnabled","config","imageSmoothing","_element","getImageData","data","putImageData","image","rect","drawImage","clearRect","History","_states","_position","length","maxUndoSteps","shift","splice","canUndo","canRedo","ImageLayer","onload","resize","naturalWidth","naturalHeight","__createBinding","create","o","m","k","k2","undefined","enumerable","get","__setModuleDefault","v","__importStar","result","prototype","hasOwnProperty","call","Utils","Vector_1","tag","_startScale","_startRotation","_scale","_rotation","_lastTouchStartTime","_pointers","document","createElement","classList","add","_index","_width","_height","style","pointerEvents","appendChild","transform","bindEventListeners","position","scale","rotation","contains","toggle","addEventListeners","removeEventListeners","remove","setPositionAndSize","ctx","save","setTransform","rotate","translate","restore","addEventListener","preventDefault","pointerEventsSupported","pointerDown","touchStart","removeEventListener","event","onDoubleTap","setPointerCapture","pointerId","addPointerEvent","timeStamp","doubleTapDelay","doubleTap","pointerMove","pointerUp","_pinchCenter","altKey","p1","clientToPixel","p2","clone","multiplyScalar","subtract","pinchStart","dragStart","index","findIndex","move","releasePointerCapture","removePointerEvent","touches","touchMove","touchEnd","pointers","pinchMove","dragMove","outlineWidth","outlineOffset","bind","_localDragPosition","center","_pinchStartDist","distanceTo","_pinchStartRotation","Math","atan2","distance","angleChange","clamp","position1","parentElement","getBoundingClientRect","isPortraitOrientation","nx","clientX","left","ny","clientY","top","Toolbar","View_1","View","show","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","done","then","apply","fontawesome_svg_core_1","free_solid_svg_icons_1","library","fas","dom","watch","BookView_1","PaintView_1","SettingsView_1","App","_settingsView","openView","_bookView","_sheet","getElementById","window","OnResize","onImageSelected","_paintView","loadImage","PaintView","test","navigator","platform","match","parseInt","docWidth","documentElement","clientWidth","docHeight","clientHeight","portrait","isLargeScreen","viewWidth","max","viewHeight","min","horizontalPixelSize","verticalPixelSize","virtualPixelSize","fullScreenCanvas","fontSize","ontouchmove","view","_activeView","hide","app","defaultShapes","debug","longClickDelay","minScrollDistance","maxScrollDelay","maxShapeCount","usePointerEvents","pixelPerfect","useAutoMask","saveInterval","imageCount","images","overlay","Vector","round","minX","minY","maxX","maxY","s","invScalar","sqrt","divideScalar","dx","dy","distanceToSq","Palette_1","ColorPalette","Palette","selectedOption","selectedIndex","element","option","background","options","rightAlign","_options","_optionElements","_selectedIndex","createOptions","collapse","updateSelectedOptionElement","_selectedElement","indexOf","_expandedPalette","addSelectedOption","addOptionElements","clear","collapseAll","isCollapsed","expand","addOptionElement","updateOptionsWidth","recreateOptions","addClick","_optionsElement","addArrowElement","i","dataset","addLongClick","optionLongClicked","optionClicked","updateOptionElement","onSelectionChanged","ImageStorage_1","ShapePalette","_shapeIds","imageStorage","keys","shapesIds","filter","startsWith","shapeId","addShapeFromImageId","addChangeListener","change","stampId","loadImageUrl","url","addOption","deleteShape","backgroundImage","innerHTML","deleteImage","removeOption","SizePalette","LocalForageAdapter_1","jszip_1","_adapter","migrate","_urls","img","Image","src","decode","urls","blob","loadBlob","URL","createObjectURL","adapter","getItem","setItem","revokeObjectURL","dispatchChangeEvent","removeItem","callback","_changeListeners","changeListener","count","zip","fetch","r","file","generateAsync","type","zipFile","loadAsync","forEach","path","buffer","async","Blob","saveImage","name","needsRefresh","endsWith","newId","replace","console","log","location","reload","amount","size","localforage_1","StorageAdapter_1","LocalForageAdapter","arguments","_imageStore","createInstance","param","iterate","Tool_1","PenTool","painter","buttonId","operation","_operation","createBrushCtx","brushCanvas","_brushCtx","_painter","captureAutoMask","_points","getWidth","pressure","speed","_widths","_startIndex","baseLayer","fillStyle","color","strokeStyle","globalCompositeOperation","requestDrawPath","recordHistoryState","delta","_drawPathRequested","drawPath","drawConnectedLines","slice","points","widths","pointCount","lineCap","lineJoin","start","startWidth","lineWidth","beginPath","arc","PI","fill","lineTo","stroke","radius","newPoints","interpolatePoints","concat","numSegments","lastWidth","maxWidthDifference","lerp","newPoint","segmentLength","end","dist","control","previous","tangent","normalize","a","pointOnQuadraticCurve","f1","f2","f3","autoMaskCtx","getBufferCtx","Rect_1","file_saver_1","SelectionTool","selectionLayerId","_selection","Empty","_deleteButton","clearSelection","_stampButton","paintSelectionToCanvas","_saveButton","saveSelectionAsNewStamp","_downloadButton","selectionLayer","toBlob","saveAs","hasFloatingSelection","getLayer","_hasFloatingSelection","toggleFloatingSelectionButtons","_isInShapesPalette","visible","enable","createSelectionLayer","isInShapesPalette","disable","destroySelectionLayer","getClampedPosition","startNewSelection","requestDrawSelectionOutline","cutSelection","floating","_startPosition","setLineDash","_drawSelectionOutlineRequested","updateSelectionAndDrawOutline","code","setImage","abs","strokeRect","removeLayer","addCanvasLayer","getVisiblePixelFrame","selection","isEmpty","drawToCanvas","Date","now","Tool","_buttonElement","opacity","_bufferCtx","createBufferCtx","Rect","dilateMask","floodFill","stringToColor","lerpCanvas","lerpColor","createNewImageId","getImageOverlayUrl","imageToBlob","upload","formatBytes","b","bytes","decimals","dm","floor","parseFloat","pow","toFixed","accept","input","onchange","files","click","PointerEvent","_a","message","optionalParams","supportScrolling","scrollStartX","scrollStartY","touchId","isTracking","startTimeStamp","scrolled","touch","changedTouches","elementFromPoint","pageX","pageY","target","identifier","stopPropagation","timer","caller","called","down","setTimeout","up","stopImmediatePropagation","clearTimeout","toString","lower","upper","n","color1","color2","ba","ga","ra","bb","gb","rb","ctxA","ctxB","ctxMask","dataA","dataB","dataMask","a32","Uint8ClampedArray","b32","m32","h","g","sourceCtx","mask","startPosition","sourcePixels","startBrightness","stack","pos","pop","isBorderPixel","scanLeft","scanRight","addToStack","setValue","indexA","pixels","cy","cx","Thumbnail_1","BookView","onSettingsClicked","settingsButton","getElementsByClassName","updateImages","_thumbnails","imageId","padStart","thumbnail","ColorPalette_1","SizePalette_1","PenTool_1","ShapePalette_1","CanvasLayer_1","ImageLayer_1","SelectionTool_1","Toolbar_1","History_1","onBackClicked","scaleFactor","_currentTouchId","_layers","_lastSaveTimestamp","_history","createButtons","createToolbar","createPalettes","createTools","_color","_stamp","_opacity","_lineWidth","_autoMaskCtx","backButton","_undoButton","undo","_redoButton","redo","_importImageButton","setTool","selectionTool","setImageUrl","layer","addLayer","overlayLayer","createOverlay","removeOverlay","penButton","markerTool","eraserButton","eraserTool","selectionButton","selectAll","_tools","addTool","tool","_mainToolbar","_contextToolbar","_sizePalette","_colorPalette","_shapePalette","stamp","_currentTool","setVisible","keyDown","cancelable","isVisible","isPrimary","buttons","getPointerEventPosition","screenToSheet","getNormalizedPointerPressure","isPressed","pointerType","touchType","force","targetTouches","getTouchEventPosition","radiusX","radiusY","getNormalizedTouchPressure","findTouch","_lastPointerData","fillRect","updateUndoButtons","recordState","getData","setDirty","putData","getCurrentState","_imageId","setOverlay","ResetHistory","_isDirty","_autoMaskCaptured","requestAnimationFrame","tick","_tickTimeStamp","autoMaskCanvas","imageData","p","screen","ConsoleLogHTML","SettingsView","exportButton","zipBlob","generateBackupArchive","importButton","importBackupArchive","updateInfo","clearButton","confirm","connect","info","innerText","getStorageUsed","overlayUrl","_imageUrl","updateBackgroundImages","_overlayUrl","offsetParent","imageUrl","join","error","hasChildNodes","removeChild","firstChild","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","getter","d","definition","key","globalThis","Function","obj","prop","Symbol","toStringTag","installedChunks","179","deferredModules","checkDeferredModules","webpackJsonpCallback","parentChunkLoadingFunction","chunkId","chunkIds","moreModules","runtime","executeModules","resolves","chunkLoadingGlobal","self","checkDeferredModulesImpl","deferredModule","j","depId","startup"],"mappings":"sFAGIA,E,MAA0B,GAA4B,KAE1DA,EAAwBC,KAAK,CAACC,EAAOC,GAAI,orLAAqsL,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,2BAA2B,MAAQ,GAAG,SAAW,q4FAAq4F,eAAiB,CAAC,qlQAAqmQ,WAAa,MAEn0hB,O,4DCCa,IAAI,IALH,CAEd,OAAiB,OACjB,WAAoB,IAMpB,UAAe,YAAkB,I,qBCXjC,IAAIC,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMC,EAAW,EAAQ,MACnBC,EAAUT,EAAgB,EAAQ,OACxC,MAAMU,UAAoBD,EAAQE,QAC9B,YAAYC,EAAQb,EAAIc,EAAGC,EAAGC,EAAOC,GACjCC,MAAML,EAAQ,SAAUb,EAAIc,EAAGC,EAAGC,EAAOC,GACzCf,KAAKiB,KAAOjB,KAAKkB,OAAOC,WAAW,KAAM,CAAEC,OAAO,IAClDpB,KAAKiB,KAAKI,sBAAwB,OAClCrB,KAAKiB,KAAKK,sBAAwBf,EAASgB,OAAOC,eAEtD,aAAe,OAAOxB,KAAKyB,SAC3B,UAAY,OAAOzB,KAAKiB,KACxB,UACI,OAAOjB,KAAKiB,KAAKS,aAAa,EAAG,EAAG1B,KAAKc,MAAOd,KAAKe,QAEzD,QAAQY,GACJ3B,KAAKiB,KAAKW,aAAaD,EAAM,EAAG,GAEpC,UAAUE,EAAOC,GACb,MAAM,EAAElB,EAAC,EAAEC,EAAC,MAAEC,EAAK,OAAEC,GAAWe,GAAQ,CAAElB,EAAG,EAAGC,EAAG,EAAGC,MAAOd,KAAKc,MAAOC,OAAQf,KAAKe,QACtFf,KAAKiB,KAAKc,UAAUF,EAAOjB,EAAGC,EAAGC,EAAOC,GAE5C,MAAMe,GACF,MAAM,EAAElB,EAAC,EAAEC,EAAC,MAAEC,EAAK,OAAEC,GAAWe,GAAQ,CAAElB,EAAG,EAAGC,EAAG,EAAGC,MAAOd,KAAKc,MAAOC,OAAQf,KAAKe,QACtFf,KAAKiB,KAAKe,UAAUpB,EAAGC,EAAGC,EAAOC,IAGzCV,EAAQK,QAAUD,G,qBC9BlBN,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ4B,aAAU,EAClB,MAAM1B,EAAW,EAAQ,MAwCzBF,EAAQ4B,QAvCR,MACI,cACIjC,KAAKkC,QAAU,GACflC,KAAKmC,WAAa,EAEtB,cAAgB,OAAOnC,KAAKmC,UAAY,EACxC,cAAgB,OAAOnC,KAAKmC,UAAYnC,KAAKkC,QAAQE,OAAS,EAC9D,YAAYT,GACJ3B,KAAKmC,WAAa5B,EAASgB,OAAOc,aAAe,IACjDrC,KAAKkC,QAAQI,QACbtC,KAAKmC,aAGTnC,KAAKkC,QAAQK,OAAOvC,KAAKmC,UAAY,EAAGnC,KAAKkC,QAAQE,OAASpC,KAAKmC,UAAY,GAC/EnC,KAAKmC,YACLnC,KAAKkC,QAAQlC,KAAKmC,WAAaR,EAEnC,OACI,OAAK3B,KAAKwC,SAGVxC,KAAKmC,YACEnC,KAAKkC,QAAQlC,KAAKmC,YAHd,KAKf,OACI,OAAKnC,KAAKyC,SAGVzC,KAAKmC,YACEnC,KAAKkC,QAAQlC,KAAKmC,YAHd,KAKf,kBACI,OAAOnC,KAAKmC,WAAa,GAAKnC,KAAKmC,UAAYnC,KAAKkC,QAAQE,OAASpC,KAAKkC,QAAQlC,KAAKmC,WAAa,KAExG,QACInC,KAAKkC,QAAU,GACflC,KAAKmC,WAAa,K,oBCvC1B,IAAIpC,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAME,EAAUT,EAAgB,EAAQ,OACxC,MAAM2C,UAAmBlC,EAAQE,QAC7B,YAAc,OAAOV,KAAKyB,SAC1B,YAAYd,EAAQb,EAAIc,EAAGC,EAAGC,EAAOC,GACjCC,MAAML,EAAQ,MAAOb,EAAIc,EAAGC,EAAGC,EAAOC,GACtCf,KAAKyB,SAASkB,OAAS,KAEnB3C,KAAK4C,OAAO5C,KAAK6B,MAAMgB,aAAc7C,KAAK6B,MAAMiB,iBAI5DzC,EAAQK,QAAUgC,G,qBCflB,IAAIK,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEP5D,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMC,EAAW,EAAQ,MACnBwD,EAAQL,EAAa,EAAQ,OAC7BM,EAAWjE,EAAgB,EAAQ,OAyQzCM,EAAQK,QAxQR,MACI,YAAYC,EAAQsD,EAAKnE,EAAIc,EAAGC,EAAGC,EAAOC,GACtCf,KAAKkE,YAAc,EACnBlE,KAAKmE,eAAiB,EACtBnE,KAAKmC,UAAY,IAAI6B,EAAStD,QAAQ,EAAG,GACzCV,KAAKoE,OAAS,EACdpE,KAAKqE,UAAY,EACjBrE,KAAKsE,oBAAsB,EAC3BtE,KAAKuE,UAAY,GACjBvE,KAAKyB,SAAW+C,SAASC,cAAcR,GACvCjE,KAAKyB,SAAS3B,GAAKA,EACnBE,KAAKyB,SAASiD,UAAUC,IAAI,SAC5B3E,KAAK4E,OAAS,EACd5E,KAAK6E,OAAS/D,EACdd,KAAK8E,QAAU/D,EACff,KAAKyB,SAASX,MAAQA,EACtBd,KAAKyB,SAASV,OAASA,EACvBf,KAAKyB,SAASsD,MAAMjE,MAAQ,GAAGA,MAC/Bd,KAAKyB,SAASsD,MAAMhE,OAAS,GAAGA,MAChCf,KAAKyB,SAASsD,MAAMC,cAAgB,OACpCrE,EAAOsE,YAAYjF,KAAKyB,UACxBzB,KAAKkF,UAAU,IAAIlB,EAAStD,QAAQE,EAAGC,GAAI,EAAG,GAC9Cb,KAAKmF,qBAET,SAAW,OAAOnF,KAAKyB,SAAS3B,GAChC,YAAc,OAAOE,KAAK4E,OAC1B,UAAUnB,GACNzD,KAAK4E,OAASnB,EACdzD,KAAKkF,UAAUlF,KAAKoF,SAAUpF,KAAKqF,MAAOrF,KAAKsF,UAEnD,YAAc,OAAOtF,KAAK6E,OAE1B,aAAe,OAAO7E,KAAK8E,QAE3B,eAAiB,OAAO9E,KAAKmC,UAC7B,eAAiB,OAAOnC,KAAKqE,UAC7B,YAAc,OAAOrE,KAAKoE,OAC1B,eAAiB,OAAOpE,KAAKyB,SAASiD,UAAUa,SAAS,YACzD,aAAajF,GACTN,KAAKyB,SAASiD,UAAUc,OAAO,WAAYlF,GAC3CN,KAAKyB,SAASsD,MAAMC,cAAgB1E,EAAQ,OAAS,OACjDA,EACAN,KAAKyF,oBAGLzF,KAAK0F,uBAGb,SACI1F,KAAKyB,SAASkE,SAElB,OAAO7E,EAAOC,GACV,MAAMH,EAAIZ,KAAKoF,SAASxE,EAAI,IAAOZ,KAAKc,MAAQA,GAC1CD,EAAIb,KAAKoF,SAASvE,EAAI,IAAOb,KAAKe,OAASA,GACjDf,KAAK4F,mBAAmBhF,EAAGC,EAAGC,EAAOC,GAEzC,mBAAmBH,EAAGC,EAAGC,EAAOC,GAC5Bf,KAAK6E,OAAS/D,EACdd,KAAK8E,QAAU/D,EACff,KAAKyB,SAASX,MAAQA,EACtBd,KAAKyB,SAASV,OAASA,EACvBf,KAAKyB,SAASsD,MAAMjE,MAAQ,GAAGA,MAC/Bd,KAAKyB,SAASsD,MAAMhE,OAAS,GAAGA,MAChCf,KAAKkF,UAAU,IAAIlB,EAAStD,QAAQE,EAAGC,GAAIb,KAAKqF,MAAOrF,KAAKsF,UAEhE,aAAaO,GACTA,EAAIC,OACJ,IAAIlF,EAAIZ,KAAKmC,UAAUvB,EAAI,GAAMZ,KAAKc,MAClCD,EAAIb,KAAKmC,UAAUtB,EAAI,GAAMb,KAAKe,OACtC8E,EAAIE,aAAa/F,KAAKoE,OAAQ,EAAG,EAAGpE,KAAKoE,OAAQxD,EAAGC,GACpDgF,EAAIG,OAAOhG,KAAKqE,WAChBwB,EAAII,WAAW,GAAMjG,KAAKc,OAAQ,GAAMd,KAAKe,QAC7C8E,EAAI9D,UAAU/B,KAAKyB,SAAU,EAAG,GAChCoE,EAAIK,UAER,oBAEIlG,KAAKyB,SAAS0E,iBAAiB,QAASnG,KAAKoG,gBACzCrC,EAAMsC,0BACNrG,KAAKyB,SAAS0E,iBAAiB,aAAcnG,KAAKoG,gBAClDpG,KAAKyB,SAAS0E,iBAAiB,cAAenG,KAAKsG,cAGnDtG,KAAKyB,SAAS0E,iBAAiB,aAAcnG,KAAKuG,YAG1D,uBACIvG,KAAKyB,SAAS+E,oBAAoB,QAASxG,KAAKoG,gBAC5CrC,EAAMsC,0BACNrG,KAAKyB,SAAS+E,oBAAoB,aAAcxG,KAAKoG,gBACrDpG,KAAKyB,SAAS+E,oBAAoB,cAAexG,KAAKsG,cAGtDtG,KAAKyB,SAAS+E,oBAAoB,aAAcxG,KAAKuG,YAG7D,eAAeE,GACXA,EAAML,iBAEV,UAAUK,GACFzG,KAAK0G,aACL1G,KAAK0G,YAAYD,GAGzB,YAAYA,GAIR,GAHAA,EAAML,iBACNpG,KAAKyB,SAASkF,kBAAkBF,EAAMG,WACtC5G,KAAK6G,gBAAgBJ,GACS,IAA1BzG,KAAKuE,UAAUnC,OAQf,GAPIqE,EAAMK,UAAY9G,KAAKsE,oBAAsB/D,EAASgB,OAAOwF,gBAC7D/G,KAAKgH,UAAUP,GAEnBzG,KAAKsE,oBAAsBmC,EAAMK,UACjC9G,KAAKyB,SAAS0E,iBAAiB,cAAenG,KAAKiH,aACnDjH,KAAKyB,SAAS0E,iBAAiB,YAAanG,KAAKkH,WACjDlH,KAAKmH,aAAe,IAAInD,EAAStD,QAAQV,KAAKmC,UAAUvB,EAAI,GAAMZ,KAAKc,MAAOd,KAAKmC,UAAUtB,EAAI,GAAMb,KAAKe,QACxG0F,EAAMW,OAAQ,CACd,IAAIC,EAAKrH,KAAKsH,cAActH,KAAKuE,UAAU,IACvCgD,EAAKvH,KAAKmH,aAAaK,QAAQC,eAAe,GAAGC,SAASL,GAC9DrH,KAAK2H,WAAWN,EAAIE,QAGpBvH,KAAK4H,UAAU5H,KAAKsH,cAActH,KAAKuE,UAAU,KAG3B,IAA1BvE,KAAKuE,UAAUnC,QACfpC,KAAK2H,WAAW3H,KAAKsH,cAActH,KAAKuE,UAAU,IAAKvE,KAAKsH,cAActH,KAAKuE,UAAU,KAGjG,gBAAgBkC,GACZ,MAAMoB,EAAQ7H,KAAKuE,UAAUuD,WAAUlH,GAAKA,EAAEgG,WAAaH,EAAMG,YAC7DiB,EAAQ,EACR7H,KAAKuE,UAAU3E,KAAK6G,GAGpBzG,KAAKuE,UAAUsD,GAASpB,EAGhC,mBAAmBA,GACf,MAAMoB,EAAQ7H,KAAKuE,UAAUuD,WAAUlH,GAAKA,EAAEgG,WAAaH,EAAMG,YAC7DiB,GAAS,GACT7H,KAAKuE,UAAUhC,OAAOsF,EAAO,GAGrC,YAAYpB,GACRA,EAAML,iBACNpG,KAAK6G,gBAAgBJ,GACrBzG,KAAK+H,KAAK/H,KAAKuE,UAAWkC,EAAMW,QAEpC,UAAUX,GACNA,EAAML,iBACNpG,KAAKyB,SAASuG,sBAAsBvB,EAAMG,WAC1C5G,KAAKiI,mBAAmBxB,GACK,GAAzBzG,KAAKuE,UAAUnC,QACfpC,KAAK4H,UAAU5H,KAAKsH,cAActH,KAAKuE,UAAU,KAExB,GAAzBvE,KAAKuE,UAAUnC,SACfpC,KAAKyB,SAAS+E,oBAAoB,cAAexG,KAAKiH,aACtDjH,KAAKyB,SAAS+E,oBAAoB,YAAaxG,KAAKkH,YAG5D,WAAWT,GAEP,GADAA,EAAML,iBACuB,IAAzBK,EAAMyB,QAAQ9F,OAQd,GAPIqE,EAAMK,UAAY9G,KAAKsE,oBAAsB/D,EAASgB,OAAOwF,gBAC7D/G,KAAKgH,UAAUP,GAEnBzG,KAAKsE,oBAAsBmC,EAAMK,UACjC9G,KAAKyB,SAAS0E,iBAAiB,YAAanG,KAAKmI,WACjDnI,KAAKyB,SAAS0E,iBAAiB,WAAYnG,KAAKoI,UAChDpI,KAAKmH,aAAe,IAAInD,EAAStD,QAAQV,KAAKmC,UAAUvB,EAAI,GAAMZ,KAAKc,MAAOd,KAAKmC,UAAUtB,EAAI,GAAMb,KAAKe,QACxG0F,EAAMW,OAAQ,CACd,IAAIC,EAAKrH,KAAKsH,cAAcb,EAAMyB,QAAQ,IACtCX,EAAKvH,KAAKmH,aAAaK,QAAQC,eAAe,GAAGC,SAASL,GAC9DrH,KAAK2H,WAAWN,EAAIE,QAGpBvH,KAAK4H,UAAU5H,KAAKsH,cAAcb,EAAMyB,QAAQ,KAG3B,IAAzBzB,EAAMyB,QAAQ9F,QACdpC,KAAK2H,WAAW3H,KAAKsH,cAAcb,EAAMyB,QAAQ,IAAKlI,KAAKsH,cAAcb,EAAMyB,QAAQ,KAG/F,UAAUzB,GACNA,EAAML,iBACNpG,KAAK+H,KAAKtB,EAAMyB,QAASzB,EAAMW,QAEnC,KAAKiB,EAAUjB,GACX,GAAwB,IAApBiB,EAASjG,OACT,GAAIgF,EAAQ,CACR,IAAIC,EAAKrH,KAAKsH,cAAce,EAAS,IACjCd,EAAKvH,KAAKmH,aAAaK,QAAQC,eAAe,GAAGC,SAASL,GAC9DrH,KAAKsI,UAAUjB,EAAIE,QAGnBvH,KAAKuI,SAASvI,KAAKsH,cAAce,EAAS,KAG1B,IAApBA,EAASjG,QACTpC,KAAKsI,UAAUtI,KAAKsH,cAAce,EAAS,IAAKrI,KAAKsH,cAAce,EAAS,KAGpF,SAAS5B,GACLA,EAAML,iBACNpG,KAAKyB,SAAS+E,oBAAoB,YAAaxG,KAAKmI,WACpDnI,KAAKyB,SAAS0E,iBAAiB,WAAYnG,KAAKoI,UAEpD,UAAUhD,EAAUC,EAAOC,GACvBtF,KAAKmC,UAAYiD,EACjBpF,KAAKqE,UAAYiB,EACjBtF,KAAKoE,OAASiB,EACd,MAAMwC,EAAQ7H,KAAK4E,OACnB5E,KAAKyB,SAASsD,MAAMG,UAAY,aAAaE,EAASxE,QAAQwE,EAASvE,eAAeyE,eAAsBD,iBAAqBwC,OACjI7H,KAAKyB,SAASsD,MAAMyD,aAAkB,EAAInD,EAAP,KACnCrF,KAAKyB,SAASsD,MAAM0D,cAAgB,IAAI,EAAIpD,MAEhD,qBAEIrF,KAAKuG,WAAavG,KAAKuG,WAAWmC,KAAK1I,MACvCA,KAAKmI,UAAYnI,KAAKmI,UAAUO,KAAK1I,MACrCA,KAAKoI,SAAWpI,KAAKoI,SAASM,KAAK1I,MACnCA,KAAKsG,YAActG,KAAKsG,YAAYoC,KAAK1I,MACzCA,KAAKiH,YAAcjH,KAAKiH,YAAYyB,KAAK1I,MACzCA,KAAKkH,UAAYlH,KAAKkH,UAAUwB,KAAK1I,MAEzC,UAAUoF,GACNpF,KAAK2I,mBAAqBvD,EAASoC,QAAQE,SAAS1H,KAAKoF,UAE7D,SAASA,GACLA,EAASsC,SAAS1H,KAAK2I,oBACvB3I,KAAKkF,UAAUE,EAAUpF,KAAKoE,OAAQpE,KAAKqE,WAE/C,WAAWgD,EAAIE,GACX,IAAIqB,EAASvB,EAAGG,QAAQ7C,IAAI4C,GAAIE,eAAe,IAC/CzH,KAAK6I,gBAAkBxB,EAAGyB,WAAWvB,GACrCvH,KAAK+I,oBAAsBC,KAAKC,MAAM5B,EAAGxG,EAAI+H,EAAO/H,EAAGwG,EAAGzG,EAAIgI,EAAOhI,GACrEZ,KAAKmE,eAAiBnE,KAAKqE,UAC3BrE,KAAKkE,YAAclE,KAAKoE,OAE5B,UAAUiD,EAAIE,GACV,IAAIqB,EAASvB,EAAGG,QAAQ7C,IAAI4C,GAAIE,eAAe,IAC3CyB,EAAW7B,EAAGyB,WAAWvB,GAEzB4B,EADQH,KAAKC,MAAM5B,EAAGxG,EAAI+H,EAAO/H,EAAGwG,EAAGzG,EAAIgI,EAAOhI,GAC5BZ,KAAK+I,oBAC3B1D,EAAQrF,KAAKkE,aAAegF,EAAWlJ,KAAK6I,iBAChDxD,EAAQtB,EAAMqF,MAAM,GAAK,GAAI/D,GAC7B,IAAID,EAAWiC,EAAGG,QAAQ7C,IAAI4C,GAAIE,eAAe,IACjDrC,EAASxE,GAAK,GAAMZ,KAAKc,MACzBsE,EAASvE,GAAK,GAAMb,KAAKe,OACzB,IAAIuE,EAAWtF,KAAKmE,eAAiBgF,EACrCnJ,KAAKkF,UAAUE,EAAUC,EAAOC,GAEpC,cAAc+D,GACV,IACIvH,EADS9B,KAAKyB,SAAS6H,cACTC,wBAClB,MAAMC,EAAwB1H,EAAKf,OAASe,EAAKhB,MACjD,IAAI2I,GAAMJ,EAAUK,QAAU5H,EAAK6H,MAAQ7H,EAAKhB,MAC5C8I,GAAMP,EAAUQ,QAAU/H,EAAKgI,KAAOhI,EAAKf,OAC3CH,GAAK4I,EAAwB,EAAII,EAAKH,GAAMlJ,EAASgB,OAAOT,MAC5DD,GAAK2I,EAAwBC,EAAKG,GAAMrJ,EAASgB,OAAOR,OAC5D,OAAO,IAAIiD,EAAStD,QAAQE,EAAGC,M,qBC/RvCV,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ0J,aAAU,EAClB,MAAMC,EAAS,EAAQ,MACvB,MAAMD,UAAgBC,EAAOC,KACzB,YAAYnK,GACRkB,MAAMlB,GACNE,KAAKkK,OAET,QACQlK,KAAKyB,SAASiD,UAAUa,SAAS,SAAWvF,KAAKyB,SAASiD,UAAUa,SAAS,YAC7EvF,KAAKyB,SAASiD,UAAUc,OAAO,QAC/BxF,KAAKyB,SAASiD,UAAUc,OAAO,WAE/BxF,KAAKyB,SAASiD,UAAUa,SAAS,QAAUvF,KAAKyB,SAASiD,UAAUa,SAAS,aAC5EvF,KAAKyB,SAASiD,UAAUc,OAAO,OAC/BxF,KAAKyB,SAASiD,UAAUc,OAAO,YAI3CnF,EAAQ0J,QAAUA,G,qBCnBlB,IAAII,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGlE9K,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,EAAQ,KACR,MAAM6K,EAAyB,EAAQ,MACjCC,EAAyB,EAAQ,MACvCD,EAAuBE,QAAQ1G,IAAIyG,EAAuBE,KAC1DH,EAAuBI,IAAIC,QAC3B,EAAQ,MACR,MAAMC,EAAa1L,EAAgB,EAAQ,OACrC2L,EAAc,EAAQ,MACtBnL,EAAW,EAAQ,MACnBoL,EAAiB5L,EAAgB,EAAQ,OAC/C,MAAM6L,EACF,cAGI5L,KAAK6L,cAAgB,IAAIF,EAAejL,QAAQ,YAAY,KACxDV,KAAK8L,SAAS9L,KAAK+L,cAEvB/L,KAAKgM,OAASxH,SAASyH,eAAe,SACtCC,OAAO/F,iBAAiB,UAAUM,IAC9BzG,KAAKmM,cAETnM,KAAKmM,WACLnM,KAAK+L,UAAY,IAAIN,EAAW/K,QAAQ,QAAQ,IAAMyJ,EAAUnK,UAAM,OAAQ,GAAQ,YAClFA,KAAK8L,SAAS9L,KAAK6L,oBAEvB7L,KAAK+L,UAAUK,gBAAmBtM,IAC9BE,KAAKqM,WAAWC,UAAUxM,GACrBmL,MAAK,KACNjL,KAAK8L,SAAS9L,KAAKqM,gBAG3BrM,KAAKqM,WAAa,IAAIX,EAAYa,UAAU,SAAS,KACjDvM,KAAK8L,SAAS9L,KAAK+L,cAKvB/L,KAAK8L,SAAS9L,KAAK+L,WAEvB,gBACI,GAAI,iBAAiBS,KAAKC,UAAUC,UAAW,CAE3C,IAAIjJ,EAAKgJ,UAAoB,WAAEE,MAAM,0BACrC,MAAO,CAACC,SAASnJ,EAAE,GAAI,IAAKmJ,SAASnJ,EAAE,GAAI,IAAKmJ,SAASnJ,EAAE,IAAM,IAAK,MAG9E,WACI,MAAMoJ,EAAWrI,SAASsI,gBAAgBC,YACpCC,EAAYxI,SAASsI,gBAAgBG,aACrCC,EAAWL,EAAWG,EACtBG,EAAgBN,EAAW,KAC3BO,EAAYpE,KAAKqE,IAAIR,EAAUG,GAC/BM,EAAatE,KAAKuE,IAAIV,EAAUG,GAChCQ,EAAsBJ,EAAY7M,EAASgB,OAAOT,MAClD2M,EAAoBH,EAAa/M,EAASgB,OAAOR,OACjD2M,EAAmBnN,EAASgB,OAAOoM,mBAAqBR,EAC1DnE,KAAKqE,IAAIG,EAAqBC,GAC9BzE,KAAKuE,IAAIC,EAAqBC,GAClCzN,KAAKgM,OAAOjH,MAAM6I,SAAW,GAAGF,MAChC1N,KAAKgM,OAAOjH,MAAM4E,MAAUuD,EAAW,IAAOL,EAAWa,EAAmBnN,EAASgB,OAAOT,OAAS,GAA5E,KAE7B,2BACI0D,SAASqJ,YAAcpH,IAAWA,EAAML,kBAE5C,SAAS0H,GACD9N,KAAK+N,aACL/N,KAAK+N,YAAYC,OAErBhO,KAAK+N,YAAcD,EACnB9N,KAAK+N,YAAY7D,QAGzB1F,SAAS2B,iBAAiB,oBAAoB,KAE1C+F,OAAO+B,IAAM,IAAIrC,M,mBCvFrBzL,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQkB,YAAS,EACjB,MAAM2M,EAAgB,CAClB,sBACA,yBACA,yBACA,yBACA,wBAEJ7N,EAAQkB,OAAS,CACb4M,OAAO,EACPpH,eAAgB,IAChBqH,eAAgB,IAChBC,kBAAmB,GACnBC,eAAgB,IAChBC,cAAe,GAAKL,EAAc9L,OAClCoM,kBAAkB,EAClBb,kBAAkB,EAClBc,cAAc,EACdjN,gBAAgB,EAChBkN,aAAa,EACbrM,aAAc,GACdsM,aAAc,IACd7N,MAAO,KACPC,OAAQ,IACRmN,cAAeA,EACfU,WAAY,GACZC,OAAQ,CACJ,cAAe,CAAEC,QAAS,6BAC1B,cAAe,CAAEA,QAAS,8BAC1B,cAAe,CAAEA,QAAS,8BAC1B,cAAe,CAAEA,QAAS,+B,qBC/BlC,IAAI/L,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEXxD,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMyD,EAAQL,EAAa,EAAQ,OACnC,MAAMqL,EACF,YAAYnO,EAAI,EAAGC,EAAI,GACnBb,KAAKY,EAAIA,EACTZ,KAAKa,EAAIA,EAEb,IAAID,EAAI,EAAGC,EAAID,GAGX,OAFAZ,KAAKY,EAAIA,EACTZ,KAAKa,EAAIA,EACFb,KAEX,QACI,OAAO,IAAI+O,EAAO/O,KAAKY,EAAGZ,KAAKa,GAEnC,IAAI4C,GAGA,OAFAzD,KAAKY,GAAK6C,EAAE7C,EACZZ,KAAKa,GAAK4C,EAAE5C,EACLb,KAEX,SAASyD,GAGL,OAFAzD,KAAKY,GAAK6C,EAAE7C,EACZZ,KAAKa,GAAK4C,EAAE5C,EACLb,KAEX,QAGI,OAFAA,KAAKY,EAAIoI,KAAKgG,MAAMhP,KAAKY,GACzBZ,KAAKa,EAAImI,KAAKgG,MAAMhP,KAAKa,GAClBb,KAEX,MAAMiP,EAAMC,EAAMC,EAAMC,GAGpB,OAFApP,KAAKY,EAAImD,EAAMqF,MAAM6F,EAAME,EAAMnP,KAAKY,GACtCZ,KAAKa,EAAIkD,EAAMqF,MAAM8F,EAAME,EAAMpP,KAAKa,GAC/Bb,KAEX,SAGI,OAFAA,KAAKY,IAAM,EACXZ,KAAKa,IAAM,EACJb,KAGX,eAAeqP,GAGX,OAFArP,KAAKY,GAAKyO,EACVrP,KAAKa,GAAKwO,EACHrP,KAGX,aAAaqP,GACT,GAAU,IAANA,EACArP,KAAKY,EAAI,EACTZ,KAAKa,EAAI,MAER,CACD,IAAIyO,EAAY,EAAID,EACpBrP,KAAKY,GAAK0O,EACVtP,KAAKa,GAAKyO,EAEd,OAAOtP,KAGX,SACI,OAAOgJ,KAAKuG,KAAKvP,KAAKY,EAAIZ,KAAKY,EAAIZ,KAAKa,EAAIb,KAAKa,GAErD,YACI,OAAOb,KAAKwP,aAAaxP,KAAKoC,UAElC,aAAaqB,GACT,MAAMgM,EAAKzP,KAAKY,EAAI6C,EAAE7C,EAAG8O,EAAK1P,KAAKa,EAAI4C,EAAE5C,EACzC,OAAO4O,EAAKA,EAAKC,EAAKA,EAE1B,WAAWjM,GACP,OAAOuF,KAAKuG,KAAKvP,KAAK2P,aAAalM,IAEvC,KAAKA,EAAGrC,GAGJ,OAFApB,KAAKY,IAAM6C,EAAE7C,EAAIZ,KAAKY,GAAKQ,EAC3BpB,KAAKa,IAAM4C,EAAE5C,EAAIb,KAAKa,GAAKO,EACpBpB,MAIfK,EAAQK,QAAUqO,G,qBCnGlB5O,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMsP,EAAY,EAAQ,MAC1B,MAAMC,UAAqBD,EAAUE,QACjC,YAAc,OAAO9P,KAAK+P,eAC1B,UAAUzP,GAASN,KAAK+P,eAAiBzP,EACzC,YAAYR,GAqBRkB,MAAMlB,EAVO,CACT,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,UACjC,UAAW,UAAW,UAAW,YAGrCE,KAAKgQ,cAAgB,GAEzB,oBAAoBC,EAASC,GACzBD,EAAQlL,MAAMoL,WAAaD,GAGnC7P,EAAQK,QAAUmP,G,qBCjClB,IAAI9M,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEXxD,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQyP,aAAU,EAClB,MAAM9F,EAAS,EAAQ,MACjBjG,EAAQL,EAAa,EAAQ,OAEnC,MAAMoM,UAAgB9F,EAAOC,KACzB,YAAYnK,EAAIsQ,EAASC,GAAa,GAClCrP,MAAMlB,GACNE,KAAKsQ,SAAWF,EAChBpQ,KAAKuQ,gBAAkB,GACvBvQ,KAAKwQ,eAAiB,EACtBxQ,KAAKyQ,gBACLzQ,KAAKkK,OACLlK,KAAK0Q,WAET,oBAAsB,OAAO1Q,KAAKwQ,eAClC,kBAAkBlQ,GACdN,KAAKwQ,eAAiBxH,KAAKqE,IAAI,EAAGrE,KAAKuE,IAAIvN,KAAKsQ,SAASlO,OAAS,EAAG9B,IACrEN,KAAK2Q,4BAA4B3Q,KAAK4Q,iBAAkB5Q,KAAK+P,gBAEjE,qBAAuB,OAAO/P,KAAKsQ,SAAStQ,KAAKwQ,gBACjD,mBAAmBlQ,GACf,IAAIuH,EAAQ7H,KAAKsQ,SAASO,QAAQvQ,IACnB,IAAXuH,IAGJ7H,KAAKgQ,cAAgBnI,GAEzB,kBAAoB,OAAO7H,KAAKyB,SAASiD,UAAUa,SAAS,aAC5D,qBACQuK,EAAQgB,kBACRhB,EAAQgB,iBAAiBJ,WAGjC,gBACI1Q,KAAK+Q,oBACL/Q,KAAKgR,oBAET,kBACIhR,KAAKiR,QACLjR,KAAKyQ,gBAET,WACIzQ,KAAKyB,SAASiD,UAAUC,IAAI,aACxBmL,EAAQgB,kBAAoB9Q,OAC5B8P,EAAQgB,iBAAmB,MAGnC,SACIhB,EAAQoB,cACRlR,KAAKyB,SAASiD,UAAUiB,OAAO,aAC/BmK,EAAQgB,iBAAmB9Q,KAE/B,SACQA,KAAKmR,YACLnR,KAAKoR,SAGLpR,KAAK0Q,WAGb,UAAUpQ,GACNN,KAAKsQ,SAAS1Q,KAAKU,GACnBN,KAAKqR,iBAAiBrR,KAAKsQ,SAASlO,OAAS,EAAG9B,GAChDN,KAAKsR,qBAET,aAAazJ,GACT7H,KAAKsQ,SAAS/N,OAAOsF,EAAO,GAC5B7H,KAAKuQ,gBAAgB1I,GAAOlC,SAC5B3F,KAAKuQ,gBAAgBhO,OAAOsF,EAAO,GAEnC7H,KAAKuR,kBAET,oBACI,IAAItB,EAAUzL,SAASC,cAAc,OACrCwL,EAAQvL,UAAUC,IAAI,UACtB3E,KAAK4Q,iBAAmBX,EACxBlM,EAAMyN,SAASvB,GAAS,IAAMjQ,KAAKwF,WACnCxF,KAAK2Q,4BAA4BV,EAASjQ,KAAK+P,gBAC/C/P,KAAKyB,SAASwD,YAAYgL,GAE9B,oBACI,IAAIA,EAAUzL,SAASC,cAAc,OACrCwL,EAAQvL,UAAUC,IAAI,WACtB3E,KAAKyR,gBAAkBxB,EACvBjQ,KAAK0R,kBACL,IAAIC,EAAI,EACR,IAAK,IAAIzB,KAAUlQ,KAAKsQ,SACpBtQ,KAAKqR,iBAAiBM,EAAGzB,GACzByB,IAEJ3R,KAAKsR,qBACLtR,KAAKyB,SAASwD,YAAYgL,GAE9B,qBACIjQ,KAAKyR,gBAAgB1M,MAAMjE,MAA4C,KAApCkI,KAAKuE,IAAI,EAAGvN,KAAKsQ,SAASlO,QAAiB,KAElF,kBACI,IAAI6N,EAAUzL,SAASC,cAAc,OACrCwL,EAAQvL,UAAUC,IAAI,SACtB3E,KAAKyR,gBAAgBxM,YAAYgL,GAErC,iBAAiBpI,EAAOqI,GACpB,IAAID,EAAUzL,SAASC,cAAc,OACrCwL,EAAQvL,UAAUC,IAAI,UACtBsL,EAAQ2B,QAAQ/J,MAAQ,GAAGA,IAC3B9D,EAAM8N,aAAa5B,GAASxJ,GAASzG,KAAK8R,kBAAkBrL,EAAOyJ,EAAQrI,KAC3E9D,EAAMyN,SAASvB,GAASxJ,GAASzG,KAAK+R,cAActL,EAAOyJ,EAAQrI,KACnE7H,KAAKgS,oBAAoB/B,EAASC,GAClClQ,KAAKyR,gBAAgBxM,YAAYgL,GACjCjQ,KAAKuQ,gBAAgB1I,GAASoI,EAElC,cAAcxJ,EAAOyJ,EAAQrI,GACzB7H,KAAKgQ,cAAgBnI,EACrB7H,KAAK0Q,WACD1Q,KAAKiS,oBACLjS,KAAKiS,mBAAmB/B,EAAQrI,GAGxC,kBAAkBpB,EAAOyJ,EAAQrI,IAEjC,oBAAoBoI,EAASC,IAE7B,4BAA4BD,EAASC,GACjClQ,KAAKgS,oBAAoB/B,EAASC,IAG1C7P,EAAQyP,QAAUA,G,oBClJlB3P,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMsP,EAAY,EAAQ,MACpBsC,EAAiB,EAAQ,MACzB3R,EAAW,EAAQ,MACzB,MAAM4R,UAAqBvC,EAAUE,QACjC,YAAYhQ,GACRkB,MAAMlB,EAAIS,EAASgB,OAAO2M,eAAe,GACzClO,KAAKoS,UAAY,GACjBpS,KAAKgQ,cAAgB,EACrBkC,EAAeG,aAAaC,OACvBrH,MAAMqH,IACP,MAAMC,EAAYD,EAAKE,QAAO5R,GAAKA,EAAE6R,WAAW,WAChD,IAAK,IAAIC,KAAWH,EAChBvS,KAAK2S,oBAAoBD,MAGjCR,EAAeG,aAAaO,mBAAkB,CAACC,EAAQ/S,KACrC,QAAV+S,GAAoB/S,EAAG2S,WAAW,UAClCzS,KAAK2S,oBAAoB7S,MAIrC,YAAc,OAAOE,KAAK+P,eAC1B,oBAAoB+C,GAChBZ,EAAeG,aAAaU,aAAaD,GACpC7H,MAAK+H,IACNhT,KAAKoS,UAAUY,GAAOF,EACtB9S,KAAKiT,UAAUD,MAGvB,kBAAkBvM,EAAOyJ,EAAQrI,GAC7B7H,KAAKkT,YAAYrL,GAErB,oBAAoBoI,EAASC,GACzBD,EAAQlL,MAAMoO,gBAAkB,QAAQjD,MAE5C,4BAA4BD,EAASC,GACjCD,EAAQmD,UAAY,gCAExB,YAAYvL,GACR,IAAIqI,EAASlQ,KAAKsQ,SAASzI,GACvBiL,EAAU9S,KAAKoS,UAAUlC,GACxB4C,GAGLZ,EAAeG,aAAagB,YAAYP,GACnC7H,MAAK,YACCjL,KAAKoS,UAAUlC,GACtBlQ,KAAKsT,aAAazL,GACd7H,KAAKgQ,eAAiBnI,IAEtB7H,KAAKgQ,cAAgBnI,OAKrCxH,EAAQK,QAAUyR,G,qBCxDlBhS,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMsP,EAAY,EAAQ,MAC1B,MAAM2D,UAAoB3D,EAAUE,QAChC,WAAa,OAAO9P,KAAK+P,eACzB,SAASzP,GAASN,KAAK+P,eAAiBzP,EACxC,YAAYR,GAERkB,MAAMlB,EADM,CAAC,EAAG,EAAG,GAAI,KACN,GACjBE,KAAKgQ,cAAgB,EAEzB,oBAAoBC,EAASC,GACzB,MAAMpP,EAAQoP,EAAS,GACvBD,EAAQmD,UAAY,wCAA0CtS,EAAQ,cAG9ET,EAAQK,QAAU6S,G,qBCflB,IAAIpJ,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGlE9K,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQgS,kBAAe,EACvB,EAAQ,MACR,MAAMmB,EAAuBzT,EAAgB,EAAQ,MAC/C0T,EAAU1T,EAAgB,EAAQ,OA8JxCM,EAAQgS,aAAe,IA7JvB,MACI,cAKI,OAJKrS,KAAK0T,WACN1T,KAAK0T,SAAW,IAAIF,EAAqB9S,QACzCV,KAAK2T,WAEF3T,KAAK0T,SAEhB,WAII,OAHK1T,KAAK4T,QACN5T,KAAK4T,MAAQ,IAEV5T,KAAK4T,MAEhB,UAAU9T,GACN,OAAOqK,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,MAAMgT,QAAYhT,KAAK+S,aAAajT,GACpC,IAAKkT,EACD,OAAO,KAEX,MAAMa,EAAM,IAAIC,MAGhB,OAFAD,EAAI/T,GAAKA,EACT+T,EAAIE,IAAMf,EACQ,MAAda,EAAIG,cACEH,EAAIG,SACHH,GAEJ,IAAIrJ,SAAQC,IACfoJ,EAAIlR,OAAS,IAAM8H,EAAQoJ,SAIvC,aAAa/T,GACT,OAAOqK,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,GAAIF,KAAME,KAAKiU,KACX,OAAOjU,KAAKiU,KAAKnU,GAErB,MAAMoU,QAAalU,KAAKmU,SAASrU,GACjC,IAAKoU,EACD,OAAO,KAEX,MAAMlB,EAAMoB,IAAIC,gBAAgBH,GAEhC,OADAlU,KAAKiU,KAAKnU,GAAMkT,EACTA,KAGf,SAASlT,GACL,OAAOE,KAAKsU,QAAQC,QAAQzU,GAEhC,UAAUA,EAAIoU,GACV,OAAO/J,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,UACUA,KAAKsU,QAAQE,QAAQ1U,EAAIoU,GAEnC,MAAOpJ,IAEHhL,KAAME,KAAKiU,MACXG,IAAIK,gBAAgBzU,KAAKiU,KAAKnU,IAElCE,KAAKiU,KAAKnU,GAAMsU,IAAIC,gBAAgBH,GACpClU,KAAK0U,oBAAoB,OAAQ5U,MAGzC,YAAYA,GACR,OAAOE,KAAKsU,QAAQK,WAAW7U,GAC1BmL,MAAK,KACFnL,KAAME,KAAKiU,OACXG,IAAIK,gBAAgBzU,KAAKiU,KAAKnU,WACvBE,KAAKiU,KAAKnU,IAErBE,KAAK0U,oBAAoB,SAAU5U,MAG3C,OACI,OAAOE,KAAKsU,QAAQhC,OAExB,kBAAkBsC,GACd5U,KAAK6U,iBAAmB7U,KAAK6U,kBAAoB,GACjD7U,KAAK6U,iBAAiBjV,KAAKgV,GAE/B,oBAAoB/B,EAAQ/S,GACxB,IAAK,IAAIgV,KAAkB9U,KAAK6U,iBAC5BC,EAAejC,EAAQ/S,GAG/B,QACIE,KAAKsU,QAAQrD,QAEjB,wBACI,OAAO9G,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,IAAI+U,EAAQ,EACZ,IAAIzC,QAAatS,KAAKsS,OAClB0C,EAAM,IAAIvB,EAAQ/S,QACtB,IAAK,IAAIZ,KAAMwS,EAAM,CACjB,MAAMU,QAAYhT,KAAK+S,aAAajT,GAC9BoU,QAAae,MAAMjC,GAAK/H,MAAKiK,GAAKA,EAAEhB,SACrCA,IAGLc,EAAIG,KAAKrV,EAAIoU,GACba,GAAS,GAEb,GAAa,GAATA,EAGJ,OAAOC,EAAII,cAAc,CAAEC,KAAM,YAGzC,oBAAoBC,GAChB,OAAOnL,EAAUnK,UAAM,OAAQ,GAAQ,mBACjByT,EAAQ/S,QAAQ6U,UAAUD,IACxCE,SAAQ,CAACC,EAAMN,IAAShL,EAAUnK,UAAM,OAAQ,GAAQ,YACxD,MAAM0V,QAAeP,EAAKQ,MAAM,eAC1BzB,EAAO,IAAI0B,KAAK,CAACF,GAAS,CAAE,KAAQ,cAC1C1V,KAAK6V,UAAUV,EAAKW,KAAM5B,WAItC,UACI,OAAO/J,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,IAAI+V,GAAe,EACnB,IAAIzD,QAAatS,KAAKsS,OACtB,IAAK,IAAIxS,KAAMwS,EAAM,CACjB,IAAKxS,EAAG2S,WAAW,WAAa3S,EAAG2S,WAAW,SAC1C,SAEJ,GAAI3S,EAAGkW,SAAS,QACZ,SAEJ,MAAMC,EAAQnW,EAAGoW,QAAQ,QAAS,SAAW,OACvCvU,QAAa3B,KAAKsU,QAAQC,QAAQzU,SAClCE,KAAKsU,QAAQE,QAAQyB,EAAOtU,SAC5B3B,KAAKsU,QAAQK,WAAW7U,GAC9BqW,QAAQC,IAAI,YAAYtW,QAASmW,MACjCF,GAAe,EAEfA,GACAM,SAASC,YAIrB,iBACI,OAAOnM,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,IAAIuW,EAAS,EACb,IAAIjE,QAAatS,KAAKsS,OACtB,IAAK,IAAIxS,KAAMwS,EAAM,CACjB,MAAMU,QAAYhT,KAAK+S,aAAajT,GAC9BoU,QAAae,MAAMjC,GAAK/H,MAAKiK,GAAKA,EAAEhB,SACrCA,IAGLqC,GAAUrC,EAAKsC,MAEnB,OAAOD,Q,oBC1KnB,IAAIxW,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMmW,EAAgB1W,EAAgB,EAAQ,OACxC2W,EAAmB3W,EAAgB,EAAQ,OACjD,MAAM4W,UAA2BD,EAAiBhW,QAC9C,cACIM,SAAS4V,WACT5W,KAAK6W,YAAcJ,EAAc/V,QAAQoW,eAAe,CAAEhB,KAAM,eAEpE,QAAQhW,GACJ,OAAOE,KAAK6W,YAAYtC,QAAQzU,GAEpC,QAAQA,EAAIoU,GACR,OAAOlU,KAAK6W,YAAYrC,QAAQ1U,EAAIoU,GAExC,WAAWpU,GACP,OAAOE,KAAK6W,YAAYlC,WAAW7U,GAEvC,OACI,OAAOE,KAAK6W,YAAYvE,OAE5B,QAAQyE,GACJ,OAAO/W,KAAK6W,YAAYG,QAAQD,GAEpC,QACI,OAAO/W,KAAK6W,YAAY5F,SAGhC5Q,EAAQK,QAAUiW,G,mBC9BlBxW,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IAGtDD,EAAQK,QAFR,S,qBCDA,IAAIqC,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEP5D,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAM2W,EAASlX,EAAgB,EAAQ,OACjCiE,EAAWjE,EAAgB,EAAQ,OACnCgE,EAAQL,EAAa,EAAQ,OAEnC,MAAMwT,UAAgBD,EAAOvW,QACzB,YAAYyW,EAASC,EAAUC,EAAY,UACvCrW,MAAMmW,EAASC,GACfpX,KAAKsX,WAAaD,EAClBrX,KAAKuX,iBAET,iBACI,IAAIC,EAAchT,SAASC,cAAc,UACzC+S,EAAY1X,GAAK,QACjB0X,EAAY1W,MAAQ,GACpB0W,EAAYzW,OAAS,GACrBf,KAAKyX,UAAYD,EAAYrW,WAAW,KAAM,CAAEC,OAAO,IACvDpB,KAAKyX,UAAUpW,sBAAwB,OACvCrB,KAAKyX,UAAUnW,uBAAwB,EAE3C,KAAKK,GACD3B,KAAK0X,SAASC,gBAAgBhW,EAAKyD,SAASoC,QAAQwH,SACpDhP,KAAK4X,QAAU,CAACjW,EAAKyD,UACrB,MAAMtE,EAAQd,KAAK6X,SAASlW,EAAKmW,SAAUnW,EAAKoW,OAChD/X,KAAKgY,QAAU,CAAClX,GAChBd,KAAKiY,YAAc,EACnB,IAAIpS,EAAM7F,KAAK0X,SAASQ,UAAUrS,IAClCA,EAAIsS,UAAYnY,KAAKoY,MACrBvS,EAAIwS,YAAcrY,KAAKoY,MASvBpY,KAAK0X,SAASQ,UAAUrS,IAAIyS,yBAA2BtY,KAAKsX,WAC5DtX,KAAKuY,kBAET,KACIvY,KAAK0X,SAASc,qBAElB,KAAKC,GACGzY,KAAK0Y,qBACL1Y,KAAK2Y,WACL3Y,KAAK0Y,oBAAqB,GAGlC,kBACI1Y,KAAK0Y,oBAAqB,EAE9B,WACI,GAA2B,GAAvB1Y,KAAK4X,QAAQxV,OACb,OAEJ,IAAIyD,EAAM7F,KAAK0X,SAASQ,UAAUrS,IAClC7F,KAAK4Y,mBAAmB/S,EAAK7F,KAAK4X,QAAQiB,MAAM7Y,KAAKiY,aAAcjY,KAAKgY,QAAQa,MAAM7Y,KAAKiY,cAuB3FjY,KAAKiY,YAAcjP,KAAKqE,IAAI,EAAGrN,KAAK4X,QAAQxV,OAAS,GAEzD,mBAAmByD,EAAKiT,EAAQC,GAC5B,MAAMC,EAAaF,EAAO1W,OAC1B,GAAkB,GAAd4W,EACA,OAEJnT,EAAIoT,QAAU,QACdpT,EAAIqT,SAAW,QACf,IAAIC,EAAQL,EAAO,GACfM,EAAaL,EAAO,GAAK/Y,KAAKqZ,UAChB,GAAdL,IAEAnT,EAAIyT,YACJzT,EAAI0T,IAAIJ,EAAMvY,EAAGuY,EAAMtY,EAAG,GAAMuY,EAAY,EAAG,EAAIpQ,KAAKwQ,IACxD3T,EAAI4T,QAER,IAAK,IAAI9H,EAAI,EAAGA,EAAIqH,EAAYrH,IAC5B9L,EAAIyT,YACJzT,EAAIwT,UAAYN,EAAOpH,GAAK3R,KAAKqZ,UACjCxT,EAAI6T,OAAOZ,EAAOnH,EAAI,GAAG/Q,EAAGkY,EAAOnH,EAAI,GAAG9Q,GAC1CgF,EAAI6T,OAAOZ,EAAOnH,GAAG/Q,EAAGkY,EAAOnH,GAAG9Q,GAClCgF,EAAI8T,SAGZ,UAAU9T,EAAKjF,EAAGC,EAAGC,GACjB,IAAI8Y,EAAiB,GAAR9Y,EACbF,GAAKgZ,EACL/Y,GAAK+Y,EAIL/T,EAAI9D,UAAU/B,KAAKyX,UAAUvW,OAAQN,EAAGC,EAAGC,EAAOA,GAEtD,KAAKa,GACD,IAAIkY,EAAY7Z,KAAK8Z,kBAAkBnY,EAAKyD,UAC5CpF,KAAK4X,QAAU5X,KAAK4X,QAAQmC,OAAOF,GACnC,MAAMG,EAAcH,EAAUzX,OAC9B,IAAItB,EAAQd,KAAK6X,SAASlW,EAAKmW,SAAUnW,EAAKoW,OAC9C,MAAMkC,EAAYja,KAAKgY,QAAQhY,KAAKgY,QAAQ5V,OAAS,GAE/C8X,EAD+B,EACqBF,EAC1DlZ,EAAQiD,EAAMqF,MAAM6Q,EAAYC,EAAoBD,EAAYC,EAAoBpZ,GACpF,IAAK,IAAI6Q,EAAI,EAAGA,EAAIqI,EAAarI,IAC7B3R,KAAKgY,QAAQpY,KAAKmE,EAAMoW,KAAKF,EAAWnZ,EAAO6Q,EAAIqI,IAEvDha,KAAKuY,kBAET,kBAAkB6B,GACd,MAAMC,EAAgBrR,KAAKqE,IAAI,EAAG,GAAMrN,KAAKqZ,WACvCP,EAAS,GACf,GAA2B,GAAvB9Y,KAAK4X,QAAQxV,OACb,OAEJ,MAAM+W,EAAQnZ,KAAK4X,QAAQ5X,KAAK4X,QAAQxV,OAAS,GAC3CkY,EAAMF,EACNG,EAAOpB,EAAMrQ,WAAWwR,GAC9B,GAAIC,EAAOF,EACP,OAAOvB,EAEX,IAAI0B,EAAUrB,EACd,GAAInZ,KAAK4X,QAAQxV,OAAS,EAAG,CACzB,MAAMqY,EAAWza,KAAK4X,QAAQ5X,KAAK4X,QAAQxV,OAAS,GAC9CsY,EAAUvB,EAAM3R,QAAQE,SAAS+S,GAAUE,YACjDH,EAAUrB,EAAM3R,QAAQ7C,IAAI+V,EAAQlT,QAAQC,eAAe,GAAM8S,IAErE,MAAMK,EAAIP,EAAgBE,EAC1B,IAAK,IAAI5I,EAAIiJ,EAAGjJ,GAAK,EAAGA,GAAKiJ,EAAG,CAC5B,MAAM7L,EAAS/O,KAAK6a,sBAAsB1B,EAAOqB,EAASF,EAAK3I,GAC/DmH,EAAOlZ,KAAKmP,GAEhB,OAAO+J,EAEX,sBAAsBK,EAAOqB,EAASF,EAAKM,GACvC,MAAME,GAAM,EAAIF,IAAM,EAAIA,GACpBG,EAAK,EAAIH,GAAK,EAAIA,GAClBI,EAAKJ,EAAIA,EACf,OAAO,IAAI5W,EAAStD,QAAQyY,EAAMvY,EAAIka,EAAKN,EAAQ5Z,EAAIma,EAAKT,EAAI1Z,EAAIoa,EAAI7B,EAAMtY,EAAIia,EAAKN,EAAQ3Z,EAAIka,EAAKT,EAAIzZ,EAAIma,GAEpH,kBACIhb,KAAKuY,kBAET,SAAST,EAAUC,GAEf,OAAOD,EADC/T,EAAMqF,MAAM,EAAG,EAAG2O,GAG9B,gBACI,IAAK/X,KAAK0X,SAASuD,YACf,OAEJ,IAAIpV,EAAM7F,KAAKkb,eACfrV,EAAIyS,yBAA2B,iBAC/BzS,EAAI9D,UAAU/B,KAAK0X,SAASuD,YAAY/Z,OAAQ,EAAG,GACnD2E,EAAIyS,yBAA2B,eAGvCjY,EAAQK,QAAUwW,G,oBCtMlB,IAAInU,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEPwG,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGlE9K,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAM2W,EAASlX,EAAgB,EAAQ,OACjCiE,EAAWjE,EAAgB,EAAQ,OACnCob,EAASpb,EAAgB,EAAQ,OACjCmS,EAAiB,EAAQ,MACzBnO,EAAQL,EAAa,EAAQ,OAC7BnD,EAAW,EAAQ,MACnB6a,EAAe,EAAQ,MAE7B,MAAMC,UAAsBpE,EAAOvW,QAC/B,YAAYyW,EAASC,GACjBpW,MAAMmW,EAASC,GACfpX,KAAKsb,iBAAmB,kBACxBtb,KAAKub,WAAaJ,EAAOza,QAAQ8a,QACjCxb,KAAKyb,cAAgBjX,SAASyH,eAAe,2BAC7ClI,EAAMyN,SAASxR,KAAKyb,eAAe,IAAMzb,KAAK0b,mBAC9C1b,KAAK2b,aAAenX,SAASyH,eAAe,0BAC5ClI,EAAMyN,SAASxR,KAAK2b,cAAc,IAAM3b,KAAK4b,2BAC7C5b,KAAK6b,YAAcrX,SAASyH,eAAe,yBAC3ClI,EAAMyN,SAASxR,KAAK6b,aAAa,IAAM7b,KAAK8b,4BAC5C9b,KAAK+b,gBAAkBvX,SAASyH,eAAe,6BAC/ClI,EAAMyN,SAASxR,KAAK+b,iBAAiB,KACjC/b,KAAKgc,eAAe9a,OAAO+a,QAAO/H,GAAQkH,EAAac,OAAOhI,EAAM,kBAExElU,KAAKmc,sBAAuB,EAC5Bnc,KAAKmC,UAAY,IAAI6B,EAAStD,QAAQ,EAAG,GAE7C,qBAAuB,OAAOV,KAAK0X,SAAS0E,SAASpc,KAAKsb,kBAC1D,gBAAkB,OAAOtb,KAAKub,WAC9B,2BAA6B,OAAOvb,KAAKqc,sBACzC,yBAAyB/b,GACrBN,KAAKqc,sBAAwB/b,EAC7BN,KAAKsc,+BAA+Bhc,GAExC,wBAA0B,OAAON,KAAKuc,mBACtC,sBAAsBjc,GAClBN,KAAKuc,mBAAqBjc,EAC1BN,KAAK6b,YAAYnX,UAAUc,OAAO,WAAYlF,GAElD,+BAA+Bkc,GAC3Bxc,KAAKyb,cAAc/W,UAAUc,OAAO,UAAWgX,GAC/Cxc,KAAK2b,aAAajX,UAAUc,OAAO,UAAWgX,GAC9Cxc,KAAK+b,gBAAgBrX,UAAUc,OAAO,UAAWgX,GACjDxc,KAAK6b,YAAYnX,UAAUc,OAAO,UAAWgX,GAEjD,SACIxb,MAAMyb,SACNzc,KAAK0c,uBACL1c,KAAKmc,sBAAuB,EAC5Bnc,KAAK2c,mBAAoB,EAE7B,UACI3b,MAAM4b,UACN5c,KAAK4b,yBACL5b,KAAK6c,wBACL7c,KAAKmc,sBAAuB,EAEhC,KAAKxa,GACD3B,KAAKmC,UAAYnC,KAAK8c,mBAAmBnb,GACzC3B,KAAK+c,oBAET,KAAKpb,GACD3B,KAAKmC,UAAYnC,KAAK8c,mBAAmBnb,GACzC3B,KAAKgd,8BAET,GAAGrb,GACC3B,KAAKid,eAET,oBACIjd,KAAK4b,yBACL5b,KAAKgc,eAAepW,mBAAmB,EAAG,EAAG5F,KAAK0X,SAAS5W,MAAOd,KAAK0X,SAAS3W,QAChFf,KAAKgc,eAAe9W,UAAU,IAAIlB,EAAStD,QAAQ,EAAG,GAAI,EAAG,GAC7DV,KAAKgc,eAAekB,UAAW,EAC/Bld,KAAKmc,sBAAuB,EAC5Bnc,KAAK2c,mBAAoB,EACzB3c,KAAKmd,eAAiBnd,KAAKmC,UAC3B,IAAI0D,EAAM7F,KAAKgc,eAAenW,IAC9BA,EAAIE,aAAa,EAAG,EAAG,EAAG,EAAG,EAAG,GAChCF,EAAIwS,YAAc,QAClBxS,EAAIoT,QAAU,QACdpT,EAAIqT,SAAW,QACfrT,EAAIwT,UAAY,EAChBxT,EAAIuX,YAAY,CAAC,EAAG,IACpBpd,KAAKgd,8BAET,mBAAmBrb,GACf,OAAOA,EAAKyD,SAAS4J,QAAQ5F,MAAM,EAAG,EAAGpJ,KAAK0X,SAAS5W,MAAQ,EAAGd,KAAK0X,SAAS3W,OAAS,GAE7F,KAAK0X,GACGzY,KAAKqd,iCACLrd,KAAKsd,gCACLtd,KAAKqd,gCAAiC,GAG9C,QAAQ5W,GACJ,OAAQA,EAAM8W,MACV,IAAK,YACDvd,KAAK0b,kBASjB,iBACI1b,KAAKgc,eAAe/K,QACpBjR,KAAK+c,oBAET,SAASlb,GACL7B,KAAKmc,sBAAuB,EAC5Bnc,KAAKgc,eAAepZ,OAAOf,EAAMf,MAAOe,EAAMd,QAC9Cf,KAAKgc,eAAekB,UAAW,EAC/Bld,KAAKgc,eAAeja,UAAUF,GAC9B7B,KAAK2c,mBAAoB,EAE7B,YAAY3J,GACR,OAAO7I,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,MAAM6T,EAAM,IAAIC,MAEhB,OADAD,EAAIE,IAAMf,EACH,IAAIxI,SAAQC,IACfoJ,EAAIlR,OAAS,KACT3C,KAAKwd,SAAS3J,GACdpJ,EAAQoJ,UAKxB,8BACI7T,KAAKqd,gCAAiC,EAE1C,gCACI,GAAIrd,KAAKmc,qBACL,OAEJnc,KAAKgc,eAAe/K,QACpB,IAAIpL,EAAM7F,KAAKgc,eAAenW,IAC9B,MAAMjF,EAAIoI,KAAKuE,IAAIvN,KAAKmd,eAAevc,EAAGZ,KAAKmC,UAAUvB,GACnDC,EAAImI,KAAKuE,IAAIvN,KAAKmd,eAAetc,EAAGb,KAAKmC,UAAUtB,GACnDC,EAAQkI,KAAKyU,IAAIzd,KAAKmd,eAAevc,EAAIZ,KAAKmC,UAAUvB,GACxDG,EAASiI,KAAKyU,IAAIzd,KAAKmd,eAAetc,EAAIb,KAAKmC,UAAUtB,GAC/Db,KAAKub,WAAa,IAAIJ,EAAOza,QAAQE,EAAGC,EAAGC,EAAOC,GAClD8E,EAAI6X,WAAW9c,EAAGC,EAAGC,EAAOC,GAEhC,wBACIf,KAAK0X,SAASiG,YAAY3d,KAAKgc,gBAEnC,uBACQhc,KAAKgc,iBAGThc,KAAK0X,SAASkG,eAAe5d,KAAKsb,iBAAkB,EAAG,EAAGtb,KAAK0X,SAAS5W,MAAOd,KAAK0X,SAAS3W,QAAQ,GACrGf,KAAKgc,eAAetV,YAAeD,IAC3BA,EAAMW,OACNpH,KAAK8b,0BAGT9b,KAAK4b,2BAGb,eAGI,GAFA5b,KAAKgc,eAAe/K,QACpBjR,KAAKub,WAAaxX,EAAM8Z,qBAAqB7d,KAAK0X,SAASQ,UAAUrS,IAAK7F,KAAK8d,WAC3E9d,KAAK8d,UAAUC,UACf,OAEJ/d,KAAKmc,sBAAuB,EAC5B,MAAM,EAAEvb,EAAC,EAAEC,EAAC,MAAEC,EAAK,OAAEC,GAAWf,KAAK8d,UACrC9d,KAAKgc,eAAepW,mBAAmBhF,EAAGC,EAAGC,EAAOC,GACpDf,KAAKgc,eAAekB,UAAW,EAC/Bld,KAAKgc,eAAenW,IAAI9D,UAAU/B,KAAK0X,SAASQ,UAAUhX,OAAQN,EAAGC,EAAGC,EAAOC,EAAQ,EAAG,EAAGD,EAAOC,GACpGf,KAAK0X,SAASQ,UAAUjH,MAAMjR,KAAK8d,WACnC9d,KAAK0X,SAASc,qBAElB,yBACSxY,KAAKmc,uBAGVnc,KAAK0X,SAASQ,UAAUrS,IAAIyS,yBAA2B,cACvDtY,KAAKgc,eAAegC,aAAahe,KAAK0X,SAASQ,UAAUrS,KACzD7F,KAAK0X,SAASc,sBAElB,0BACItG,EAAeG,aAAaC,OACvBrH,MAAMqH,IAEP,GADkBA,EAAKE,QAAO5R,GAAKA,EAAE6R,WAAW,WAClCrQ,QAAU7B,EAASgB,OAAOgN,cAEpC,YADA4H,QAAQC,IAAI,iFAGhB,MAAMtW,EAAK,QAAQme,KAAKC,YACxB/H,QAAQC,IAAI,wBAAwBtW,KACpCE,KAAKgc,eAAe9a,OAAO+a,QAAO/H,GAAQhC,EAAeG,aAAawD,UAAU/V,EAAIoU,KACpFlU,KAAK2c,mBAAoB,KA4BjC,YACI3c,KAAK+c,oBACL/c,KAAKub,WAAa,IAAIJ,EAAOza,QAAQ,EAAG,EAAGV,KAAK0X,SAAS5W,MAAOd,KAAK0X,SAAS3W,QAC9Ef,KAAKid,gBAGb5c,EAAQK,QAAU2a,G,mBCnQlBlb,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IAEtD,MAAM6d,EACF,YAAYhH,EAASC,GACjBpX,KAAK0X,SAAWP,EAChBnX,KAAKoe,eAAiB5Z,SAASyH,eAAemL,GAElD,YAAc,OAAOpX,KAAK0X,SAASU,MAEnC,cAAgB,OAAOpY,KAAK0X,SAAS2G,QACrC,gBAAkB,OAAOre,KAAK0X,SAAS2B,UAIvC,kBACI,IAAI7B,EAAchT,SAASC,cAAc,UACzC+S,EAAY1X,GAAK,SACjB0X,EAAY1W,MAAQd,KAAK0X,SAAS5W,MAClC0W,EAAYzW,OAASf,KAAK0X,SAAS3W,OACnCod,EAAKG,WAAa9G,EAAYrW,WAAW,KAAM,CAAEC,OAAO,IACxD+c,EAAKG,WAAWjd,sBAAwB,OACxC8c,EAAKG,WAAWhd,uBAAwB,EAE5C,eAII,OAHuB,MAAnB6c,EAAKG,YACLte,KAAKue,kBAEFJ,EAAKG,WAEhB,SACIte,KAAKoe,eAAe1Z,UAAUC,IAAI,YAEtC,UACI3E,KAAKoe,eAAe1Z,UAAUiB,OAAO,YAEzC,KAAKhE,IACL,KAAKA,IACL,GAAGA,IACH,mBACA,KAAK8W,IACL,QAAQhS,KAEZpG,EAAQK,QAAUyd,G,mBC1ClBhe,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMke,EACF,YAAY5d,EAAGC,EAAGC,EAAOC,GACrBf,KAAKY,EAAIA,EACTZ,KAAKa,EAAIA,EACTb,KAAKc,MAAQA,EACbd,KAAKe,OAASA,EAElB,WAAa,OAAOf,KAAKY,EACzB,WAAa,OAAOZ,KAAKa,EACzB,WAAa,OAAOb,KAAKY,EAAIZ,KAAKc,MAClC,WAAa,OAAOd,KAAKa,EAAIb,KAAKe,OAClC,UACI,OAAOf,KAAKc,OAAS,GAAKd,KAAKe,QAAU,EAE7C,eACI,OAAO,IAAIyd,EAAK,EAAG,EAAG,EAAG,IAGjCne,EAAQK,QAAU8d,G,qBCnBlB,IAAIrU,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGlE9K,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQoe,WAAape,EAAQwd,qBAAuBxd,EAAQqe,UAAYre,EAAQse,cAAgBte,EAAQue,WAAave,EAAQwe,UAAYxe,EAAQ+I,MAAQ/I,EAAQ8Z,KAAO9Z,EAAQye,iBAAmBze,EAAQwR,aAAexR,EAAQmR,SAAWnR,EAAQ+V,IAAM/V,EAAQ0e,mBAAqB1e,EAAQgG,uBAAyBhG,EAAQ2e,YAAc3e,EAAQ4e,OAAS5e,EAAQ6e,iBAAc,EACtX,MAAM3e,EAAW,EAAQ,MACnB4a,EAASpb,EAAgB,EAAQ,OACjCiE,EAAWjE,EAAgB,EAAQ,OAwKzC,SAASoa,EAAKS,EAAGuE,EAAG/d,GAChB,OAAOwZ,GAAK,EAAIxZ,GAAS+d,EAAI/d,EAxKhB,EAAQ,MAYzBf,EAAQ6e,YATR,SAAqBE,EAAOC,EAAW,GACnC,GAAc,IAAVD,EACA,MAAO,UACX,MACME,EAAKD,EAAW,EAAI,EAAIA,EAExB1N,EAAI3I,KAAKuW,MAAMvW,KAAKoN,IAAIgJ,GAASpW,KAAKoN,IAHlC,OAIV,OAAOoJ,YAAYJ,EAAQpW,KAAKyW,IAJtB,KAI6B9N,IAAI+N,QAAQJ,IAAO,IAF5C,CAAC,QAAS,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAEI3N,IAqB1EtR,EAAQ4e,OAlBR,SAAgBU,GACZ,OAAOxV,EAAUnK,UAAM,OAAQ,GAAQ,YACnC,OAAO,IAAIwK,SAAQC,IACf,MAAMmV,EAAQpb,SAASC,cAAc,SACrCmb,EAAMvK,KAAO,OACbuK,EAAMD,OAASA,EACfC,EAAMC,SAAW,KACb,GAA0B,GAAtBD,EAAME,MAAM1d,OACZ,OAEJ,IAAI+S,EAAOyK,EAAME,MAAM,GACvBrV,EAAQ0K,GACRyK,EAAMja,UAEVia,EAAMG,eAgBlB1f,EAAQ2e,YAXR,SAAqBnd,GACjB,MAAMX,EAASsD,SAASC,cAAc,UAMtC,OALAvD,EAAOpB,GAAK,gBACZoB,EAAOJ,MAAQe,EAAMgB,aACrB3B,EAAOH,OAASc,EAAMiB,cACV5B,EAAOC,WAAW,KAAM,CAAEC,OAAO,IACzCW,UAAUF,EAAO,EAAG,GACjB,IAAI2I,SAAQC,IACfvJ,EAAO+a,QAAO/H,GAAQzJ,EAAQyJ,SAOtC7T,EAAQgG,uBAHR,WACI,OAA8B,MAAvB6F,OAAO8T,cAOlB3f,EAAQ0e,mBAJR,SAA4Bjf,GACxB,IAAImgB,EACJ,OAA6C,QAArCA,EAAK1f,EAASgB,OAAOsN,OAAO/O,UAAwB,IAAPmgB,OAAgB,EAASA,EAAGnR,SASrFzO,EAAQ+V,IANR,SAAa8J,KAAYC,GAChB5f,EAASgB,OAAO4M,OAGrBgI,QAAQC,IAAI8J,EAASC,IA8EzB9f,EAAQmR,SA3ER,SAAkBvB,EAAS2E,EAAUwL,GAAmB,GACpD,IAAIC,EACAC,EACAC,EACAC,EACAC,EACAC,EA0BJ,SAASvY,EAAU1B,GAIf,GAHK2Z,GACD3Z,EAAML,kBAELoa,EACD,OAEJ,MAAMG,EAAQla,EAAMma,eAAe,GAE/Bpc,SAASqc,iBAAiBF,EAAMG,MAAOH,EAAMI,QAAUta,EAAMua,SAC7DR,GAAa,EACbvQ,EAAQvL,UAAUiB,OAAO,UAEzB+a,GAAYja,EAAMK,UAAY2Z,EAAiBlgB,EAASgB,OAAO+M,iBAC3D8R,IACCpX,KAAKyU,IAAIkD,EAAMG,MAAQT,GAAgB9f,EAASgB,OAAO8M,mBACpDrF,KAAKyU,IAAIkD,EAAMI,MAAQT,GAAgB/f,EAASgB,OAAO8M,qBAC3DmS,GAAa,EACbvQ,EAAQvL,UAAUiB,OAAO,SAK7Bc,EAAMK,UAAY2Z,EAAiBlgB,EAASgB,OAAO+M,iBAC/CtF,KAAKyU,IAAIkD,EAAMG,MAAQT,GAAgB,GACvCrX,KAAKyU,IAAIkD,EAAMI,MAAQT,GAAgB,KACvCI,GAAW,GAIvB,SAAStY,EAAS3B,GACdA,EAAML,iBACN6J,EAAQzJ,oBAAoB,YAAa2B,GACzC8H,EAAQzJ,oBAAoB,WAAY4B,GACxC6H,EAAQvL,UAAUiB,OAAO,QACpB6a,IAGLA,GAAa,EACbD,EAAU,KACV3L,EAAS9Q,KAAK2C,EAAMua,OAAQva,IAjEhCwJ,EAAQ9J,iBAAiB,cAOzB,SAAoBM,GAIhB,GAHK2Z,GACD3Z,EAAML,iBAENoa,GAAc/Z,EAAMyB,QAAQ9F,OAAS,EACrC,OAEJ,MAAMue,EAAQla,EAAMma,eAAe,GACnCJ,GAAa,EACbD,EAAUI,EAAMM,WAChBP,GAAW,EACXL,EAAeM,EAAMG,MACrBR,EAAeK,EAAMI,MACrBN,EAAiBha,EAAMK,UACvBmJ,EAAQvL,UAAUC,IAAI,QACtBsL,EAAQ9J,iBAAiB,YAAagC,GACtC8H,EAAQ9J,iBAAiB,WAAYiC,MAtBzC6H,EAAQ9J,iBAAiB,WACzB,SAAiBM,GACbA,EAAML,iBACNK,EAAMya,kBACNtM,EAAS9Q,KAAK2C,EAAMua,OAAQva,OA0FpCpG,EAAQwR,aA1BR,SAAsB5B,EAAS2E,GAC3B,IAAIuM,EACAC,EAASphB,KACTqhB,GAAS,EAKb,SAASC,EAAK7a,GACV4a,GAAS,EACTF,EAAQI,YAAW,KACf3M,EAAS9Q,KAAKsd,EAAQ3a,GACtB4a,GAAS,IACV9gB,EAASgB,OAAO6M,gBAEvB,SAASoT,EAAG/a,GACJ4a,GACA5a,EAAMgb,2BACNxR,EAAQvL,UAAUiB,OAAO,QACzB0b,GAAS,GAGTK,aAAaP,GAlBrBlR,EAAQ9J,iBAAiB,aAAcmb,GACvCrR,EAAQ9J,iBAAiB,WAAYqb,GACrCvR,EAAQ9J,iBAAiB,YAAamb,GACtCrR,EAAQ9J,iBAAiB,UAAWqb,IAuBxCnhB,EAAQye,iBAHR,WACI,OAAOb,KAAKC,MAAMyD,YAMtBthB,EAAQ8Z,KAAOA,EAIf9Z,EAAQ+I,MAHR,SAAewY,EAAOC,EAAOC,GACzB,OAAO9Y,KAAKuE,IAAIsU,EAAO7Y,KAAKqE,IAAIuU,EAAOE,KAwB3CzhB,EAAQwe,UArBR,SAAmBkD,EAAQC,EAAQ5gB,GAC/B,GAAa,GAATA,EACA,OAAO2gB,EAEX,GAAa,GAAT3gB,EACA,OAAO4gB,EAEX,MACMC,GAAe,SAATF,IAAwB,GAC9BG,GAAe,MAATH,IAAwB,EAC9BI,EAAe,IAATJ,EAENK,GAAe,SAATJ,IAAwB,GAC9BK,GAAe,MAATL,IAAwB,EAC9BM,EAAe,IAATN,EAKZ,OAJUhZ,KAAKuW,MAAMpF,EAAKgI,EAAIG,EAAIlhB,KACxB4H,KAAKuW,MAAMpF,EAAK+H,EAAIG,EAAIjhB,KAGjB,IAFP4H,KAAKuW,MAAMpF,EAAK8H,EAAIG,EAAIhhB,KAEN,IAAM,YAqBtCf,EAAQue,WAlBR,SAAoB2D,EAAMC,EAAMC,GAC5B,MAAM3hB,EAAQyhB,EAAKrhB,OAAOJ,MACpBC,EAASwhB,EAAKrhB,OAAOH,OACrB2hB,EAAQH,EAAK7gB,aAAa,EAAG,EAAGZ,EAAOC,GACvC4hB,EAAQH,EAAK9gB,aAAa,EAAG,EAAGZ,EAAOC,GACvC6hB,EAAWH,EAAQ/gB,aAAa,EAAG,EAAGZ,EAAOC,GAC7C8hB,EAAM,IAAIC,kBAAkBJ,EAAM/gB,KAAK+T,QACvCqN,EAAM,IAAID,kBAAkBH,EAAMhhB,KAAK+T,QACvCsN,EAAM,IAAIF,kBAAkBF,EAASjhB,KAAK+T,QAChD,IAAK,IAAI/D,EAAI,EAAGA,EAAI7Q,EAAQC,EAAQ4Q,IAAK,CACrC,MAAMiJ,EAAIoI,EAAQ,EAAJrR,EAAQ,GAAK,IAC3BkR,EAAQ,EAAJlR,EAAQ,IAAM,EAAIiJ,GAAKiI,EAAQ,EAAJlR,EAAQ,GAAKiJ,EAAImI,EAAQ,EAAJpR,EAAQ,GAC5DkR,EAAQ,EAAJlR,EAAQ,IAAM,EAAIiJ,GAAKiI,EAAQ,EAAJlR,EAAQ,GAAKiJ,EAAImI,EAAQ,EAAJpR,EAAQ,GAC5DkR,EAAQ,EAAJlR,EAAQ,IAAM,EAAIiJ,GAAKiI,EAAQ,EAAJlR,EAAQ,GAAKiJ,EAAImI,EAAQ,EAAJpR,EAAQ,GAC5DkR,EAAQ,EAAJlR,EAAQ,IAAM,EAAIiJ,GAAKiI,EAAQ,EAAJlR,EAAQ,GAAKiJ,EAAImI,EAAQ,EAAJpR,EAAQ,GAEhE4Q,EAAK3gB,aAAa8gB,EAAO,EAAG,IAiBhCriB,EAAQse,cAdR,SAAuBsE,GACnB,IAAI/N,EAAI,EAAGgO,EAAI,EAAG/D,EAAI,EAWtB,OAVgB,GAAZ8D,EAAE7gB,QACF8S,EAAItI,SAASqW,EAAE,GAAKA,EAAE,GAAI,IAC1BC,EAAItW,SAASqW,EAAE,GAAKA,EAAE,GAAI,IAC1B9D,EAAIvS,SAASqW,EAAE,GAAKA,EAAE,GAAI,MAG1B/N,EAAItI,SAASqW,EAAE,GAAKA,EAAE,GAAI,IAC1BC,EAAItW,SAASqW,EAAE,GAAKA,EAAE,GAAI,IAC1B9D,EAAIvS,SAASqW,EAAE,GAAKA,EAAE,GAAI,KAEvB,WAAa/N,GAAKgO,GAAK,IAAM/D,GAAK,KAqH7C9e,EAAQqe,UAlHR,SAAmByE,EAAWC,EAAMC,EAAejL,GAC/C,MACMtX,EAAQqiB,EAAUjiB,OAAOJ,MACzBC,EAASoiB,EAAUjiB,OAAOH,OAE1BuiB,EADaH,EAAUzhB,aAAa,EAAG,EAAGZ,EAAOC,GACvBY,KAY1B4hB,IAXNF,EAAgBA,EAAc7b,QAAQwH,SACLpO,EAAIyiB,EAAcxiB,EAU3B,MALT+L,SAASwL,EAAM,GAAKA,EAAM,GAAI,IAC9BxL,SAASwL,EAAM,GAAKA,EAAM,GAAI,IAC9BxL,SAASwL,EAAM,GAAKA,EAAM,GAAI,MAK7C,IAAK,IAAIzG,EAAI,EAAGA,EAAI7Q,EAAQC,EAAQ4Q,IAChCyR,EAAS,EAAJzR,EAAQ,GAAK,EAGtB,IAAI6R,EAAQ,GAcZ,IAbAA,EAAM5jB,KAAKyjB,GACPA,EAAcziB,EAAI,GAClB4iB,EAAM5jB,KAAK,IAAIoE,EAAStD,QAAQ2iB,EAAcziB,EAAI,EAAGyiB,EAAcxiB,IAEnEwiB,EAAcziB,EAAIE,EAAQ,GAC1B0iB,EAAM5jB,KAAK,IAAIoE,EAAStD,QAAQ2iB,EAAcziB,EAAI,EAAGyiB,EAAcxiB,IAEnEwiB,EAAcxiB,EAAI,GAClB2iB,EAAM5jB,KAAK,IAAIoE,EAAStD,QAAQ2iB,EAAcziB,EAAGyiB,EAAcxiB,EAAI,IAEnEwiB,EAAcxiB,EAAIE,EAAS,GAC3ByiB,EAAM5jB,KAAK,IAAIoE,EAAStD,QAAQ2iB,EAAcziB,EAAGyiB,EAAcxiB,EAAI,IAEhE2iB,EAAMphB,OAAS,GAAG,CACrB,IAAIqhB,EAAMD,EAAME,MAChB,GAAIC,EAAcF,EAAI7iB,EAAG6iB,EAAI5iB,GAAG,GAC5B,SAEJ,MAAMoO,EAAO2U,EAASH,EAAI7iB,EAAG6iB,EAAI5iB,GAC3BsO,EAAO0U,EAAUJ,EAAI7iB,EAAG6iB,EAAI5iB,GAClCijB,EAAW7U,EAAME,EAAMsU,EAAI5iB,EAAI,GAC/BijB,EAAW7U,EAAME,EAAMsU,EAAI5iB,EAAI,GAEnC,SAAS+iB,EAAShjB,EAAGC,GACjB,IAAIoO,EAAOrO,EACX,KAAOqO,GAAQ,IACP0U,EAAc1U,EAAMpO,GAAG,IAG3BoO,GAAQ,EAEZ,OAAOA,EAAO,EAElB,SAAS4U,EAAUjjB,EAAGC,GAClB,IAAIsO,EAAOvO,EAAI,EACf,KAAOuO,EAAOrO,IACN6iB,EAAcxU,EAAMtO,GAAG,IAG3BsO,GAAQ,EAEZ,OAAOA,EAAO,EAElB,SAAS2U,EAAW7U,EAAME,EAAMtO,GAC5B,KAAIA,EAAI,GAAKA,GAAKE,GAGlB,IAAK,IAAIH,EAAIqO,EAAMrO,GAAKuO,EAAMvO,IACtB+iB,EAAc/iB,EAAGC,GAAG,IAGxB2iB,EAAM5jB,KAAK,IAAIoE,EAAStD,QAAQE,EAAGC,IAG3C,SAAS8iB,EAAc/iB,EAAGC,EAAGkjB,GACzB,MAAMlc,EAA0B,GAAjBjH,EAAIC,EAAIC,GACjBkjB,EAASnc,EAAQ,EACvB,GAAIub,EAAKY,GACL,OAAO,EAEX,MAAM9O,EAAIoO,EAAazb,GACjBqb,EAAII,EAAazb,EAAQ,GACzBsX,EAAImE,EAAazb,EAAQ,GAU/B,QATUyb,EAAazb,EAAQ,GASvB,KADW,MAASqN,EAAIgO,EAAI/D,IACPoE,KACrBQ,IACAX,EAAKY,GAAU,MAEZ,KA0CnB3jB,EAAQwd,qBA3BR,SAA8BhY,EAAK/D,GAC/B,IAAI,EAAElB,EAAC,EAAEC,EAAC,MAAEC,EAAK,OAAEC,GAAWe,EAC9B,GAAIhB,GAAS,GAAKC,GAAU,EACxB,OAAOoa,EAAOza,QAAQ8a,QAE1B,MACMyI,EADOpe,EAAInE,aAAad,EAAGC,EAAGC,EAAOC,GACvBY,KACpB,IAAIsN,EAAOnO,EACPqO,EAAO,EACPD,EAAOnO,EACPqO,EAAO,EACX,IAAK,IAAI8U,EAAK,EAAGA,EAAKnjB,EAAQmjB,IAC1B,IAAK,IAAIC,EAAK,EAAGA,EAAKrjB,EAAOqjB,IACrBF,EAA2B,GAAnBE,EAAKD,EAAKpjB,GAAa,KAC/BmO,EAAOkV,EAAKlV,EAAOkV,EAAKlV,EACxBE,EAAOgV,EAAKhV,EAAOgV,EAAKhV,EACxBD,EAAOgV,EAAKhV,EAAOgV,EAAKhV,EACxBE,EAAO8U,EAAK9U,EAAO8U,EAAK9U,GAQpC,OAJAxO,GAAKqO,EACLpO,GAAKqO,EACLpO,EAAQkI,KAAKqE,IAAI,EAAG8B,EAAOF,EAAO,GAClClO,EAASiI,KAAKqE,IAAI,EAAG+B,EAAOF,EAAO,GAC5B,IAAIiM,EAAOza,QAAQE,EAAGC,EAAGC,EAAOC,IAiC3CV,EAAQoe,WA9BR,SAAoBwF,EAAQnjB,EAAOC,GAC/B,IAAK,IAAIF,EAAI,EAAGA,EAAIE,EAAQF,IAAK,CAC7B,IAAK,IAAID,EAAI,EAAGA,EAAIE,EAAQ,EAAGF,IAAK,CAChC,MAAM+Q,EAAsB,GAAjB/Q,EAAIC,EAAIC,GAAa,EAC5BmjB,EAAOtS,EAAI,KACXsS,EAAOtS,GAAK,KAGpB,IAAK,IAAI/Q,EAAIE,EAAQ,EAAGF,EAAI,EAAGA,IAAK,CAChC,MAAM+Q,EAAsB,GAAjB/Q,EAAIC,EAAIC,GAAa,EAC5BmjB,EAAOtS,EAAI,KACXsS,EAAOtS,GAAK,MAIxB,IAAK,IAAI/Q,EAAI,EAAGA,EAAIE,EAAOF,IAAK,CAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAIE,EAAS,EAAGF,IAAK,CACjC,MAAM8Q,EAAsB,GAAjB/Q,EAAIC,EAAIC,GAAa,EAC5BmjB,EAAOtS,EAAI,EAAI7Q,KACfmjB,EAAOtS,GAAK,KAGpB,IAAK,IAAI9Q,EAAIE,EAAS,EAAGF,EAAI,EAAGA,IAAK,CACjC,MAAM8Q,EAAsB,GAAjB/Q,EAAIC,EAAIC,GAAa,EAC5BmjB,EAAOtS,EAAI,EAAI7Q,KACfmjB,EAAOtS,GAAK,S,qBCha5B,IAAI5O,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEP5D,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAM0J,EAAS,EAAQ,MACjBzJ,EAAW,EAAQ,MACnB6jB,EAAcrkB,EAAgB,EAAQ,OACtCgE,EAAQL,EAAa,EAAQ,OACnC,MAAM2gB,UAAiBra,EAAOC,KAC1B,YAAYnK,EAAIwkB,GACZtjB,MAAMlB,GACN,IAAIykB,EAAiBvkB,KAAKyB,SAAS+iB,uBAAuB,mBAAmB,GAC7EzgB,EAAMyN,SAAS+S,GAAgB,IAAMD,MAEzC,OACItjB,MAAMkJ,OACNlK,KAAKykB,eAKT,eACI,IAAIzkB,KAAK0kB,YAAT,CAGA1kB,KAAK0kB,YAAc,GACnB,IAAK,IAAI/S,EAAI,EAAGA,EAAIpR,EAASgB,OAAOqN,WAAY+C,IAAK,CACjD,MAAMgT,EAAU,SAAS,IAAMhT,EAAI,IAAIiT,SAAS,EAAG,WACnD,IAAIC,EAAY,IAAIT,EAAY1jB,QAAQV,KAAKyB,SAAUkjB,GAAU7kB,GAAOE,KAAKoM,gBAAgBtM,KAC7FE,KAAK0kB,YAAY9kB,KAAKilB,MAIlCxkB,EAAQK,QAAU2jB,G,qBCpDlB,IAAIthB,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEPwG,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGlE9K,EAAmBC,MAAQA,KAAKD,iBAAoB,SAAUE,GAC9D,OAAQA,GAAOA,EAAIC,WAAcD,EAAM,CAAE,QAAWA,IAExDE,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQkM,eAAY,EACpB,MAAMvC,EAAS,EAAQ,MACjB8a,EAAiB/kB,EAAgB,EAAQ,OACzCglB,EAAgBhlB,EAAgB,EAAQ,OACxCgE,EAAQL,EAAa,EAAQ,OAC7BshB,EAAYjlB,EAAgB,EAAQ,OACpCiE,EAAWjE,EAAgB,EAAQ,OACnC6P,EAAY,EAAQ,MACpBsC,EAAiB,EAAQ,MACzB3R,EAAW,EAAQ,MACnB0kB,EAAiBllB,EAAgB,EAAQ,MACzCmlB,EAAgBnlB,EAAgB,EAAQ,OACxColB,EAAeplB,EAAgB,EAAQ,MACvCqlB,EAAkBrlB,EAAgB,EAAQ,MAC1CslB,EAAY,EAAQ,MACpBC,EAAY,EAAQ,MAC1B,MAAM/Y,UAAkBvC,EAAOC,KAC3B,YAAYnK,EAAIylB,GACZvkB,MAAMlB,GACNE,KAAKwlB,YAAc,EACnBxlB,KAAKylB,gBAAkB,EACvBzlB,KAAK0lB,QAAU,GACf1lB,KAAK2lB,mBAAqB,EAC1B3lB,KAAK4lB,SAAW,IAAIN,EAAUrjB,QAC9BjC,KAAKgM,OAASxH,SAASyH,eAAe,SACtCjM,KAAKc,MAAQP,EAASgB,OAAOT,MAC7Bd,KAAKe,OAASR,EAASgB,OAAOR,OAC9BgD,EAAMqS,IAAI,6BAA6BpW,KAAKc,WAAWd,KAAKe,UAC5Df,KAAK4d,eAAe,aAAc,EAAG,EAAG5d,KAAKc,MAAOd,KAAKe,QAAQ,GACjEf,KAAKyF,oBACLzF,KAAK6lB,cAAcN,GACnBvlB,KAAK8lB,gBACL9lB,KAAK+lB,iBACL/lB,KAAKgmB,cAET,YAAc,OAAOhmB,KAAKimB,OAC1B,YAAc,OAAOjmB,KAAKkmB,OAC1B,cAAgB,OAAOlmB,KAAKmmB,SAC5B,gBAAkB,OAAOnmB,KAAKomB,WAC9B,kBAAoB,OAAOpmB,KAAKqmB,aAEhC,gBAAkB,OAAOrmB,KAAK0lB,QAAQ,cACtC,mBAAqB,OAAO1lB,KAAK0lB,QAAQ,iBACzC,SAAS5lB,GACL,OAAOE,KAAK0lB,QAAQ5lB,GAExB,cAAcylB,GACV,IAAIe,EAAatmB,KAAKyB,SAAS+iB,uBAAuB,eAAe,GACrEzgB,EAAMyN,SAAS8U,GAAY,IAAMf,MACjCvlB,KAAKumB,YAAc/hB,SAASyH,eAAe,eAC3ClI,EAAMyN,SAASxR,KAAKumB,aAAa,IAAMvmB,KAAKwmB,SAC5CxmB,KAAKymB,YAAcjiB,SAASyH,eAAe,eAC3ClI,EAAMyN,SAASxR,KAAKymB,aAAa,IAAMzmB,KAAK0mB,SAC5C1mB,KAAK2mB,mBAAqBniB,SAASyH,eAAe,uBAClDlI,EAAMyN,SAASxR,KAAK2mB,oBAAoB,IAAMxc,EAAUnK,UAAM,OAAQ,GAAQ,YAC1E,MAAMkU,QAAanQ,EAAMkb,OAAO,WAChCjf,KAAK4mB,QAAQ5mB,KAAK6mB,eAClB,MAAM7T,EAAMoB,IAAIC,gBAAgBH,SAC1BlU,KAAK6mB,cAAcC,YAAY9T,GACrCoB,IAAIK,gBAAgBzB,QAG5B,SAAS+T,GAGL,OAFAA,EAAMlf,MAAQ1H,OAAOmS,KAAKtS,KAAK0lB,SAAStjB,OACxCpC,KAAK0lB,QAAQqB,EAAMjnB,IAAMinB,EAClBA,EAEX,cAAcjnB,EAAIc,EAAGC,EAAGC,EAAOC,EAAQmc,GACnC,MAAM6J,EAAQ,IAAI5B,EAAazkB,QAAQV,KAAKgM,OAAQlM,EAAIc,EAAGC,EAAGC,EAAOC,GAGrE,OAFAgmB,EAAM7J,SAAWA,EACjBld,KAAKgnB,SAASD,GACPA,EAEX,eAAejnB,EAAIc,EAAGC,EAAGC,EAAOC,EAAQmc,GACpC,MAAM6J,EAAQ,IAAI7B,EAAcxkB,QAAQV,KAAKgM,OAAQlM,EAAIc,EAAGC,EAAGC,EAAOC,GAGtE,OAFAgmB,EAAM7J,SAAWA,EACjBld,KAAKgnB,SAASD,GACPA,EAEX,YAAYA,GACHA,IAGLA,EAAMphB,gBACC3F,KAAK0lB,QAAQqB,EAAMjnB,KAE9B,gBACQE,KAAKinB,cAGTjnB,KAAKgnB,SAAS,IAAI7B,EAAazkB,QAAQV,KAAKgM,OAAQ,gBAAiB,EAAG,EAAGhM,KAAKc,MAAOd,KAAKe,SAEhG,gBACIf,KAAK2d,YAAY3d,KAAKinB,cAE1B,WAAWjU,GACFA,GAILhT,KAAKknB,gBACLlnB,KAAKinB,aAAaplB,MAAMkS,IAAMf,GAJ1BhT,KAAKmnB,gBAWb,cACI,IAAIC,EAAY5iB,SAASyH,eAAe,YACxClI,EAAM8N,aAAauV,GAAW,IAAMpnB,KAAKyZ,SACzC1V,EAAMyN,SAAS4V,GAAW,IAAMpnB,KAAK4mB,QAAQ5mB,KAAKqnB,cAClD,IAAIC,EAAe9iB,SAASyH,eAAe,eAC3ClI,EAAM8N,aAAayV,GAAc,IAAMtnB,KAAKiR,OAAM,KAClDlN,EAAMyN,SAAS8V,GAAc,IAAMtnB,KAAK4mB,QAAQ5mB,KAAKunB,cACrD,IAAIC,EAAkBhjB,SAASyH,eAAe,kBAC9ClI,EAAMyN,SAASgW,GAAiB,IAAMxnB,KAAK4mB,QAAQ5mB,KAAK6mB,iBACxD9iB,EAAM8N,aAAa2V,GAAiB,KAChCxnB,KAAK4mB,QAAQ5mB,KAAK6mB,eAClB7mB,KAAK6mB,cAAcY,eAEvBznB,KAAK0nB,OAAS,GAEd1nB,KAAKqnB,WAAarnB,KAAK2nB,QAAQ,IAAI3C,EAAUtkB,QAAQV,KAAM,WAAY,WACvEA,KAAKunB,WAAavnB,KAAK2nB,QAAQ,IAAI3C,EAAUtkB,QAAQV,KAAM,cAAe,oBAC1EA,KAAK6mB,cAAgB7mB,KAAK2nB,QAAQ,IAAIvC,EAAgB1kB,QAAQV,KAAM,mBAGpEA,KAAK4mB,QAAQ5mB,KAAKqnB,YAEtB,QAAQO,GAEJ,OADA5nB,KAAK0nB,OAAO9nB,KAAKgoB,GACVA,EAEX,gBACI5nB,KAAK6nB,aAAe,IAAIxC,EAAUtb,QAAQ,gBAC1C/J,KAAK8nB,gBAAkB,IAAIzC,EAAUtb,QAAQ,mBAEjD,iBACI/J,KAAK+nB,aAAe,IAAIhD,EAAcrkB,QAAQ,gBAC9CV,KAAK+nB,aAAa9V,mBAAsBoH,IACpCrZ,KAAKomB,WAAa/M,GAEtBrZ,KAAKomB,WAAapmB,KAAK+nB,aAAavR,KACpCxW,KAAKgoB,cAAgB,IAAIlD,EAAepkB,QAAQ,iBAChDV,KAAKgoB,cAAc/V,mBAAsBmG,GAAUpY,KAAKimB,OAAS7N,EACjEpY,KAAKimB,OAASjmB,KAAKgoB,cAAc5P,MACjCpY,KAAKioB,cAAgB,IAAIhD,EAAevkB,QAAQ,iBAChDV,KAAKioB,cAAchW,mBAAsBiW,IACrCloB,KAAKkmB,OAASgC,EACdloB,KAAK4mB,QAAQ5mB,KAAK6mB,eAClB7mB,KAAK6mB,cAAcC,YAAY9mB,KAAKkoB,QAExCloB,KAAKkmB,OAASlmB,KAAKioB,cAAcC,MACjCloB,KAAKmmB,SAAW,EAEpB,QAAQyB,GACA5nB,KAAKmoB,cAAgBP,IAGrB5nB,KAAKmoB,cACLnoB,KAAKmoB,aAAavL,UAEtB5c,KAAKmoB,aAAeP,EAChB5nB,KAAKmoB,cACLnoB,KAAKmoB,aAAa1L,SAEtBzc,KAAKgoB,cAAcI,WAAWpoB,KAAKmoB,cAAgBnoB,KAAKqnB,YACxDrnB,KAAK+nB,aAAaK,WAAWpoB,KAAKmoB,cAAgBnoB,KAAKqnB,YAAcrnB,KAAKmoB,cAAgBnoB,KAAKunB,aAInG,oBACI,IAAIrmB,EAASlB,KAAKkY,UAAUhX,OAC5BA,EAAO6D,MAAMC,cAAgB,OAE7BR,SAAS2B,iBAAiB,WAAWM,GAASzG,KAAKqoB,QAAQ5hB,KAC3DvF,EAAOiF,iBAAiB,SAASM,GAASA,EAAML,mBAC5C7F,EAASgB,OAAOiN,kBAA2C,MAAvBtC,OAAO8T,cAE3C9e,EAAOiF,iBAAiB,cAAcM,IAC9BA,EAAM6hB,YACN7hB,EAAML,oBAGdlF,EAAOiF,iBAAiB,eAAeM,GAASzG,KAAKsG,YAAYG,KACjEvF,EAAOiF,iBAAiB,eAAeM,GAASzG,KAAKiH,YAAYR,KACjEvF,EAAOiF,iBAAiB,aAAaM,GAASzG,KAAKkH,UAAUT,KAC7DvF,EAAOiF,iBAAiB,iBAAiBM,GAASA,EAAML,qBAGxDlF,EAAOiF,iBAAiB,cAAcM,GAASzG,KAAKuG,WAAWE,KAC/DvF,EAAOiF,iBAAiB,aAAaM,GAASzG,KAAKmI,UAAU1B,KAC7DvF,EAAOiF,iBAAiB,YAAYM,GAASzG,KAAKoI,SAAS3B,KAC3DvF,EAAOiF,iBAAiB,eAAeM,GAASA,EAAML,oBAO9D,wBAAwBK,GACpB,IACI3E,EADS2E,EAAMua,OACDzX,wBAClB,MAAMC,EAAwB1H,EAAKf,OAASe,EAAKhB,MACjD,IAAI2I,GAAMhD,EAAMiD,QAAU5H,EAAK6H,MAAQ7H,EAAKhB,MACxC8I,GAAMnD,EAAMoD,QAAU/H,EAAKgI,KAAOhI,EAAKf,OACvCH,GAAK4I,EAAwB,EAAII,EAAKH,GAAMzJ,KAAKc,MACjDD,GAAK2I,EAAwBC,EAAKG,GAAM5J,KAAKe,OAKjD,OAJIR,EAASgB,OAAOkN,eAChB7N,EAAIoI,KAAKgG,MAAMpO,GACfC,EAAImI,KAAKgG,MAAMnO,IAEZ,IAAImD,EAAStD,QAAQE,EAAGC,GAEnC,sBAAsB8f,GAClB,IAAI7e,EAAO9B,KAAKkY,UAAUhX,OAAOqI,wBACjC,MAAMC,EAAwB1H,EAAKf,OAASe,EAAKhB,MACjD,IAAI2I,GAAMkX,EAAMjX,QAAU5H,EAAK6H,MAAQ7H,EAAKhB,MACxC8I,GAAM+W,EAAM9W,QAAU/H,EAAKgI,KAAOhI,EAAKf,OACvCH,GAAK4I,EAAwB,EAAII,EAAKH,GAAMzJ,KAAKc,MACjDD,GAAK2I,EAAwBC,EAAKG,GAAM5J,KAAKe,OAKjD,OAJIR,EAASgB,OAAOkN,eAChB7N,EAAIoI,KAAKgG,MAAMpO,GACfC,EAAImI,KAAKgG,MAAMnO,IAEZ,IAAImD,EAAStD,QAAQE,EAAGC,GAEnC,QAAQ4F,GACCzG,KAAKuoB,cAGF9hB,EAAM8W,KAQTvd,KAAKmoB,cAGVnoB,KAAKmoB,aAAaE,QAAQ5hB,IAE9B,YAAYA,GACRA,EAAML,iBACDK,EAAM+hB,WAA+B,IAAlB/hB,EAAMgiB,UAGjBhiB,EAAMua,OACZra,kBAAkBF,EAAMG,WAC/B5G,KAAKylB,gBAAkBhf,EAAMG,UAC7B5G,KAAKshB,KAAK,CACNxa,UAAWL,EAAMK,UACjB1B,SAAUpF,KAAK0oB,wBAAwBjiB,GACvCmT,OAAQ5Z,KAAK2oB,cAAc,IAAI3kB,EAAStD,QAAQ+F,EAAM3F,MAAO2F,EAAM1F,SACnE+W,SAAU9X,KAAK4oB,6BAA6BniB,GAC5CsR,MAAO,EACP8Q,WAAW,KAGnB,YAAYpiB,GACRA,EAAML,iBACDK,EAAM+hB,WAA+B,IAAlB/hB,EAAMgiB,SAG9BzoB,KAAK+H,KAAK,CACNjB,UAAWL,EAAMK,UACjB1B,SAAUpF,KAAK0oB,wBAAwBjiB,GACvCmT,OAAQ5Z,KAAK2oB,cAAc,IAAI3kB,EAAStD,QAAQ+F,EAAM3F,MAAO2F,EAAM1F,SACnE+W,SAAU9X,KAAK4oB,6BAA6BniB,GAC5CsR,MAAO,EACP8Q,WAAW,IAGnB,6BAA6BpiB,GACzB,MAA4B,OAArBA,EAAMqiB,YAAuB/kB,EAAMqF,MAAM,GAAK,EAAoB,EAAjB3C,EAAMqR,UAAgB,EAElF,2BAA2B6I,GACvB,MAA0B,UAAnBA,EAAMoI,UAAwBhlB,EAAMqF,MAAM,GAAK,EAAiB,EAAduX,EAAMqI,OAAa,EAEhF,UAAUviB,GACNA,EAAML,iBACDK,EAAM+hB,YAGE/hB,EAAMua,OACZhZ,sBAAsBvB,EAAMG,WACnC5G,KAAKwhB,GAAG,CACJ1a,UAAWL,EAAMK,UACjB1B,SAAUpF,KAAK0oB,wBAAwBjiB,GACvCmT,OAAQ,IAAI5V,EAAStD,QAAQ+F,EAAM3F,MAAO2F,EAAM1F,QAChD+W,SAAU,EACVC,MAAO,EACP8Q,WAAW,IAEf7oB,KAAKylB,gBAAkB,GAE3B,gBAAgBuD,IAKhB,WAAWviB,GAEP,GADAA,EAAML,iBACuB,IAAzBpG,KAAKylB,gBACL,OAEJ,MAAM9E,EAAQla,EAAMwiB,cAAc,GAClCjpB,KAAKylB,gBAAkB9E,EAAMM,WAC7BjhB,KAAKshB,KAAK,CACNxa,UAAWL,EAAMK,UACjB1B,SAAUpF,KAAKkpB,sBAAsBvI,GACrC/G,OAAQ5Z,KAAK2oB,cAAc,IAAI3kB,EAAStD,QAAQigB,EAAMwI,QAASxI,EAAMyI,UACrEtR,SAAU9X,KAAKqpB,2BAA2B1I,GAC1C5I,MAAO,EACP8Q,WAAW,IAGnB,UAAUpiB,GACNA,EAAML,iBACN,IAAIua,EAAQpU,EAAU+c,UAAU7iB,EAAMwiB,cAAejpB,KAAKylB,iBAC7C,MAAT9E,IAGJxK,QAAQC,IAAIuK,EAAMqI,OAClBhpB,KAAK+H,KAAK,CACNjB,UAAWL,EAAMK,UACjB1B,SAAUpF,KAAKkpB,sBAAsBvI,GACrC/G,OAAQ5Z,KAAK2oB,cAAc,IAAI3kB,EAAStD,QAAQigB,EAAMwI,QAASxI,EAAMyI,UACrEtR,SAAU9X,KAAKqpB,2BAA2B1I,GAC1C5I,MAAO,EACP8Q,WAAW,KAGnB,SAASpiB,GACLA,EAAML,iBAEO,MADDmG,EAAU+c,UAAU7iB,EAAMwiB,cAAejpB,KAAKylB,mBAK1DzlB,KAAKwhB,GAAG,CACJ1a,UAAWL,EAAMK,UACjB1B,SAAU,IAAIpB,EAAStD,QAAQ,EAAG,GAClCkZ,OAAQ,IAAI5V,EAAStD,QAAQ,EAAG,GAChCoX,SAAU,EACVC,MAAO,EACP8Q,WAAW,IAEf7oB,KAAKylB,gBAAkB,GAE3B,iBAAiBvd,EAASpI,GACtB,IAAK,IAAI6R,EAAI,EAAGA,EAAIzJ,EAAQ9F,OAAQuP,IAChC,GAAIzJ,EAAQyJ,GAAGsP,YAAcnhB,EACzB,OAAOoI,EAAQyJ,GAGvB,OAAO,KAEX,KAAKhQ,GACD,IAAK3B,KAAKmoB,aACN,OAEJ,IAAI1P,EAAQzY,KAAKupB,iBAAiBnkB,SAAS0D,WAAWnH,EAAKyD,UAC3D,GAAIqT,GAAS,EACT,OAEJzY,KAAKupB,iBAAmBvpB,KAAKupB,kBAAoB5nB,EAEjD,MAAMoW,EAAQU,GADE9W,EAAKmF,UAAY9G,KAAKupB,iBAAiBziB,WAEvDnF,EAAKoW,MAAQhU,EAAMoW,KAAKna,KAAKupB,iBAAiBxR,MAAOA,EAAO,IAC5D/X,KAAKupB,iBAAmB5nB,EACxB3B,KAAKmoB,aAAapgB,KAAKpG,GAE3B,KAAKA,GACDiO,EAAUE,QAAQoB,cACblR,KAAKmoB,eAGVnoB,KAAKupB,iBAAmB5nB,EACxB3B,KAAKmoB,aAAa7G,KAAK3f,IAE3B,GAAGA,GACM3B,KAAKmoB,eAGVnoB,KAAKupB,iBAAmB5nB,EACxB3B,KAAKmoB,aAAa3G,GAAG7f,IAEzB,MAAM6W,GAAqB,GACvBxY,KAAKkY,UAAUjH,QACXuH,GACAxY,KAAKwY,qBAGb,OACIxY,KAAKkY,UAAUrS,IAAIsS,UAAYnY,KAAKoY,MACpCpY,KAAKkY,UAAUrS,IAAI2jB,SAAS,EAAG,EAAGxpB,KAAKc,MAAOd,KAAKe,QACnDf,KAAKwY,qBAET,eACIxY,KAAK4lB,SAAS3U,QACdjR,KAAKwY,qBACLxY,KAAKypB,oBAET,qBACIzpB,KAAK4lB,SAAS8D,YAAY1pB,KAAKkY,UAAUyR,WACzC3pB,KAAKypB,oBACLzpB,KAAK4pB,WAET,oBACI5pB,KAAKumB,YAAY7hB,UAAUc,OAAO,YAAaxF,KAAK4lB,SAASpjB,SAC7DxC,KAAKymB,YAAY/hB,UAAUc,OAAO,YAAaxF,KAAK4lB,SAASnjB,SAEjE,OACSzC,KAAK4lB,SAASpjB,UAGnBxC,KAAKkY,UAAU2R,QAAQ7pB,KAAK4lB,SAASY,QACrCxmB,KAAKypB,oBACLzpB,KAAK4pB,YAET,OACS5pB,KAAK4lB,SAASnjB,UAGnBzC,KAAKkY,UAAU2R,QAAQ7pB,KAAK4lB,SAASc,QACrC1mB,KAAKypB,oBACLzpB,KAAK4pB,YAET,6BACI5pB,KAAKkY,UAAU2R,QAAQ7pB,KAAK4lB,SAASkE,mBAEzC,UAAUhqB,GACN,OAAOoS,EAAeG,aAAa/F,UAAUxM,GACxCmL,MAAKpJ,IACN7B,KAAK+pB,SAAWjqB,EAChBE,KAAKiR,QACDpP,GACA7B,KAAKkY,UAAUnW,UAAUF,GAE7B7B,KAAKgqB,WAAWjmB,EAAMgb,mBAAmBjf,IACzCE,KAAKiqB,eACLjqB,KAAKkqB,UAAW,KAGxB,YACInmB,EAAMqS,IAAI,gBACVpW,KAAKkY,UAAUhX,OAAO+a,QAAO/H,GAAQhC,EAAeG,aAAawD,UAAU7V,KAAK+pB,SAAU7V,KAC1FlU,KAAKkqB,UAAW,EAChBlqB,KAAK2lB,mBAAqB1H,KAAKC,MAEnC,WACIle,KAAKkqB,UAAW,EAEpB,OACIlpB,MAAMkJ,OACNlK,KAAKylB,gBAAkB,EACvBzlB,KAAKmqB,mBAAoB,EACzBje,OAAOke,uBAAsBtjB,GAAa9G,KAAKqqB,KAAKvjB,KACpD9G,KAAKmoB,aAAa1L,SAEtB,OACI7M,EAAUE,QAAQoB,cACdlR,KAAKmoB,cACLnoB,KAAKmoB,aAAavL,UAElB5c,KAAK0lB,SAEL1lB,KAAK6V,YAEL7V,KAAK4lB,UACL5lB,KAAK4lB,SAAS3U,QAElBjQ,MAAMgN,OAEV,KAAKlH,GACD,IAAK9G,KAAKuoB,YACN,OAEJrc,OAAOke,uBAAsBtjB,GAAa9G,KAAKqqB,KAAKvjB,KACpD,IAAI2R,EAAQ3R,EAAY9G,KAAKsqB,eAC7BtqB,KAAKsqB,eAAiBxjB,EAClB9G,KAAKmoB,eACLnoB,KAAKmoB,aAAakC,KAAK5R,GAEnBzY,KAAKupB,kBAAoBvpB,KAAKupB,iBAAiBV,YAInD7oB,KAAKkqB,UAAYjM,KAAKC,MAAQle,KAAK2lB,mBAAqBplB,EAASgB,OAAOoN,cACxE3O,KAAK6V,YAGb,gBAAgBzQ,GACZ,IAAK7E,EAASgB,OAAOmN,YACjB,OAMJ,GAJA1O,KAAKmqB,mBAAoB,GAIpBnqB,KAAKqmB,aAAc,CACpB,IAAIkE,EAAiB/lB,SAASC,cAAc,UAC5C8lB,EAAezqB,GAAK,YACpByqB,EAAezpB,MAAQd,KAAKc,MAC5BypB,EAAexpB,OAASf,KAAKe,OAC7Bf,KAAKqmB,aAAekE,EAAeppB,WAAW,KAAM,CAAEC,OAAO,IAEjE,IAAIopB,EAAYxqB,KAAKqmB,aAAa3kB,aAAa,EAAG,EAAG1B,KAAKc,MAAOd,KAAKe,QAEvDqE,EAASxE,EAAIwE,EAASvE,EAAIb,KAAKc,MAI9CiD,EAAMqS,IAAI,uBACVrS,EAAM2a,UAAU1e,KAAKkY,UAAUrS,IAAK2kB,EAAU7oB,KAAMyD,EAAUpF,KAAKoY,OACnErU,EAAM0a,WAAW+L,EAAU7oB,KAAM3B,KAAKc,MAAOd,KAAKe,QAClDf,KAAKqmB,aAAazkB,aAAa4oB,EAAW,EAAG,GAEjD,eAAe3kB,GACX,MAAM2kB,EAAY3kB,EAAInE,aAAa,EAAG,EAAG1B,KAAKc,MAAOd,KAAKe,QACpDkjB,EAASuG,EAAU7oB,KACzB,IAAK,IAAIgQ,EAAIsS,EAAO7hB,OAAS,EAAGuP,GAAK,EAAGA,IACpCsS,EAAOtS,GAAKsS,EAAOtS,GAAK,GAAK,IAAM,EAEvC9L,EAAIjE,aAAa4oB,EAAW,EAAG,GAEnC,cAAcC,GACV,OAAO,IAAIzmB,EAAStD,QAAQ+pB,EAAE7pB,EAAI8pB,OAAO5pB,MAAQP,EAASgB,OAAOT,MAAO2pB,EAAE5pB,EAAI6pB,OAAO3pB,OAASR,EAASgB,OAAOR,SAGtHV,EAAQkM,UAAYA,G,qBCtjBpB,IAAIxJ,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEPwG,EAAanK,MAAQA,KAAKmK,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIE,WAAU,SAAUC,EAASC,GAC/C,SAASC,EAAUrK,GAAS,IAAMsK,EAAKL,EAAUM,KAAKvK,IAAW,MAAOwK,GAAKJ,EAAOI,IACpF,SAASC,EAASzK,GAAS,IAAMsK,EAAKL,EAAiB,MAAEjK,IAAW,MAAOwK,GAAKJ,EAAOI,IACvF,SAASF,EAAKjH,GAJlB,IAAerD,EAIaqD,EAAOqH,KAAOP,EAAQ9G,EAAOrD,QAJ1CA,EAIyDqD,EAAOrD,MAJhDA,aAAiBgK,EAAIhK,EAAQ,IAAIgK,GAAE,SAAUG,GAAWA,EAAQnK,OAIT2K,KAAKN,EAAWI,GAClGH,GAAML,EAAYA,EAAUW,MAAMd,EAASC,GAAc,KAAKQ,YAGtE1K,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAM0J,EAAS,EAAQ,MACjBjG,EAAQL,EAAa,EAAQ,OAC7BwO,EAAiB,EAAQ,MAE/B,IAAIyY,EAAiB,EAAQ,MAC7B,MAAMvP,EAAe,EAAQ,MAC7B,MAAMwP,UAAqB5gB,EAAOC,KAC9B,YAAYnK,EAAIylB,GACZvkB,MAAMlB,GACN,IAAIwmB,EAAatmB,KAAKyB,SAAS+iB,uBAAuB,eAAe,GACrEzgB,EAAMyN,SAAS8U,GAAY,IAAMf,MACjC,IAAIsF,EAAe7qB,KAAKyB,SAAS+iB,uBAAuB,iBAAiB,GACzEzgB,EAAMyN,SAASqZ,GAAc,IAAM1gB,EAAUnK,UAAM,OAAQ,GAAQ,YAC/D,MAAM8qB,QAAgB5Y,EAAeG,aAAa0Y,wBAClD3P,EAAac,OAAO4O,EAAS,6BAEjC,IAAIE,EAAehrB,KAAKyB,SAAS+iB,uBAAuB,iBAAiB,GACzEzgB,EAAMyN,SAASwZ,GAAc,IAAM7gB,EAAUnK,UAAM,OAAQ,GAAQ,YAC/DkS,EAAeG,aAAa4Y,0BAA0BlnB,EAAMkb,OAAO,SACnEjf,KAAKkrB,kBAET,IAAIC,EAAcnrB,KAAKyB,SAAS+iB,uBAAuB,gBAAgB,GACvEzgB,EAAMyN,SAAS2Z,GAAa,KACpBC,QAAQ,8BACRlZ,EAAeG,aAAapB,QAC5BoF,SAASC,aAGjBqU,EAAeU,QAAQ7mB,SAASyH,eAAe,OAAQ,IAAI,GAAM,GAAM,GAE3E,OACIjL,MAAMkJ,OACNlK,KAAKkrB,aAET,aACI,MAAMI,EAAO9mB,SAASyH,eAAe,QACrCqf,EAAKC,UAAY,iBACjBrZ,EAAeG,aAAamZ,iBAAiBvgB,MAAKsL,IAC9C+U,EAAKC,WAAa,mBAAmBxnB,EAAMmb,YAAY3I,EAAQ,SAI3ElW,EAAQK,QAAUkqB,G,qBCvElB,IAAI7nB,EAAmB/C,MAAQA,KAAK+C,kBAAqB5C,OAAO6C,OAAS,SAAUC,EAAGC,EAAGC,EAAGC,QAC7EC,IAAPD,IAAkBA,EAAKD,GAC3BhD,OAAOC,eAAe6C,EAAGG,EAAI,CAAEE,YAAY,EAAMC,IAAK,WAAa,OAAOL,EAAEC,OAC3E,SAAUF,EAAGC,EAAGC,EAAGC,QACTC,IAAPD,IAAkBA,EAAKD,GAC3BF,EAAEG,GAAMF,EAAEC,KAEVK,EAAsBxD,MAAQA,KAAKwD,qBAAwBrD,OAAO6C,OAAS,SAAUC,EAAGQ,GACxFtD,OAAOC,eAAe6C,EAAG,UAAW,CAAEK,YAAY,EAAMhD,MAAOmD,KAC9D,SAASR,EAAGQ,GACbR,EAAW,QAAIQ,IAEfC,EAAgB1D,MAAQA,KAAK0D,cAAiB,SAAUzD,GACxD,GAAIA,GAAOA,EAAIC,WAAY,OAAOD,EAClC,IAAI0D,EAAS,GACb,GAAW,MAAP1D,EAAa,IAAK,IAAIkD,KAAKlD,EAAe,YAANkD,GAAmBhD,OAAOyD,UAAUC,eAAeC,KAAK7D,EAAKkD,IAAIJ,EAAgBY,EAAQ1D,EAAKkD,GAEtI,OADAK,EAAmBG,EAAQ1D,GACpB0D,GAEXxD,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtD,MAAMyD,EAAQL,EAAa,EAAQ,OAC7BwO,EAAiB,EAAQ,MAkE/B7R,EAAQK,QAjER,MACI,YAAYC,EAAQb,EAAIsM,GACpB,IAAI6D,EAAUzL,SAASC,cAAc,OACrCzE,KAAKyB,SAAWwO,EAChBA,EAAQnQ,GAAKA,EACbmQ,EAAQvL,UAAUC,IAAI,aACtB3E,KAAKyB,SAASsD,MAAMsZ,QAAU,IAY9Bta,EAAMyN,SAASvB,GAAS,KAChB7D,GACAA,EAAgBtM,MAErB,GACHoS,EAAeG,aAAaO,mBAAkB,CAACC,EAAQ/S,KACrC,QAAV+S,GAAoB/S,GAAME,KAAKF,IAC/BE,KAAKsM,eAGbtM,KAAKyrB,WAAa1nB,EAAMgb,mBAAmBjf,GAC3Ca,EAAOsE,YAAYgL,GACnBjQ,KAAKsM,YAET,SAAW,OAAOtM,KAAKyB,SAAS3B,GAChC,aAAaiU,GACT/T,KAAK0rB,UAAY3X,EACjB/T,KAAKyB,SAASsD,MAAMsZ,QAAU,IAC9Bre,KAAK2rB,yBAET,eAAe5X,GACX/T,KAAK4rB,YAAc7X,EACnB/T,KAAK2rB,yBAET,SACI3rB,KAAKyB,SAASkE,SAElB,WACI,OAAuC,OAA/B3F,KAAKyB,SAASoqB,aAE1B,YACI3Z,EAAeG,aAAaU,aAAa/S,KAAKF,IACzCmL,MAAK+H,IACNhT,KAAK8rB,SAAW9Y,KAGxB,yBACI,IAAIiB,EAAO,GACPjU,KAAK4rB,aACL3X,EAAKrU,KAAK,OAAOI,KAAK4rB,gBAEtB5rB,KAAK0rB,WACLzX,EAAKrU,KAAK,OAAOI,KAAK0rB,cAE1B1rB,KAAKyB,SAASsD,MAAMoO,gBAAkBc,EAAK8X,KAAK,Q,mBCpFxD5rB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ4J,UAAO,EA2Bf5J,EAAQ4J,KA1BR,MACI,YAAYnK,GACRE,KAAKyB,SAAW+C,SAASyH,eAAenM,GACnCE,KAAKyB,UACN0U,QAAQ6V,MAAM,kCAAkClsB,KAEpDE,KAAKgO,OAET,QACI,KAAOhO,KAAKyB,SAASwqB,iBACjBjsB,KAAKyB,SAASyqB,YAAYlsB,KAAKyB,SAAS0qB,YAGhD,OACInsB,KAAKyB,SAASiD,UAAUiB,OAAO,UAEnC,OACI3F,KAAKyB,SAASiD,UAAUC,IAAI,UAEhC,WAAW6X,GACPxc,KAAKyB,SAASiD,UAAUc,OAAO,UAAWgX,GAE9C,YACI,OAAQxc,KAAKyB,SAASiD,UAAUa,SAAS,cCzB7C6mB,EAA2B,GAG/B,SAASC,EAAoBC,GAE5B,GAAGF,EAAyBE,GAC3B,OAAOF,EAAyBE,GAAUjsB,QAG3C,IAAIR,EAASusB,EAAyBE,GAAY,CACjDxsB,GAAIwsB,EAEJjsB,QAAS,IAOV,OAHAksB,EAAoBD,GAAUxoB,KAAKjE,EAAOQ,QAASR,EAAQA,EAAOQ,QAASgsB,GAGpExsB,EAAOQ,QAIfgsB,EAAoBnpB,EAAIqpB,EAIxBF,EAAoBzrB,EAAI,aC3BxByrB,EAAoBvK,EAAI,SAASjiB,GAChC,IAAI2sB,EAAS3sB,GAAUA,EAAOK,WAC7B,WAAa,OAAOL,EAAgB,SACpC,WAAa,OAAOA,GAErB,OADAwsB,EAAoBI,EAAED,EAAQ,CAAE5R,EAAG4R,IAC5BA,GCLRH,EAAoBI,EAAI,SAASpsB,EAASqsB,GACzC,IAAI,IAAIC,KAAOD,EACXL,EAAoBppB,EAAEypB,EAAYC,KAASN,EAAoBppB,EAAE5C,EAASssB,IAC5ExsB,OAAOC,eAAeC,EAASssB,EAAK,CAAErpB,YAAY,EAAMC,IAAKmpB,EAAWC,MCJ3EN,EAAoBnJ,EAAI,WACvB,GAA0B,iBAAf0J,WAAyB,OAAOA,WAC3C,IACC,OAAO5sB,MAAQ,IAAI6sB,SAAS,cAAb,GACd,MAAO/hB,GACR,GAAsB,iBAAXoB,OAAqB,OAAOA,QALjB,GCAxBmgB,EAAoBppB,EAAI,SAAS6pB,EAAKC,GAAQ,OAAO5sB,OAAOyD,UAAUC,eAAeC,KAAKgpB,EAAKC,ICC/FV,EAAoBnX,EAAI,SAAS7U,GACX,oBAAX2sB,QAA0BA,OAAOC,aAC1C9sB,OAAOC,eAAeC,EAAS2sB,OAAOC,YAAa,CAAE3sB,MAAO,WAE7DH,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,K,WCAvD,IAAI4sB,EAAkB,CACrBC,IAAK,GAGFC,EAAkB,CACrB,CAAC,KAAK,MAYHC,EAAuB,aAGvBC,EAAuB,SAASC,EAA4B5rB,GAQ/D,IAPA,IAMI2qB,EAAUkB,EANVC,EAAW9rB,EAAK,GAChB+rB,EAAc/rB,EAAK,GACnBgsB,EAAUhsB,EAAK,GACfisB,EAAiBjsB,EAAK,GAGHgQ,EAAI,EAAGkc,EAAW,GACpClc,EAAI8b,EAASrrB,OAAQuP,IACzB6b,EAAUC,EAAS9b,GAChB0a,EAAoBppB,EAAEiqB,EAAiBM,IAAYN,EAAgBM,IACrEK,EAASjuB,KAAKstB,EAAgBM,GAAS,IAExCN,EAAgBM,GAAW,EAE5B,IAAIlB,KAAYoB,EACZrB,EAAoBppB,EAAEyqB,EAAapB,KACrCD,EAAoBnpB,EAAEopB,GAAYoB,EAAYpB,IAKhD,IAFGqB,GAASA,EAAQtB,GACjBkB,GAA4BA,EAA2B5rB,GACpDksB,EAASzrB,QACdyrB,EAASvrB,OAATurB,GAOD,OAHGD,GAAgBR,EAAgBxtB,KAAKsL,MAAMkiB,EAAiBQ,GAGxDP,KAGJS,EAAqBC,KAA4B,sBAAIA,KAA4B,uBAAK,GAI1F,SAASC,IAER,IADA,IAAIrqB,EACIgO,EAAI,EAAGA,EAAIyb,EAAgBhrB,OAAQuP,IAAK,CAG/C,IAFA,IAAIsc,EAAiBb,EAAgBzb,GACjChH,GAAY,EACRujB,EAAI,EAAGA,EAAID,EAAe7rB,OAAQ8rB,IAAK,CAC9C,IAAIC,EAAQF,EAAeC,GACG,IAA3BhB,EAAgBiB,KAAcxjB,GAAY,GAE3CA,IACFyiB,EAAgB7qB,OAAOoP,IAAK,GAC5BhO,EAAS0oB,EAAoBA,EAAoBhd,EAAI4e,EAAe,KAOtE,OAJ8B,IAA3Bb,EAAgBhrB,SAClBiqB,EAAoBzrB,IACpByrB,EAAoBzrB,EAAI,cAElB+C,EArBRmqB,EAAmBtY,QAAQ8X,EAAqB5kB,KAAK,KAAM,IAC3DolB,EAAmBluB,KAAO0tB,EAAqB5kB,KAAK,KAAMolB,EAAmBluB,KAAK8I,KAAKolB,IAsBvF,IAAIM,EAAU/B,EAAoBzrB,EAClCyrB,EAAoBzrB,EAAI,WAGvB,OADAyrB,EAAoBzrB,EAAIwtB,GAAW,cAC3Bf,EAAuBW,M,GCrFhC3B,EAAoBzrB,I","file":"main.c96719283c0b27b1a5c0.js","sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"*{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:none}textarea{-webkit-user-select:initial}html,body{margin:0;width:100%;height:100%;position:fixed;font-size:40px}@media(max-width: 400px),(max-height: 400px){html,body{font-size:28px}}body{-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\";line-height:1.5rem}body,input,textarea{font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\";line-height:1.5rem}.button{width:1.5rem;height:1.5rem;line-height:1.5rem;text-align:center;font-size:.75rem;border-radius:30%;cursor:pointer;background:rgba(255,255,255,.5);color:#000;transition:transform .25s}.button.down{transform:scale(0.9)}.button i{line-height:1.5rem}#dropbox-button{border-radius:3px;background-color:#007ee5;border:none;color:#fff;font-size:16px;padding:10px 15px;text-decoration:none;height:24px}.view{display:flex;position:fixed;width:100%;height:100%;background:#bbb;overflow:hidden}.dropbox-auth{align-items:center;justify-content:center}.view.book{flex-wrap:wrap;align-content:flex-start;justify-content:center;overflow-y:auto;-webkit-overflow-scrolling:touch}.view.book,.view.book *{touch-action:pan-y}.view.settings{font-size:.5rem;padding:2rem;display:block;box-sizing:border-box;padding-right:52%;line-height:1.4em}.view.settings .button.text{width:auto;border-radius:.5em;padding:0 .5em;margin-right:.5em;margin-bottom:.5em}.view.settings label{display:block;text-transform:uppercase;color:gray}.view.settings #log{width:50vw;background:#272727;color:#c7c7c7;overflow:scroll;-webkit-overflow-scrolling:touch;touch-action:pan-y;height:100vh;padding:0;font-family:monospace;font-size:12px;position:fixed;top:0;right:0;margin:0;line-height:20px}#log li{border-bottom:#444 solid 1px;padding:0 1em}.thumbnail{margin:.3rem;color:#ccc;background:#fff;border-radius:.1rem;font-size:5.6rem;width:1em;height:.75em;background-size:contain;cursor:pointer;transition:opacity 1s}.thumbnail.down{transform:scale(0.9)}.paint{align-items:center}.paint #sheet{font-size:1px;width:1024em;height:768em;margin:auto;overflow:auto;position:fixed;object-fit:contain;left:0;top:0;bottom:0;right:0}.layer{position:absolute;left:0;top:0;background:none}#base-layer{background:#fff}.layer.floating{outline:2px dashed #000}#stamp-layer{opacity:.2}@media(orientation: portrait){.paint #sheet{transform:rotate(-90deg);overflow-x:hidden}}.button.back{position:absolute;top:.25rem;left:.25rem;z-index:100}.button.settings{position:absolute;right:.25rem;top:.25rem;z-index:100}.button a{width:100%;height:100%;display:block;color:#000}.button#stamp-button{font-size:1.25rem;position:absolute;top:.25rem;right:.25rem;width:2rem;height:2rem;z-index:100;line-height:1.85rem}.toolbar{display:flex;background:#d3d3d3;border-radius:.5rem;z-index:100;position:absolute}.toolbar.left{flex-direction:column;left:.25rem;top:50%;transform:translateY(-50%)}.toolbar.right{flex-direction:column;right:.25rem;top:50%;transform:translateY(-50%)}.toolbar.top{flex-direction:row;left:50%;top:.25em;transform:translateX(-50%)}.toolbar.bottom{flex-direction:row;left:50%;bottom:.25em;transform:translateX(-50%)}.toolbar .button{background:transparent}.toolbar .spacer{width:1.5em;height:1.5em}.palette{position:relative;transition:transform .25s;display:inline-block;float:left;text-align:center;z-index:100}.palette .option i{font-size:.75em}.palette .options{position:absolute;display:flex;flex-wrap:wrap;background:#d3d3d3;border-radius:.5rem;padding:.25rem;transition:transform .15s;top:2.25rem;left:50%;transform:translateX(-50%)}.palette .option{width:1em;height:1em;line-height:.75em;display:inline-block;margin:.25em;float:left;transition:transform .25s;background-size:contain;background-repeat:no-repeat;background-position:center}.palette .options .option{margin:.125em}.palette .option:active{transform:scale(0.9)}.palette .options .arrow{position:absolute;width:0;height:0;font-size:.25rem;top:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-bottom:2em solid #d3d3d3;border-top:none}.toolbar.left .palette .options{left:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.left .palette .options .arrow{top:initial;left:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-right:2em solid #d3d3d3}.toolbar.right .palette .options{left:initial;right:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.right .palette .options .arrow{left:initial;top:initial;right:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-left:2em solid #d3d3d3;border-right:0}.toolbar.bottom .palette .options{left:50%;top:initial;bottom:2.25rem;transform:translateX(-50%)}.toolbar.bottom .palette .options .arrow{top:initial;bottom:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-top:2em solid #d3d3d3;border-bottom:none}.palette.collapsed:active{transform:scale(0.9)}.toolbar.top .palette.collapsed .options,.toolbar.bottom .palette.collapsed .options{transform:translateX(-50%) scale(0)}.toolbar.left .palette.collapsed .options,.toolbar.right .palette.collapsed .options{transform:translateY(-50%) scale(0)}#stamp-palette.palette .options{font-size:1.5rem}@media(max-width: 400px),(max-height: 400px){#stamp-palette.palette .options{font-size:1rem}}.line-width{background:#000;height:100%;margin:auto;border-radius:.15em}#color-palette .option{border-radius:40%}.hidden{display:none !important}.disabled{opacity:.25}.selected{background:#58b0ff !important;color:#fff}\", \"\",{\"version\":3,\"sources\":[\"webpack://./painter.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"* {\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    user-select: none;\\n    touch-action: none; /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n    -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody{\\n    margin: 0;\\n    width: 100%;\\n    height: 100%;\\n    position: fixed;\\n    font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    html,\\n    body{\\n        font-size: 28px;\\n    }   \\n}\\n\\nbody {\\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\n.button {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    text-align: center;\\n    font-size: 0.75rem;\\n    border-radius: 30%;\\n    cursor: pointer;\\n    background: rgba(255, 255, 255, 0.5);\\n    color: black;\\n    transition: transform 0.25s;\\n}\\n\\n.button.down {\\n    transform: scale(0.9);\\n}\\n\\n.button i{\\n    line-height: 1.5rem;\\n}\\n\\n#dropbox-button{\\n    border-radius: 3px;\\n    background-color: #007ee5;\\n    border: none;\\n    color: #fff;\\n    font-size: 16px;\\n    padding: 10px 15px;\\n    text-decoration: none;\\n    height: 24px;\\n}\\n\\n.view {\\n    display: flex;\\n    position: fixed;\\n    width: 100%;\\n    height: 100%;\\n    background: #BBB;\\n    overflow: hidden;\\n}\\n\\n.dropbox-auth{\\n    align-items: center;\\n    justify-content: center;\\n}\\n\\n.view.book {\\n    flex-wrap: wrap;\\n    align-content: flex-start;\\n    justify-content: center;\\n    overflow-y: auto;\\n    -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n    touch-action: pan-y;\\n}\\n\\n.view.settings {\\n    font-size: 0.5rem;\\n    padding: 2rem;\\n    display: block;\\n    box-sizing: border-box;\\n    padding-right: 52%;\\n    line-height: 1.4em;\\n}\\n\\n.view.settings .button.text {\\n    width: auto;\\n    border-radius: 0.5em;\\n    padding: 0 0.5em;\\n    margin-right: 0.5em;\\n    margin-bottom: 0.5em;\\n}\\n\\n.view.settings label{\\n    display: block;\\n    text-transform: uppercase;\\n    color: grey;\\n}\\n\\n.view.settings #log {\\n    width: 50vw;\\n    background: #272727;\\n    color: #c7c7c7;\\n    overflow: scroll;\\n    -webkit-overflow-scrolling: touch;\\n    touch-action: pan-y;\\n    height: 100vh;\\n    padding: 0;\\n    font-family: monospace;\\n    font-size: 12px;\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    margin: 0;\\n    line-height: 20px;\\n}\\n\\n#log li {\\n    border-bottom: #444444 solid 1px;\\n    padding: 0 1em;\\n}\\n\\n.thumbnail {\\n    margin: 0.3rem;\\n    color: #CCC;\\n    background: white;\\n    border-radius: 0.1rem;\\n    font-size: 5.6rem;\\n    width: 1em;\\n    height: 0.75em;\\n    background-size: contain;\\n    cursor: pointer;\\n    transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n    transform: scale(0.9);\\n}\\n\\n.paint{\\n    align-items: center;\\n}\\n\\n.paint #sheet {\\n    font-size: 1px;\\n    width: 1024em;\\n    height: 768em;\\n    margin: auto;\\n    overflow: auto;\\n    position: fixed;\\n    object-fit: contain;\\n    left: 0;\\n    top: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.layer {\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    background: none;\\n}\\n\\n#base-layer {\\n    background: white;\\n}\\n\\n.layer.floating{\\n    outline: 2px dashed black;\\n}\\n\\n#stamp-layer{\\n    opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n    .paint #sheet {\\n        transform: rotate(-90deg);\\n        overflow-x: hidden;\\n    }\\n}\\n\\n\\n.button.back {\\n    position: absolute;\\n    top: 0.25rem;\\n    left: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button.settings {\\n    position: absolute;\\n    right: 0.25rem;\\n    top: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button a{\\n    width: 100%;\\n    height: 100%;\\n    display: block;\\n    color: black;    \\n}\\n\\n.button#stamp-button{\\n    font-size: 1.25rem;\\n    position: absolute;\\n    top: 0.25rem;\\n    right: 0.25rem;\\n    width: 2rem;\\n    height: 2rem;\\n    z-index: 100;\\n    line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n    display: flex;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    z-index: 100;\\n    position: absolute;\\n}\\n\\n.toolbar.left {\\n    flex-direction: column;\\n    left: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n    flex-direction: column;\\n    right: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n    flex-direction: row;\\n    left: 50%;\\n    top: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n    flex-direction: row;\\n    left: 50%;\\n    bottom: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n\\n.toolbar .button {\\n    /*display: inline-block;*/\\n    background: transparent;\\n}\\n\\n.toolbar .spacer {\\n    width: 1.5em;\\n    height: 1.5em;\\n}\\n\\n.palette {\\n    position: relative;\\n    transition: transform 0.25s;\\n    display: inline-block;\\n    float: left;\\n    text-align: center;\\n    z-index: 100;\\n}\\n\\n.palette .option i {\\n    font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options{\\n    position: absolute;\\n    display: flex;\\n    flex-wrap: wrap;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    padding: 0.25rem;\\n    transition: transform 0.15s;\\n    top: 2.25rem;\\n    left: 50%;\\n    transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n    width: 1em;\\n    height: 1em;\\n    line-height: 0.75em;\\n    display: inline-block;\\n    margin: 0.25em;\\n    float: left;\\n    transition: transform 0.25s;\\n    background-size: contain;\\n    background-repeat: no-repeat;\\n    background-position: center;\\n}\\n\\n.palette .options .option {\\n    margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n    transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n    position: absolute;\\n    width: 0;\\n    height: 0;\\n    font-size: 0.25rem;\\n    top: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-bottom: 2em solid lightgray;\\n    border-top: none;\\n}\\n\\n.toolbar.left .palette .options{\\n    left: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n    top: initial;\\n    left: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options{\\n    left: initial;\\n    right: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n    left: initial;\\n    top: initial;\\n    right: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-left: 2em solid lightgray;\\n    border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options{\\n    left: 50%;\\n    top: initial;\\n    bottom: 2.25rem;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n    top: initial;\\n    bottom: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-top: 2em solid lightgray;\\n    border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n    transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n    transform: translateX(-50%) scale(0.0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n    transform: translateY(-50%) scale(0.0);\\n}\\n\\n#stamp-palette.palette .options{\\n    font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    #stamp-palette.palette .options{\\n        font-size: 1rem;\\n    }\\n}\\n\\n.line-width{\\n    background: black;\\n    height: 100%;\\n    margin: auto;\\n    border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n    border-radius: 40%;\\n}\\n\\n.hidden {\\n    display: none!important;\\n}\\n\\n.disabled {\\n    opacity: 0.25;\\n}\\n\\n.selected {\\n    background: #58b0ff!important;\\n    color: white;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/resolve-url-loader/index.js!../../node_modules/sass-loader/dist/cjs.js!./painter.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = require(\"./config\");\nconst Layer_1 = __importDefault(require(\"./Layer\"));\nclass CanvasLayer extends Layer_1.default {\n    constructor(parent, id, x, y, width, height) {\n        super(parent, \"canvas\", id, x, y, width, height);\n        this._ctx = this.canvas.getContext(\"2d\", { alpha: true });\n        this._ctx.imageSmoothingQuality = \"high\";\n        this._ctx.imageSmoothingEnabled = config_1.config.imageSmoothing;\n    }\n    get canvas() { return this._element; }\n    get ctx() { return this._ctx; }\n    getData() {\n        return this._ctx.getImageData(0, 0, this.width, this.height);\n    }\n    putData(data) {\n        this._ctx.putImageData(data, 0, 0);\n    }\n    drawImage(image, rect) {\n        const { x, y, width, height } = rect || { x: 0, y: 0, width: this.width, height: this.height };\n        this._ctx.drawImage(image, x, y, width, height);\n    }\n    clear(rect) {\n        const { x, y, width, height } = rect || { x: 0, y: 0, width: this.width, height: this.height };\n        this._ctx.clearRect(x, y, width, height);\n    }\n}\nexports.default = CanvasLayer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.History = void 0;\nconst config_1 = require(\"./config\");\nclass History {\n    constructor() {\n        this._states = [];\n        this._position = -1;\n    }\n    get canUndo() { return this._position > 0; }\n    get canRedo() { return this._position < this._states.length - 1; }\n    recordState(data) {\n        if (this._position == config_1.config.maxUndoSteps - 1) {\n            this._states.shift();\n            this._position--;\n        }\n        // remove all future steps\n        this._states.splice(this._position + 1, this._states.length - this._position + 1);\n        this._position++;\n        this._states[this._position] = data;\n    }\n    undo() {\n        if (!this.canUndo) {\n            return null;\n        }\n        this._position--;\n        return this._states[this._position];\n    }\n    redo() {\n        if (!this.canRedo) {\n            return null;\n        }\n        this._position++;\n        return this._states[this._position];\n    }\n    getCurrentState() {\n        return this._position > -1 && this._position < this._states.length ? this._states[this._position] : null;\n    }\n    clear() {\n        this._states = [];\n        this._position = -1;\n    }\n}\nexports.History = History;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Layer_1 = __importDefault(require(\"./Layer\"));\nclass ImageLayer extends Layer_1.default {\n    get image() { return this._element; }\n    constructor(parent, id, x, y, width, height) {\n        super(parent, \"img\", id, x, y, width, height);\n        this._element.onload = () => {\n            // if this.image.completed\n            this.resize(this.image.naturalWidth, this.image.naturalHeight);\n        };\n    }\n}\nexports.default = ImageLayer;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_1 = require(\"./config\");\nconst Utils = __importStar(require(\"./utils/Utils\"));\nconst Vector_1 = __importDefault(require(\"./math/Vector\"));\nclass Layer {\n    constructor(parent, tag, id, x, y, width, height) {\n        this._startScale = 1;\n        this._startRotation = 0;\n        this._position = new Vector_1.default(0, 0);\n        this._scale = 1;\n        this._rotation = 0;\n        this._lastTouchStartTime = 0;\n        this._pointers = [];\n        this._element = document.createElement(tag);\n        this._element.id = id;\n        this._element.classList.add(\"layer\");\n        this._index = 0;\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this._element.style.pointerEvents = \"none\";\n        parent.appendChild(this._element);\n        this.transform(new Vector_1.default(x, y), 1, 0);\n        this.bindEventListeners();\n    }\n    get id() { return this._element.id; }\n    get index() { return this._index; }\n    set index(v) {\n        this._index = v;\n        this.transform(this.position, this.scale, this.rotation);\n    }\n    get width() { return this._width; }\n    ;\n    get height() { return this._height; }\n    ;\n    get position() { return this._position; }\n    get rotation() { return this._rotation; }\n    get scale() { return this._scale; }\n    get floating() { return this._element.classList.contains(\"floating\"); }\n    set floating(value) {\n        this._element.classList.toggle(\"floating\", value);\n        this._element.style.pointerEvents = value ? \"auto\" : \"none\";\n        if (value) {\n            this.addEventListeners();\n        }\n        else {\n            this.removeEventListeners();\n        }\n    }\n    remove() {\n        this._element.remove();\n    }\n    resize(width, height) {\n        const x = this.position.x + 0.5 * (this.width - width);\n        const y = this.position.y + 0.5 * (this.height - height);\n        this.setPositionAndSize(x, y, width, height);\n    }\n    setPositionAndSize(x, y, width, height) {\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this.transform(new Vector_1.default(x, y), this.scale, this.rotation);\n    }\n    drawToCanvas(ctx) {\n        ctx.save();\n        let x = this._position.x + 0.5 * this.width;\n        let y = this._position.y + 0.5 * this.height;\n        ctx.setTransform(this._scale, 0, 0, this._scale, x, y);\n        ctx.rotate(this._rotation);\n        ctx.translate(-0.5 * this.width, -0.5 * this.height);\n        ctx.drawImage(this._element, 0, 0);\n        ctx.restore();\n    }\n    addEventListeners() {\n        // pinch gesture handling inspired by https://codepen.io/hanseklund/pen/izloq\n        this._element.addEventListener('click', this.preventDefault);\n        if (Utils.pointerEventsSupported()) {\n            this._element.addEventListener('touchstart', this.preventDefault);\n            this._element.addEventListener('pointerdown', this.pointerDown);\n        }\n        else {\n            this._element.addEventListener('touchstart', this.touchStart);\n        }\n    }\n    removeEventListeners() {\n        this._element.removeEventListener('click', this.preventDefault);\n        if (Utils.pointerEventsSupported()) {\n            this._element.removeEventListener('touchstart', this.preventDefault);\n            this._element.removeEventListener('pointerdown', this.pointerDown);\n        }\n        else {\n            this._element.removeEventListener('touchstart', this.touchStart);\n        }\n    }\n    preventDefault(event) {\n        event.preventDefault();\n    }\n    doubleTap(event) {\n        if (this.onDoubleTap) {\n            this.onDoubleTap(event);\n        }\n    }\n    pointerDown(event) {\n        event.preventDefault();\n        this._element.setPointerCapture(event.pointerId);\n        this.addPointerEvent(event);\n        if (this._pointers.length === 1) {\n            if (event.timeStamp < this._lastTouchStartTime + config_1.config.doubleTapDelay) {\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            this._element.addEventListener(\"pointermove\", this.pointerMove);\n            this._element.addEventListener(\"pointerup\", this.pointerUp);\n            this._pinchCenter = new Vector_1.default(this._position.x + 0.5 * this.width, this._position.y + 0.5 * this.height);\n            if (event.altKey) {\n                let p1 = this.clientToPixel(this._pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else {\n                this.dragStart(this.clientToPixel(this._pointers[0]));\n            }\n        }\n        if (this._pointers.length === 2) {\n            this.pinchStart(this.clientToPixel(this._pointers[0]), this.clientToPixel(this._pointers[1]));\n        }\n    }\n    addPointerEvent(event) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index < 0) {\n            this._pointers.push(event);\n        }\n        else {\n            this._pointers[index] = event;\n        }\n    }\n    removePointerEvent(event) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index >= 0) {\n            this._pointers.splice(index, 1);\n        }\n    }\n    pointerMove(event) {\n        event.preventDefault();\n        this.addPointerEvent(event);\n        this.move(this._pointers, event.altKey);\n    }\n    pointerUp(event) {\n        event.preventDefault();\n        this._element.releasePointerCapture(event.pointerId);\n        this.removePointerEvent(event);\n        if (this._pointers.length == 1) {\n            this.dragStart(this.clientToPixel(this._pointers[0]));\n        }\n        if (this._pointers.length == 0) {\n            this._element.removeEventListener(\"pointermove\", this.pointerMove);\n            this._element.removeEventListener(\"pointerup\", this.pointerUp);\n        }\n    }\n    touchStart(event) {\n        event.preventDefault();\n        if (event.touches.length === 1) {\n            if (event.timeStamp < this._lastTouchStartTime + config_1.config.doubleTapDelay) {\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            this._element.addEventListener('touchmove', this.touchMove);\n            this._element.addEventListener('touchend', this.touchEnd);\n            this._pinchCenter = new Vector_1.default(this._position.x + 0.5 * this.width, this._position.y + 0.5 * this.height);\n            if (event.altKey) {\n                let p1 = this.clientToPixel(event.touches[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else {\n                this.dragStart(this.clientToPixel(event.touches[0]));\n            }\n        }\n        if (event.touches.length === 2) {\n            this.pinchStart(this.clientToPixel(event.touches[0]), this.clientToPixel(event.touches[1]));\n        }\n    }\n    touchMove(event) {\n        event.preventDefault();\n        this.move(event.touches, event.altKey);\n    }\n    move(pointers, altKey) {\n        if (pointers.length === 1) {\n            if (altKey) {\n                let p1 = this.clientToPixel(pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchMove(p1, p2);\n            }\n            else {\n                this.dragMove(this.clientToPixel(pointers[0]));\n            }\n        }\n        if (pointers.length === 2) {\n            this.pinchMove(this.clientToPixel(pointers[0]), this.clientToPixel(pointers[1]));\n        }\n    }\n    touchEnd(event) {\n        event.preventDefault();\n        this._element.removeEventListener('touchmove', this.touchMove);\n        this._element.addEventListener('touchend', this.touchEnd);\n    }\n    transform(position, scale, rotation) {\n        this._position = position;\n        this._rotation = rotation;\n        this._scale = scale;\n        const index = this._index;\n        this._element.style.transform = `translate(${position.x}em, ${position.y}em) rotate(${rotation}rad) scale(${scale}) translateZ(${index}px)`;\n        this._element.style.outlineWidth = `${2 / scale}em`;\n        this._element.style.outlineOffset = `-${2 / scale}em`;\n    }\n    bindEventListeners() {\n        // TODO: Find a better way. This is ugly:\n        this.touchStart = this.touchStart.bind(this);\n        this.touchMove = this.touchMove.bind(this);\n        this.touchEnd = this.touchEnd.bind(this);\n        this.pointerDown = this.pointerDown.bind(this);\n        this.pointerMove = this.pointerMove.bind(this);\n        this.pointerUp = this.pointerUp.bind(this);\n    }\n    dragStart(position) {\n        this._localDragPosition = position.clone().subtract(this.position);\n    }\n    dragMove(position) {\n        position.subtract(this._localDragPosition);\n        this.transform(position, this._scale, this._rotation);\n    }\n    pinchStart(p1, p2) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        this._pinchStartDist = p1.distanceTo(p2);\n        this._pinchStartRotation = Math.atan2(p1.y - center.y, p1.x - center.x);\n        this._startRotation = this._rotation;\n        this._startScale = this._scale;\n    }\n    pinchMove(p1, p2) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        let distance = p1.distanceTo(p2);\n        let angle = Math.atan2(p1.y - center.y, p1.x - center.x);\n        let angleChange = angle - this._pinchStartRotation;\n        let scale = this._startScale * (distance / this._pinchStartDist);\n        scale = Utils.clamp(0.1, 10, scale);\n        let position = p1.clone().add(p2).multiplyScalar(0.5);\n        position.x -= 0.5 * this.width;\n        position.y -= 0.5 * this.height;\n        let rotation = this._startRotation + angleChange;\n        this.transform(position, scale, rotation);\n    }\n    clientToPixel(position1) {\n        let parent = this._element.parentElement;\n        let rect = parent.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (position1.clientX - rect.left) / rect.width;\n        let ny = (position1.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * config_1.config.width;\n        let y = (isPortraitOrientation ? nx : ny) * config_1.config.height;\n        return new Vector_1.default(x, y);\n    }\n}\nexports.default = Layer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Toolbar = void 0;\nconst View_1 = require(\"./views/View\");\nclass Toolbar extends View_1.View {\n    constructor(id) {\n        super(id);\n        this.show();\n    }\n    flip() {\n        if (this._element.classList.contains(\"left\") || this._element.classList.contains(\"right\")) {\n            this._element.classList.toggle(\"left\");\n            this._element.classList.toggle(\"right\");\n        }\n        if (this._element.classList.contains(\"top\") || this._element.classList.contains(\"bottom\")) {\n            this._element.classList.toggle(\"top\");\n            this._element.classList.toggle(\"bottom\");\n        }\n    }\n}\nexports.Toolbar = Toolbar;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire('../css/painter.css');\nconst fontawesome_svg_core_1 = require(\"@fortawesome/fontawesome-svg-core\");\nconst free_solid_svg_icons_1 = require(\"@fortawesome/free-solid-svg-icons\");\nfontawesome_svg_core_1.library.add(free_solid_svg_icons_1.fas);\nfontawesome_svg_core_1.dom.watch();\nrequire(\"babel-polyfill\");\nconst BookView_1 = __importDefault(require(\"./views/BookView\"));\nconst PaintView_1 = require(\"./views/PaintView\");\nconst config_1 = require(\"./config\");\nconst SettingsView_1 = __importDefault(require(\"./views/SettingsView\"));\nclass App {\n    constructor() {\n        // App.preventOverScroll();\n        //PeerToPeer.createInstance();\n        this._settingsView = new SettingsView_1.default(\"settings\", () => {\n            this.openView(this._bookView);\n        });\n        this._sheet = document.getElementById(\"sheet\");\n        window.addEventListener('resize', event => {\n            this.OnResize();\n        });\n        this.OnResize();\n        this._bookView = new BookView_1.default(\"book\", () => __awaiter(this, void 0, void 0, function* () {\n            this.openView(this._settingsView);\n        }));\n        this._bookView.onImageSelected = (id) => {\n            this._paintView.loadImage(id)\n                .then(() => {\n                this.openView(this._paintView);\n            });\n        };\n        this._paintView = new PaintView_1.PaintView(\"paint\", () => {\n            this.openView(this._bookView);\n        });\n        // Dropbox integration is not working yet:\n        // this.dropboxAuthView = new DropboxAuthView(\"dropbox-auth\");\n        // this.openView(ImageStorage.adapter.isAuthenticated ? this.bookView : this.dropboxAuthView);\n        this.openView(this._bookView);\n    }\n    getIOSVersion() {\n        if (/iP(hone|od|ad)/.test(navigator.platform)) {\n            // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n            var v = (navigator.appVersion).match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || \"0\", 10)];\n        }\n    }\n    OnResize() {\n        const docWidth = document.documentElement.clientWidth;\n        const docHeight = document.documentElement.clientHeight;\n        const portrait = docWidth < docHeight;\n        const isLargeScreen = docWidth > 1024;\n        const viewWidth = Math.max(docWidth, docHeight);\n        const viewHeight = Math.min(docWidth, docHeight);\n        const horizontalPixelSize = viewWidth / config_1.config.width;\n        const verticalPixelSize = viewHeight / config_1.config.height;\n        const virtualPixelSize = config_1.config.fullScreenCanvas && !isLargeScreen ?\n            Math.max(horizontalPixelSize, verticalPixelSize) :\n            Math.min(horizontalPixelSize, verticalPixelSize);\n        this._sheet.style.fontSize = `${virtualPixelSize}px`;\n        this._sheet.style.left = `${portrait ? 0.5 * (docWidth - virtualPixelSize * config_1.config.width) : 0}px`;\n    }\n    static preventOverScroll() {\n        document.ontouchmove = event => { event.preventDefault(); };\n    }\n    openView(view) {\n        if (this._activeView) {\n            this._activeView.hide();\n        }\n        this._activeView = view;\n        this._activeView.show();\n    }\n}\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    // @ts-ignore\n    window.app = new App();\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.config = void 0;\nconst defaultShapes = [\n    \"img/stamps/star.png\",\n    \"img/stamps/unicorn.png\",\n    \"img/stamps/snowman.png\",\n    \"img/stamps/dolphin.png\",\n    \"img/stamps/snail.png\"\n];\nexports.config = {\n    debug: true,\n    doubleTapDelay: 400,\n    longClickDelay: 1000,\n    minScrollDistance: 30,\n    maxScrollDelay: 500,\n    maxShapeCount: 64 - defaultShapes.length,\n    usePointerEvents: true,\n    fullScreenCanvas: true,\n    pixelPerfect: false,\n    imageSmoothing: true,\n    useAutoMask: false,\n    maxUndoSteps: 10,\n    saveInterval: 5000,\n    width: 1024,\n    height: 768,\n    defaultShapes: defaultShapes,\n    imageCount: 32,\n    images: {\n        \"image01.png\": { overlay: \"./img/overlays/spirit.png\" },\n        \"image02.png\": { overlay: \"./img/overlays/spirit2.png\" },\n        \"image03.png\": { overlay: \"./img/overlays/spirit3.png\" },\n        \"image04.png\": { overlay: \"./img/overlays/santa.png\" }\n    }\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Utils = __importStar(require(\"../utils/Utils\"));\nclass Vector {\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    set(x = 0, y = x) {\n        this.x = x;\n        this.y = y;\n        return this;\n    }\n    clone() {\n        return new Vector(this.x, this.y);\n    }\n    add(v) {\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    }\n    subtract(v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    }\n    round() {\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n    clamp(minX, minY, maxX, maxY) {\n        this.x = Utils.clamp(minX, maxX, this.x);\n        this.y = Utils.clamp(minY, maxY, this.y);\n        return this;\n    }\n    invert() {\n        this.x *= -1;\n        this.y *= -1;\n        return this;\n    }\n    ;\n    multiplyScalar(s) {\n        this.x *= s;\n        this.y *= s;\n        return this;\n    }\n    ;\n    divideScalar(s) {\n        if (s === 0) {\n            this.x = 0;\n            this.y = 0;\n        }\n        else {\n            var invScalar = 1 / s;\n            this.x *= invScalar;\n            this.y *= invScalar;\n        }\n        return this;\n    }\n    ;\n    length() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    normalize() {\n        return this.divideScalar(this.length());\n    }\n    distanceToSq(v) {\n        const dx = this.x - v.x, dy = this.y - v.y;\n        return dx * dx + dy * dy;\n    }\n    distanceTo(v) {\n        return Math.sqrt(this.distanceToSq(v));\n    }\n    lerp(v, alpha) {\n        this.x += (v.x - this.x) * alpha;\n        this.y += (v.y - this.y) * alpha;\n        return this;\n    }\n    ;\n}\nexports.default = Vector;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nclass ColorPalette extends Palette_1.Palette {\n    get color() { return this.selectedOption; }\n    set color(value) { this.selectedOption = value; }\n    constructor(id) {\n        // 16 color Mac palette\n        // https://en.wikipedia.org/wiki/List_of_software_palettes#Apple_Macintosh_default_16-color_palette\n        // let colors: string[] = [\n        //     \"#FFFFFF\", \"#f5f60d\", \"#f5650a\", \"#d50406\",\n        //     \"#f50695\", \"#330496\", \"#0306c5\", \"#0692f0\",\n        //     \"#06a606\", \"#026405\", \"#643403\", \"#946434\",\n        //     \"#b5b5b5\", \"#848484\", \"#444444\", \"#030303\",\n        // ];\n        // 32 color palette\n        // https://github.com/geoffb/dawnbringer-palettes\n        let colors = [\n            \"#000000\", \"#222034\", \"#45283c\", \"#663931\",\n            \"#8f563b\", \"#df7126\", \"#d9a066\", \"#eec39a\",\n            \"#fbf236\", \"#99e550\", \"#6abe30\", \"#37946e\",\n            \"#4b692f\", \"#524b24\", \"#323c39\", \"#3f3f74\",\n            \"#306082\", \"#5b6ee1\", \"#639bff\", \"#5fcde4\",\n            \"#cbdbfc\", \"#ffffff\", \"#9badb7\", \"#847e87\",\n            \"#696a6a\", \"#595652\", \"#76428a\", \"#ac3232\",\n            \"#d95763\", \"#d77bba\", \"#8f974a\", \"#8a6f30\",\n        ];\n        super(id, colors);\n        this.selectedIndex = 15;\n    }\n    updateOptionElement(element, option) {\n        element.style.background = option;\n    }\n}\nexports.default = ColorPalette;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Palette = void 0;\nconst View_1 = require(\"../views/View\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\n// base class for palettes\nclass Palette extends View_1.View {\n    constructor(id, options, rightAlign = false) {\n        super(id);\n        this._options = options;\n        this._optionElements = [];\n        this._selectedIndex = 0;\n        this.createOptions();\n        this.show();\n        this.collapse();\n    }\n    get selectedIndex() { return this._selectedIndex; }\n    set selectedIndex(value) {\n        this._selectedIndex = Math.max(0, Math.min(this._options.length - 1, value));\n        this.updateSelectedOptionElement(this._selectedElement, this.selectedOption);\n    }\n    get selectedOption() { return this._options[this._selectedIndex]; }\n    set selectedOption(value) {\n        let index = this._options.indexOf(value);\n        if (index === -1) {\n            return;\n        }\n        this.selectedIndex = index;\n    }\n    get isCollapsed() { return this._element.classList.contains(\"collapsed\"); }\n    static collapseAll() {\n        if (Palette._expandedPalette) {\n            Palette._expandedPalette.collapse();\n        }\n    }\n    createOptions() {\n        this.addSelectedOption();\n        this.addOptionElements();\n    }\n    recreateOptions() {\n        this.clear();\n        this.createOptions();\n    }\n    collapse() {\n        this._element.classList.add(\"collapsed\");\n        if (Palette._expandedPalette == this) {\n            Palette._expandedPalette = null;\n        }\n    }\n    expand() {\n        Palette.collapseAll();\n        this._element.classList.remove(\"collapsed\");\n        Palette._expandedPalette = this;\n    }\n    toggle() {\n        if (this.isCollapsed) {\n            this.expand();\n        }\n        else {\n            this.collapse();\n        }\n    }\n    addOption(value) {\n        this._options.push(value);\n        this.addOptionElement(this._options.length - 1, value);\n        this.updateOptionsWidth();\n    }\n    removeOption(index) {\n        this._options.splice(index, 1);\n        this._optionElements[index].remove();\n        this._optionElements.splice(index, 1);\n        // update the index assigned to each element:\n        this.recreateOptions();\n    }\n    addSelectedOption() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"option\");\n        this._selectedElement = element;\n        Utils.addClick(element, () => this.toggle());\n        this.updateSelectedOptionElement(element, this.selectedOption);\n        this._element.appendChild(element);\n    }\n    addOptionElements() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"options\");\n        this._optionsElement = element;\n        this.addArrowElement();\n        let i = 0;\n        for (let option of this._options) {\n            this.addOptionElement(i, option);\n            i++;\n        }\n        this.updateOptionsWidth();\n        this._element.appendChild(element);\n    }\n    updateOptionsWidth() {\n        this._optionsElement.style.width = Math.min(8, this._options.length) * 1.25 + \"em\";\n    }\n    addArrowElement() {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"arrow\");\n        this._optionsElement.appendChild(element);\n    }\n    addOptionElement(index, option) {\n        let element = document.createElement(\"div\");\n        element.classList.add(\"option\");\n        element.dataset.index = `${index}`;\n        Utils.addLongClick(element, event => this.optionLongClicked(event, option, index));\n        Utils.addClick(element, event => this.optionClicked(event, option, index));\n        this.updateOptionElement(element, option);\n        this._optionsElement.appendChild(element);\n        this._optionElements[index] = element;\n    }\n    optionClicked(event, option, index) {\n        this.selectedIndex = index;\n        this.collapse();\n        if (this.onSelectionChanged) {\n            this.onSelectionChanged(option, index);\n        }\n    }\n    optionLongClicked(event, option, index) {\n    }\n    updateOptionElement(element, option) {\n    }\n    updateSelectedOptionElement(element, option) {\n        this.updateOptionElement(element, option);\n    }\n}\nexports.Palette = Palette;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst config_1 = require(\"../config\");\nclass ShapePalette extends Palette_1.Palette {\n    constructor(id) {\n        super(id, config_1.config.defaultShapes, true);\n        this._shapeIds = {};\n        this.selectedIndex = 0;\n        ImageStorage_1.imageStorage.keys()\n            .then((keys) => {\n            const shapesIds = keys.filter(x => x.startsWith(\"shape\"));\n            for (let shapeId of shapesIds) {\n                this.addShapeFromImageId(shapeId);\n            }\n        });\n        ImageStorage_1.imageStorage.addChangeListener((change, id) => {\n            if (change == \"save\" && id.startsWith(\"shape\")) {\n                this.addShapeFromImageId(id);\n            }\n        });\n    }\n    get stamp() { return this.selectedOption; }\n    addShapeFromImageId(stampId) {\n        ImageStorage_1.imageStorage.loadImageUrl(stampId)\n            .then(url => {\n            this._shapeIds[url] = stampId;\n            this.addOption(url);\n        });\n    }\n    optionLongClicked(event, option, index) {\n        this.deleteShape(index);\n    }\n    updateOptionElement(element, option) {\n        element.style.backgroundImage = `url(\"${option}\")`;\n    }\n    updateSelectedOptionElement(element, option) {\n        element.innerHTML = '<i class=\"fas fa-shapes\"></i>';\n    }\n    deleteShape(index) {\n        let option = this._options[index];\n        let stampId = this._shapeIds[option];\n        if (!stampId) {\n            return;\n        }\n        ImageStorage_1.imageStorage.deleteImage(stampId)\n            .then(() => {\n            delete this._shapeIds[option];\n            this.removeOption(index);\n            if (this.selectedIndex == index) {\n                // select the following item that now has the same index\n                this.selectedIndex = index;\n            }\n        });\n    }\n}\nexports.default = ShapePalette;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Palette_1 = require(\"./Palette\");\nclass SizePalette extends Palette_1.Palette {\n    get size() { return this.selectedOption; }\n    set size(value) { this.selectedOption = value; }\n    constructor(id) {\n        let sizes = [2, 8, 24, 40];\n        super(id, sizes, true);\n        this.selectedIndex = 1;\n    }\n    updateOptionElement(element, option) {\n        const width = option / 40;\n        element.innerHTML = '<div class=\"line-width\" style=\"width:' + width + 'em\"></div>';\n    }\n}\nexports.default = SizePalette;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.imageStorage = void 0;\nrequire(\"whatwg-fetch\");\nconst LocalForageAdapter_1 = __importDefault(require(\"./LocalForageAdapter\"));\nconst jszip_1 = __importDefault(require(\"jszip\"));\nclass ImageStorage {\n    get adapter() {\n        if (!this._adapter) {\n            this._adapter = new LocalForageAdapter_1.default();\n            this.migrate();\n        }\n        return this._adapter;\n    }\n    get urls() {\n        if (!this._urls) {\n            this._urls = {};\n        }\n        return this._urls;\n    }\n    loadImage(id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const url = yield this.loadImageUrl(id);\n            if (!url) {\n                return null;\n            }\n            const img = new Image();\n            img.id = id;\n            img.src = url;\n            if (img.decode != null) {\n                yield img.decode();\n                return img;\n            }\n            return new Promise(resolve => {\n                img.onload = () => resolve(img);\n            });\n        });\n    }\n    loadImageUrl(id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (id in this.urls) {\n                return this.urls[id];\n            }\n            const blob = yield this.loadBlob(id);\n            if (!blob) {\n                return null;\n            }\n            const url = URL.createObjectURL(blob);\n            this.urls[id] = url;\n            return url;\n        });\n    }\n    loadBlob(id) {\n        return this.adapter.getItem(id);\n    }\n    saveImage(id, blob) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                yield this.adapter.setItem(id, blob);\n            }\n            catch (e) {\n            }\n            if (id in this.urls) {\n                URL.revokeObjectURL(this.urls[id]);\n            }\n            this.urls[id] = URL.createObjectURL(blob);\n            this.dispatchChangeEvent(\"save\", id);\n        });\n    }\n    deleteImage(id) {\n        return this.adapter.removeItem(id)\n            .then(() => {\n            if (id in this.urls) {\n                URL.revokeObjectURL(this.urls[id]);\n                delete this.urls[id];\n            }\n            this.dispatchChangeEvent(\"delete\", id);\n        });\n    }\n    keys() {\n        return this.adapter.keys();\n    }\n    addChangeListener(callback) {\n        this._changeListeners = this._changeListeners || [];\n        this._changeListeners.push(callback);\n    }\n    dispatchChangeEvent(change, id) {\n        for (let changeListener of this._changeListeners) {\n            changeListener(change, id);\n        }\n    }\n    clear() {\n        this.adapter.clear();\n    }\n    generateBackupArchive() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let count = 0;\n            var keys = yield this.keys();\n            var zip = new jszip_1.default();\n            for (let id of keys) {\n                const url = yield this.loadImageUrl(id);\n                const blob = yield fetch(url).then(r => r.blob());\n                if (!blob) {\n                    continue;\n                }\n                zip.file(id, blob);\n                count += 1;\n            }\n            if (count == 0) {\n                return;\n            }\n            return zip.generateAsync({ type: \"blob\" });\n        });\n    }\n    importBackupArchive(zipFile) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const zip = yield jszip_1.default.loadAsync(zipFile);\n            zip.forEach((path, file) => __awaiter(this, void 0, void 0, function* () {\n                const buffer = yield file.async(\"arraybuffer\");\n                const blob = new Blob([buffer], { \"type\": \"image/png\" });\n                this.saveImage(file.name, blob);\n            }));\n        });\n    }\n    migrate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let needsRefresh = false;\n            var keys = yield this.keys();\n            for (let id of keys) {\n                if (!id.startsWith(\"image\") && !id.startsWith(\"Shape\")) {\n                    continue;\n                }\n                if (id.endsWith(\".png\")) {\n                    continue;\n                }\n                const newId = id.replace(\"Shape\", \"shape\") + \".png\";\n                const data = yield this.adapter.getItem(id);\n                yield this.adapter.setItem(newId, data);\n                yield this.adapter.removeItem(id);\n                console.log(`Migrated ${id} to ${newId}.`);\n                needsRefresh = true;\n            }\n            if (needsRefresh) {\n                location.reload();\n            }\n        });\n    }\n    getStorageUsed() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let amount = 0;\n            var keys = yield this.keys();\n            for (let id of keys) {\n                const url = yield this.loadImageUrl(id);\n                const blob = yield fetch(url).then(r => r.blob());\n                if (!blob) {\n                    continue;\n                }\n                amount += blob.size;\n            }\n            return amount;\n        });\n    }\n}\nexports.imageStorage = new ImageStorage();\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst localforage_1 = __importDefault(require(\"localforage\"));\nconst StorageAdapter_1 = __importDefault(require(\"./StorageAdapter\"));\nclass LocalForageAdapter extends StorageAdapter_1.default {\n    constructor() {\n        super(...arguments);\n        this._imageStore = localforage_1.default.createInstance({ name: \"ImageStore\" });\n    }\n    getItem(id) {\n        return this._imageStore.getItem(id);\n    }\n    setItem(id, blob) {\n        return this._imageStore.setItem(id, blob);\n    }\n    removeItem(id) {\n        return this._imageStore.removeItem(id);\n    }\n    keys() {\n        return this._imageStore.keys();\n    }\n    iterate(param) {\n        return this._imageStore.iterate(param);\n    }\n    clear() {\n        return this._imageStore.clear();\n    }\n}\nexports.default = LocalForageAdapter;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass StorageAdapter {\n}\nexports.default = StorageAdapter;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Tool_1 = __importDefault(require(\"./Tool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\n// Paints lines with varying stroke width\nclass PenTool extends Tool_1.default {\n    constructor(painter, buttonId, operation = \"darken\") {\n        super(painter, buttonId);\n        this._operation = operation;\n        this.createBrushCtx();\n    }\n    createBrushCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"brush\";\n        brushCanvas.width = 64;\n        brushCanvas.height = 64;\n        this._brushCtx = brushCanvas.getContext(\"2d\", { alpha: true });\n        this._brushCtx.imageSmoothingQuality = \"high\";\n        this._brushCtx.imageSmoothingEnabled = true;\n    }\n    down(data) {\n        this._painter.captureAutoMask(data.position.clone().round());\n        this._points = [data.position];\n        const width = this.getWidth(data.pressure, data.speed);\n        this._widths = [width];\n        this._startIndex = 0;\n        let ctx = this._painter.baseLayer.ctx;\n        ctx.fillStyle = this.color;\n        ctx.strokeStyle = this.color;\n        // let ctx = this._brushCtx;\n        // let brushWidth = ctx.canvas.width;\n        // ctx.clearRect(0, 0, brushWidth, brushWidth);\n        // ctx.fillStyle = this.color;\n        // let radius = brushWidth * 0.5;\n        // ctx.beginPath();\n        // ctx.arc(radius, radius, radius - 1, 0, 2 * Math.PI);\n        // ctx.fill();  \n        this._painter.baseLayer.ctx.globalCompositeOperation = this._operation;\n        this.requestDrawPath();\n    }\n    up() {\n        this._painter.recordHistoryState();\n    }\n    tick(delta) {\n        if (this._drawPathRequested) {\n            this.drawPath();\n            this._drawPathRequested = false;\n        }\n    }\n    requestDrawPath() {\n        this._drawPathRequested = true;\n    }\n    drawPath() {\n        if (this._points.length == 0) {\n            return;\n        }\n        let ctx = this._painter.baseLayer.ctx;\n        this.drawConnectedLines(ctx, this._points.slice(this._startIndex), this._widths.slice(this._startIndex));\n        // if (this._points.length - this._startIndex == 1){\n        //     const p = this._points[this._startIndex];\n        //     this.drawBrush(ctx, p.x, p.y, this._widths[this._startIndex]);\n        //     return;\n        // }\n        //\n        // for (let i = this._startIndex; i < this._points.length - 1; i++) {\n        //     const p1 = this._points[i];\n        //     const p2 = this._points[i+1];\n        //    \n        //     const w1 = this._widths[i];\n        //     const w2 = this._widths[i+1];\n        //\n        //     const dist = Vector.distance(p1, p2);\n        //     const step = Math.max(1, 0.125 * Math.min(w1, w2, 64));\n        //     for (let d = 0; d <= dist; d += step){\n        //         const a = d / dist;\n        //         const p = Vector.lerp(p1, p2, a);\n        //         const w = Utils.lerp(w1, w2, a);\n        //         this.drawBrush(ctx, p.x, p.y, w);\n        //     }\n        // }\n        this._startIndex = Math.max(0, this._points.length - 1);\n    }\n    drawConnectedLines(ctx, points, widths) {\n        const pointCount = points.length;\n        if (pointCount == 0) {\n            return;\n        }\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        let start = points[0];\n        let startWidth = widths[0] * this.lineWidth;\n        if (pointCount == 1) {\n            // single dot\n            ctx.beginPath();\n            ctx.arc(start.x, start.y, 0.5 * startWidth, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n        for (let i = 1; i < pointCount; i++) {\n            ctx.beginPath();\n            ctx.lineWidth = widths[i] * this.lineWidth;\n            ctx.lineTo(points[i - 1].x, points[i - 1].y);\n            ctx.lineTo(points[i].x, points[i].y);\n            ctx.stroke();\n        }\n    }\n    drawBrush(ctx, x, y, width) {\n        let radius = width * 0.5;\n        x -= radius;\n        y -= radius;\n        // x = Math.floor(x - radius);\n        // y = Math.floor(y - radius);\n        // width = Math.ceil(width);\n        ctx.drawImage(this._brushCtx.canvas, x, y, width, width);\n    }\n    move(data) {\n        let newPoints = this.interpolatePoints(data.position);\n        this._points = this._points.concat(newPoints);\n        const numSegments = newPoints.length;\n        let width = this.getWidth(data.pressure, data.speed);\n        const lastWidth = this._widths[this._widths.length - 1];\n        const maxWidthDifferencePerSegment = 2;\n        const maxWidthDifference = maxWidthDifferencePerSegment * numSegments;\n        width = Utils.clamp(lastWidth - maxWidthDifference, lastWidth + maxWidthDifference, width);\n        for (let i = 0; i < numSegments; i++) {\n            this._widths.push(Utils.lerp(lastWidth, width, i / numSegments));\n        }\n        this.requestDrawPath();\n    }\n    interpolatePoints(newPoint) {\n        const segmentLength = Math.max(4, 0.1 * this.lineWidth);\n        const points = [];\n        if (this._points.length == 0) {\n            return;\n        }\n        const start = this._points[this._points.length - 1];\n        const end = newPoint;\n        const dist = start.distanceTo(end);\n        if (dist < segmentLength) {\n            return points;\n        }\n        let control = start;\n        if (this._points.length > 1) {\n            const previous = this._points[this._points.length - 2];\n            const tangent = start.clone().subtract(previous).normalize();\n            control = start.clone().add(tangent.clone().multiplyScalar(0.3 * dist));\n        }\n        const a = segmentLength / dist;\n        for (let i = a; i <= 1; i += a) {\n            const Vector = this.pointOnQuadraticCurve(start, control, end, i);\n            points.push(Vector);\n        }\n        return points;\n    }\n    pointOnQuadraticCurve(start, control, end, a) {\n        const f1 = (1 - a) * (1 - a);\n        const f2 = 2 * a * (1 - a);\n        const f3 = a * a;\n        return new Vector_1.default(start.x * f1 + control.x * f2 + end.x * f3, start.y * f1 + control.y * f2 + end.y * f3);\n    }\n    pressureChanged() {\n        this.requestDrawPath();\n    }\n    getWidth(pressure, speed) {\n        speed = Utils.clamp(1, 2, speed);\n        return pressure / speed; // range: 0.5 - 1\n    }\n    applyAutoMask() {\n        if (!this._painter.autoMaskCtx) {\n            return;\n        }\n        let ctx = this.getBufferCtx();\n        ctx.globalCompositeOperation = \"destination-in\";\n        ctx.drawImage(this._painter.autoMaskCtx.canvas, 0, 0);\n        ctx.globalCompositeOperation = \"source-over\";\n    }\n}\nexports.default = PenTool;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Tool_1 = __importDefault(require(\"./Tool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Rect_1 = __importDefault(require(\"../utils/Rect\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst config_1 = require(\"../config\");\nconst file_saver_1 = require(\"file-saver\");\n// Provides a floating selection the user can manipulate \nclass SelectionTool extends Tool_1.default {\n    constructor(painter, buttonId) {\n        super(painter, buttonId);\n        this.selectionLayerId = \"selection-layer\";\n        this._selection = Rect_1.default.Empty();\n        this._deleteButton = document.getElementById(\"selection-delete-button\");\n        Utils.addClick(this._deleteButton, () => this.clearSelection());\n        this._stampButton = document.getElementById(\"selection-stamp-button\");\n        Utils.addClick(this._stampButton, () => this.paintSelectionToCanvas());\n        this._saveButton = document.getElementById(\"selection-save-button\");\n        Utils.addClick(this._saveButton, () => this.saveSelectionAsNewStamp());\n        this._downloadButton = document.getElementById(\"selection-download-button\");\n        Utils.addClick(this._downloadButton, () => {\n            this.selectionLayer.canvas.toBlob(blob => file_saver_1.saveAs(blob, \"image.png\"));\n        });\n        this.hasFloatingSelection = false;\n        this._position = new Vector_1.default(0, 0);\n    }\n    get selectionLayer() { return this._painter.getLayer(this.selectionLayerId); }\n    get selection() { return this._selection; }\n    get hasFloatingSelection() { return this._hasFloatingSelection; }\n    set hasFloatingSelection(value) {\n        this._hasFloatingSelection = value;\n        this.toggleFloatingSelectionButtons(value);\n    }\n    get isInShapesPalette() { return this._isInShapesPalette; }\n    set isInShapesPalette(value) {\n        this._isInShapesPalette = value;\n        this._saveButton.classList.toggle(\"disabled\", value);\n    }\n    toggleFloatingSelectionButtons(visible) {\n        this._deleteButton.classList.toggle(\"hidden\", !visible);\n        this._stampButton.classList.toggle(\"hidden\", !visible);\n        this._downloadButton.classList.toggle(\"hidden\", !visible);\n        this._saveButton.classList.toggle(\"hidden\", !visible);\n    }\n    enable() {\n        super.enable();\n        this.createSelectionLayer();\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n    }\n    disable() {\n        super.disable();\n        this.paintSelectionToCanvas();\n        this.destroySelectionLayer();\n        this.hasFloatingSelection = false;\n    }\n    down(data) {\n        this._position = this.getClampedPosition(data);\n        this.startNewSelection();\n    }\n    move(data) {\n        this._position = this.getClampedPosition(data);\n        this.requestDrawSelectionOutline();\n    }\n    up(data) {\n        this.cutSelection();\n    }\n    startNewSelection() {\n        this.paintSelectionToCanvas();\n        this.selectionLayer.setPositionAndSize(0, 0, this._painter.width, this._painter.height);\n        this.selectionLayer.transform(new Vector_1.default(0, 0), 1, 0);\n        this.selectionLayer.floating = false;\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n        this._startPosition = this._position;\n        let ctx = this.selectionLayer.ctx;\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\n        ctx.strokeStyle = \"black\";\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        this.requestDrawSelectionOutline();\n    }\n    getClampedPosition(data) {\n        return data.position.round().clamp(0, 0, this._painter.width - 1, this._painter.height - 1);\n    }\n    tick(delta) {\n        if (this._drawSelectionOutlineRequested) {\n            this.updateSelectionAndDrawOutline();\n            this._drawSelectionOutlineRequested = false;\n        }\n    }\n    keyDown(event) {\n        switch (event.code) {\n            case 'Backspace':\n                this.clearSelection();\n                break;\n            // case 'KeyC':\n            //     if (event.metaKey){\n            //         this.copyToClipboard();\n            //     }\n            //     break;\n        }\n    }\n    clearSelection() {\n        this.selectionLayer.clear();\n        this.startNewSelection();\n    }\n    setImage(image) {\n        this.hasFloatingSelection = true;\n        this.selectionLayer.resize(image.width, image.height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.drawImage(image);\n        this.isInShapesPalette = true;\n    }\n    setImageUrl(url) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const img = new Image();\n            img.src = url;\n            return new Promise(resolve => {\n                img.onload = () => {\n                    this.setImage(img);\n                    resolve(img);\n                };\n            });\n        });\n    }\n    requestDrawSelectionOutline() {\n        this._drawSelectionOutlineRequested = true;\n    }\n    updateSelectionAndDrawOutline() {\n        if (this.hasFloatingSelection) {\n            return;\n        }\n        this.selectionLayer.clear();\n        let ctx = this.selectionLayer.ctx;\n        const x = Math.min(this._startPosition.x, this._position.x);\n        const y = Math.min(this._startPosition.y, this._position.y);\n        const width = Math.abs(this._startPosition.x - this._position.x);\n        const height = Math.abs(this._startPosition.y - this._position.y);\n        this._selection = new Rect_1.default(x, y, width, height);\n        ctx.strokeRect(x, y, width, height);\n    }\n    destroySelectionLayer() {\n        this._painter.removeLayer(this.selectionLayer);\n    }\n    createSelectionLayer() {\n        if (this.selectionLayer) {\n            return;\n        }\n        this._painter.addCanvasLayer(this.selectionLayerId, 0, 0, this._painter.width, this._painter.height, false);\n        this.selectionLayer.onDoubleTap = (event) => {\n            if (event.altKey) {\n                this.saveSelectionAsNewStamp();\n                return;\n            }\n            this.paintSelectionToCanvas();\n        };\n    }\n    cutSelection() {\n        this.selectionLayer.clear();\n        this._selection = Utils.getVisiblePixelFrame(this._painter.baseLayer.ctx, this.selection);\n        if (this.selection.isEmpty()) {\n            return;\n        }\n        this.hasFloatingSelection = true;\n        const { x, y, width, height } = this.selection;\n        this.selectionLayer.setPositionAndSize(x, y, width, height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas, x, y, width, height, 0, 0, width, height);\n        this._painter.baseLayer.clear(this.selection);\n        this._painter.recordHistoryState();\n    }\n    paintSelectionToCanvas() {\n        if (!this.hasFloatingSelection) {\n            return;\n        }\n        this._painter.baseLayer.ctx.globalCompositeOperation = \"source-over\";\n        this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx);\n        this._painter.recordHistoryState();\n    }\n    saveSelectionAsNewStamp() {\n        ImageStorage_1.imageStorage.keys()\n            .then((keys) => {\n            const shapesIds = keys.filter(x => x.startsWith(\"Shape\"));\n            if (shapesIds.length >= config_1.config.maxShapeCount) {\n                console.log(\"Cannot save selection as shape because there are already too many in storage.\");\n                return;\n            }\n            const id = `shape${Date.now()}.png`;\n            console.log(`Saving selection as: ${id}`);\n            this.selectionLayer.canvas.toBlob(blob => ImageStorage_1.imageStorage.saveImage(id, blob));\n            this.isInShapesPalette = true;\n        });\n    }\n    // copyToClipboard(){\n    //     this.selectionLayer.canvas.toBlob(blob => navigator.clipboard.write([new ClipboardItem({'image/png': blob})]));\n    //     console.log(\"copied selection to clipboard\");\n    // }\n    //\n    // pasteFromClipboard() {\n    //     navigator.permissions.query({name: \"clipboard-read\"})\n    //         .then(result => {\n    //             if (!(result.state == \"granted\" || result.state == \"prompt\")) {\n    //                 return;\n    //             }\n    //             navigator.clipboard.read()\n    //                 .then(data => {\n    //                     for (let i = 0; i < data.length; i++) {\n    //                         if (!data[i].types.includes(\"image/png\")){\n    //                             continue;\n    //                         }\n    //                         data[i].getType(\"image/png\")\n    //                             .then(blob => {\n    //                                 this.setImageUrl(URL.createObjectURL(blob));\n    //                             })\n    //                     }\n    //                 });\n    //         });\n    // }\n    selectAll() {\n        this.startNewSelection();\n        this._selection = new Rect_1.default(0, 0, this._painter.width, this._painter.height);\n        this.cutSelection();\n    }\n}\nexports.default = SelectionTool;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// Base class for all tools\nclass Tool {\n    constructor(painter, buttonId) {\n        this._painter = painter;\n        this._buttonElement = document.getElementById(buttonId);\n    }\n    get color() { return this._painter.color; }\n    ;\n    get opacity() { return this._painter.opacity; }\n    get lineWidth() { return this._painter.lineWidth; }\n    ;\n    // creates a context to draw the current stroke to so we can draw the complete stroke with a different\n    // operation. The buffer can be shared by different tools.\n    createBufferCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"buffer\";\n        brushCanvas.width = this._painter.width;\n        brushCanvas.height = this._painter.height;\n        Tool._bufferCtx = brushCanvas.getContext(\"2d\", { alpha: true });\n        Tool._bufferCtx.imageSmoothingQuality = \"high\";\n        Tool._bufferCtx.imageSmoothingEnabled = true;\n    }\n    getBufferCtx() {\n        if (Tool._bufferCtx == null) {\n            this.createBufferCtx();\n        }\n        return Tool._bufferCtx;\n    }\n    enable() {\n        this._buttonElement.classList.add(\"selected\");\n    }\n    disable() {\n        this._buttonElement.classList.remove(\"selected\");\n    }\n    down(data) { }\n    move(data) { }\n    up(data) { }\n    pressureChanged() { }\n    tick(delta) { }\n    keyDown(event) { }\n}\nexports.default = Tool;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass Rect {\n    constructor(x, y, width, height) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    get minX() { return this.x; }\n    get minY() { return this.y; }\n    get maxX() { return this.x + this.width; }\n    get maxY() { return this.y + this.height; }\n    isEmpty() {\n        return this.width <= 0 || this.height <= 0;\n    }\n    static Empty() {\n        return new Rect(0, 0, 0, 0);\n    }\n}\nexports.default = Rect;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.dilateMask = exports.getVisiblePixelFrame = exports.floodFill = exports.stringToColor = exports.lerpCanvas = exports.lerpColor = exports.clamp = exports.lerp = exports.createNewImageId = exports.addLongClick = exports.addClick = exports.log = exports.getImageOverlayUrl = exports.pointerEventsSupported = exports.imageToBlob = exports.upload = exports.formatBytes = void 0;\nconst config_1 = require(\"../config\");\nconst Rect_1 = __importDefault(require(\"./Rect\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Pressure = require('pressure');\n// source:\n// https://stackoverflow.com/questions/15900485/correct-way-to-convert-size-in-bytes-to-kb-mb-gb-in-javascript\nfunction formatBytes(bytes, decimals = 2) {\n    if (bytes === 0)\n        return '0 Bytes';\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\nexports.formatBytes = formatBytes;\nfunction upload(accept) {\n    return __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n            const input = document.createElement('input');\n            input.type = \"file\";\n            input.accept = accept;\n            input.onchange = () => {\n                if (input.files.length == 0) {\n                    return;\n                }\n                let file = input.files[0];\n                resolve(file);\n                input.remove();\n            };\n            input.click();\n        });\n    });\n}\nexports.upload = upload;\nfunction imageToBlob(image) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"imageToCanvas\";\n    canvas.width = image.naturalWidth;\n    canvas.height = image.naturalHeight;\n    const ctx = canvas.getContext(\"2d\", { alpha: true });\n    ctx.drawImage(image, 0, 0);\n    return new Promise(resolve => {\n        canvas.toBlob(blob => resolve(blob));\n    });\n}\nexports.imageToBlob = imageToBlob;\nfunction pointerEventsSupported() {\n    return window.PointerEvent != null;\n}\nexports.pointerEventsSupported = pointerEventsSupported;\nfunction getImageOverlayUrl(id) {\n    var _a;\n    return (_a = config_1.config.images[id]) === null || _a === void 0 ? void 0 : _a.overlay;\n}\nexports.getImageOverlayUrl = getImageOverlayUrl;\nfunction log(message, ...optionalParams) {\n    if (!config_1.config.debug) {\n        return;\n    }\n    console.log(message, optionalParams);\n}\nexports.log = log;\nfunction addClick(element, callback, supportScrolling = false) {\n    let scrollStartX;\n    let scrollStartY;\n    let touchId;\n    let isTracking;\n    let startTimeStamp;\n    let scrolled;\n    element.addEventListener(\"touchstart\", touchStart);\n    element.addEventListener(\"mouseup\", mouseUp);\n    function mouseUp(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        callback.call(event.target, event);\n    }\n    function touchStart(event) {\n        if (!supportScrolling) {\n            event.preventDefault();\n        }\n        if (isTracking || event.touches.length > 1) {\n            return;\n        }\n        const touch = event.changedTouches[0];\n        isTracking = true;\n        touchId = touch.identifier;\n        scrolled = false;\n        scrollStartX = touch.pageX;\n        scrollStartY = touch.pageY;\n        startTimeStamp = event.timeStamp;\n        element.classList.add(\"down\");\n        element.addEventListener(\"touchmove\", touchMove);\n        element.addEventListener(\"touchend\", touchEnd);\n    }\n    function touchMove(event) {\n        if (!supportScrolling) {\n            event.preventDefault();\n        }\n        if (!isTracking) {\n            return;\n        }\n        const touch = event.changedTouches[0];\n        // user dragged out of the element:\n        if (document.elementFromPoint(touch.pageX, touch.pageY) != event.target) {\n            isTracking = false;\n            element.classList.remove(\"down\");\n        }\n        if (scrolled || event.timeStamp < startTimeStamp + config_1.config.maxScrollDelay) {\n            if (supportScrolling &&\n                (Math.abs(touch.pageX - scrollStartX) > config_1.config.minScrollDistance ||\n                    Math.abs(touch.pageY - scrollStartY) > config_1.config.minScrollDistance)) {\n                isTracking = false;\n                element.classList.remove(\"down\");\n            }\n        }\n        // After tapping and holding for a while the element does not start scrolling any more.\n        // In that case we don't want perform the scroll check above any more:\n        if (event.timeStamp < startTimeStamp + config_1.config.maxScrollDelay) {\n            if (Math.abs(touch.pageX - scrollStartX) > 2 ||\n                Math.abs(touch.pageY - scrollStartY) > 2) {\n                scrolled = true;\n            }\n        }\n    }\n    function touchEnd(event) {\n        event.preventDefault();\n        element.removeEventListener(\"touchmove\", touchMove);\n        element.removeEventListener(\"touchend\", touchEnd);\n        element.classList.remove(\"down\");\n        if (!isTracking) {\n            return;\n        }\n        isTracking = false;\n        touchId = null;\n        callback.call(event.target, event);\n    }\n}\nexports.addClick = addClick;\nfunction addLongClick(element, callback) {\n    let timer;\n    let caller = this;\n    let called = false;\n    element.addEventListener(\"touchstart\", down);\n    element.addEventListener(\"touchend\", up);\n    element.addEventListener(\"mousedown\", down);\n    element.addEventListener(\"mouseup\", up);\n    function down(event) {\n        called = false;\n        timer = setTimeout(() => {\n            callback.call(caller, event);\n            called = true;\n        }, config_1.config.longClickDelay);\n    }\n    function up(event) {\n        if (called) {\n            event.stopImmediatePropagation();\n            element.classList.remove(\"down\");\n            called = false;\n        }\n        else {\n            clearTimeout(timer);\n        }\n    }\n}\nexports.addLongClick = addLongClick;\nfunction createNewImageId() {\n    return Date.now().toString();\n}\nexports.createNewImageId = createNewImageId;\nfunction lerp(a, b, alpha) {\n    return a * (1 - alpha) + b * alpha;\n}\nexports.lerp = lerp;\nfunction clamp(lower, upper, n) {\n    return Math.min(upper, Math.max(lower, n));\n}\nexports.clamp = clamp;\nfunction lerpColor(color1, color2, alpha) {\n    if (alpha == 0) {\n        return color1;\n    }\n    if (alpha == 1) {\n        return color2;\n    }\n    const aa = (color1 & 0xff000000) >> 24;\n    const ba = (color1 & 0x00ff0000) >> 16;\n    const ga = (color1 & 0x0000ff00) >> 8;\n    const ra = (color1 & 0x000000ff);\n    const ab = (color2 & 0xff000000) >> 24;\n    const bb = (color2 & 0x00ff0000) >> 16;\n    const gb = (color2 & 0x0000ff00) >> 8;\n    const rb = (color2 & 0x000000ff);\n    const r = Math.floor(lerp(ra, rb, alpha));\n    const g = Math.floor(lerp(ga, gb, alpha));\n    const b = Math.floor(lerp(ba, bb, alpha));\n    const a = 255; //Math.floor(Utils.lerp(aa, ab, alpha));\n    return r + (g << 8) + (b << 16) + 0xFF000000;\n}\nexports.lerpColor = lerpColor;\nfunction lerpCanvas(ctxA, ctxB, ctxMask) {\n    const width = ctxA.canvas.width;\n    const height = ctxA.canvas.height;\n    const dataA = ctxA.getImageData(0, 0, width, height);\n    const dataB = ctxB.getImageData(0, 0, width, height);\n    const dataMask = ctxMask.getImageData(0, 0, width, height);\n    const a32 = new Uint8ClampedArray(dataA.data.buffer);\n    const b32 = new Uint8ClampedArray(dataB.data.buffer);\n    const m32 = new Uint8ClampedArray(dataMask.data.buffer);\n    for (let i = 0; i < width * height; i++) {\n        const a = m32[i * 4 + 3] / 255;\n        a32[i * 4 + 0] = (1 - a) * a32[i * 4 + 0] + a * b32[i * 4 + 0];\n        a32[i * 4 + 1] = (1 - a) * a32[i * 4 + 1] + a * b32[i * 4 + 1];\n        a32[i * 4 + 2] = (1 - a) * a32[i * 4 + 2] + a * b32[i * 4 + 2];\n        a32[i * 4 + 3] = (1 - a) * a32[i * 4 + 3] + a * b32[i * 4 + 3];\n    }\n    ctxA.putImageData(dataA, 0, 0);\n}\nexports.lerpCanvas = lerpCanvas;\nfunction stringToColor(h) {\n    let r = 0, g = 0, b = 0;\n    if (h.length == 4) {\n        r = parseInt(h[1] + h[1], 16);\n        g = parseInt(h[2] + h[2], 16);\n        b = parseInt(h[3] + h[3], 16);\n    }\n    else {\n        r = parseInt(h[1] + h[2], 16);\n        g = parseInt(h[3] + h[4], 16);\n        b = parseInt(h[5] + h[6], 16);\n    }\n    return 0xFF000000 + r + (g << 8) + (b << 16);\n}\nexports.stringToColor = stringToColor;\nfunction floodFill(sourceCtx, mask, startPosition, color) {\n    const threshold = 0.5;\n    const width = sourceCtx.canvas.width;\n    const height = sourceCtx.canvas.height;\n    const sourceData = sourceCtx.getImageData(0, 0, width, height);\n    const sourcePixels = sourceData.data;\n    startPosition = startPosition.clone().round();\n    const startIndex = startPosition.x + startPosition.y * width;\n    // const startR = sourcePixels[startIndex * 4];\n    // const startG = sourcePixels[startIndex * 4 + 1];\n    // const startB = sourcePixels[startIndex * 4 + 2];\n    // const startA = sourcePixels[startIndex * 4 + 3];\n    const startR = parseInt(color[1] + color[2], 16);\n    const startG = parseInt(color[3] + color[4], 16);\n    const startB = parseInt(color[5] + color[6], 16);\n    // take into account that transparent pixels appear white (due to white bg) but their rgb value is 0:\n    // const startBrightness = startA < 5 ? 255 : 0.333 * (startR + startG + startB);\n    const startBrightness = 0.333 * (startR + startG + startB);\n    // clear alpha channel:\n    for (let i = 0; i < width * height; i++) {\n        mask[i * 4 + 3] = 0;\n    }\n    // start at multiple positions around start position:\n    let stack = [];\n    stack.push(startPosition);\n    if (startPosition.x > 1) {\n        stack.push(new Vector_1.default(startPosition.x - 2, startPosition.y));\n    }\n    if (startPosition.x < width - 2) {\n        stack.push(new Vector_1.default(startPosition.x + 2, startPosition.y));\n    }\n    if (startPosition.y > 1) {\n        stack.push(new Vector_1.default(startPosition.x, startPosition.y - 2));\n    }\n    if (startPosition.y < height - 2) {\n        stack.push(new Vector_1.default(startPosition.x, startPosition.y + 2));\n    }\n    while (stack.length > 0) {\n        let pos = stack.pop();\n        if (isBorderPixel(pos.x, pos.y, false)) {\n            continue;\n        }\n        const minX = scanLeft(pos.x, pos.y);\n        const maxX = scanRight(pos.x, pos.y);\n        addToStack(minX, maxX, pos.y - 1);\n        addToStack(minX, maxX, pos.y + 1);\n    }\n    function scanLeft(x, y) {\n        let minX = x;\n        while (minX >= 0) {\n            if (isBorderPixel(minX, y, true)) {\n                break;\n            }\n            minX -= 1;\n        }\n        return minX + 1;\n    }\n    function scanRight(x, y) {\n        let maxX = x + 1;\n        while (maxX < width) {\n            if (isBorderPixel(maxX, y, true)) {\n                break;\n            }\n            maxX += 1;\n        }\n        return maxX - 1;\n    }\n    function addToStack(minX, maxX, y) {\n        if (y < 0 || y >= height) {\n            return;\n        }\n        for (let x = minX; x <= maxX; x++) {\n            if (isBorderPixel(x, y, false)) {\n                continue;\n            }\n            stack.push(new Vector_1.default(x, y));\n        }\n    }\n    function isBorderPixel(x, y, setValue) {\n        const index = (x + y * width) * 4;\n        const indexA = index + 3;\n        if (mask[indexA]) {\n            return true;\n        }\n        const r = sourcePixels[index];\n        const g = sourcePixels[index + 1];\n        const b = sourcePixels[index + 2];\n        const a = sourcePixels[index + 3];\n        //\n        // let difference = Math.max(\n        //     Math.abs(r - startR),\n        //     Math.abs(g - startG),\n        //     Math.abs(b - startB),\n        //     Math.abs(a - startA)\n        // ) / 255;\n        const brightness = 0.333 * (r + g + b);\n        if (a < 250 || brightness >= startBrightness) {\n            if (setValue) {\n                mask[indexA] = 255;\n            }\n            return false;\n        }\n        // if (difference < threshold){\n        //     if (setValue){\n        //         mask[indexA] = 255;\n        //     }\n        //     return false;\n        // }\n        // if (setValue) {\n        //     mask[indexA] = (1 - difference) * 255;\n        // }\n        return true;\n    }\n}\nexports.floodFill = floodFill;\nfunction getVisiblePixelFrame(ctx, rect) {\n    let { x, y, width, height } = rect;\n    if (width <= 0 || height <= 0) {\n        return Rect_1.default.Empty();\n    }\n    const data = ctx.getImageData(x, y, width, height);\n    const pixels = data.data;\n    let minX = width;\n    let maxX = 0;\n    let minY = height;\n    let maxY = 0;\n    for (let cy = 0; cy < height; cy++) {\n        for (let cx = 0; cx < width; cx++) {\n            if (pixels[(cx + cy * width) * 4 + 3]) {\n                minX = cx < minX ? cx : minX;\n                maxX = cx > maxX ? cx : maxX;\n                minY = cy < minY ? cy : minY;\n                maxY = cy > maxY ? cy : maxY;\n            }\n        }\n    }\n    x += minX;\n    y += minY;\n    width = Math.max(0, maxX - minX + 1);\n    height = Math.max(0, maxY - minY + 1);\n    return new Rect_1.default(x, y, width, height);\n}\nexports.getVisiblePixelFrame = getVisiblePixelFrame;\nfunction dilateMask(pixels, width, height) {\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width - 1; x++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4]) {\n                pixels[i] = 255;\n            }\n        }\n        for (let x = width - 1; x > 0; x--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4]) {\n                pixels[i] = 255;\n            }\n        }\n    }\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height - 1; y++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4 * width]) {\n                pixels[i] = 255;\n            }\n        }\n        for (let y = height - 1; y > 0; y--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4 * width]) {\n                pixels[i] = 255;\n            }\n        }\n    }\n}\nexports.dilateMask = dilateMask;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst View_1 = require(\"./View\");\nconst config_1 = require(\"../config\");\nconst Thumbnail_1 = __importDefault(require(\"./Thumbnail\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\nclass BookView extends View_1.View {\n    constructor(id, onSettingsClicked) {\n        super(id);\n        let settingsButton = this._element.getElementsByClassName(\"button settings\")[0];\n        Utils.addClick(settingsButton, () => onSettingsClicked());\n    }\n    show() {\n        super.show();\n        this.updateImages();\n        // PeerToPeer.instance.onDataReceived = (data: ArrayBuffer) => {\n        //     this._thumbnails[0].setImageSrc(URL.createObjectURL(new Blob([data])));\n        // }\n    }\n    updateImages() {\n        if (this._thumbnails) {\n            return;\n        }\n        this._thumbnails = [];\n        for (let i = 0; i < config_1.config.imageCount; i++) {\n            const imageId = `image${(\"\" + (i + 1)).padStart(2, \"0\")}.png`;\n            let thumbnail = new Thumbnail_1.default(this._element, imageId, (id) => this.onImageSelected(id));\n            this._thumbnails.push(thumbnail);\n        }\n    }\n}\nexports.default = BookView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PaintView = void 0;\nconst View_1 = require(\"./View\");\nconst ColorPalette_1 = __importDefault(require(\"../palettes/ColorPalette\"));\nconst SizePalette_1 = __importDefault(require(\"../palettes/SizePalette\"));\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst PenTool_1 = __importDefault(require(\"../tools/PenTool\"));\nconst Vector_1 = __importDefault(require(\"../math/Vector\"));\nconst Palette_1 = require(\"../palettes/Palette\");\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst config_1 = require(\"../config\");\nconst ShapePalette_1 = __importDefault(require(\"../palettes/ShapePalette\"));\nconst CanvasLayer_1 = __importDefault(require(\"../CanvasLayer\"));\nconst ImageLayer_1 = __importDefault(require(\"../ImageLayer \"));\nconst SelectionTool_1 = __importDefault(require(\"../tools/SelectionTool\"));\nconst Toolbar_1 = require(\"../Toolbar\");\nconst History_1 = require(\"../History\");\nclass PaintView extends View_1.View {\n    constructor(id, onBackClicked) {\n        super(id);\n        this.scaleFactor = 1;\n        this._currentTouchId = 0;\n        this._layers = {};\n        this._lastSaveTimestamp = 0;\n        this._history = new History_1.History();\n        this._sheet = document.getElementById(\"sheet\");\n        this.width = config_1.config.width;\n        this.height = config_1.config.height;\n        Utils.log(`Setting PaintView size to ${this.width} x ${this.height}`);\n        this.addCanvasLayer(\"base-layer\", 0, 0, this.width, this.height, false);\n        this.addEventListeners();\n        this.createButtons(onBackClicked);\n        this.createToolbar();\n        this.createPalettes();\n        this.createTools();\n    }\n    get color() { return this._color; }\n    get stamp() { return this._stamp; }\n    get opacity() { return this._opacity; }\n    get lineWidth() { return this._lineWidth; }\n    get autoMaskCtx() { return this._autoMaskCtx; }\n    //get layers(): Layer[] { return this._layers; }\n    get baseLayer() { return this._layers[\"base-layer\"]; }\n    get overlayLayer() { return this._layers[\"overlay-layer\"]; }\n    getLayer(id) {\n        return this._layers[id];\n    }\n    createButtons(onBackClicked) {\n        let backButton = this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n        this._undoButton = document.getElementById(\"undo-button\");\n        Utils.addClick(this._undoButton, () => this.undo());\n        this._redoButton = document.getElementById(\"redo-button\");\n        Utils.addClick(this._redoButton, () => this.redo());\n        this._importImageButton = document.getElementById(\"import-image-button\");\n        Utils.addClick(this._importImageButton, () => __awaiter(this, void 0, void 0, function* () {\n            const blob = yield Utils.upload(\"image/*\");\n            this.setTool(this.selectionTool);\n            const url = URL.createObjectURL(blob);\n            yield this.selectionTool.setImageUrl(url);\n            URL.revokeObjectURL(url);\n        }));\n    }\n    addLayer(layer) {\n        layer.index = Object.keys(this._layers).length;\n        this._layers[layer.id] = layer;\n        return layer;\n    }\n    addImageLayer(id, x, y, width, height, floating) {\n        const layer = new ImageLayer_1.default(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    addCanvasLayer(id, x, y, width, height, floating) {\n        const layer = new CanvasLayer_1.default(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    removeLayer(layer) {\n        if (!layer) {\n            return;\n        }\n        layer.remove();\n        delete this._layers[layer.id];\n    }\n    createOverlay() {\n        if (this.overlayLayer) {\n            return;\n        }\n        this.addLayer(new ImageLayer_1.default(this._sheet, \"overlay-layer\", 0, 0, this.width, this.height));\n    }\n    removeOverlay() {\n        this.removeLayer(this.overlayLayer);\n    }\n    setOverlay(url) {\n        if (!url) {\n            this.removeOverlay();\n            return;\n        }\n        this.createOverlay();\n        this.overlayLayer.image.src = url;\n        //this.processOverlay(this.overlay.ctx);\n        // show processed overlay:\n        // this._overlayCtx.canvas.toBlob(blob => {\n        //     this._overlay.src = URL.createObjectURL(blob);\n        // })\n    }\n    createTools() {\n        let penButton = document.getElementById(\"tool-pen\");\n        Utils.addLongClick(penButton, () => this.fill());\n        Utils.addClick(penButton, () => this.setTool(this.markerTool));\n        let eraserButton = document.getElementById(\"tool-eraser\");\n        Utils.addLongClick(eraserButton, () => this.clear(true));\n        Utils.addClick(eraserButton, () => this.setTool(this.eraserTool));\n        let selectionButton = document.getElementById(\"tool-selection\");\n        Utils.addClick(selectionButton, () => this.setTool(this.selectionTool));\n        Utils.addLongClick(selectionButton, () => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.selectAll();\n        });\n        this._tools = [];\n        // this.brushTool = this.addTool(new PenTool(this, \"tool-\", \"source-over\"));\n        this.markerTool = this.addTool(new PenTool_1.default(this, \"tool-pen\", \"darken\"));\n        this.eraserTool = this.addTool(new PenTool_1.default(this, \"tool-eraser\", \"destination-out\"));\n        this.selectionTool = this.addTool(new SelectionTool_1.default(this, \"tool-selection\"));\n        // this.paintBucketTool = this.addTool(new PaintBucketTool(this));\n        // this._currentTool = this.brushTool;\n        this.setTool(this.markerTool);\n    }\n    addTool(tool) {\n        this._tools.push(tool);\n        return tool;\n    }\n    createToolbar() {\n        this._mainToolbar = new Toolbar_1.Toolbar(\"main-toolbar\");\n        this._contextToolbar = new Toolbar_1.Toolbar(\"context-toolbar\");\n    }\n    createPalettes() {\n        this._sizePalette = new SizePalette_1.default(\"size-palette\");\n        this._sizePalette.onSelectionChanged = (lineWidth) => {\n            this._lineWidth = lineWidth;\n        };\n        this._lineWidth = this._sizePalette.size;\n        this._colorPalette = new ColorPalette_1.default(\"color-palette\");\n        this._colorPalette.onSelectionChanged = (color) => this._color = color;\n        this._color = this._colorPalette.color;\n        this._shapePalette = new ShapePalette_1.default(\"stamp-palette\");\n        this._shapePalette.onSelectionChanged = (stamp) => {\n            this._stamp = stamp;\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImageUrl(this.stamp);\n        };\n        this._stamp = this._shapePalette.stamp;\n        this._opacity = 1;\n    }\n    setTool(tool) {\n        if (this._currentTool == tool) {\n            return;\n        }\n        if (this._currentTool) {\n            this._currentTool.disable();\n        }\n        this._currentTool = tool;\n        if (this._currentTool) {\n            this._currentTool.enable();\n        }\n        this._colorPalette.setVisible(this._currentTool == this.markerTool);\n        this._sizePalette.setVisible(this._currentTool == this.markerTool || this._currentTool == this.eraserTool);\n        // this._shapePalette.setVisible(this._currentTool == this.selectionTool);\n        // this._importImageButton.classList.toggle(\"hidden\", this._currentTool != this.selectionTool);\n    }\n    addEventListeners() {\n        let canvas = this.baseLayer.canvas;\n        canvas.style.pointerEvents = \"auto\";\n        //canvas.addEventListener('keydown', event => this.keyDown(event));\n        document.addEventListener('keydown', event => this.keyDown(event));\n        canvas.addEventListener('click', event => event.preventDefault());\n        if (config_1.config.usePointerEvents && window.PointerEvent != null) {\n            // Required to prevent pointerDown events from being choked when tapping repeatedly: \n            canvas.addEventListener('touchstart', event => {\n                if (event.cancelable) {\n                    event.preventDefault();\n                }\n            });\n            canvas.addEventListener('pointerdown', event => this.pointerDown(event));\n            canvas.addEventListener('pointermove', event => this.pointerMove(event));\n            canvas.addEventListener('pointerup', event => this.pointerUp(event));\n            canvas.addEventListener('pointercancel', event => event.preventDefault());\n        }\n        else {\n            canvas.addEventListener('touchstart', event => this.touchStart(event));\n            canvas.addEventListener('touchmove', event => this.touchMove(event));\n            canvas.addEventListener('touchend', event => this.touchEnd(event));\n            canvas.addEventListener('touchcancel', event => event.preventDefault());\n        }\n        //canvas.addEventListener('touchforcechanged', event => this.pressureChanged(<TouchEvent>event))\n        // Pressure.set(canvas, {\n        //     change: (force: number, event: Event) => this.pressureChanged(force)\n        // })\n    }\n    getPointerEventPosition(event) {\n        let target = event.target;\n        let rect = target.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (event.clientX - rect.left) / rect.width;\n        let ny = (event.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n        if (config_1.config.pixelPerfect) {\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector_1.default(x, y);\n    }\n    getTouchEventPosition(touch) {\n        let rect = this.baseLayer.canvas.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n        let nx = (touch.clientX - rect.left) / rect.width;\n        let ny = (touch.clientY - rect.top) / rect.height;\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n        if (config_1.config.pixelPerfect) {\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector_1.default(x, y);\n    }\n    keyDown(event) {\n        if (!this.isVisible()) {\n            return;\n        }\n        switch (event.code) {\n            // case 'KeyV':\n            //     if (event.metaKey){\n            //         this.setTool(this.selectionTool);\n            //         this.selectionTool.pasteFromClipboard();\n            //     }\n            //     break;\n        }\n        if (!this._currentTool) {\n            return;\n        }\n        this._currentTool.keyDown(event);\n    }\n    pointerDown(event) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n        let target = event.target;\n        target.setPointerCapture(event.pointerId);\n        this._currentTouchId = event.pointerId;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector_1.default(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    pointerMove(event) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector_1.default(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    getNormalizedPointerPressure(event) {\n        return event.pointerType == \"pen\" ? Utils.clamp(0.5, 2, event.pressure * 4) : 1;\n    }\n    getNormalizedTouchPressure(touch) {\n        return touch.touchType == \"stylus\" ? Utils.clamp(0.5, 2, touch.force * 4) : 1;\n    }\n    pointerUp(event) {\n        event.preventDefault();\n        if (!event.isPrimary) {\n            return;\n        }\n        let target = event.target;\n        target.releasePointerCapture(event.pointerId);\n        this.up({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: new Vector_1.default(event.width, event.height),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    pressureChanged(force) {\n        // let pressure = Utils.clamp(0.3, 1, force * 2);\n        // this._currentTool.pressure = Math.max(pressure, this._currentTool.pressure);\n        // this._currentTool.pressureChanged();\n    }\n    touchStart(event) {\n        event.preventDefault();\n        if (this._currentTouchId !== 0) {\n            return;\n        }\n        const touch = event.targetTouches[0];\n        this._currentTouchId = touch.identifier;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector_1.default(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    touchMove(event) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch == null) {\n            return;\n        }\n        console.log(touch.force);\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector_1.default(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n    touchEnd(event) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch != null) {\n            // current touch is still in the list of target touches, this means it has not ended yet\n            return;\n        }\n        this.up({\n            timeStamp: event.timeStamp,\n            position: new Vector_1.default(0, 0),\n            radius: new Vector_1.default(0, 0),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    static findTouch(touches, id) {\n        for (let i = 0; i < touches.length; i++) {\n            if (touches[i].identifier == id) {\n                return touches[i];\n            }\n        }\n        return null;\n    }\n    move(data) {\n        if (!this._currentTool) {\n            return;\n        }\n        let delta = this._lastPointerData.position.distanceTo(data.position);\n        if (delta <= 1) {\n            return;\n        }\n        this._lastPointerData = this._lastPointerData || data;\n        let timeDelta = data.timeStamp - this._lastPointerData.timeStamp;\n        const speed = delta / timeDelta;\n        data.speed = Utils.lerp(this._lastPointerData.speed, speed, 0.2);\n        this._lastPointerData = data;\n        this._currentTool.move(data);\n    }\n    down(data) {\n        Palette_1.Palette.collapseAll();\n        if (!this._currentTool) {\n            return;\n        }\n        this._lastPointerData = data;\n        this._currentTool.down(data);\n    }\n    up(data) {\n        if (!this._currentTool) {\n            return;\n        }\n        this._lastPointerData = data;\n        this._currentTool.up(data);\n    }\n    clear(recordHistoryState = false) {\n        this.baseLayer.clear();\n        if (recordHistoryState) {\n            this.recordHistoryState();\n        }\n    }\n    fill() {\n        this.baseLayer.ctx.fillStyle = this.color;\n        this.baseLayer.ctx.fillRect(0, 0, this.width, this.height);\n        this.recordHistoryState();\n    }\n    ResetHistory() {\n        this._history.clear();\n        this.recordHistoryState();\n        this.updateUndoButtons();\n    }\n    recordHistoryState() {\n        this._history.recordState(this.baseLayer.getData());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    updateUndoButtons() {\n        this._undoButton.classList.toggle(\"disabled\", !this._history.canUndo);\n        this._redoButton.classList.toggle(\"disabled\", !this._history.canRedo);\n    }\n    undo() {\n        if (!this._history.canUndo) {\n            return;\n        }\n        this.baseLayer.putData(this._history.undo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    redo() {\n        if (!this._history.canRedo) {\n            return;\n        }\n        this.baseLayer.putData(this._history.redo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    restoreCurrentHistoryState() {\n        this.baseLayer.putData(this._history.getCurrentState());\n    }\n    loadImage(id) {\n        return ImageStorage_1.imageStorage.loadImage(id)\n            .then(image => {\n            this._imageId = id;\n            this.clear();\n            if (image) {\n                this.baseLayer.drawImage(image);\n            }\n            this.setOverlay(Utils.getImageOverlayUrl(id));\n            this.ResetHistory();\n            this._isDirty = false;\n        });\n    }\n    saveImage() {\n        Utils.log(\"Saving image\");\n        this.baseLayer.canvas.toBlob(blob => ImageStorage_1.imageStorage.saveImage(this._imageId, blob));\n        this._isDirty = false;\n        this._lastSaveTimestamp = Date.now();\n    }\n    setDirty() {\n        this._isDirty = true;\n    }\n    show() {\n        super.show();\n        this._currentTouchId = 0;\n        this._autoMaskCaptured = false;\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp));\n        this._currentTool.enable();\n    }\n    hide() {\n        Palette_1.Palette.collapseAll();\n        if (this._currentTool) {\n            this._currentTool.disable();\n        }\n        if (this._layers) {\n            // Always save when closing the paint view in case we forgot to set the dirty flag somewhere:\n            this.saveImage();\n        }\n        if (this._history) {\n            this._history.clear();\n        }\n        super.hide();\n    }\n    tick(timeStamp) {\n        if (!this.isVisible()) {\n            return;\n        }\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp));\n        let delta = timeStamp - this._tickTimeStamp;\n        this._tickTimeStamp = timeStamp;\n        if (this._currentTool) {\n            this._currentTool.tick(delta);\n            // never save while painting to avoid lags:\n            if (this._lastPointerData && this._lastPointerData.isPressed) {\n                return;\n            }\n        }\n        if (this._isDirty && Date.now() > this._lastSaveTimestamp + config_1.config.saveInterval) {\n            this.saveImage();\n        }\n    }\n    captureAutoMask(position) {\n        if (!config_1.config.useAutoMask) {\n            return;\n        }\n        this._autoMaskCaptured = true;\n        // if (!this.overlayLayer){\n        //     return;\n        // }\n        if (!this._autoMaskCtx) {\n            let autoMaskCanvas = document.createElement(\"canvas\");\n            autoMaskCanvas.id = \"auto-mask\";\n            autoMaskCanvas.width = this.width;\n            autoMaskCanvas.height = this.height;\n            this._autoMaskCtx = autoMaskCanvas.getContext(\"2d\", { alpha: true });\n        }\n        let imageData = this._autoMaskCtx.getImageData(0, 0, this.width, this.height);\n        // avoid expensive floodfill:\n        const index = (position.x + position.y * this.width) * 4 + 3;\n        // if (this._autoMaskCaptured && imageData.data[index] > 0){\n        //     return;\n        // }\n        Utils.log(\"capturing auto mask\");\n        Utils.floodFill(this.baseLayer.ctx, imageData.data, position, this.color);\n        Utils.dilateMask(imageData.data, this.width, this.height);\n        this._autoMaskCtx.putImageData(imageData, 0, 0);\n    }\n    processOverlay(ctx) {\n        const imageData = ctx.getImageData(0, 0, this.width, this.height);\n        const pixels = imageData.data;\n        for (let i = pixels.length - 1; i >= 0; i--) {\n            pixels[i] = pixels[i] > 64 ? 255 : 0;\n        }\n        ctx.putImageData(imageData, 0, 0);\n    }\n    screenToSheet(p) {\n        return new Vector_1.default(p.x / screen.width * config_1.config.width, p.y / screen.height * config_1.config.height);\n    }\n}\nexports.PaintView = PaintView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst View_1 = require(\"./View\");\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nconst version = \"1.0.0\"; //require('/package').version;\nvar ConsoleLogHTML = require('console-log-html');\nconst file_saver_1 = require(\"file-saver\");\nclass SettingsView extends View_1.View {\n    constructor(id, onBackClicked) {\n        super(id);\n        let backButton = this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n        let exportButton = this._element.getElementsByClassName(\"button export\")[0];\n        Utils.addClick(exportButton, () => __awaiter(this, void 0, void 0, function* () {\n            const zipBlob = yield ImageStorage_1.imageStorage.generateBackupArchive();\n            file_saver_1.saveAs(zipBlob, \"web-paint-backup.zip\");\n        }));\n        let importButton = this._element.getElementsByClassName(\"button import\")[0];\n        Utils.addClick(importButton, () => __awaiter(this, void 0, void 0, function* () {\n            ImageStorage_1.imageStorage.importBackupArchive(yield Utils.upload(\".zip\"));\n            this.updateInfo();\n        }));\n        let clearButton = this._element.getElementsByClassName(\"button clear\")[0];\n        Utils.addClick(clearButton, () => {\n            if (confirm(\"Really clear all iamges?\")) {\n                ImageStorage_1.imageStorage.clear();\n                location.reload();\n            }\n        });\n        ConsoleLogHTML.connect(document.getElementById(\"log\"), {}, true, true, true);\n    }\n    show() {\n        super.show();\n        this.updateInfo();\n    }\n    updateInfo() {\n        const info = document.getElementById(\"info\");\n        info.innerText = `Version: ${version}`;\n        ImageStorage_1.imageStorage.getStorageUsed().then(amount => {\n            info.innerText += `\\rStorage used: ${Utils.formatBytes(amount, 1)}`;\n        });\n    }\n}\nexports.default = SettingsView;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst Utils = __importStar(require(\"../utils/Utils\"));\nconst ImageStorage_1 = require(\"../storage/ImageStorage\");\nclass Thumbnail {\n    constructor(parent, id, onImageSelected) {\n        let element = document.createElement(\"div\");\n        this._element = element;\n        element.id = id;\n        element.classList.add(\"thumbnail\");\n        this._element.style.opacity = \"0\";\n        // Utils.addLongClick(element, () => {\n        //     if (!this._image || !PeerToPeer.instance || !PeerToPeer.instance.loggedIn || PeerToPeer.instance.peerList.length < 2){\n        //         return;\n        //     }\n        //\n        //     Utils.imageToBlob(this._image)\n        //         .then(blob => {\n        //             const peerName = PeerToPeer.instance.peerList[1];\n        //             PeerToPeer.instance.sendData(peerName, blob);\n        //         });\n        // });\n        Utils.addClick(element, () => {\n            if (onImageSelected) {\n                onImageSelected(id);\n            }\n        }, true);\n        ImageStorage_1.imageStorage.addChangeListener((change, id) => {\n            if (change == \"save\" && id == this.id) {\n                this.loadImage();\n            }\n        });\n        this.overlayUrl = Utils.getImageOverlayUrl(id);\n        parent.appendChild(element);\n        this.loadImage();\n    }\n    get id() { return this._element.id; }\n    set imageUrl(src) {\n        this._imageUrl = src;\n        this._element.style.opacity = \"1\";\n        this.updateBackgroundImages();\n    }\n    set overlayUrl(src) {\n        this._overlayUrl = src;\n        this.updateBackgroundImages();\n    }\n    remove() {\n        this._element.remove();\n    }\n    isHidden() {\n        return (this._element.offsetParent === null);\n    }\n    loadImage() {\n        ImageStorage_1.imageStorage.loadImageUrl(this.id)\n            .then(url => {\n            this.imageUrl = url;\n        });\n    }\n    updateBackgroundImages() {\n        let urls = [];\n        if (this._overlayUrl) {\n            urls.push(`url(${this._overlayUrl})`);\n        }\n        if (this._imageUrl) {\n            urls.push(`url(${this._imageUrl})`);\n        }\n        this._element.style.backgroundImage = urls.join(\",\");\n    }\n}\nexports.default = Thumbnail;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.View = void 0;\nclass View {\n    constructor(id) {\n        this._element = document.getElementById(id);\n        if (!this._element) {\n            console.error(`Could not find element with id ${id}`);\n        }\n        this.hide();\n    }\n    clear() {\n        while (this._element.hasChildNodes()) {\n            this._element.removeChild(this._element.firstChild);\n        }\n    }\n    show() {\n        this._element.classList.remove(\"hidden\");\n    }\n    hide() {\n        this._element.classList.add(\"hidden\");\n    }\n    setVisible(visible) {\n        this._element.classList.toggle(\"hidden\", !visible);\n    }\n    isVisible() {\n        return !this._element.classList.contains(\"hidden\");\n    }\n}\nexports.View = View;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n// It's empty as some runtime module handles the default behavior\n__webpack_require__.x = function() {};\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\nvar deferredModules = [\n\t[5866,195]\n];\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = function() {};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\tvar executeModules = data[3];\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb_paint\"] = self[\"webpackChunkweb_paint\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = function() {};\n\t}\n\treturn result;\n}\nvar startup = __webpack_require__.x;\n__webpack_require__.x = function() {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = startup || (function() {});\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};","// run startup\n__webpack_require__.x();\n"],"sourceRoot":""}