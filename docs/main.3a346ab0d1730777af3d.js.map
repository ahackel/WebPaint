{"version":3,"sources":["webpack://web-paint/./src/ts/CanvasLayer.ts","webpack://web-paint/./src/ts/History.ts","webpack://web-paint/./src/ts/ImageLayer .ts","webpack://web-paint/./src/ts/Layer.ts","webpack://web-paint/./src/ts/Toolbar.ts","webpack://web-paint/./src/ts/app.ts","webpack://web-paint/./src/ts/config.ts","webpack://web-paint/./src/ts/math/Vector.ts","webpack://web-paint/./src/ts/palettes/ColorPalette.ts","webpack://web-paint/./src/ts/palettes/GiftPalette.ts","webpack://web-paint/./src/ts/palettes/Palette.ts","webpack://web-paint/./src/ts/palettes/SendPalette.ts","webpack://web-paint/./src/ts/palettes/ShapePalette.ts","webpack://web-paint/./src/ts/palettes/SizePalette.ts","webpack://web-paint/./src/ts/storage/DropboxStorage.ts","webpack://web-paint/./src/ts/storage/ImageStorage.ts","webpack://web-paint/./src/ts/storage/LocalForageAdapter.ts","webpack://web-paint/./src/ts/storage/Server.ts","webpack://web-paint/./src/ts/storage/StorageAdapter.ts","webpack://web-paint/./src/ts/tools/PenTool.ts","webpack://web-paint/./src/ts/tools/SelectionTool.ts","webpack://web-paint/./src/ts/tools/Tool.ts","webpack://web-paint/./src/ts/utils/FileSync.ts","webpack://web-paint/./src/ts/utils/Rect.ts","webpack://web-paint/./src/ts/utils/Utils.ts","webpack://web-paint/./src/ts/views/BookView.ts","webpack://web-paint/./src/ts/views/PaintView.ts","webpack://web-paint/./src/ts/views/SettingsView.ts","webpack://web-paint/./src/ts/views/Thumbnail.ts","webpack://web-paint/./src/ts/views/View.ts","webpack://web-paint/./src/css/painter.css","webpack://web-paint/./src/css/painter.css?effd","webpack://web-paint/ignored|crypto","webpack://web-paint/webpack/bootstrap","webpack://web-paint/webpack/runtime/compat get default export","webpack://web-paint/webpack/runtime/define property getters","webpack://web-paint/webpack/runtime/global","webpack://web-paint/webpack/runtime/hasOwnProperty shorthand","webpack://web-paint/webpack/runtime/make namespace object","webpack://web-paint/webpack/runtime/jsonp chunk loading","webpack://web-paint/webpack/startup"],"names":["CanvasLayer","parent","id","x","y","width","height","_ctx","canvas","getContext","alpha","imageSmoothingQuality","imageSmoothingEnabled","config","_element","getImageData","data","putImageData","image","rect","drawImage","clearRect","Layer","History","_states","_position","length","shift","splice","canUndo","canRedo","ImageLayer","onload","resize","naturalWidth","naturalHeight","tag","_startScale","_startRotation","Vector","_scale","_rotation","_lastTouchStartTime","_pointers","document","createElement","classList","add","_index","_width","_height","style","pointerEvents","appendChild","transform","bindEventListeners","v","position","scale","rotation","contains","value","toggle","addEventListeners","removeEventListeners","remove","setPositionAndSize","ctx","save","setTransform","rotate","translate","restore","addEventListener","preventDefault","Utils","pointerDown","touchStart","removeEventListener","event","onDoubleTap","setPointerCapture","pointerId","addPointerEvent","timeStamp","doubleTap","pointerMove","pointerUp","_pinchCenter","altKey","p1","clientToPixel","p2","clone","multiplyScalar","subtract","pinchStart","dragStart","index","findIndex","push","move","releasePointerCapture","removePointerEvent","touches","touchMove","touchEnd","pointers","pinchMove","dragMove","outlineWidth","outlineOffset","bind","_localDragPosition","center","_pinchStartDist","distanceTo","_pinchStartRotation","Math","atan2","distance","angle","angleChange","position1","parentElement","getBoundingClientRect","isPortraitOrientation","nx","clientX","left","ny","clientY","top","Toolbar","show","View","require","library","fas","dom","App","socketInit","_settingsView","SettingsView","openView","_bookView","_sheet","getElementById","window","OnResize","BookView","onImageSelected","_paintView","loadImage","then","PaintView","test","navigator","platform","appVersion","match","parseInt","docWidth","documentElement","clientWidth","docHeight","clientHeight","portrait","isLargeScreen","viewWidth","max","viewHeight","min","horizontalPixelSize","verticalPixelSize","virtualPixelSize","fontSize","view","_activeView","hide","_socket","io","on","msg","console","log","emit","ontouchmove","app","localForage","localforage","debug","doubleTapDelay","longClickDelay","minScrollDistance","maxScrollDelay","maxShapeCount","usePointerEvents","fullScreenCanvas","pixelPerfect","imageSmoothing","useAutoMask","maxUndoSteps","saveInterval","imageCount","useHtmlLog","dropboxSyncInterval","round","minX","minY","maxX","maxY","s","invScalar","sqrt","divideScalar","dx","dy","distanceToSq","ColorPalette","colors","selectedIndex","selectedOption","element","option","background","Palette","GIFT_PATH","GiftPalette","addGifts","imageStorage","change","startsWith","addGift","bounce","removeGift","paths","path","addOption","_options","indexOf","removeOption","url","backgroundImage","innerHTML","options","rightAlign","hideWhenEmpty","_optionElements","_selectedIndex","createOptions","collapse","updateSelectedOption","addSelectedOption","addOptionElements","clear","_expandedPalette","collapseAll","isCollapsed","expand","addOptionElement","updateOptionsWidth","recreateOptions","_selectedElement","offsetWidth","_optionsElement","addArrowElement","i","dataset","optionLongClicked","optionClicked","updateOptionElement","onSelectionChanged","updateSelectedOptionElement","SendPalette","addRecipients","userId","receipients","filter","receipient","innerText","ShapePalette","_shapeIds","addShapes","addShape","shapesPaths","deleteShape","stampId","SizePalette","sizes","CLIENT_ID","FileSet","itemId","filesB","load","getHash","_files","get","hash","has","keys","clientFileSet","_rootPath","ids","Map","set","content","fetch","r","blob","serverFileSet","dbx","_dbx","_cursor","serverRootPath","clientRootPath","_serverRoot","_clientRoot","filesListFolder","recursive","res","addServerEntries","result","entries","has_more","filesListFolderContinue","cursor","serverFiles","name","endsWith","file","serverToClientPath","path_display","content_hash","serverPath","replace","clientPath","contents","clientToServerPath","filesUpload","mode","filesDeleteV2","filesDownload","status","fileBlob","FileSyncStatus","loadEntries","hashA","hashB","_entries","delete","pairs","DropboxStorage","_isAuthorized","_isSyncing","_lastSyncDate","SYNC_BOTH","SYNC_UPLOAD","SYNC_DOWNLOAD","init","_userId","token","getAccessTokenFromUrl","authorize","startSync","auth","DropboxAuth","clientId","getAuthenticationUrl","location","href","sync","longPoll","stopSync","isAuthorized","syncFolder","clientFiles","setPath","fileSyncStatus","fileSync","FileSync","copyTo","syncFiles","saveEntries","getCursor","filesListFolderLongpoll","timeout","changes","backoff","setTimeout","parseQueryString","access_token","str","ret","Object","create","trim","split","forEach","param","parts","key","val","join","undefined","decodeURIComponent","Array","isArray","Date","now","toString","getGiftCount","Dropbox","accessToken","authTokenRevoke","dropboxStorage","ImageStorage","hasChanges","loadFileMeta","_adapter","LocalForageAdapter","migrate","_urls","includes","loadImageUrl","img","Image","src","decode","Promise","resolve","urls","loadBlob","URL","createObjectURL","adapter","getItem","setItem","generateContentHash","setHash","revokeObjectURL","dispatchChangeEvent","removeItem","callback","_changeListeners","changeListener","count","zip","JSZip","generateAsync","type","zipFile","async","buffer","Blob","saveImage","oldId","newId","migrateLooseFilesIntoFolders","renameImage","amount","size","_fileMeta","substring","lastIndexOf","String","padStart","imageId","getFilenameFromPath","BLOCK_SIZE","tempBuffer","Uint8Array","ceil","tempPos","p","blobChunk","slice","arrayBuffer","buf","crypto","subtle","digest","hashBuffer","hashArray","from","hashHex2","map","b","_imageStore","iterate","StorageAdapter","Server","_host","localStorage","error","downloadDefaultAssets","uploadUserContent","createDirectory","host","fileName","postImage","getPathInfo","ok","json","info","isFile","downloadImage","directoryName","method","headers","body","server","PenTool","painter","buttonId","operation","_operation","createBrushCtx","brushCanvas","_brushCtx","_painter","captureAutoMask","_points","getWidth","pressure","speed","_widths","_startIndex","baseLayer","fillStyle","color","strokeStyle","globalCompositeOperation","requestDrawPath","recordHistoryState","delta","_drawPathRequested","drawPath","drawConnectedLines","points","widths","pointCount","lineCap","lineJoin","start","startWidth","lineWidth","beginPath","arc","PI","fill","lineTo","stroke","radius","newPoints","interpolatePoints","concat","numSegments","lastWidth","maxWidthDifferencePerSegment","maxWidthDifference","newPoint","segmentLength","end","dist","control","previous","tangent","normalize","a","pointOnQuadraticCurve","f1","f2","f3","autoMaskCtx","getBufferCtx","Tool","SelectionTool","selectionLayerId","_selection","Rect","_deleteButton","clearSelection","_stampButton","paintSelectionToCanvas","_saveButton","saveSelectionAsNewShape","_downloadButton","selectionLayer","toBlob","saveAs","_sendPalette","shake","hasFloatingSelection","getLayer","_hasFloatingSelection","toggleFloatingSelectionButtons","_isInShapesPalette","visible","setVisible","createSelectionLayer","isInShapesPalette","destroySelectionLayer","getClampedPosition","startNewSelection","requestDrawSelectionOutline","cutSelection","floating","_startPosition","setLineDash","clamp","_drawSelectionOutlineRequested","updateSelectionAndDrawOutline","code","setImage","setImageUrl","abs","strokeRect","removeLayer","addCanvasLayer","selection","isEmpty","drawToCanvas","shapes","_buttonElement","opacity","_bufferCtx","createBufferCtx","filesA","resolveConflict","_filesA","_filesB","_status","_resolveConflict","changed","files","getAllFiles","syncFile","handleModification","modified","statusHashes","allFiles","Set","getAll","Pressure","formatBytes","bytes","decimals","k","dm","floor","parseFloat","pow","toFixed","upload","accept","input","onchange","click","imageToBlob","pointerEventsSupported","PointerEvent","message","optionalParams","addClick","supportScrolling","scrollStartX","scrollStartY","touchId","isTracking","startTimeStamp","scrolled","passive","mouseUp","stopPropagation","call","target","touch","changedTouches","identifier","pageX","pageY","elementFromPoint","addLongClick","timer","caller","called","down","up","stopImmediatePropagation","clearTimeout","createNewImageId","lerp","lower","upper","n","lerpColor","color1","color2","aa","ba","ga","ra","ab","bb","gb","rb","g","lerpCanvas","ctxA","ctxB","ctxMask","dataA","dataB","dataMask","a32","Uint8ClampedArray","b32","m32","stringToColor","h","floodFill","sourceCtx","mask","startPosition","threshold","sourceData","sourcePixels","startIndex","startR","startG","startB","startBrightness","stack","pos","pop","isBorderPixel","scanLeft","scanRight","addToStack","setValue","indexA","brightness","getVisiblePixelFrame","pixels","cy","cx","dilateMask","onSettingsClicked","settingsButton","getElementsByClassName","updateImages","_thumbnails","thumbnail","Thumbnail","onBackClicked","_history","createButtons","createToolbar","createPalettes","createTools","_color","_shape","_opacity","_lineWidth","_autoMaskCtx","_layers","backButton","_undoButton","undo","_redoButton","redo","_importImageButton","setTool","selectionTool","layer","addLayer","overlayLayer","removeOverlay","createOverlay","penButton","markerTool","eraserButton","eraserTool","selectionButton","selectAll","_tools","addTool","tool","_mainToolbar","_contextToolbar","_sizePalette","_colorPalette","_shapePalette","shape","stamp","_giftPalette","setImagePath","_currentTool","disable","enable","keyDown","cancelable","isVisible","isPrimary","buttons","_currentTouchId","getPointerEventPosition","screenToSheet","getNormalizedPointerPressure","isPressed","pointerType","touchType","force","targetTouches","getTouchEventPosition","radiusX","radiusY","getNormalizedTouchPressure","findTouch","_lastPointerData","timeDelta","fillRect","updateUndoButtons","recordState","getData","setDirty","putData","getCurrentState","_imageId","setOverlay","ResetHistory","_isDirty","_lastSaveTimestamp","_autoMaskCaptured","requestAnimationFrame","tick","_tickTimeStamp","autoMaskCanvas","imageData","screen","scaleFactor","version","ConsoleLogHTML","querySelector","_hostElement","onblur","_userIdElement","_connectButton","_disconnectButton","updateButtons","_syncButton","exportButton","zipBlob","importButton","importBackupArchive","updateInfo","clearButton","confirm","reload","connect","_imageUrl","updateBackgroundImages","_overlayUrl","offsetParent","imageUrl","overlayUrl","hasChildNodes","removeChild","firstChild"],"mappings":"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U,UAAU,WAAW,MAAM,KAAK,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW,UAAU,MAAM,KAAK,UAAU,UAAU,MAAM,KAAK,UAAU,WAAW,UAAU,WAAW,WAAW,WAAW,UAAU,UAAU,WAAW,UAAU,UAAU,UAAU,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,UAAU,MAAM,KAAK,UAAU,UAAU,WAAW,WAAW,WAAW,UAAU,UAAU,WAAW,UAAU,WAAW,MAAM,KAAK,WAAW,MAAM,KAAK,WAAW,MAAM,KAAK,UAAU,UAAU,UAAU,UAAU,UAAU,UAAU,WAAW,UAAU,UAAU,UAAU,UAAU,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,MAAM,KAAK,WAAW,MAAM,KAAK,UAAU,MAAM,KAAK,KAAK,WAAW,WAAW,KAAK,KAAK,KAAK,WAAW,UAAU,UAAU,UAAU,MAAM,KAAK,WAAW,UAAU,UAAU,UAAU,MAAM,KAAK,UAAU,UAAU,UAAU,UAAU,MAAM,KAAK,WAAW,WAAW,UAAU,UAAU,UAAU,UAAU,UAAU,WAAW,MAAM,KAAK,UAAU,WAAW,WAAW,UAAU,WAAW,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,WAAW,WAAW,MAAM,KAAK,UAAU,UAAU,MAAM,KAAK,WAAW,WAAW,WAAW,UAAU,WAAW,UAAU,MAAM,KAAK,WAAW,MAAM,WAAW,KAAK,WAAW,UAAU,UAAU,WAAW,WAAW,WAAW,WAAW,UAAU,UAAU,WAAW,MAAM,KAAK,UAAU,UAAU,WAAW,WAAW,UAAU,UAAU,WAAW,WAAW,WAAW,WAAW,MAAM,KAAK,UAAU,UAAU,WAAW,UAAU,MAAM,KAAK,UAAU,MAAM,KAAK,WAAW,MAAM,KAAK,WAAW,UAAU,UAAU,WAAW,UAAU,UAAU,WAAW,WAAW,WAAW,WAAW,WAAW,MAAM,KAAK,WAAW,MAAM,KAAK,UAAU,WAAW,WAAW,UAAU,MAAM,KAAK,UAAU,UAAU,WAAW,MAAM,KAAK,UAAU,UAAU,UAAU,WAAW,WAAW,WAA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YAAsL;;AAEtL;;AAEA;AACA;;AAEA,aAAa,0GAAG,CAAC,mKAAO;;;;AAIxB,+DAAe,0KAAc,MAAM,E;;;;;;;;;;ACZnC,e;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;WC5BA;WACA;WACA;WACA,cAAc,0BAA0B,EAAE;WAC1C,cAAc,eAAe;WAC7B,gCAAgC,YAAY;WAC5C;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,EAAE;WACF;WACA;WACA,CAAC,I;;;;;WCPD,6CAA6C,wDAAwD,E;;;;;WCArG;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;WCNA;;WAEA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;WACA;WACA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;;WAEA;WACA;WACA;WACA;WACA;WACA;WACA,MAAM,oBAAoB;WAC1B;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;;WAEA;WACA;;WAEA;WACA;WACA;;WAEA;WACA;WACA;;WAEA;WACA;WACA,eAAe,4BAA4B;WAC3C;WACA;WACA,gBAAgB,2BAA2B;WAC3C;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA;WACA,kDAAkD;WAClD;WACA,E;;;;UCpFA;UACA","file":"main.3a346ab0d1730777af3d.js","sourcesContent":["import {config} from \"./config\";\nimport Layer from \"./Layer\";\nimport Rect from \"./utils/Rect\";\n\nexport default class CanvasLayer extends Layer<HTMLCanvasElement> {\n\n    protected _ctx: CanvasRenderingContext2D;\n    \n    get canvas() { return this._element; }\n    get ctx() { return this._ctx; }\n\n    constructor(parent: HTMLElement, id: string, x: number, y: number, width: number, height: number) {\n        super(parent, \"canvas\", id, x, y, width, height);\n        this._ctx = <CanvasRenderingContext2D>this.canvas.getContext(\"2d\", {alpha: true});\n        this._ctx.imageSmoothingQuality = \"high\";\n        this._ctx.imageSmoothingEnabled = config.imageSmoothing;\n    }\n    \n    getData(): ImageData {\n        return this._ctx.getImageData(0, 0, this.width, this.height);\n    }\n\n    putData(data: ImageData) {\n        this._ctx.putImageData(data, 0, 0);\n    }\n    \n    drawImage(image: HTMLImageElement | HTMLCanvasElement, rect?: Rect){\n        const {x, y, width, height} = rect || {x:0, y:0, width:this.width, height:this.height};\n        this._ctx.drawImage(image, x, y, width, height);\n    }\n    \n    clear(rect?: Rect){\n        const {x, y, width, height} = rect || {x:0, y:0, width:this.width, height:this.height};\n        this._ctx.clearRect(x, y, width, height);\n    }\n}","import {config} from \"./config\";\n\nexport class History {\n    \n    private _states: ImageData[] = [];\n    private _position: number = -1; \n    \n    get canUndo() { return this._position > 0 }\n    get canRedo() { return this._position < this._states.length - 1 }\n    \n    recordState(data: ImageData){\n        if (this._position == config.maxUndoSteps - 1){\n            this._states.shift();\n            this._position--;\n        }\n\n        // remove all future steps\n        this._states.splice(this._position + 1, this._states.length - this._position + 1);\n\n        this._position++;\n        this._states[this._position] = data;\n    }\n\n    undo(): ImageData{\n        if (!this.canUndo){\n            return null;\n        }\n\n        this._position--;\n        return this._states[this._position];\n    }\n\n    redo(): ImageData{\n        if (!this.canRedo){\n            return null;\n        }\n\n        this._position++;\n        return this._states[this._position];\n    }\n    \n    getCurrentState(): ImageData{\n        return this._position > -1 && this._position < this._states.length ? this._states[this._position] : null;\n    }\n\n    clear(){\n        this._states = [];\n        this._position = -1;\n    }\n}","import Layer from \"./Layer\";\n\nexport default class ImageLayer extends Layer<HTMLImageElement> {\n\n    get image(): HTMLImageElement { return this._element; }\n\n    constructor(parent: HTMLElement, id: string, x: number, y: number, width: number, height: number) {\n        super(parent, \"img\", id, x, y, width, height);\n        this._element.onload = () => {\n            // if this.image.completed\n            this.resize(this.image.naturalWidth, this.image.naturalHeight);\n        }\n    }\n}","import {config} from \"./config\";\nimport * as Utils from \"./utils/Utils\";\nimport Vector from \"./math/Vector\";\nimport ILayer from \"./ILayer\";\n\ninterface IPointer {\n    clientX: number,\n    clientY: number\n}\n\ninterface IPointerList {\n    readonly length: number;\n    [index: number]: IPointer;\n}\n\nexport default abstract class Layer<T extends HTMLImageElement | HTMLCanvasElement> implements ILayer {\n\n    public onDoubleTap: Function | undefined;\n    \n    protected _element: T;\n    private _index: number;\n    private _pinchCenter: Vector;\n    private _localDragPosition: Vector;\n    private _pinchStartDist: number;\n    private _pinchStartRotation: number;\n    private _startScale: number = 1;\n    private _startRotation: number = 0;\n    private _position: Vector = new Vector(0, 0);\n    private _scale: number = 1;\n    private _rotation: number = 0;\n    private _lastTouchStartTime: number = 0;\n    private _pointers: PointerEvent[] = [];\n    private _width: number;\n    private _height: number;\n    \n    get id(): string { return this._element.id; }\n    get index(): number { return this._index; }\n    set index(v: number) {\n        this._index = v;\n        this.transform(this.position, this.scale, this.rotation);\n    }\n    get width(): number { return this._width; };\n    get height(): number { return this._height; };\n    get position() { return this._position; }\n    get rotation() { return this._rotation; }\n    get scale() { return this._scale; }\n    get floating(): boolean { return this._element.classList.contains(\"floating\"); }\n    \n    set floating(value: boolean) { \n        this._element.classList.toggle(\"floating\", value);\n        this._element.style.pointerEvents = value ? \"auto\" : \"none\";\n        if (value){\n            this.addEventListeners();\n        }\n        else {\n            this.removeEventListeners();\n        }\n    }\n\n    constructor(parent: HTMLElement, tag: string, id: string, x: number, y: number, width: number, height: number) {\n        this._element = <T>document.createElement(tag);\n        this._element.id = id;\n        this._element.classList.add(\"layer\");\n        this._index = 0;\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this._element.style.pointerEvents = \"none\";\n            \n        parent.appendChild(this._element);\n        this.transform(new Vector(x, y), 1, 0);\n        this.bindEventListeners();\n    }\n    \n    remove() {\n        this._element.remove();\n    }\n\n    resize(width: number, height: number) {\n        const x = this.position.x + 0.5 * (this.width - width);\n        const y = this.position.y + 0.5 * (this.height - height);\n\n        this.setPositionAndSize(x, y, width, height);\n    }\n\n    setPositionAndSize(x: number, y: number, width: number, height: number) {\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this.transform(new Vector(x, y), this.scale, this.rotation);\n    }\n\n    drawToCanvas(ctx: CanvasRenderingContext2D) {\n        ctx.save();\n        let x = this._position.x + 0.5 * this.width;\n        let y = this._position.y + 0.5 * this.height;\n        ctx.setTransform(this._scale, 0, 0, this._scale, x, y);\n        ctx.rotate(this._rotation);\n        ctx.translate(-0.5 * this.width, -0.5 * this.height);\n        ctx.drawImage(this._element, 0, 0);\n        ctx.restore();\n    }\n\n    private addEventListeners() {\n        // pinch gesture handling inspired by https://codepen.io/hanseklund/pen/izloq\n        \n        this._element.addEventListener('click', this.preventDefault);\n\n        if (Utils.pointerEventsSupported()){\n            this._element.addEventListener('touchstart', this.preventDefault);\n            this._element.addEventListener('pointerdown', this.pointerDown);\n        }\n        else{\n            this._element.addEventListener('touchstart', this.touchStart);\n        }\n    }\n    \n    private removeEventListeners() {\n        this._element.removeEventListener('click', this.preventDefault);\n\n        if (Utils.pointerEventsSupported()){\n            this._element.removeEventListener('touchstart', this.preventDefault);\n            this._element.removeEventListener('pointerdown', this.pointerDown);\n        }\n        else{\n            this._element.removeEventListener('touchstart', this.touchStart);\n        }\n    }\n    \n    private preventDefault(event: Event) {\n        event.preventDefault();\n    }\n    \n    private doubleTap(event: TouchEvent | PointerEvent) {\n        if (this.onDoubleTap){\n            this.onDoubleTap(event);\n        }\n    }\n    \n    private pointerDown(event: PointerEvent){\n        event.preventDefault();\n        this._element.setPointerCapture(event.pointerId);\n        this.addPointerEvent(event);\n\n        if (this._pointers.length === 1){\n            if (event.timeStamp < this._lastTouchStartTime + config.doubleTapDelay){\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n\n            this._element.addEventListener(\"pointermove\", this.pointerMove);\n            this._element.addEventListener(\"pointerup\", this.pointerUp);\n\n            this._pinchCenter = new Vector(\n                this._position.x + 0.5 * this.width,\n                this._position.y + 0.5 * this.height);\n\n            if (event.altKey){\n                let p1 = this.clientToPixel(this._pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else{\n                this.dragStart(this.clientToPixel(this._pointers[0]));\n            }\n        }\n        \n        if (this._pointers.length === 2 ){\n            this.pinchStart(this.clientToPixel(this._pointers[0]), this.clientToPixel(this._pointers[1]));\n        }  \n    }\n\n    private addPointerEvent(event: PointerEvent) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index < 0) {\n            this._pointers.push(event);\n        } else {\n            this._pointers[index] = event;\n        }\n    }\n\n    private removePointerEvent(event: PointerEvent) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index >= 0) {\n            this._pointers.splice(index, 1);\n        }\n    }\n\n    private pointerMove(event: PointerEvent) {\n        event.preventDefault();\n        this.addPointerEvent(event);\n        this.move(this._pointers, event.altKey);\n    }\n\n    private pointerUp(event: PointerEvent) {\n        event.preventDefault();\n        this._element.releasePointerCapture(event.pointerId);\n        this.removePointerEvent(event);\n\n        if (this._pointers.length == 1) {\n            this.dragStart(this.clientToPixel(this._pointers[0]));\n        }\n\n        if (this._pointers.length == 0){\n            this._element.removeEventListener(\"pointermove\", this.pointerMove);\n            this._element.removeEventListener(\"pointerup\", this.pointerUp);\n        }\n    }\n\n    private touchStart(event: TouchEvent) {\n        event.preventDefault();\n\n        if (event.touches.length === 1){\n            if (event.timeStamp < this._lastTouchStartTime + config.doubleTapDelay){\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            \n            this._element.addEventListener('touchmove', this.touchMove);\n            this._element.addEventListener('touchend', this.touchEnd);\n\n            this._pinchCenter = new Vector(\n                this._position.x + 0.5 * this.width,\n                this._position.y + 0.5 * this.height);\n\n            if (event.altKey){\n                let p1 = this.clientToPixel(event.touches[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else{\n                this.dragStart(this.clientToPixel(event.touches[0]));\n            }\n        }\n        \n        if (event.touches.length === 2){\n            this.pinchStart(this.clientToPixel(event.touches[0]), this.clientToPixel(event.touches[1]));\n        }\n    }\n\n    private touchMove(event: TouchEvent) {\n        event.preventDefault();\n        this.move(event.touches, event.altKey);\n    }\n\n    private move(pointers: IPointerList, altKey: boolean) {\n        if (pointers.length === 1) {\n            if (altKey) {\n                let p1 = this.clientToPixel(pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchMove(p1, p2);\n            } else {\n                this.dragMove(this.clientToPixel(pointers[0]));\n            }\n        }\n        if (pointers.length === 2) {\n            this.pinchMove(this.clientToPixel(pointers[0]), this.clientToPixel(pointers[1]));\n        }\n    }\n\n    private touchEnd (event: TouchEvent) {\n        event.preventDefault();\n        this._element.removeEventListener('touchmove', this.touchMove);\n        this._element.addEventListener('touchend', this.touchEnd);\n    }\n\n    transform(position: Vector, scale: number, rotation: number) {\n        this._position = position;\n        this._rotation = rotation;\n        this._scale = scale;\n        const index = this._index;\n        this._element.style.transform = `translate(${position.x}em, ${position.y}em) rotate(${rotation}rad) scale(${scale}) translateZ(${index}px)`;\n        this._element.style.outlineWidth = `${2 / scale}em`;\n        this._element.style.outlineOffset = `-${2 / scale}em`;\n    }\n\n    private bindEventListeners() {\n        \n        // TODO: Find a better way. This is ugly:\n        this.touchStart = this.touchStart.bind(this);\n        this.touchMove = this.touchMove.bind(this);\n        this.touchEnd = this.touchEnd.bind(this);\n\n        this.pointerDown = this.pointerDown.bind(this);\n        this.pointerMove = this.pointerMove.bind(this);\n        this.pointerUp = this.pointerUp.bind(this);\n    }\n\n    private dragStart(position: Vector) {\n        this._localDragPosition = position.clone().subtract(this.position);\n    }\n\n    private dragMove(position: Vector) {\n        position.subtract(this._localDragPosition);\n        this.transform(position, this._scale, this._rotation);\n    }\n\n    private pinchStart(p1: Vector, p2: Vector) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        this._pinchStartDist = p1.distanceTo(p2);\n        this._pinchStartRotation = Math.atan2(p1.y - center.y, p1.x - center.x);\n        this._startRotation = this._rotation;\n        this._startScale = this._scale;       \n    }\n\n    private pinchMove(p1: Vector, p2: Vector) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        let distance = p1.distanceTo(p2);\n        let angle = Math.atan2(p1.y - center.y, p1.x - center.x);\n        let angleChange = angle - this._pinchStartRotation;\n\n        let scale = this._startScale * (distance / this._pinchStartDist);\n        scale = Utils.clamp(0.1, 10, scale);\n        let position = p1.clone().add(p2).multiplyScalar(0.5);\n        position.x -= 0.5 * this.width;\n        position.y -= 0.5 * this.height;\n\n        let rotation = this._startRotation + angleChange;\n        this.transform(position, scale, rotation);\n    }\n\n    private clientToPixel(position1: IPointer){\n        let parent = this._element.parentElement;\n        let rect = parent.getBoundingClientRect();\n\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (position1.clientX - rect.left) / rect.width;\n        let ny = (position1.clientY - rect.top) / rect.height;\n\n        let x = (isPortraitOrientation ? 1 - ny : nx) * config.width;\n        let y = (isPortraitOrientation ? nx : ny) * config.height;\n\n        return new Vector(x, y);\n    }\n}","import {View} from \"./views/View\";\n\nexport class Toolbar extends View {\n    constructor(id: string) {\n        super(id);\n        this.show();\n    }\n    \n    flip(){\n        if (this._element.classList.contains(\"left\") || this._element.classList.contains(\"right\")){\n            this._element.classList.toggle(\"left\");\n            this._element.classList.toggle(\"right\");\n        }\n        if (this._element.classList.contains(\"top\") || this._element.classList.contains(\"bottom\")){\n            this._element.classList.toggle(\"top\");\n            this._element.classList.toggle(\"bottom\");\n        }\n    }\n}","import localforage from \"localforage\";\n\nrequire('../css/painter.css');\nimport {library, dom} from '@fortawesome/fontawesome-svg-core'\nimport { fas } from '@fortawesome/free-solid-svg-icons'\nrequire('blueimp-canvas-to-blob/js/canvas-to-blob');\n\nlibrary.add(fas)\ndom.watch();\n\n// required to make 'async' work on old devices: \nimport \"core-js/stable\";\nimport \"regenerator-runtime/runtime\";\n\nimport {View} from \"./views/View\";\nimport BookView from \"./views/BookView\";\nimport {PaintView} from \"./views/PaintView\";\nimport DropboxAuthView from \"./views/DropboxAuthView\";\nimport {config} from \"./config\";\nimport PeerToPeer from \"./PeerToPeer\";\nimport SettingsView from \"./views/SettingsView\";\nimport { imageStorage } from \"./storage/ImageStorage\";\nimport { io } from \"socket.io-client\";\n\nclass App {\n    private _activeView: View;\n    private _bookView: BookView;\n    private _paintView: PaintView;\n    private _settingsView: SettingsView;\n    private dropboxAuthView: DropboxAuthView;\n    private _sheet: HTMLElement;\n    _socket: SocketIOClient.Socket;\n\n    constructor() {\n        this.socketInit();\n        \n        // App.preventOverScroll();\n        \n        //PeerToPeer.createInstance();\n\n        this._settingsView = new SettingsView(\"settings\",() => {\n            this.openView(this._bookView);\n        });\n        \n        this._sheet = document.getElementById(\"sheet\")\n        window.addEventListener('resize', event => {\n            this.OnResize();\n        });\n        this.OnResize();\n        \n        this._bookView = new BookView(\"book\", async () => {\n            this.openView(this._settingsView);\n        });\n        this._bookView.onImageSelected = (id: string) => {\n            this._paintView.loadImage(id)\n                .then(() => {\n                    this.openView(this._paintView);\n                });\n        }\n\n        this._paintView = new PaintView(\"paint\",() => {\n            this.openView(this._bookView);\n        });\n\n\n        // Dropbox integration is not working yet:\n        // this.dropboxAuthView = new DropboxAuthView(\"dropbox-auth\");\n        // this.openView(ImageStorage.adapter.isAuthenticated ? this.bookView : this.dropboxAuthView);\n\n        this.openView(this._bookView);\n    }\n\n    getIOSVersion(): number[] {\n        if (/iP(hone|od|ad)/.test(navigator.platform)) {\n            // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n            var v = (navigator.appVersion).match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || \"0\", 10)];\n        }\n    }\n\n    private OnResize() {\n        const docWidth = document.documentElement.clientWidth;\n        const docHeight = document.documentElement.clientHeight;\n        \n        const portrait = docWidth < docHeight;\n        const isLargeScreen = docWidth > 1024;\n        \n        const viewWidth = Math.max(docWidth, docHeight);\n        const viewHeight = Math.min(docWidth, docHeight);\n        \n        const horizontalPixelSize = viewWidth / config.width;\n        const verticalPixelSize = viewHeight / config.height;\n        \n        const virtualPixelSize = config.fullScreenCanvas && !isLargeScreen ?\n            Math.max(horizontalPixelSize, verticalPixelSize) :\n            Math.min(horizontalPixelSize, verticalPixelSize);\n\n        this._sheet.style.fontSize = `${virtualPixelSize}px`;\n        this._sheet.style.left = `${portrait ? 0.5 * (docWidth - virtualPixelSize * config.width) : 0}px`;\n    }\n\n    private static preventOverScroll() {\n        document.ontouchmove = event => { event.preventDefault();}\n    }\n\n    openView(view: View){\n        if (this._activeView){\n            this._activeView.hide();\n        }\n        this._activeView = view;\n        this._activeView.show();\n    }\n    \n    socketInit(){\n        this._socket = io(\"http://192.168.178.20:3002\");\n        this._socket.on(\"TestMsg\", (msg: string) => console.log(msg));\n    }\n\n    socketTest(){\n        this._socket.emit(\"TestMsg\", \"Test\");\n    }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    // @ts-ignore\n    window.app = new App();\n    // @ts-ignore\n    window.localForage = localforage;\n});\n\n","interface IImageConfig{\n    overlay: string;\n}\n\ninterface IAppConfig{\n    debug: boolean;\n    doubleTapDelay: number;\n    longClickDelay: number;\n    minScrollDistance: number;\n    maxScrollDelay: number;\n    maxShapeCount: number;\n    usePointerEvents: boolean;\n    fullScreenCanvas: boolean;\n    pixelPerfect: boolean;\n    imageSmoothing: boolean;\n    useAutoMask: boolean;\n    maxUndoSteps: number;\n    saveInterval: number;\n    width: number;\n    height: number;\n    imageCount: number;\n    useHtmlLog: boolean;\n    dropboxSyncInterval: number;\n}\n\nexport const config: IAppConfig = {\n    debug: true,\n    doubleTapDelay: 400,\n    longClickDelay: 1000,\n    minScrollDistance: 30,\n    maxScrollDelay: 500,\n    maxShapeCount: 64,\n    usePointerEvents: true,\n    fullScreenCanvas: true, // If true fills the whole screen with the canvas, if false makes sure the whole canvas fits on the screen\n    pixelPerfect: false,   // Make sure to perform painting operations on rounded pixel positions\n    imageSmoothing: true,  // Whether to use smooth pixel filtering or to draw hard pixel edges\n    useAutoMask: false,\n    maxUndoSteps: 10,\n    saveInterval: 5000,\n    width: 1024,\n    height: 768,\n    imageCount: 32,\n    useHtmlLog: true,\n    dropboxSyncInterval: 30\n};","import * as Utils from \"../utils/Utils\";\n\nexport default class Vector {\n    public x: number;\n    public y: number;\n\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    \n    set(x = 0, y = x){\n        this.x = x;\n        this.y = y;\n        return this;\n    }\n\n    clone(): Vector{\n        return new Vector(this.x, this.y);\n    }\n\n    add(v: Vector){\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    }\n\n    subtract(v: Vector){\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    }\n\n    round(){\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n    \n    clamp(minX: number, minY: number, maxX: number, maxY: number){\n        this.x = Utils.clamp(minX, maxX, this.x);\n        this.y = Utils.clamp(minY, maxY, this.y);\n        return this;\n    }\n\n    invert() {\n        this.x *= -1;\n        this.y *= -1;\n        return this;\n    };\n\n    multiplyScalar(s: number) {\n        this.x *= s;\n        this.y *= s;\n        return this;\n    };\n\n    divideScalar(s: number) {\n        if(s === 0) {\n            this.x = 0;\n            this.y = 0;\n        } else {\n            var invScalar = 1 / s;\n            this.x *= invScalar;\n            this.y *= invScalar;\n        }\n        return this;\n    };\n    \n    length(): number {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    } \n    \n    normalize() {\n        return this.divideScalar(this.length());\n    }\n\n    distanceToSq(v: Vector) {\n        const dx = this.x - v.x, dy = this.y - v.y;\n        return dx * dx + dy * dy;\n    }\n    \n    distanceTo(v: Vector) {\n        return Math.sqrt(this.distanceToSq(v));\n    }\n\n    lerp(v: Vector, alpha: number) {\n        this.x += (v.x - this.x) * alpha;\n        this.y += (v.y - this.y) * alpha;\n        return this;\n    };\n}","import {Palette} from \"./Palette\";\n\nexport default class ColorPalette extends Palette {\n\n    get color() { return this.selectedOption }\n    set color(value: string) { this.selectedOption = value }\n\n    constructor(id: string){\n        // 16 color Mac palette\n        // https://en.wikipedia.org/wiki/List_of_software_palettes#Apple_Macintosh_default_16-color_palette\n        // let colors: string[] = [\n        //     \"#FFFFFF\", \"#f5f60d\", \"#f5650a\", \"#d50406\",\n        //     \"#f50695\", \"#330496\", \"#0306c5\", \"#0692f0\",\n        //     \"#06a606\", \"#026405\", \"#643403\", \"#946434\",\n        //     \"#b5b5b5\", \"#848484\", \"#444444\", \"#030303\",\n        // ];\n\n        // 32 color palette\n        // https://github.com/geoffb/dawnbringer-palettes\n        let colors: string[] = [\n            \"#000000\", \"#222034\", \"#45283c\", \"#663931\",\n            \"#8f563b\", \"#df7126\", \"#d9a066\", \"#eec39a\",\n            \"#fbf236\", \"#99e550\", \"#6abe30\", \"#37946e\",\n            \"#4b692f\", \"#524b24\", \"#323c39\", \"#3f3f74\",\n            \"#306082\", \"#5b6ee1\", \"#639bff\", \"#5fcde4\",\n            \"#cbdbfc\", \"#ffffff\", \"#9badb7\", \"#847e87\",\n            \"#696a6a\", \"#595652\", \"#76428a\", \"#ac3232\",\n            \"#d95763\", \"#d77bba\", \"#8f974a\", \"#8a6f30\",\n        ];\n\n        super(id, colors);\n        this.selectedIndex = 15;\n    }\n    \n    updateOptionElement(element: HTMLDivElement, option: string) {\n        element.style.background = option;\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nconst GIFT_PATH = \"user/gifts\";\n\nexport default class GiftPalette extends Palette {\n    \n    constructor(id: string) {\n        super(id, [], true);\n        this.selectedIndex = 0;\n        this.addGifts();\n\n        imageStorage.addChangeListener((change: string, id: string) => {\n            if (id.startsWith(GIFT_PATH)){\n                if (change == \"save\") {\n                    this.addGift(id);\n                    this.bounce();\n                }\n                else if (change == \"delete\") {\n                    this.removeGift(id);\n                }\n            }\n        });\n    }\n\n    private async addGifts() {\n        const paths = await imageStorage.listFolder(GIFT_PATH);\n        for (let path of paths) {\n            await this.addGift(path);\n        }\n    }\n\n    private async addGift(path: string) {\n        this.addOption(path);\n    }\n\n    private removeGift(path: string) {\n        let index = this._options.indexOf(path);\n        if (index < 0){\n            return;\n        }\n        \n        this.removeOption(index);\n        if (this.selectedIndex == index){\n            // select the following item that now has the same index\n            this.selectedIndex = index;\n        }\n    }\n    \n    protected optionLongClicked(event: TouchEvent, option: any, index: number) {\n        imageStorage.deleteImage(this._options[index]);\n    }\n\n    async updateOptionElement(element: HTMLDivElement, path: string) {\n        const url = await imageStorage.loadImageUrl(path);\n        element.style.backgroundImage = `url(\"${url}\")`;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-gift\"></i>';\n    }\n}","import {View} from \"../views/View\";\nimport * as Utils from \"../utils/Utils\";\n\n// base class for palettes\nexport class Palette extends View {\n    public hideWhenEmpty: boolean = true;\n    public onSelectionChanged: Function | undefined;\n    private _selectedElement: HTMLDivElement;\n    private _optionsElement: HTMLDivElement;\n    private _optionElements: HTMLDivElement[];\n    private _selectedIndex: number;\n    protected _options: any[];\n    \n    private static _expandedPalette: Palette;\n\n    get selectedIndex(){ return this._selectedIndex }\n    set selectedIndex(value){\n        this._selectedIndex = Math.max(0, Math.min(this._options.length - 1, value));\n        this.updateSelectedOption();\n    }\n    \n    get selectedOption(){ return this._options[this._selectedIndex] }\n    set selectedOption(value){\n        let index = this._options.indexOf(value);\n        if (index === -1){\n            return;\n        }\n        this.selectedIndex = index;\n    }\n    \n    get isCollapsed(){ return this._element.classList.contains(\"collapsed\") }\n\n    constructor(id: string, options: any[], rightAlign: boolean = false) {\n        super(id);\n        this._options = options;\n        this._optionElements = [];\n        this._selectedIndex = 0;\n        this.createOptions();\n        this.show();\n        this.collapse();\n    }\n    \n    static collapseAll() {\n        if (Palette._expandedPalette){\n            Palette._expandedPalette.collapse();\n        }\n    }\n    \n    private createOptions(){\n        this.addSelectedOption();\n        this.addOptionElements();\n    }\n    \n    recreateOptions(){\n        this.clear();\n        this.createOptions();\n    }\n\n    collapse() {\n        this._element.classList.add(\"collapsed\");\n        if (Palette._expandedPalette == this){\n            Palette._expandedPalette = null;\n        }\n    }\n\n    expand() {\n        Palette.collapseAll();\n        if (this._options.length == 0){\n            return;\n        }\n        this._element.classList.remove(\"collapsed\");\n        Palette._expandedPalette = this;\n    }\n\n    toggle() {\n        if (this.isCollapsed){\n            this.expand();\n        }\n        else {\n            this.collapse();\n        }\n    }\n    \n    addOption(value: any): number {\n        this._options.push(value);\n        let index = this._options.length - 1;\n        this.addOptionElement(index, value);\n        this.updateOptionsWidth();\n        this.updateSelectedOption();\n        return index;\n    }\n\n    removeOption(index: number){\n        this._options.splice(index, 1);\n        this._optionElements[index].remove();\n        this._optionElements.splice(index, 1);\n        \n        // update the index assigned to each element:\n        this.recreateOptions();\n        if (this._options.length == 0){\n            this.collapse();\n        }\n        this.updateSelectedOption();\n    }\n    \n    bounce(){\n        this._selectedElement.classList.remove(\"bounce\");\n        void this._selectedElement.offsetWidth;\n        this._selectedElement.classList.add(\"bounce\");\n    }\n\n    shake(){\n        this._selectedElement.classList.remove(\"shake\");\n        void this._selectedElement.offsetWidth;\n        this._selectedElement.classList.add(\"shake\");\n    }\n\n    private addSelectedOption() {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"option\");\n        this._selectedElement = element;\n        Utils.addClick(element, () => this.toggle());\n        this.updateSelectedOption();\n        this._element.appendChild(element);\n    }\n    \n    private addOptionElements(){\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"options\");\n        this._optionsElement = element;\n        this.addArrowElement();\n\n        let i: number = 0;\n        for (let option of this._options){\n            this.addOptionElement(i, option);\n            i ++;\n        }\n        this.updateOptionsWidth();\n        this._element.appendChild(element);\n    }\n\n    private updateOptionsWidth() {\n        this._optionsElement.style.width = Math.min(8, this._options.length) * 1.25 + \"em\";\n    }\n\n    private addArrowElement(){\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"arrow\");\n        this._optionsElement.appendChild(element);\n    }\n\n    private addOptionElement(index: number, option: any) {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"option\");\n        element.dataset.index = `${index}`;\n        Utils.addLongClick(element, event => this.optionLongClicked(event, option, index));\n        Utils.addClick(element, event => this.optionClicked(event, option, index));\n        this.updateOptionElement(element, option);\n        this._optionsElement.appendChild(element);\n        this._optionElements[index] = element;\n    }\n    \n    protected optionClicked(event: Event, option: any, index: number){\n        this.selectedIndex = index;\n        this.collapse();\n        if (this.onSelectionChanged) {\n            this.onSelectionChanged(option, index);\n        }        \n    }\n\n    protected optionLongClicked(event: Event, option: any, index: number){\n    }\n\n    protected updateOptionElement(element: HTMLDivElement, option: any){\n    }\n\n    protected updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        this.updateOptionElement(element, option);\n    }\n    \n    protected updateSelectedOption() {\n        this.updateSelectedOptionElement(this._selectedElement, this.selectedOption);\n        if (this.hideWhenEmpty){\n            this._element.classList.toggle('hidden', this._options.length == 0);\n        }\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport localforage from \"localforage\";\n\nexport default class SendPalette extends Palette {\n\n    constructor(id: string) {\n        super(id, [], true);\n        this.hideWhenEmpty = false;\n        this.selectedIndex = 0;\n        this.addRecipients();\n    }\n\n    private async addRecipients() {\n        const userId = await localforage.getItem<string>(\"user-id\") ?? \"\";\n        const receipients = [\"Andreas\", \"Juri\", \"Jutta\", \"Lila\"].filter(x => x != userId);\n\n        for (let receipient of receipients) {\n            this.addOption(receipient);\n        }\n    }\n\n    async updateOptionElement(element: HTMLDivElement, receipient: string) {\n        element.innerText = receipient;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-paper-plane\"></i>';\n        element.classList.toggle('hidden', this._options.length == 0);\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nexport default class ShapePalette extends Palette {\n\n    private _shapeIds: { [id : string] : string };\n    \n    get stamp() { return this.selectedOption }\n    \n    constructor(id: string) {\n        super(id, [], true);\n        this._shapeIds = {};\n        this.selectedIndex = 0;\n        this.addShapes();\n\n        imageStorage.addChangeListener((change: string, id: string) => {\n            if (change == \"save\" && id.startsWith(\"user/shapes/\")) {\n                this.addShape(id);\n            }\n        });\n    }\n\n    private async addShapes() {\n        const shapesPaths = await imageStorage.listFolder(\"user/shapes\");\n        for (let path of shapesPaths) {\n            await this.addShape(path);\n        }\n    }\n\n    private async addShape(path: string) {\n        const url = await imageStorage.loadImageUrl(path);\n        this._shapeIds[url] = path;\n        this.addOption(url);\n    }\n\n    protected optionLongClicked(event: TouchEvent, option: any, index: number) {\n        this.deleteShape(index);\n    }\n\n    updateOptionElement(element: HTMLDivElement, option: string) {\n        element.style.backgroundImage = `url(\"${option}\")`;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-shapes\"></i>';\n    }\n\n    private deleteShape(index: number) {\n        let option = this._options[index];\n        let stampId = this._shapeIds[option];\n        if (!stampId){\n            return;\n        }\n        imageStorage.deleteImage(stampId)\n            .then(() => {\n                delete this._shapeIds[option];\n                this.removeOption(index);\n                if (this.selectedIndex == index){\n                    // select the following item that now has the same index\n                    this.selectedIndex = index;\n                }\n            })\n    }\n}","import {Palette} from \"./Palette\";\n\nexport default class SizePalette extends Palette {\n\n    get size() { return this.selectedOption }\n    set size(value: number) { this.selectedOption = value }\n\n    constructor(id: string){\n        let sizes: number[] = [2, 8, 24, 40];\n        super(id, sizes, true);\n        this.selectedIndex = 1;\n    }\n\n    updateOptionElement(element: HTMLDivElement, option: any) {\n        const width = option / 40;\n        element.innerHTML = '<div class=\"line-width\" style=\"width:' + width + 'em\"></div>';\n    }\n}","import {Dropbox, DropboxAuth, DropboxResponse, files} from \"dropbox\";\nimport localforage from \"localforage\";\nimport {imageStorage} from \"./ImageStorage\";\nimport {config} from \"../config\";\nimport {FileSync, IFileSet, IFileStatusEntry, IFileSyncStatus} from \"../utils/FileSync\";\nimport ILayer from \"../ILayer\";\n\nconst CLIENT_ID = 'dyfw7wk3nb2utzo';\n\n\ninterface IFile {\n    hash: string\n}\n\nabstract class FileSet implements IFileSet {\n    protected _files: Map<string, IFile>;\n    \n    async copyTo(itemId: string, filesB: IFileSet): Promise<void>{\n        await (<FileSet>filesB).add(itemId, await this.load(itemId), this.getHash(itemId));\n    }\n\n    abstract load(id: string): Promise<Blob>;\n    \n    abstract add(id: string, content: Blob, hash: string): Promise<void>;\n\n    abstract delete(id: string): Promise<void>;\n\n    getHash(id: string): string {\n        return this._files.get(id)?.hash;\n    }\n\n    has(id: string): boolean {\n        return this._files.has(id);\n    }\n\n    getAll(): IterableIterator<string>{\n        return this._files.keys();\n    }\n}\n\nclass clientFileSet extends FileSet {\n    private _rootPath: string;\n\n    async setPath(path: string){\n        this._rootPath = path;\n        const ids = await imageStorage.listFolder(path);\n        this._files = new Map<string, IFile>();\n        for (let id of ids) {\n            this._files.set(id, {hash: await imageStorage.getHash(id)});\n        }\n    }\n    \n    async add(id: string, content: Blob, hash: string): Promise<void> {\n        console.log(\"save \" + id);\n        await imageStorage.saveImage(id, content, hash);\n    }\n\n    async delete(id: string): Promise<void> {\n        console.log(\"delete \" + id);\n        await imageStorage.deleteImage(id);\n    }\n\n    async load(id: string): Promise<Blob> {\n        const url = await imageStorage.loadImageUrl(id);\n        return fetch(url).then(r => r.blob());\n    }\n}\n\nclass serverFileSet extends FileSet {\n    private _dbx: Dropbox;\n    private _serverRoot: string;\n    private _clientRoot: string;\n    private _cursor: string;\n    \n    constructor(dbx: Dropbox) {\n        super();\n        this._dbx = dbx;\n    }\n    \n    getCursor(){\n        return this._cursor;\n    }\n    \n    async setPath(serverRootPath: string, clientRootPath: string){\n        this._serverRoot = \"/\" + serverRootPath;\n        this._clientRoot = clientRootPath;\n        this._files = new Map<string, IFile>();\n\n        let res = await this._dbx.filesListFolder({\n            path: this._serverRoot,\n            recursive: true,\n        });\n        this.addServerEntries(<files.FileMetadataReference[]><unknown>res.result.entries);\n\n        while (res.result.has_more){\n            console.log(\"more\")\n            res = await this._dbx.filesListFolderContinue({\n                cursor: res.result.cursor\n            });\n            this.addServerEntries(<files.FileMetadataReference[]><unknown>res.result.entries);\n        }\n        \n        this._cursor = res.result.cursor;\n    }\n\n    private addServerEntries(entries: files.FileMetadataReference[]) {\n        const serverFiles: files.FileMetadataReference[] = entries\n            .filter(x => x.name.endsWith(\".png\") && x[\".tag\"] == \"file\");\n\n        for (let file of serverFiles) {\n            const itemId = this.serverToClientPath(file.path_display);\n            this._files.set(itemId, {hash: file.content_hash});\n        }\n    }\n    \n    private serverToClientPath(serverPath: string){\n        return serverPath.replace(this._serverRoot, this._clientRoot);\n    }\n\n    private clientToServerPath(clientPath: string){\n        return clientPath.replace(this._clientRoot, this._serverRoot);\n    }\n\n    async add(itemId: string, contents: Blob, hash: string): Promise<void> {\n        console.log(\"upload \" + itemId);\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"upload \" + itemId + \" > \" + serverPath);\n        await this._dbx.filesUpload({path: serverPath, contents: contents, mode: { \".tag\": \"overwrite\" }})\n    }\n    \n    async delete(itemId: string): Promise<void> {\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"delete \" + serverPath + \" from dropbox\");\n        await this._dbx.filesDeleteV2({path: serverPath});\n    }\n\n    async load(itemId: string): Promise<Blob> {\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"download \" + serverPath + \" > \" + itemId);\n        const res = await this._dbx.filesDownload({path: serverPath});\n        if (res.status == 200) {\n            // @ts-ignore\n            return res.result.fileBlob;\n        }\n    }\n}\n\nclass FileSyncStatus implements IFileSyncStatus{\n    private _entries: Map<string, IFileStatusEntry>;\n    private _rootPath: string;\n    \n    async setPath(path: string){\n        this._rootPath = path;\n        await this.loadEntries();\n    }\n\n    async set(itemId: string, hashA: string, hashB: string): Promise<void> {\n        this._entries.set(itemId, {hashA: hashA, hashB: hashB});\n    }\n\n    async delete(itemId: string): Promise<void> {\n        this._entries.delete(itemId);\n    }\n\n    get(itemId: string): IFileStatusEntry {\n        return this._entries.get(itemId);\n    }\n\n    has(itemId: string): boolean {\n        return this._entries.has(itemId);\n    }\n\n    private async loadEntries() {\n        const pairs: [string, IFileStatusEntry][] = await localforage.getItem(\"file-sync-status-\" + this._rootPath) ?? [];\n        this._entries = new Map(pairs);\n    }\n\n    public async saveEntries() {\n        const pairs = [...this._entries];\n        await localforage.setItem(\"file-sync-status-\" + this._rootPath, pairs);\n    }\n\n    getAll(): IterableIterator<string> {\n        return this._entries.keys();\n    }\n}\n\nclass DropboxStorage {\n    \n    private _isAuthorized: boolean = false;\n    private _dbx: Dropbox;\n    private _userId: string;\n    private _isSyncing: boolean = false;\n    private _lastSyncDate: number = 0;\n    \n    SYNC_BOTH = 0;\n    SYNC_UPLOAD = 1;\n    SYNC_DOWNLOAD = 2;\n\n    get isAuthorized(): boolean {\n        return this._isAuthorized;\n    }\n    \n    get isSyncing(): boolean{\n        return this._isSyncing;\n    }\n    \n    get dbx(): Dropbox {\n        return this._dbx;\n    }\n\n    get userId(): string{\n        return this._userId;\n    }\n    \n    set userId(value: string){\n        this._userId = value;\n        localforage.setItem(\"user-id\", value);\n    }\n    \n    get lastSyncDate(): number{\n        return this._lastSyncDate;\n    }\n\n    set lastSyncDate(value: number){\n        this._lastSyncDate = value;\n        localforage.setItem(\"last-dropbox-sync\", value);\n    }\n    \n    constructor() {\n        this.init();\n    }\n\n    private async init() {\n        this._userId = await localforage.getItem<string>(\"user-id\") ?? \"\";\n        this._lastSyncDate = await localforage.getItem<number>(\"last-dropbox-sync\") ?? 0;\n        \n        let token = this.getAccessTokenFromUrl();\n        if (!token) {\n            token = await localforage.getItem<string>('dropbox-token')\n            if (!token) {\n                return;\n            }\n        }\n        this.authorize(token);\n        this.startSync();\n    }\n\n    getAuthenticationUrl(): string{\n        const auth = new DropboxAuth({ clientId: CLIENT_ID });\n        return auth.getAuthenticationUrl(location.href);\n    }\n    \n    async startSync(){\n        if (this._isSyncing){\n            return;\n        }\n\n        console.log(\"Starting Dropbox Sync.\");\n        this._isSyncing = true;\n        const cursor = await this.sync();\n        this.longPoll(cursor);\n    }\n    \n    stopSync(){\n        this._isSyncing = false;\n        console.log(\"Stopping Dropbox Sync.\");\n    }\n    \n    toggleSync(){\n        if (this._isSyncing){\n            this.stopSync();\n        } else {\n            this.startSync();\n        }\n    }\n\n    async sync(): Promise<string>{\n        if (!this.isAuthorized || !this.userId){\n            return;\n        }\n\n        await this.syncFolder(\"default\", \"default\");\n        const cursor = await this.syncFolder(this.userId, \"user\");\n        \n        return cursor;\n    }\n    \n    async syncFolder(serverPath: string, clientPath: string): Promise<string> {\n        console.log(\"Sync \" + serverPath + \" (Server) <-> \" + clientPath + \" (Client)\");\n        try{\n            const clientFiles = new clientFileSet();\n            await clientFiles.setPath(clientPath);\n            const serverFiles = new serverFileSet(this.dbx);\n            await serverFiles.setPath(serverPath, clientPath);\n            const fileSyncStatus = new FileSyncStatus();\n            await fileSyncStatus.setPath(clientPath);\n            \n            const fileSync = new FileSync(clientFiles, serverFiles, fileSyncStatus, async id => {\n                // in doubt keep the files of the client:\n                await clientFiles.copyTo(id, serverFiles);\n                await fileSyncStatus.set(id, clientFiles.getHash(id), clientFiles.getHash(id));\n            });\n            await fileSync.syncFiles();\n            await fileSyncStatus.saveEntries();\n            \n            let cursor = serverFiles.getCursor();\n            // if (fileSync.modified){\n            //     // refresh cursor because we don't want to get updates from dropbox about the files we just posted:\n            //     const res = await this.dbx.filesListFolderGetLatestCursor({path: \"/\" + path, recursive: true});\n            //     cursor = res.result.cursor;\n            // }\n            return cursor;\n        }\n        catch (error){\n            console.log(error);\n        }\n        return null;\n    }\n\n    private async longPoll(cursor: string) {\n        if (!this._isSyncing){\n            return;\n        }\n        \n        if (!cursor){\n            this.stopSync();\n            return;\n        }\n\n        console.log(\"Polling.\");\n        const res = await this.dbx.filesListFolderLongpoll({cursor: cursor, timeout: config.dropboxSyncInterval});\n\n        if (!this._isSyncing){\n            return;\n        }\n        \n        if (res.result.changes || imageStorage.hasChanges) {\n            cursor = await this.sync();\n            imageStorage.hasChanges = false;\n        }\n        const timeout = res.result.backoff ?? config.dropboxSyncInterval;\n        setTimeout(() => this.longPoll(cursor), timeout);\n    }\n    \n    private getAccessTokenFromUrl() {\n        return this.parseQueryString(window.location.hash).access_token;\n    }\n\n    private parseQueryString(str: string) {\n        const ret = Object.create(null);\n    \n        if (typeof str !== 'string') {\n            return ret;\n        }\n    \n        str = str.trim().replace(/^(\\?|#|&)/, '');\n    \n        if (!str) {\n            return ret;\n        }\n    \n        str.split('&').forEach((param) => {\n            const parts = param.replace(/\\+/g, ' ').split('=');\n            // Firefox (pre 40) decodes `%3D` to `=`\n            // https://github.com/sindresorhus/query-string/pull/37\n            let key = parts.shift();\n            let val = parts.length > 0 ? parts.join('=') : undefined;\n    \n            key = decodeURIComponent(key);\n    \n            // missing `=` should be `null`:\n            // http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\n            val = val === undefined ? null : decodeURIComponent(val);\n    \n            if (ret[key] === undefined) {\n                ret[key] = val;\n            } else if (Array.isArray(ret[key])) {\n                ret[key].push(val);\n            } else {\n                ret[key] = [ret[key], val];\n            }\n        });\n    \n        return ret;\n    }\n    \n    async getGiftCount(receipient: string): Promise<number>{\n        try {\n            const res = await this._dbx.filesListFolder({path: \"/\" + receipient + \"/gifts\"});\n            return res.result.entries.length;\n        }\n        catch {\n            return 0;\n        }\n    }\n\n    async sendGift(blob: Blob, receipient: string): Promise<boolean> {\n        const id = Date.now().toString() + \".png\";\n        const path = \"/\" + receipient + \"/gifts/\" + id;\n\n        if (await this.getGiftCount(receipient) >= 10){\n            console.log(\"Cannot send gift to \" + path + \". Limit reached.\");\n            return false;\n        }\n        \n        console.log(\"Sending gift to \" + path);\n        try{\n            await this._dbx.filesUpload({path: path, contents: blob, mode: { \".tag\": \"overwrite\" }})\n            return true;\n        }\n        catch{\n            return false;\n        }\n    }\n\n    private authorize(token: string) {\n        this._isAuthorized = !!token;\n\n        if (this.isAuthorized){\n            this._dbx = new Dropbox({ accessToken: token });\n            localforage.setItem('dropbox-token', token);\n        }\n    }\n\n    unauthorize() {\n        if (!this.isAuthorized) {\n            return;\n        }\n        this.dbx.authTokenRevoke()\n            .then(() => {\n                this._isAuthorized = false;\n                localforage.removeItem('dropbox-token');\n            });\n    }\n}\n\nexport const dropboxStorage = new DropboxStorage();","import 'whatwg-fetch';\nimport LocalForageAdapter from \"./LocalForageAdapter\";\nimport StorageAdapter from \"./StorageAdapter\";\nimport JSZip from \"jszip\";\n\ninterface IFileMeta {\n\thash: string;\n}\n\ntype IFileMetaList = { [id: string]: IFileMeta };\n\nclass ImageStorage {\n\n\tprivate _adapter: StorageAdapter;\n\tprivate _changeListeners: Function[];\n\tprivate _urls: { [id: string]: string }\n\tprivate _fileMeta: IFileMetaList\n\thasChanges: boolean = false;\n\t\n\tconstructor() {\n\t\tthis.loadFileMeta();\n\t}\n\t\n\tpublic get adapter() {\n\t\tif (!this._adapter) {\n\t\t\tthis._adapter = new LocalForageAdapter();\n\t\t\tthis.migrate();\n\t\t}\n\t\treturn this._adapter \n\t}\n\t\n\tpublic get urls(){\n\t\tif (!this._urls){\n\t\t\tthis._urls = {};\n\t\t}\n\t\treturn this._urls;\n\t}\n\t\n\tasync ContainsImage(id: string){\n\t\tvar keys = <string[]> await this.keys();\n\t\treturn keys.includes(id);\n\t}\n\n\tpublic async loadImage(id: string): Promise<HTMLImageElement> {\n\t\tconst url: string = await this.loadImageUrl(id);\n\t\t\n\t\tif (!url){\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tconst img = new Image();\n\t\timg.id = id;\n\t\timg.src = url;\n\n\t\tif (img.decode != null) {\n\t\t\tawait img.decode();\n\t\t\treturn img;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\timg.onload = () => resolve(img);\n\t\t});\n\t}\n\t\n\n\tpublic async loadImageUrl(id: string): Promise<string> {\n\t\tif (id in this.urls){\n\t\t\treturn this.urls[id];\n\t\t}\n\t\t\n\t\tconst blob = await this.loadBlob(id);\n\t\tif (!blob){\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = URL.createObjectURL(blob);\n\t\tthis.urls[id] = url;\n\t\treturn url;\n\t}\n\n\tprivate loadBlob(id: string): Promise<Blob> {\n\t\treturn <Promise<Blob>>this.adapter.getItem(id)\n\t}\n\n\tpublic async saveImage(id: string, blob: Blob, hash?: string){\n\t\ttry{\n\t\t\tawait this.adapter.setItem(id, blob);\n\t\t\tawait this.setHash(id, hash ?? await this.generateContentHash(blob));\n\t\t\tthis.hasChanges = true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\t\t\n\t\tif (id in this.urls){\n\t\t\tURL.revokeObjectURL(this.urls[id]);\n\t\t}\n\t\tthis.urls[id] = URL.createObjectURL(blob);\n\t\t\n\t\tthis.dispatchChangeEvent(\"save\", id);\n\t}\n\t\n\tpublic deleteImage(id: string){\n\t\treturn this.adapter.removeItem(id)\n\t\t\t.then(() => {\n\t\t\t\tif (id in this.urls){\n\t\t\t\t\tURL.revokeObjectURL(this.urls[id]);\n\t\t\t\t\tdelete this.urls[id];\n\t\t\t\t}\n\t\t\t\tthis.dispatchChangeEvent(\"delete\", id);\n\t\t\t})\t\t\n\t}\n\n\tasync keys(): Promise<string[]> {\n\t\tvar keys = <string[]>await this.adapter.keys();\n\t\treturn keys.filter(x => x != \"file-meta\")\n\t}\n\n\tpublic addChangeListener(callback: Function){\n\t\tthis._changeListeners = this._changeListeners || [];\n\t\tthis._changeListeners.push(callback);\n\t}\n\n\tprivate dispatchChangeEvent(change: string, id: string) {\n\t\tfor (let changeListener of this._changeListeners) {\n\t\t\tchangeListener(change, id);\n\t\t}\n\t}\n\t\n\tpublic clear(){\n\t\tthis.adapter.clear();\n\t}\n\t\n\tpublic async generateBackupArchive(): Promise<Blob> {\n\t\tlet count = 0;\n\t\tvar keys = <string[]> await this.keys();\n\t\tvar zip = new JSZip();\n\t\t\n\t\tfor (let id of keys) {\n\t\t\tconst url = await this.loadImageUrl(id);\n\t\t\tconst blob = await fetch(url).then(r => r.blob());\n\t\t\tif (!blob){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tzip.file(id, blob);\n\t\t\tcount += 1;\n\t\t}\n\t\t\n\t\tif (count == 0){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\treturn zip.generateAsync({type:\"blob\"});\n\t}\n\t\n\tpublic async importBackupArchive(zipFile: Blob) {\n\t\tconst zip = await JSZip.loadAsync(zipFile);\n\t\t\n\t\tzip.forEach(async (path, file) => {\n\t\t\tconst buffer = await file.async(\"arraybuffer\");\n\t\t\tconst blob = new Blob([buffer], {\"type\": \"image/png\"});\n\t\t\tthis.saveImage(file.name, blob);\n\t\t})\n\t}\n\t\n\tprivate async renameImage(oldId: string, newId: string){\n\t\tconst data = <Blob>await this.adapter.getItem(oldId);\n\t\tif (!data){\n\t\t\treturn;\n\t\t}\n\t\tawait this.adapter.setItem(newId, data);\n\t\tawait this.adapter.removeItem(oldId);\n\t}\n\t\n\tprivate async migrate(){\n\t\tvar keys = <string[]> await this.keys();\n\n\t\tfor (let id of keys) {\n\t\t\tif (!id.includes(\"/\")) {\n\t\t\t\tawait this.migrateLooseFilesIntoFolders(id);\n\t\t\t}\n\t\t\tif (id.startsWith(\"images/\") ||\n\t\t\t\tid.startsWith(\"shapes/\")){\n\t\t\t\tawait this.renameImage(id, \"user/\" + id);\n\t\t\t}\n\t\t\tif (id.startsWith(\"overlays/\")){\n\t\t\t\tawait this.renameImage(id, \"default/\" + id);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async migrateLooseFilesIntoFolders(id: string) {\n\t\tif (id.startsWith(\"image\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"image\", \"user/images/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"shape-\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"shape-\", \"user/shapes/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"shape\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"shape\", \"user/shapes/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"overlay-image\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"overlay-image\", \"default/overlays/\"));\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async getStorageUsed(): Promise<number> {\n\t\tlet amount = 0;\n\t\tvar keys = <string[]> await this.keys();\n\t\tfor (let id of keys) {\n\t\t\tconst url = await this.loadImageUrl(id);\n\t\t\tconst blob = await fetch(url).then(r => r.blob());\n\t\t\tif (!blob){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tamount += blob.size;\n\t\t}\n\t\treturn amount;\n\t}\n\n\tprivate async loadFileMeta() {\n\t\tthis._fileMeta = <IFileMetaList> await this.adapter.getItem(\"file-meta\") ?? {};\n\t}\n\n\tgetFilenameFromPath(path: string): string{\n\t\treturn path.substring(path.lastIndexOf('/')+1);\n\t}\t\t\n\t\n\tgetImagePath(i: number): string {\n\t\treturn \"user/images/\" + String(i + 1).padStart(2, \"0\") + \".png\";\n\t}\n\n\tgetOverlayPath(imageId: string): string {\n\t\treturn \"default/overlays/\" + this.getFilenameFromPath(imageId);\n\t}\n\t\n\tasync listFolder(path: string): Promise<string[]> {\n\t\tconst keys = <string[]>await this.adapter.keys();\n\t\treturn keys.filter(x => x.startsWith(path + \"/\"));\n\t}\t\n\n\tasync getHash(id: string): Promise<string> {\n\t\tif (id in this._fileMeta){\n\t\t\treturn this._fileMeta[id].hash;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate async setHash(id: string, hash: string) {\n\t\tthis._fileMeta[id] = { hash: hash };\n\t\tawait this.adapter.setItem(\"file-meta\", this._fileMeta);\n\t}\n\n\tpublic async generateContentHash(blob: Blob): Promise<string> {\n\t\tconst BLOCK_SIZE = 4 * 1024 * 1024;\n\t\t\n\t\tconst tempBuffer = new Uint8Array(Math.ceil(blob.size / BLOCK_SIZE) * 32);\n\t\tlet tempPos = 0;\n\t\t\n\t\tfor (let p = 0; p < blob.size; p += BLOCK_SIZE) {\n\t\t\tconst blobChunk = blob.slice(p, p + BLOCK_SIZE);\n\t\t\tconst buf = await blob.arrayBuffer();\n\t\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', buf);\n\t\t\ttempBuffer.set(new Uint8Array(hashBuffer), tempPos);\n\t\t\ttempPos += 32;\n\t\t}\n\n\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', tempBuffer);\n\t\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\t\tconst hashHex2 = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\t\t\n\t\treturn hashHex2;\n\t}\n}\n\nexport const imageStorage = new ImageStorage();\n","import localforage from 'localforage';\nimport StorageAdapter from \"./StorageAdapter\";\n\nexport default class LocalForageAdapter extends StorageAdapter{\n\n    private _imageStore = localforage.createInstance({name: \"ImageStore\"});\n\n    getItem(id: string): Promise<unknown> {\n        return this._imageStore.getItem(id);\n    }\n\n    setItem(id: string, value: unknown): Promise<unknown> {\n        return this._imageStore.setItem(id, value);\n    }\n    \n    removeItem(id: string): Promise<unknown> {\n        return this._imageStore.removeItem(id);\n    }\n\n    keys(): Promise<unknown> {\n        return this._imageStore.keys()\n    }\n\n    iterate(param: (blob: Blob, id: string, iteration: number) => void): Promise<unknown> {\n        return this._imageStore.iterate(param)\n    }\n    \n    clear() {\n        return this._imageStore.clear();\n    }\n}","import {imageStorage} from \"../storage/ImageStorage\";\n\ninterface IPathInfo {\n    atime: string\n    atimeMs: number\n    birthtime: string\n    birthtimeMs: number\n    blksize: number\n    blocks: number\n    ctime: string\n    ctimeMs: number\n    dev: number\n    gid: number\n    ino: number\n    isBlockDevice: boolean\n    isDirectory: boolean\n    isFIFO: boolean\n    isFile: boolean\n    isSocket: boolean\n    mode: number\n    mtime: string\n    mtimeMs: number\n    name: string\n    nlink: number\n    rdev: number\n    size: number\n    uid: number\n}\n\nclass Server {\n\n    private _host: string;\n    private _userId: string;\n    \n    get host(): string{\n        return this._host;\n    }\n\n    set host(value: string){\n        this._host = value;\n        localStorage.setItem(\"server-url\", value);\n    }\n    \n    get userId(): string{\n        return this._userId;\n    }\n    \n    set userId(value: string){\n        this._userId = value;\n        localStorage.setItem(\"user-id\", value);\n    }\n\n    constructor() {\n        this._host = localStorage.getItem(\"server-url\") ?? \"http://localhost:3000\";\n        this._userId = localStorage.getItem(\"user-id\") ?? \"\";\n    }\n\n    async sync(){\n        if (!this.userId){\n            console.error(\"Cannot sync without user id.\");\n            return;\n        }\n        \n        await this.downloadDefaultAssets();\n        await this.uploadUserContent();\n    }\n\n    private async uploadUserContent() {\n        this.createDirectory(this.host, this.userId);\n\n        var keys = <string[]>await imageStorage.keys();\n\n        for (let id of keys) {\n            const url = await imageStorage.loadImageUrl(id);\n            const blob = await fetch(url).then(r => r.blob());\n            if (!blob) {\n                continue;\n            }\n            let fileName = this.userId + \"/\" + id;\n            console.log(\"posting: \" + fileName);\n            this.postImage(this.host, blob, fileName);\n        }\n    }\n\n    async downloadDefaultAssets(){\n        var res = await this.getPathInfo(this.host, 'default');\n        if (!res.ok){\n            console.log('Could not download default assets.');\n            return;\n        }\n        var info: IPathInfo[] = await res.json();\n        for (let path of info) {\n            if (!path.isFile){\n                continue;\n            }\n            if (!path.name.endsWith(\".png\")){\n                continue;\n            }\n            \n            console.log(\"getting default asset: \" + path.name);\n            this.downloadImage(\"default/\" + path.name, path.name);\n        }\n    }\n\n    private async downloadImage(path: string, imageId: string) {\n        const url = this.host + \"/\" + path;\n        var res = await fetch(url);\n        if (res.ok){\n            var blob = await res.blob();\n            if (blob){\n                imageStorage.saveImage(imageId, blob);\n            }\n        }\n    }\n    \n    async getPathInfo(host: string, path: string){\n        const url = host + \"/\" + path + \"?type=json\";\n        return fetch(url);\n    }\n    \n    async createDirectory(host: string, directoryName: string){\n        const url = host + \"/\" + directoryName + \"?create=directory\";\n        return fetch(url, {\n            method: \"POST\"\n        })\n    }\n\n    async postImage(host: string, blob: Blob, fileName: string){\n        const url = host + \"/\" + fileName;\n        return fetch(url, {\n            method: \"PUT\",\n            headers: {\n                \"Accept\": \"image/png\",\n                \"Content-Type\": \"image/png\"\n            },\n            body: blob\n        })\n    }\n}\n\nexport const server = new Server();","export default abstract class StorageAdapter {\n    abstract getItem(id: string): Promise<unknown>;\n    abstract setItem(id: string, value: unknown): Promise<unknown>;\n    abstract removeItem(id: string): Promise<unknown>;\n    abstract keys(): Promise<unknown>;\n    abstract clear(): void;\n}","import Tool from \"./Tool\";\nimport Vector from \"../math/Vector\";\nimport {PaintView, IPointerData} from \"../views/PaintView\";\nimport * as Utils from \"../utils/Utils\";\n\n// @ts-ignore\nimport brushPath from \"url:../../img/brush.png\";\nimport Layer from \"../Layer\";\n\n// Paints lines with varying stroke width\nexport default class PenTool extends Tool {\n\n    private _startIndex: number;\n    private _points: Vector[];\n    private _widths: number[];\n    private _drawPathRequested: boolean;\n    private _brushCtx: CanvasRenderingContext2D;\n    \n    private readonly _operation: string;\n\n    constructor(painter: PaintView, buttonId: string, operation: string = \"darken\") {\n        super(painter, buttonId);\n        this._operation = operation;\n        this.createBrushCtx();\n    }\n\n    private createBrushCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"brush\";\n        brushCanvas.width = 64;\n        brushCanvas.height = 64;\n        this._brushCtx = <CanvasRenderingContext2D>brushCanvas.getContext(\"2d\", {alpha: true});\n        this._brushCtx.imageSmoothingQuality = \"high\";\n        this._brushCtx.imageSmoothingEnabled = true;\n    }\n\n    down(data: IPointerData): void {\n        this._painter.captureAutoMask(data.position.clone().round());\n        \n        this._points = [data.position];\n        const width = this.getWidth(data.pressure, data.speed);\n        this._widths = [width];\n        this._startIndex = 0;\n\n        let ctx = this._painter.baseLayer.ctx;\n        ctx.fillStyle = this.color;\n        ctx.strokeStyle = this.color;\n\n\n        // let ctx = this._brushCtx;\n        // let brushWidth = ctx.canvas.width;\n        // ctx.clearRect(0, 0, brushWidth, brushWidth);\n        // ctx.fillStyle = this.color;\n        // let radius = brushWidth * 0.5;\n        // ctx.beginPath();\n        // ctx.arc(radius, radius, radius - 1, 0, 2 * Math.PI);\n        // ctx.fill();  \n        this._painter.baseLayer.ctx.globalCompositeOperation = this._operation;\n\n        this.requestDrawPath();\n    }\n    \n    up(): void{\n        this._painter.recordHistoryState();\n    }\n    \n    tick(delta: number) {\n        if (this._drawPathRequested){\n            this.drawPath();\n            this._drawPathRequested = false;\n        }\n    }\n\n    requestDrawPath(){\n        this._drawPathRequested = true;\n    }\n\n    drawPath(){\n        if (this._points.length == 0) {\n            return;\n        }\n\n        let ctx = this._painter.baseLayer.ctx;\n        this.drawConnectedLines(ctx, this._points.slice(this._startIndex), this._widths.slice(this._startIndex));\n        \n        // if (this._points.length - this._startIndex == 1){\n        //     const p = this._points[this._startIndex];\n        //     this.drawBrush(ctx, p.x, p.y, this._widths[this._startIndex]);\n        //     return;\n        // }\n        //\n        // for (let i = this._startIndex; i < this._points.length - 1; i++) {\n        //     const p1 = this._points[i];\n        //     const p2 = this._points[i+1];\n        //    \n        //     const w1 = this._widths[i];\n        //     const w2 = this._widths[i+1];\n        //\n        //     const dist = Vector.distance(p1, p2);\n        //     const step = Math.max(1, 0.125 * Math.min(w1, w2, 64));\n        //     for (let d = 0; d <= dist; d += step){\n        //         const a = d / dist;\n        //         const p = Vector.lerp(p1, p2, a);\n        //         const w = Utils.lerp(w1, w2, a);\n        //         this.drawBrush(ctx, p.x, p.y, w);\n        //     }\n        // }\n        this._startIndex = Math.max(0, this._points.length - 1);\n    }\n    \n    drawConnectedLines(ctx: CanvasRenderingContext2D, points: Vector[], widths: number[]){\n        const pointCount = points.length;\n        if (pointCount == 0){\n            return;\n        }\n        \n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        let start = points[0];\n        let startWidth = widths[0] * this.lineWidth;\n\n        if (pointCount == 1){\n            // single dot\n            ctx.beginPath();\n            ctx.arc(start.x, start.y, 0.5 * startWidth, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n\n        for (let i = 1; i < pointCount; i++) {\n            ctx.beginPath();\n            ctx.lineWidth = widths[i] * this.lineWidth;\n            ctx.lineTo(points[i-1].x, points[i-1].y);\n            ctx.lineTo(points[i].x, points[i].y);\n            ctx.stroke();\n        }\n    }\n    \n    \n    drawBrush(ctx: CanvasRenderingContext2D, x: number, y: number, width: number){\n        let radius = width * 0.5;\n        x -= radius;\n        y -= radius;\n        // x = Math.floor(x - radius);\n        // y = Math.floor(y - radius);\n        // width = Math.ceil(width);\n        ctx.drawImage(this._brushCtx.canvas, x, y, width, width);\n    }\n\n    move(data: IPointerData): void {\n        let newPoints = this.interpolatePoints(data.position);\n\n        this._points = this._points.concat(newPoints);\n        const numSegments = newPoints.length;\n\n        let width = this.getWidth(data.pressure, data.speed);\n        const lastWidth = this._widths[this._widths.length - 1];\n        const maxWidthDifferencePerSegment = 2;\n        const maxWidthDifference = maxWidthDifferencePerSegment * numSegments;\n        width = Utils.clamp(lastWidth - maxWidthDifference, lastWidth + maxWidthDifference, width);\n\n        for (let i = 0; i < numSegments; i++) {\n            this._widths.push(Utils.lerp(lastWidth, width, i / numSegments));\n        }\n\n        this.requestDrawPath();\n    }\n\n    private interpolatePoints(newPoint: Vector): Vector[] {\n        const segmentLength = Math.max(4, 0.1 * this.lineWidth);\n        const points: Vector[] = [];\n        \n        if (this._points.length == 0){\n            return;\n        }\n        \n        const start = this._points[this._points.length - 1];\n        const end = newPoint;\n        const dist = start.distanceTo(end);\n\n        if (dist < segmentLength){\n            return points;\n        }\n\n        let control = start;\n        if (this._points.length > 1){\n            const previous = this._points[this._points.length - 2];\n            const tangent = start.clone().subtract(previous).normalize();\n            control = start.clone().add(tangent.clone().multiplyScalar(0.3 * dist));\n        }\n        \n        const a = segmentLength / dist;\n        for (let i = a; i <= 1; i += a) {\n            const Vector = this.pointOnQuadraticCurve(start, control, end, i);\n            points.push(Vector);\n        }\n        return points;\n    }\n\n    private pointOnQuadraticCurve(start : Vector, control: Vector, end: Vector, a: number): Vector {\n        const f1 = (1 - a) * (1 - a);\n        const f2 = 2 * a * (1 - a);\n        const f3 = a * a;\n        \n        return new Vector(\n            start.x * f1 + control.x * f2 + end.x * f3,\n            start.y * f1 + control.y * f2 + end.y * f3);\n    }\n\n    pressureChanged(){\n        this.requestDrawPath();\n    }\n\n    getWidth(pressure: number, speed: number){\n        speed = Utils.clamp(1, 2, speed);\n        return pressure / speed; // range: 0.5 - 1\n    }\n\n    private applyAutoMask() {\n        if (!this._painter.autoMaskCtx){\n            return;\n        }\n        \n        let ctx = this.getBufferCtx();\n        ctx.globalCompositeOperation = \"destination-in\";\n        ctx.drawImage(this._painter.autoMaskCtx.canvas, 0, 0);\n        ctx.globalCompositeOperation = \"source-over\";\n    }\n}","import Tool from \"./Tool\";\nimport Vector from \"../math/Vector\";\nimport CanvasLayer from \"../CanvasLayer\";\nimport Rect from \"../utils/Rect\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport * as Utils from \"../utils/Utils\";\nimport {PaintView, IPointerData} from \"../views/PaintView\";\nimport {config} from \"../config\";\nimport {saveAs} from \"file-saver\";\nimport SendPalette from \"../palettes/SendPalette\";\nimport { dropboxStorage } from \"../storage/DropboxStorage\";\n\n// Provides a floating selection the user can manipulate \nexport default class SelectionTool extends Tool {\n    readonly selectionLayerId = \"selection-layer\";\n\n    get selectionLayer(): CanvasLayer { return <CanvasLayer>this._painter.getLayer(this.selectionLayerId) }\n    get selection(): Rect { return this._selection; }\n    get hasFloatingSelection(): boolean { return this._hasFloatingSelection; }\n    set hasFloatingSelection(value: boolean) { \n        this._hasFloatingSelection = value;\n        this.toggleFloatingSelectionButtons(value);\n    }\n    get isInShapesPalette(): boolean { return this._isInShapesPalette; }\n    set isInShapesPalette(value: boolean) { \n        this._isInShapesPalette = value;\n        this._saveButton.classList.toggle(\"disabled\", value);\n    }\n    \n    protected _position: Vector;\n    protected _startPosition: Vector;\n    protected _selection: Rect = Rect.Empty();\n    private _hasFloatingSelection: boolean;\n    private _drawSelectionOutlineRequested: boolean;\n    private _isInShapesPalette: boolean;\n    private _deleteButton: HTMLDivElement;\n    private _stampButton: HTMLDivElement;\n    private _saveButton: HTMLDivElement;\n    private _downloadButton: HTMLDivElement;\n    private _sendPalette: SendPalette;\n\n    constructor(painter: PaintView, buttonId: string) {\n        super(painter, buttonId);\n        this._deleteButton = <HTMLDivElement>document.getElementById(\"selection-delete-button\");\n        Utils.addClick(this._deleteButton, () => this.clearSelection());\n        this._stampButton = <HTMLDivElement>document.getElementById(\"selection-stamp-button\");\n        Utils.addClick(this._stampButton, () => this.paintSelectionToCanvas());\n        this._saveButton = <HTMLDivElement>document.getElementById(\"selection-save-button\");\n        Utils.addClick(this._saveButton, () => this.saveSelectionAsNewShape());\n        this._downloadButton = <HTMLDivElement>document.getElementById(\"selection-download-button\");\n        Utils.addClick(this._downloadButton, () => {\n            this.selectionLayer.canvas.toBlob(blob => saveAs(blob, \"image.png\"));\n        });\n        \n        this._sendPalette = new SendPalette(\"send-palette\");\n        this._sendPalette.onSelectionChanged = (receipient: string) => {\n            this.selectionLayer.canvas.toBlob(async blob => {\n                if (await dropboxStorage.sendGift(blob, receipient)){\n                    this._sendPalette.bounce();\n                } else {\n                    this._sendPalette.shake();\n                }\n            });\n        }\n        \n        this.hasFloatingSelection = false;\n        this._position = new Vector(0, 0);\n    }\n    \n    toggleFloatingSelectionButtons(visible: boolean){\n        this._deleteButton.classList.toggle(\"hidden\", !visible);\n        this._stampButton.classList.toggle(\"hidden\", !visible);\n        this._downloadButton.classList.toggle(\"hidden\", !visible);\n        this._saveButton.classList.toggle(\"hidden\", !visible);\n        this._sendPalette.setVisible(visible);\n    }\n\n    enable() {\n        super.enable();\n        this.createSelectionLayer();\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n    }\n\n    disable() {\n        super.disable();\n        this.paintSelectionToCanvas();\n        this.destroySelectionLayer();\n        this.hasFloatingSelection = false;\n    }\n    \n    down(data: IPointerData) {\n        this._position = this.getClampedPosition(data);\n        this.startNewSelection();\n    }\n\n    move(data: IPointerData): void {\n        this._position = this.getClampedPosition(data);\n        this.requestDrawSelectionOutline();\n    }\n\n    up(data: IPointerData): void {\n        this.cutSelection();\n    }\n\n    private startNewSelection() {\n        this.paintSelectionToCanvas();\n        this.selectionLayer.setPositionAndSize(0, 0, this._painter.width, this._painter.height);\n        this.selectionLayer.transform(new Vector(0, 0), 1, 0);\n        this.selectionLayer.floating = false;\n\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n        this._startPosition = this._position;\n        \n        let ctx = this.selectionLayer.ctx;\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\n        ctx.strokeStyle = \"black\";\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        this.requestDrawSelectionOutline();\n    }\n\n    private getClampedPosition(data: IPointerData) {\n        return data.position.round().clamp(0, 0, this._painter.width - 1, this._painter.height - 1);\n    }\n\n    tick(delta: number) {\n        if (this._drawSelectionOutlineRequested) {\n            this.updateSelectionAndDrawOutline();\n            this._drawSelectionOutlineRequested = false;\n        }\n    }\n    \n    keyDown(event: KeyboardEvent) {\n        switch (event.code){\n            case 'Backspace':\n                this.clearSelection();\n                break;\n            // case 'KeyC':\n            //     if (event.metaKey){\n            //         this.copyToClipboard();\n            //     }\n            //     break;\n        }\n    }\n\n    private clearSelection() {\n        this.selectionLayer.clear();\n        this.startNewSelection();\n    }\n\n    setImage(image: HTMLImageElement){\n        this.hasFloatingSelection = true;\n        this.selectionLayer.resize(image.width, image.height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.drawImage(image);\n        this.isInShapesPalette = true;\n    }\n\n    async setImageUrl(url: string): Promise<HTMLImageElement>{\n        const img = new Image();\n        img.src = url;\n        return new Promise(resolve => {\n            img.onload = () => {\n                this.setImage(img);\n                resolve(img);\n            }\n        });\n    }\n\n    async setImagePath(path: string): Promise<HTMLImageElement>{\n        const url = await imageStorage.loadImageUrl(path);\n        return this.setImageUrl(url);\n    }\n\n    private requestDrawSelectionOutline() {\n        this._drawSelectionOutlineRequested = true;\n    }\n\n    private updateSelectionAndDrawOutline() {\n        if (this.hasFloatingSelection){\n            return;\n        }\n        this.selectionLayer.clear();\n        let ctx = this.selectionLayer.ctx;\n\n        const x = Math.min(this._startPosition.x, this._position.x);\n        const y = Math.min(this._startPosition.y, this._position.y);\n        const width = Math.abs(this._startPosition.x - this._position.x);\n        const height = Math.abs(this._startPosition.y - this._position.y);\n        this._selection = new Rect(x, y, width, height);\n\n        ctx.strokeRect(x, y, width, height);\n    }\n    \n    private destroySelectionLayer() {\n        this._painter.removeLayer(this.selectionLayer);\n    }\n\n    private createSelectionLayer() {\n        if (this.selectionLayer){\n            return;\n        }\n\n        this._painter.addCanvasLayer(this.selectionLayerId, 0, 0, this._painter.width, this._painter.height, false);\n        this.selectionLayer.onDoubleTap = (event: TouchEvent) => {\n            if (event.altKey){\n                this.saveSelectionAsNewShape();\n                return;\n            }\n            this.paintSelectionToCanvas();\n        }\n    }\n    \n    private cutSelection() {\n        this.selectionLayer.clear();\n        this._selection = Utils.getVisiblePixelFrame(this._painter.baseLayer.ctx, this.selection);\n        \n        if (this.selection.isEmpty()){\n            return;\n        }\n\n        this.hasFloatingSelection = true;\n        const {x, y, width, height} = this.selection;\n        \n        this.selectionLayer.setPositionAndSize(x, y, width, height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas, x, y, width, height, 0, 0, width, height);\n        this._painter.baseLayer.clear(this.selection);\n        this._painter.recordHistoryState();\n    }\n\n    private paintSelectionToCanvas() {\n        if (!this.hasFloatingSelection){\n            return;\n        }\n        this._painter.baseLayer.ctx.globalCompositeOperation = \"source-over\";\n        this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx);\n        this._painter.recordHistoryState();\n    }\n\n    private async saveSelectionAsNewShape() {\n        const shapes = await imageStorage.listFolder(\"user/shapes\");\n        if (shapes.length >= config.maxShapeCount){\n            console.log(\"Cannot save selection as shape because there are already too many in storage.\");\n            return;\n        }\n        \n        const path = `user/shapes/${Date.now()}.png`;\n        console.log(`Saving selection as: ${path}`);\n        this.selectionLayer.canvas.toBlob(blob => imageStorage.saveImage(path, blob as Blob));\n        this.isInShapesPalette = true;\n    }\n\n    // copyToClipboard(){\n    //     this.selectionLayer.canvas.toBlob(blob => navigator.clipboard.write([new ClipboardItem({'image/png': blob})]));\n    //     console.log(\"copied selection to clipboard\");\n    // }\n    //\n    // pasteFromClipboard() {\n    //     navigator.permissions.query({name: \"clipboard-read\"})\n    //         .then(result => {\n    //             if (!(result.state == \"granted\" || result.state == \"prompt\")) {\n    //                 return;\n    //             }\n    //             navigator.clipboard.read()\n    //                 .then(data => {\n    //                     for (let i = 0; i < data.length; i++) {\n    //                         if (!data[i].types.includes(\"image/png\")){\n    //                             continue;\n    //                         }\n    //                         data[i].getType(\"image/png\")\n    //                             .then(blob => {\n    //                                 this.setImageUrl(URL.createObjectURL(blob));\n    //                             })\n    //                     }\n    //                 });\n    //         });\n    // }\n\n    selectAll() {\n        this.startNewSelection();\n        this._selection = new Rect(0, 0, this._painter.width, this._painter.height);\n        this.cutSelection();\n    }\n}\n","import {PaintView, IPointerData} from \"../views/PaintView\";\n\n// Base class for all tools\nexport default abstract class Tool {\n    protected _painter: PaintView;\n    \n    get color() { return this._painter.color };\n    get opacity() { return this._painter.opacity }\n    get lineWidth() { return this._painter.lineWidth };\n    \n    private static _bufferCtx: CanvasRenderingContext2D;\n    protected _buttonElement: HTMLElement; \n\n    constructor(painter: PaintView, buttonId: string) {\n        this._painter = painter;\n        this._buttonElement = document.getElementById(buttonId);\n    }\n\n    // creates a context to draw the current stroke to so we can draw the complete stroke with a different\n    // operation. The buffer can be shared by different tools.\n    private createBufferCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"buffer\";\n        brushCanvas.width = this._painter.width;\n        brushCanvas.height = this._painter.height;\n        Tool._bufferCtx = <CanvasRenderingContext2D>brushCanvas.getContext(\"2d\", {alpha: true});\n        Tool._bufferCtx.imageSmoothingQuality = \"high\";\n        Tool._bufferCtx.imageSmoothingEnabled = true;\n    }\n\n    protected getBufferCtx(){\n        if (Tool._bufferCtx == null){\n            this.createBufferCtx();\n        }\n        return Tool._bufferCtx;\n    }\n\n    enable(): void {\n        this._buttonElement.classList.add(\"selected\");\n    }\n    disable(): void {\n        this._buttonElement.classList.remove(\"selected\");\n    }\n    down(data: IPointerData): void {}\n\n    move(data: IPointerData): void {}\n    \n    up(data: IPointerData): void {}\n    \n    pressureChanged(): void {}\n    tick(delta: number): void {}\n    keyDown(event: KeyboardEvent): void {}\n}","export interface IFileSet {\n    has(itemId: string): boolean;\n    delete(itemId: string): Promise<void>;\n    copyTo(itemId: string, filesB: IFileSet): Promise<void>;\n    getHash(itemId: string): string;\n    getAll(): IterableIterator<string>;\n}\n\nexport interface IFileStatusEntry {\n    hashA: string;\n    hashB: string;\n}\n\nexport interface IFileSyncStatus {\n    has(itemId: string): boolean;\n    delete(itemId: string): Promise<void>;\n    set(itemId: string, hashA: string, hashB: string): Promise<void>;\n    get(itemId: string): IFileStatusEntry;\n    getAll(): IterableIterator<string>;\n}\n\nexport interface ISyncConflictResolver {\n    (itemId: string): Promise<void>;\n}\n\n// inspiration: https://unterwaditzer.net/2016/sync-algorithm.html\nexport class FileSync{\n    private readonly _filesA: IFileSet;\n    private readonly _filesB: IFileSet;\n    private readonly _status: IFileSyncStatus;\n    private readonly _resolveConflict: ISyncConflictResolver;\n    modified: boolean;\n    \n    constructor(filesA: IFileSet, filesB: IFileSet, status: IFileSyncStatus, resolveConflict: ISyncConflictResolver){\n        this._filesA = filesA;\n        this._filesB = filesB;\n        this._status = status;\n        this._resolveConflict = resolveConflict;\n    }\n\n    async syncFiles(): Promise<void>{\n        let changed: boolean = false;\n        const files = this.getAllFiles();\n        for (let file of files) {\n            await this.syncFile(file)\n        }\n    }\n\n    private async syncFile(itemId: string): Promise<void>{\n        const filesA = this._filesA;\n        const filesB = this._filesB;\n        const status = this._status;\n\n        if (status.has(itemId)){\n            if (filesA.has(itemId)){\n                if (filesB.has(itemId)){\n                    // check modification\n                    await this.handleModification(itemId);\n                }\n                else {\n                    // file has been deleted from B\n                    await filesA.delete(itemId);\n                    await status.delete(itemId);\n                    this.modified = true;\n                }\n            }\n            else\n            {\n                if (filesB.has(itemId)){\n                    // file has been deleted from A\n                    await filesB.delete(itemId);\n                    await status.delete(itemId);\n                    this.modified = true;\n                }\n                else {\n                    // neither on A nor B\n                    await status.delete(itemId);\n                }\n            }\n        }\n        else\n            // not on status\n        {\n            if (filesA.has(itemId)){\n                if (filesB.has(itemId)) {\n                    // is on A and B but not on status. We cannot compare the hashes so we need to\n                    console.log(\"not on status: \", itemId)\n\n                    await this._resolveConflict(itemId);\n                    this.modified = true;\n                }\n                else {\n                    // only on A\n                    console.log(\"only on A\")\n                    await filesA.copyTo(itemId, filesB);\n                    await status.set(itemId, filesA.getHash(itemId), filesA.getHash(itemId));\n                    this.modified = true;\n                }\n            }\n            else\n            {\n                if (filesB.has(itemId)){\n                    console.log(\"only on B\")\n                    // only on B\n                    await filesB.copyTo(itemId, filesA);\n                    await status.set(itemId, filesB.getHash(itemId), filesB.getHash(itemId));\n                    this.modified = true;\n                }\n                // else it's on none\n            }\n        }\n    }\n    \n    private async handleModification(itemId: string) {\n        const filesA = this._filesA;\n        const filesB = this._filesB;\n        const status = this._status;\n\n        const hashA = filesA.getHash(itemId);\n        const hashB = filesB.getHash(itemId);\n        const statusHashes = status.get(itemId);\n        \n        // console.log(\"handleModification \", itemId)\n        // console.log(\"hashA \", hashA)\n        // console.log(\"hashB \", hashB)\n\n        // nothing changed\n        if (hashA == statusHashes.hashA && hashB == statusHashes.hashB) {\n            return;\n        }\n\n        // changed on A but not on B\n        if (hashA != statusHashes.hashA && hashB == statusHashes.hashB) {\n            console.log(\"changed on A but not on B\", hashA, statusHashes.hashA)\n            await filesA.copyTo(itemId, filesB);\n            await status.set(itemId, filesA.getHash(itemId), filesA.getHash(itemId));\n            this.modified = true;\n        }\n        // changed on B but not on A\n        else if (hashA == statusHashes.hashA && hashB != statusHashes.hashB) {\n            console.log(\"changed on B but not on A\", hashB, statusHashes.hashB)\n            await filesB.copyTo(itemId, filesA);\n            await status.set(itemId, filesB.getHash(itemId), filesB.getHash(itemId));\n            this.modified = true;\n        }\n        // changed on both\n        else if (hashA != statusHashes.hashA && hashB != statusHashes.hashB) {\n            await this._resolveConflict(itemId);\n            this.modified = true;\n        }\n    }\n\n    private getAllFiles(): string[] {\n        const allFiles = new Set(this._status.getAll());\n        const filesA = this._filesA.getAll();\n        const filesB = this._filesB.getAll();\n\n        for (let file of filesA) {\n            allFiles.add(file);\n        }\n        for (let file of filesB) {\n            allFiles.add(file);\n        }\n        return Array.from(allFiles);\n    }\n}","export default class Rect {\n    public x: number;\n    public y: number;\n    public width: number;\n    public height: number;\n    \n    get minX() { return this.x; }\n    get minY() { return this.y; }\n    get maxX() { return this.x + this.width; }\n    get maxY() { return this.y + this.height; }\n\n    constructor(x: number, y: number, width: number, height: number) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    \n    isEmpty(): boolean{\n        return this.width <= 0 || this.height <= 0;\n    }\n    \n    static Empty(): Rect{\n        return new Rect(0, 0, 0, 0);\n    }\n}","import {config} from \"../config\";\nimport Rect from \"./Rect\";\nimport Vector from \"../math/Vector\";\nconst Pressure = require('pressure');\n\n// source:\n// https://stackoverflow.com/questions/15900485/correct-way-to-convert-size-in-bytes-to-kb-mb-gb-in-javascript\nexport function formatBytes(bytes: number, decimals = 2) {\n    if (bytes === 0) return '0 Bytes';\n\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nexport async function upload(accept: string): Promise<Blob> {\n    return new Promise(resolve => {\n        const input = document.createElement('input');\n        input.type = \"file\";\n        input.accept = accept; \n        input.onchange = () => {\n            if (input.files.length == 0){\n                return;\n            }\n            let file = input.files[0];\n            resolve(file);\n            input.remove();\n        }\n        input.click();\n    });\n}\n\nexport function imageToBlob(image: HTMLImageElement){\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"imageToCanvas\";\n    canvas.width = image.naturalWidth;\n    canvas.height = image.naturalHeight;\n    const ctx = <CanvasRenderingContext2D>canvas.getContext(\"2d\", {alpha: true});\n    ctx.drawImage(image, 0 ,0);\n    return new Promise(resolve => {\n        canvas.toBlob(blob => resolve(blob));\n    })\n}\n\nexport function pointerEventsSupported(): boolean {\n    return window.PointerEvent != null;\n}\n\nexport function log(message?: any, ...optionalParams: any[]){\n    if (!config.debug){\n        return;\n    }\n    console.log(message, optionalParams);\n}\n\n\nexport function addClick(element: HTMLElement, callback: (this: HTMLElement, event: any) => any,\n                       supportScrolling: boolean = false){\n    \n    let scrollStartX: number;\n    let scrollStartY: number;\n    let touchId: number;\n    let isTracking: boolean;\n    let startTimeStamp: number;\n    let scrolled: boolean;\n    \n    element.addEventListener(\"touchstart\", touchStart, {passive: supportScrolling});\n    element.addEventListener(\"mouseup\", mouseUp);\n    \n    function mouseUp(event: Event){\n        event.preventDefault();\n        event.stopPropagation();\n        callback.call(event.target, event);\n    }\n    \n    function touchStart(event: TouchEvent){\n        if (!supportScrolling){\n            event.preventDefault();\n        }\n        \n        if (isTracking || event.touches.length > 1){\n            return;\n        }\n        const touch = event.changedTouches[0];\n\n        isTracking = true;\n        touchId = touch.identifier;\n        scrolled = false;\n        scrollStartX = touch.pageX;\n        scrollStartY = touch.pageY;\n        startTimeStamp = event.timeStamp;\n        element.classList.add(\"down\");\n\n        element.addEventListener(\"touchmove\", touchMove, {passive: supportScrolling});\n        element.addEventListener(\"touchend\", touchEnd);\n    }\n\n    function touchMove(event: TouchEvent){\n        if (!supportScrolling){\n            event.preventDefault();\n        }\n\n        if (!isTracking){\n            return;\n        }\n        const touch = event.changedTouches[0];\n        \n        // user dragged out of the element:\n        if (document.elementFromPoint(touch.pageX,touch.pageY) != event.target){\n            isTracking = false;\n            element.classList.remove(\"down\");\n        }\n\n        if (scrolled || event.timeStamp < startTimeStamp + config.maxScrollDelay){\n            if (supportScrolling &&\n                (Math.abs(touch.pageX - scrollStartX) > config.minScrollDistance ||\n                    Math.abs(touch.pageY - scrollStartY) > config.minScrollDistance)){\n                isTracking = false;\n                element.classList.remove(\"down\");\n            }\n        }\n\n        // After tapping and holding for a while the element does not start scrolling any more.\n        // In that case we don't want perform the scroll check above any more:\n        if (event.timeStamp < startTimeStamp + config.maxScrollDelay){\n            if (Math.abs(touch.pageX - scrollStartX) > 2 ||\n                Math.abs(touch.pageY - scrollStartY) > 2){\n                scrolled = true;\n            }\n        }\n    }\n\n    function touchEnd(event: TouchEvent){\n        event.preventDefault();\n        element.removeEventListener(\"touchmove\", touchMove);\n        element.removeEventListener(\"touchend\", touchEnd);\n        element.classList.remove(\"down\");\n        \n        if (!isTracking){\n            return;\n        }\n        isTracking = false;\n        touchId = null;\n\n        callback.call(event.target, event);\n    }\n}\n\nexport function addLongClick(element: HTMLElement, callback: (this: HTMLElement, event: any) => any){\n    let timer: any;\n    let caller = this;\n    let called: boolean = false;\n\n    element.addEventListener(\"touchstart\", down,{passive: true});\n    element.addEventListener(\"touchend\", up);\n    element.addEventListener(\"mousedown\", down);\n    element.addEventListener(\"mouseup\", up);\n\n    function down(event: Event) {\n        called = false;\n        timer = setTimeout(() => {\n            callback.call(caller, event);\n            called = true;\n        }, config.longClickDelay);\n    }\n\n    function up(event: Event) {\n        if (called) {\n            event.stopImmediatePropagation();\n            element.classList.remove(\"down\");\n            called = false;\n        } else {\n            clearTimeout(timer);\n        }\n    }\n}\n\nexport function createNewImageId(): string {\n    return Date.now().toString();\n}\n\nexport function lerp(a: number, b: number, alpha: number): number{\n    return a * (1 - alpha) + b * alpha;\n}\n\nexport function clamp(lower: number, upper: number, n: number): number{\n    return Math.min(upper, Math.max(lower, n));\n}\n\nexport function lerpColor(color1: number, color2: number, alpha: number): number{\n    if (alpha == 0){\n        return color1;\n    }\n\n    if (alpha == 1){\n        return color2;\n    }\n\n    const aa = (color1 & 0xff000000) >> 24;\n    const ba = (color1 & 0x00ff0000) >> 16;\n    const ga = (color1 & 0x0000ff00) >> 8;\n    const ra = (color1 & 0x000000ff);\n\n    const ab = (color2 & 0xff000000) >> 24;\n    const bb = (color2 & 0x00ff0000) >> 16;\n    const gb = (color2 & 0x0000ff00) >> 8;\n    const rb = (color2 & 0x000000ff);\n\n    const r = Math.floor(lerp(ra, rb, alpha));\n    const g = Math.floor(lerp(ga, gb, alpha));\n    const b = Math.floor(lerp(ba, bb, alpha));\n    const a = 255; //Math.floor(Utils.lerp(aa, ab, alpha));\n\n    return r + (g << 8) + (b << 16) + 0xFF000000;\n}\n\nexport function lerpCanvas(ctxA: CanvasRenderingContext2D, ctxB: CanvasRenderingContext2D, ctxMask: CanvasRenderingContext2D) {\n    const width = ctxA.canvas.width;\n    const height = ctxA.canvas.height;\n    const dataA = ctxA.getImageData(0, 0, width, height);\n    const dataB = ctxB.getImageData(0, 0, width, height);\n    const dataMask = ctxMask.getImageData(0, 0, width, height);\n\n    const a32 = new Uint8ClampedArray(dataA.data.buffer);\n    const b32 = new Uint8ClampedArray(dataB.data.buffer);\n    const m32 = new Uint8ClampedArray(dataMask.data.buffer);\n\n    for (let i = 0; i < width * height; i++){\n        const a = m32[i * 4 + 3] / 255;\n        a32[i * 4 + 0] = (1 - a) * a32[i * 4 + 0] + a * b32[i * 4 + 0];\n        a32[i * 4 + 1] = (1 - a) * a32[i * 4 + 1] + a * b32[i * 4 + 1];\n        a32[i * 4 + 2] = (1 - a) * a32[i * 4 + 2] + a * b32[i * 4 + 2];\n        a32[i * 4 + 3] = (1 - a) * a32[i * 4 + 3] + a * b32[i * 4 + 3];\n    }\n    ctxA.putImageData(dataA, 0, 0);\n}\n\nexport function stringToColor(h: string): number {\n    let r = 0, g = 0, b = 0;\n\n    if (h.length == 4) {\n        r = parseInt(h[1] + h[1], 16);\n        g = parseInt(h[2] + h[2], 16);\n        b = parseInt(h[3] + h[3], 16);\n    } \n    else  {\n        r = parseInt(h[1] + h[2], 16);\n        g = parseInt(h[3] + h[4], 16);\n        b = parseInt(h[5] + h[6], 16);\n    }\n\n    return 0xFF000000 + r + (g << 8) + (b << 16);\n}\n\nexport function floodFill(sourceCtx: CanvasRenderingContext2D, mask: Uint8ClampedArray,  startPosition: Vector, color: string) {\n    const threshold = 0.5;\n    const width = sourceCtx.canvas.width;\n    const height = sourceCtx.canvas.height;\n    \n    const sourceData = sourceCtx.getImageData(0, 0, width, height);\n    const sourcePixels = sourceData.data;\n\n    startPosition = startPosition.clone().round();\n    const startIndex: number = startPosition.x + startPosition.y * width;\n    \n    // const startR = sourcePixels[startIndex * 4];\n    // const startG = sourcePixels[startIndex * 4 + 1];\n    // const startB = sourcePixels[startIndex * 4 + 2];\n    // const startA = sourcePixels[startIndex * 4 + 3];\n\n    const startR = parseInt(color[1] + color[2], 16);\n    const startG = parseInt(color[3] + color[4], 16);\n    const startB = parseInt(color[5] + color[6], 16);\n\n    // take into account that transparent pixels appear white (due to white bg) but their rgb value is 0:\n    // const startBrightness = startA < 5 ? 255 : 0.333 * (startR + startG + startB);\n    const startBrightness = 0.333 * (startR + startG + startB);\n    \n    // clear alpha channel:\n    for (let i = 0; i < width * height; i++) {\n        mask[i * 4 + 3] = 0;\n    }\n\n    // start at multiple positions around start position:\n    let stack: Vector[] = [];\n    stack.push(startPosition);\n    if (startPosition.x > 1){\n        stack.push(new Vector(startPosition.x - 2, startPosition.y));\n    }\n    if (startPosition.x < width - 2){\n        stack.push(new Vector(startPosition.x + 2, startPosition.y));\n    }\n    if (startPosition.y > 1){\n        stack.push(new Vector(startPosition.x, startPosition.y - 2));\n    }\n    if (startPosition.y < height - 2){\n        stack.push(new Vector(startPosition.x, startPosition.y + 2));\n    }\n\n    while (stack.length > 0)\n    {\n        let pos = stack.pop();\n\n        if (isBorderPixel(pos.x, pos.y, false)){\n            continue;\n        }\n        \n        const minX = scanLeft(pos.x, pos.y);\n        const maxX = scanRight(pos.x, pos.y);\n        addToStack(minX, maxX, pos.y - 1);\n        addToStack(minX, maxX, pos.y + 1);\n    }\n\n    function scanLeft(x: number, y: number): number\n    {\n        let minX = x;\n        while (minX >= 0)\n        {\n            if (isBorderPixel(minX, y, true)){\n                break;\n            }\n            minX -= 1;\n        }\n        return minX + 1;\n    }\n\n    function scanRight(x: number, y: number): number\n    {\n        let maxX: number = x + 1;\n        while (maxX < width)\n        {\n            if (isBorderPixel(maxX, y, true)){\n                break;\n            }\n            maxX += 1;\n        }\n        return maxX - 1;\n    }\n    \n    function addToStack(minX: number, maxX: number, y: number)\n    {\n        if (y < 0 || y >= height)\n        {\n            return;\n        }\n\n        for (let x = minX; x <= maxX; x++)\n        {\n            if (isBorderPixel(x, y, false)){\n                continue;\n            }\n            stack.push(new Vector(x, y));\n        }\n\n    }\n\n    function isBorderPixel(x: number, y: number, setValue: boolean): boolean {\n        const index = (x + y * width) * 4;\n        const indexA = index + 3;\n        if (mask[indexA]){\n            return true;\n        }\n\n        const r = sourcePixels[index];\n        const g = sourcePixels[index + 1];\n        const b = sourcePixels[index + 2];\n        const a = sourcePixels[index + 3];\n        //\n        // let difference = Math.max(\n        //     Math.abs(r - startR),\n        //     Math.abs(g - startG),\n        //     Math.abs(b - startB),\n        //     Math.abs(a - startA)\n        // ) / 255;\n        const brightness = 0.333 * (r + g + b);\n        \n        if (a < 250 || brightness >= startBrightness){\n            if (setValue){\n                mask[indexA] = 255;\n            }\n            return false;               \n        }\n        \n        // if (difference < threshold){\n        //     if (setValue){\n        //         mask[indexA] = 255;\n        //     }\n        //     return false;\n        // }\n\n        // if (setValue) {\n        //     mask[indexA] = (1 - difference) * 255;\n        // }\n        return true;\n    }\n}\n\nexport function getVisiblePixelFrame(ctx: CanvasRenderingContext2D, rect: Rect): Rect {\n    let {x, y, width, height} = rect;\n\n    if (width <= 0 || height <= 0){\n        return Rect.Empty();\n    }\n    \n    const data = ctx.getImageData(x, y, width, height);\n    const pixels = data.data;\n    \n    let minX = width;\n    let maxX = 0;\n    let minY = height;\n    let maxY = 0;\n\n    for (let cy = 0; cy < height; cy++) {\n        for (let cx = 0; cx < width; cx++) {\n            if (pixels[(cx + cy * width) * 4 + 3]){\n                minX = cx < minX ? cx : minX;\n                maxX = cx > maxX ? cx : maxX;\n                minY = cy < minY ? cy : minY;\n                maxY = cy > maxY ? cy : maxY;\n            }\n        }\n    }\n    \n    x += minX;\n    y += minY;\n    width = Math.max(0, maxX - minX + 1);\n    height = Math.max(0, maxY - minY + 1);\n    return new Rect(x, y, width, height); \n}\n\nexport function dilateMask(pixels: Uint8ClampedArray, width: number, height: number) {\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width - 1; x++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4]){\n                pixels[i] = 255;\n            }\n        }\n        for (let x = width - 1; x > 0; x--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4]){\n                pixels[i] = 255;\n            }\n        }\n    }\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height - 1; y++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4 * width]){\n                pixels[i] = 255;\n            }\n        }\n        for (let y = height - 1; y > 0; y--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4 * width]){\n                pixels[i] = 255;\n            }\n        }\n    }\n}","import {View} from \"./View\";\nimport {config} from \"../config\";\nimport Thumbnail from \"./Thumbnail\";\nimport PeerToPeer from \"../PeerToPeer\";\nimport * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\n\nexport default class BookView extends View {\n\n    public onImageSelected: Function | undefined;\n    private _thumbnails: Thumbnail[];\n    \n    constructor(id: string, onSettingsClicked: Function) {\n        super(id);\n        let settingsButton = <HTMLDivElement>this._element.getElementsByClassName(\"button settings\")[0];\n        Utils.addClick(settingsButton, () => onSettingsClicked());\n    }\n\n    show(): void {\n        super.show();\n        this.updateImages();\n        \n        // PeerToPeer.instance.onDataReceived = (data: ArrayBuffer) => {\n        //     this._thumbnails[0].setImageSrc(URL.createObjectURL(new Blob([data])));\n        // }\n    }\n\n    private updateImages() {\n        if (this._thumbnails){\n            return;\n        }\n        \n        this._thumbnails = [];\n        \n        for (let i=0; i<config.imageCount; i++) {\n            const imageId = imageStorage.getImagePath(i);\n            let thumbnail = new Thumbnail(this._element, imageId, (id: string) => this.onImageSelected(id))\n            this._thumbnails.push(thumbnail);\n        }\n    }\n}\n","import {View} from \"./View\";\nimport Tool from \"../tools/Tool\";\nimport ColorPalette from \"../palettes/ColorPalette\";\nimport ToolPalette from \"../palettes/ToolPalette\";\nimport SizePalette from \"../palettes/SizePalette\";\nimport * as Utils from \"../utils/Utils\";\nimport PenTool from \"../tools/PenTool\";\nimport PaintBucketTool from \"../tools/PaintBucketTool\";\nimport Vector from \"../math/Vector\";\nimport {Palette} from \"../palettes/Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport {config} from \"../config\";\nimport RectangleTool from \"../tools/RectangleTool\";\nimport LineTool from \"../tools/LineTool\";\nimport ShapePalette from \"../palettes/ShapePalette\";\nimport Layer from \"../Layer\";\nimport ILayer from \"../ILayer\";\nimport CanvasLayer from \"../CanvasLayer\";\nimport ImageLayer from \"../ImageLayer \";\nimport SelectionTool from \"../tools/SelectionTool\";\nimport {Toolbar} from \"../Toolbar\";\nimport {History} from \"../History\";\nimport GiftPalette from \"../palettes/GiftPalette\";\nimport SendPalette from \"../palettes/SendPalette\";\n\n// var Pressure = require('pressure');\nexport interface IPointerData {\n    timeStamp: number;\n    position: Vector;\n    radius: Vector;\n    pressure: number;\n    speed: number;\n    isPressed: boolean;\n}\n\nexport class PaintView extends View {\n    public readonly scaleFactor = 1;\n    public readonly width: number;\n    public readonly height: number;\n\n    public brushTool: Tool;\n    public markerTool: Tool;\n    public eraserTool: Tool;\n    public selectionTool: SelectionTool;\n    public paintBucketTool: Tool;\n\n    private _currentTool: Tool;\n    private _imageId: string;\n    private _color: string;\n    private _opacity: number;\n    private _lineWidth: number;\n    private _autoMaskCtx: CanvasRenderingContext2D;\n    private _mainToolbar: Toolbar;\n    private _contextToolbar: Toolbar;\n    private _colorPalette: ColorPalette;\n    private _sizePalette: SizePalette;\n    private _shapePalette: ShapePalette;\n    private _giftPalette: GiftPalette;\n    private _tools: Tool[];\n    private _currentTouchId: number = 0;\n    private _history: History;\n    private _undoButton: HTMLDivElement;\n    private _redoButton: HTMLDivElement;\n    private _lastPointerData: IPointerData;\n    private _tickTimeStamp: number;\n    private _autoMaskCaptured: boolean;\n    private _shape: string;\n    private _layers: { [id : string] : ILayer } = {};\n    private _sheet: HTMLElement;\n    private _importImageButton: HTMLDivElement;\n    private _isDirty: boolean;\n    private _lastSaveTimestamp: number = 0;\n\n    get color(): string { return this._color; }\n    get shape(): string { return this._shape; }\n    get opacity(): number { return this._opacity; }\n    get lineWidth(): number { return this._lineWidth; }\n    get autoMaskCtx(): CanvasRenderingContext2D { return this._autoMaskCtx; }\n    //get layers(): Layer[] { return this._layers; }\n    get baseLayer(): CanvasLayer { return <CanvasLayer>this._layers[\"base-layer\"]; }\n    get overlayLayer(): ImageLayer { return <ImageLayer>this._layers[\"overlay-layer\"]; }\n\n    constructor(id: string, onBackClicked: Function) {\n        super(id);\n        \n        this._history = new History();\n        this._sheet = document.getElementById(\"sheet\");\n\n        this.width = config.width;\n        this.height = config.height;\n\n        this.addCanvasLayer(\"base-layer\", 0, 0, this.width, this.height,false);\n        this.addEventListeners();\n        this.createButtons(onBackClicked);\n        this.createToolbar();\n        this.createPalettes();\n        this.createTools();\n    }\n    \n    getLayer(id: string){\n        return this._layers[id];\n    }\n\n    private createButtons(onBackClicked: Function) {\n        let backButton = <HTMLDivElement>this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n\n        this._undoButton = <HTMLDivElement>document.getElementById(\"undo-button\");\n        Utils.addClick(this._undoButton, () => this.undo());\n\n        this._redoButton = <HTMLDivElement>document.getElementById(\"redo-button\");\n        Utils.addClick(this._redoButton, () => this.redo());\n        \n        this._importImageButton = <HTMLDivElement>document.getElementById(\"import-image-button\");\n        Utils.addClick(this._importImageButton, async () => {\n            const blob = await Utils.upload(\"image/*\");\n            this.setTool(this.selectionTool);\n            const url = URL.createObjectURL(blob);\n            await this.selectionTool.setImageUrl(url);\n            URL.revokeObjectURL(url);\n        });\n    }\n\n    private addLayer(layer: ILayer): ILayer {\n        layer.index = Object.keys(this._layers).length;\n        this._layers[layer.id] = layer;\n        return layer;\n    }\n    \n    public addImageLayer(id: string, x: number, y: number, width: number, height: number, floating: boolean): ImageLayer{\n        const layer = new ImageLayer(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    \n    public addCanvasLayer(id: string, x: number, y: number, width: number, height: number, floating: boolean): CanvasLayer{\n        const layer = new CanvasLayer(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    \n    public removeLayer(layer: ILayer) {\n        if (!layer){\n            return;\n        }\n        layer.remove();\n        delete this._layers[layer.id]\n    }\n    \n    public createOverlay(){\n        if (this.overlayLayer){\n            return;\n        }\n        this.addLayer(new ImageLayer(this._sheet, \"overlay-layer\", 0, 0, this.width, this.height));\n    }\n    \n    public removeOverlay(){\n        this.removeLayer(this.overlayLayer);\n    }\n    \n    public async setOverlay(id: string){\n        const url = await imageStorage.loadImageUrl(id);\n        \n        if (!url){\n            this.removeOverlay();\n            return;\n        }\n        this.createOverlay();\n        this.overlayLayer.image.src = url;\n                //this.processOverlay(this.overlay.ctx);\n\n                // show processed overlay:\n                // this._overlayCtx.canvas.toBlob(blob => {\n                //     this._overlay.src = URL.createObjectURL(blob);\n                // })\n    }\n    \n    private createTools() {\n        let penButton = document.getElementById(\"tool-pen\");\n        Utils.addLongClick(penButton, () => this.fill());\n        Utils.addClick(penButton, () => this.setTool(this.markerTool));\n        let eraserButton = document.getElementById(\"tool-eraser\");\n        Utils.addLongClick(eraserButton, () => this.clear(true));\n        Utils.addClick(eraserButton, () => this.setTool(this.eraserTool));\n        let selectionButton = document.getElementById(\"tool-selection\");\n        Utils.addClick(selectionButton, () => this.setTool(this.selectionTool));\n        Utils.addLongClick(selectionButton, () => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.selectAll();\n        });\n        \n        this._tools = [];\n        // this.brushTool = this.addTool(new PenTool(this, \"tool-\", \"source-over\"));\n        this.markerTool = this.addTool(new PenTool(this, \"tool-pen\", \"darken\"));\n        this.eraserTool = this.addTool(new PenTool(this, \"tool-eraser\", \"destination-out\"));\n        this.selectionTool = <SelectionTool>this.addTool(new SelectionTool(this, \"tool-selection\"));\n        // this.paintBucketTool = this.addTool(new PaintBucketTool(this));\n        // this._currentTool = this.brushTool;\n        this.setTool(this.markerTool);\n    }\n    \n    private addTool(tool: Tool){\n        this._tools.push(tool);\n        return tool;\n    }\n    \n    private createToolbar(){\n        this._mainToolbar = new Toolbar(\"main-toolbar\");\n\n        this._contextToolbar = new Toolbar(\"context-toolbar\");\n    }\n\n    private createPalettes() {\n        this._sizePalette = new SizePalette(\"size-palette\");\n        this._sizePalette.onSelectionChanged = (lineWidth: number) => {\n            this._lineWidth = lineWidth;\n        };\n        this._lineWidth = this._sizePalette.size;\n\n        this._colorPalette = new ColorPalette(\"color-palette\");\n        this._colorPalette.onSelectionChanged = (color: string) => this._color = color;\n        this._color = this._colorPalette.color;\n\n        this._shapePalette = new ShapePalette(\"shape-palette\");\n        this._shapePalette.onSelectionChanged = (shape: string) => {\n            this._shape = shape;\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImageUrl(this.shape);\n        }\n        this._shape = this._shapePalette.stamp;\n\n        this._giftPalette = new GiftPalette(\"gift-palette\");\n        this._giftPalette.onSelectionChanged = (path: string) => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImagePath(path);\n            imageStorage.deleteImage(path);\n        }\n\n        this._opacity = 1;\n    }\n\n    private setTool(tool: Tool) {\n        if (this._currentTool == tool){\n            return;\n        }\n        \n        if (this._currentTool){\n            this._currentTool.disable();\n        }\n        this._currentTool = tool;\n        if (this._currentTool){\n            this._currentTool.enable();\n        }\n\n        this._colorPalette.setVisible(this._currentTool == this.markerTool);\n        this._sizePalette.setVisible(this._currentTool == this.markerTool || this._currentTool == this.eraserTool);\n        // this._shapePalette.setVisible(this._currentTool == this.selectionTool);\n        // this._importImageButton.classList.toggle(\"hidden\", this._currentTool != this.selectionTool);\n    }\n\n    private addEventListeners() {\n        let canvas = this.baseLayer.canvas;\n        canvas.style.pointerEvents = \"auto\";\n        //canvas.addEventListener('keydown', event => this.keyDown(event));\n        document.addEventListener('keydown', event => this.keyDown(event));\n        canvas.addEventListener('click', event => event.preventDefault());\n\n        if (config.usePointerEvents && window.PointerEvent != null){\n            // Required to prevent pointerDown events from being choked when tapping repeatedly: \n            canvas.addEventListener('touchstart', event => {\n                if (event.cancelable){\n                    event.preventDefault();\n                }\n            });\n            \n            canvas.addEventListener('pointerdown', event => this.pointerDown(event));\n            canvas.addEventListener('pointermove', event => this.pointerMove(event));\n            canvas.addEventListener('pointerup', event => this.pointerUp(event));\n            canvas.addEventListener('pointercancel', event => event.preventDefault());\n        }\n        else{\n            canvas.addEventListener('touchstart', event => this.touchStart(event));\n            canvas.addEventListener('touchmove', event => this.touchMove(event));\n            canvas.addEventListener('touchend', event => this.touchEnd(event));\n            canvas.addEventListener('touchcancel', event => event.preventDefault());\n        }\n        //canvas.addEventListener('touchforcechanged', event => this.pressureChanged(<TouchEvent>event))\n        // Pressure.set(canvas, {\n        //     change: (force: number, event: Event) => this.pressureChanged(force)\n        // })\n    }\n\n    private getPointerEventPosition(event: PointerEvent) {\n        let target = <HTMLElement>event.target;\n        let rect = target.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (event.clientX - rect.left) / rect.width;\n        let ny = (event.clientY - rect.top) / rect.height;\n        \n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height; \n\n        if (config.pixelPerfect){\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector(x, y);\n    }\n\n    private getTouchEventPosition(touch: Touch) {\n        let rect = this.baseLayer.canvas.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (touch.clientX - rect.left) / rect.width;\n        let ny = (touch.clientY - rect.top) / rect.height;\n\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n\n        if (config.pixelPerfect){\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector(x, y);\n    }\n    \n    private keyDown(event: KeyboardEvent){\n        if (!this.isVisible()){\n            return;\n        }\n        \n        switch (event.code){\n            // case 'KeyV':\n            //     if (event.metaKey){\n            //         this.setTool(this.selectionTool);\n            //         this.selectionTool.pasteFromClipboard();\n            //     }\n            //     break;\n        }\n        \n        if (!this._currentTool) {\n            return;\n        }\n        this._currentTool.keyDown(event);\n    }\n\n    pointerDown(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n\n        let target = <HTMLElement>event.target;\n        target.setPointerCapture(event.pointerId);\n        this._currentTouchId = event.pointerId;\n\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n     }\n\n    pointerMove(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    getNormalizedPointerPressure(event: PointerEvent): number {\n        return event.pointerType == \"pen\" ? Utils.clamp(0.5, 2, event.pressure * 4) : 1;\n    }\n\n    getNormalizedTouchPressure(touch: Touch): number {\n        return touch.touchType == \"stylus\" ? Utils.clamp(0.5, 2, touch.force * 4) : 1;\n    }\n\n    pointerUp(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary){\n            return;\n        }\n\n        let target = <HTMLElement>event.target;\n        target.releasePointerCapture(event.pointerId);\n\n        this.up({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: new Vector(event.width, event.height),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    \n    pressureChanged(force: number){\n        // let pressure = Utils.clamp(0.3, 1, force * 2);\n        // this._currentTool.pressure = Math.max(pressure, this._currentTool.pressure);\n        // this._currentTool.pressureChanged();\n    }\n\n    touchStart(event: TouchEvent) {\n        event.preventDefault();\n        if (this._currentTouchId !== 0){\n            return;\n        }\n        const touch = event.targetTouches[0];\n        this._currentTouchId = touch.identifier;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    touchMove(event: TouchEvent) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch == null){\n            return;\n        }\n        console.log(touch.force)\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    touchEnd(event: TouchEvent) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch != null){\n            // current touch is still in the list of target touches, this means it has not ended yet\n            return;\n        }\n        this.up({\n            timeStamp: event.timeStamp,\n            position: new Vector(0 ,0),\n            radius: new Vector(0 ,0),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n\n    private static findTouch(touches: TouchList, id: number){\n        for (let i = 0; i < touches.length; i++) {\n            if (touches[i].identifier == id){\n                return touches[i];\n            }\n        }\n        return null;\n    }\n\n    private move(data: IPointerData) {\n        if (!this._currentTool) {\n            return;\n        }\n\n        let delta = this._lastPointerData.position.distanceTo(data.position);\n\n        if (delta <= 1) {\n            return;\n        }\n        \n        this._lastPointerData = this._lastPointerData || data;\n        let timeDelta = data.timeStamp - this._lastPointerData.timeStamp;\n        const speed = delta / timeDelta;\n        data.speed = Utils.lerp(this._lastPointerData.speed, speed, 0.2);\n        this._lastPointerData = data;\n        this._currentTool.move(data);\n    }\n\n    private down(data: IPointerData) {\n        Palette.collapseAll();\n\n        if (!this._currentTool) {\n            return;\n        }\n\n        this._lastPointerData = data;\n        this._currentTool.down(data);\n    }\n\n    private up(data: IPointerData) {\n        if (!this._currentTool) {\n            return;\n        }\n\n        this._lastPointerData = data;\n        this._currentTool.up(data);\n    }\n\n    clear(recordHistoryState: boolean = false) {\n        this.baseLayer.clear();\n        if (recordHistoryState){\n            this.recordHistoryState();\n        }\n    }\n\n    fill() {\n        this.baseLayer.ctx.fillStyle = this.color;\n        this.baseLayer.ctx.fillRect(0, 0, this.width, this.height);\n        this.recordHistoryState();\n    }\n\n    private ResetHistory() {\n        this._history.clear();\n        this.recordHistoryState();\n        this.updateUndoButtons();\n    }\n\n    recordHistoryState(){\n        this._history.recordState(this.baseLayer.getData());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n\n    updateUndoButtons(){\n        this._undoButton.classList.toggle(\"disabled\", !this._history.canUndo);\n        this._redoButton.classList.toggle(\"disabled\", !this._history.canRedo);\n    }\n\n    undo() {\n        if (!this._history.canUndo){\n            return;\n        }\n        this.baseLayer.putData(this._history.undo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    \n    redo() {\n        if (!this._history.canRedo){\n            return;\n        }\n        this.baseLayer.putData(this._history.redo());\n        this.updateUndoButtons()\n        this.setDirty();\n    }\n\n    restoreCurrentHistoryState(){\n        this.baseLayer.putData(this._history.getCurrentState());\n    }\n\n    loadImage(id: string) {\n        return imageStorage.loadImage(id)\n            .then(image => {\n                this._imageId = id;\n                this.clear();\n                if (image){\n                    this.baseLayer.drawImage(image);\n                }\n                \n                this.setOverlay(\"overlay-\" + id);\n                this.ResetHistory();\n                this._isDirty = false;\n            })\n    }\n\n    private saveImage() {\n        Utils.log(\"Saving \" + this._imageId);\n        this.baseLayer.canvas.toBlob(blob => imageStorage.saveImage(this._imageId, blob as Blob));\n        this._isDirty = false;\n        this._lastSaveTimestamp = Date.now();\n    }\n\n    setDirty() {\n        this._isDirty = true;\n    }\n\n    show(){\n        super.show();\n        this._currentTouchId = 0;\n        this._autoMaskCaptured = false;\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp))\n        this._currentTool.enable();\n    }\n    \n    hide(){\n        Palette.collapseAll();\n\n        if (this._currentTool){\n            this._currentTool.disable();\n        }\n        if (this._layers){\n            // Always save when closing the paint view in case we forgot to set the dirty flag somewhere:\n            this.saveImage();\n        }\n        if (this._history){\n            this._history.clear();\n        }\n        super.hide();\n    }\n\n    private tick(timeStamp: number) {\n        if (!this.isVisible()){\n            return;\n        }\n\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp))\n\n        let delta = timeStamp - this._tickTimeStamp;\n        this._tickTimeStamp = timeStamp;\n\n        if (this._currentTool) {\n            this._currentTool.tick(delta);\n            \n            // never save while painting to avoid lags:\n            if (this._lastPointerData && this._lastPointerData.isPressed){\n                return;\n            }\n        }\n        \n        if (this._isDirty && Date.now() > this._lastSaveTimestamp + config.saveInterval){\n            this.saveImage();\n        }\n    }\n\n    captureAutoMask(position: Vector) {\n        if (!config.useAutoMask){\n            return;\n        }\n        \n        this._autoMaskCaptured = true;\n        // if (!this.overlayLayer){\n        //     return;\n        // }\n\n        if (!this._autoMaskCtx){\n            let autoMaskCanvas = document.createElement(\"canvas\");\n            autoMaskCanvas.id = \"auto-mask\";\n            autoMaskCanvas.width = this.width;\n            autoMaskCanvas.height = this.height;\n            this._autoMaskCtx = <CanvasRenderingContext2D>autoMaskCanvas.getContext(\"2d\", {alpha: true});\n        }\n\n        let imageData = this._autoMaskCtx.getImageData(0, 0, this.width, this.height);\n\n        // avoid expensive floodfill:\n        const index = (position.x + position.y * this.width) * 4 + 3;\n        // if (this._autoMaskCaptured && imageData.data[index] > 0){\n        //     return;\n        // }\n\n        Utils.log(\"capturing auto mask\");\n        Utils.floodFill(this.baseLayer.ctx, imageData.data, position, this.color);\n        Utils.dilateMask(imageData.data, this.width, this.height);\n        this._autoMaskCtx.putImageData(imageData, 0, 0);\n    }\n\n    private processOverlay(ctx: CanvasRenderingContext2D) {\n        const imageData = ctx.getImageData(0, 0, this.width, this.height);\n        const pixels = imageData.data;\n        for (let i = pixels.length - 1; i >= 0; i--) {\n            pixels[i] = pixels[i] > 64 ? 255 : 0;\n        }\n        ctx.putImageData(imageData, 0, 0);\n    }\n\n    private screenToSheet(p: Vector): Vector {\n        return new Vector(p.x / screen.width * config.width, p.y / screen.height * config.height);\n    }\n}","import {View} from \"./View\";\nimport * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nconst version = \"1.0.0\" //require('/package').version;\nvar ConsoleLogHTML = require('console-log-html');\nimport { saveAs } from 'file-saver';\nimport {server} from \"../storage/Server\";\nimport {dropboxStorage} from \"../storage/DropboxStorage\";\nimport {config} from \"../config\";\n\nexport default class SettingsView extends View {\n    \n    private _hostElement: HTMLInputElement;\n    private _userIdElement: HTMLInputElement;\n    private _connectButton: HTMLDivElement;\n    private _disconnectButton: HTMLDivElement;\n    private _syncButton: HTMLDivElement;\n    \n    constructor(id: string, onBackClicked: Function) {\n        super(id);\n        let backButton = this._element.querySelector<HTMLDivElement>(\".button.back\");\n        Utils.addClick(backButton, () => onBackClicked());\n\n        this._hostElement = this._element.querySelector<HTMLInputElement>(\"#server-url\");\n        this._hostElement.onblur = () => server.host = this._hostElement.value;\n        \n        this._userIdElement = this._element.querySelector<HTMLInputElement>(\"#user-id\");\n        this._userIdElement.onblur = () => dropboxStorage.userId = this._userIdElement.value;\n\n        this._connectButton = this._element.querySelector<HTMLDivElement>(\".button.connect\");\n        Utils.addClick(this._connectButton, () => {\n            location.href = dropboxStorage.getAuthenticationUrl();\n        });\n\n        this._disconnectButton = this._element.querySelector<HTMLDivElement>(\".button.disconnect\");\n        Utils.addClick(this._disconnectButton, () => {\n            dropboxStorage.unauthorize();\n            this.updateButtons();\n        });\n\n        this._syncButton = this._element.querySelector<HTMLDivElement>(\".button.sync\");\n        Utils.addClick(this._syncButton, async () => {\n            dropboxStorage.toggleSync();\n            this.updateButtons();\n        });\n\n        let exportButton = this._element.querySelector<HTMLDivElement>(\".button.export\");\n        Utils.addClick(exportButton, async () => {\n            const zipBlob = await imageStorage.generateBackupArchive();\n            saveAs(zipBlob, \"web-paint-backup.zip\");\n        });\n\n        let importButton = this._element.querySelector<HTMLDivElement>(\".button.import\");\n        Utils.addClick(importButton, async () => {\n            imageStorage.importBackupArchive(await Utils.upload(\".zip\"));\n            this.updateInfo();\n        });\n\n        let clearButton = this._element.querySelector<HTMLDivElement>(\".button.clear\");\n        Utils.addClick(clearButton, () => {\n            if (confirm(\"Really clear all images?\")){\n                imageStorage.clear();\n                location.reload();\n            }\n        });\n\n        if (config.useHtmlLog){\n            ConsoleLogHTML.connect(document.getElementById(\"log\"), {}, true, true, true);\n        }\n    }\n\n    private updateButtons() {\n        this._connectButton.classList.toggle('hidden', dropboxStorage.isAuthorized);\n        this._disconnectButton.classList.toggle('hidden', !dropboxStorage.isAuthorized);\n        this._syncButton.classList.toggle(\"disabled\", !dropboxStorage.isAuthorized);\n        this._syncButton.innerHTML = '<i class=\"fas fa-sync fa-fw\"></i> ' + (dropboxStorage.isSyncing ? \"Stop Sync\" : \"Start Sync\");\n    }\n\n    show(){\n        super.show();\n        this.updateInfo();\n        this.updateButtons();\n    }\n\n    private updateInfo() {\n        const info = <HTMLParagraphElement>document.getElementById(\"info\");\n        info.innerText = `Version: ${version}`;\n        imageStorage.getStorageUsed().then(amount => {\n            info.innerText += `\\rStorage used: ${Utils.formatBytes(amount, 1)}`;\n        });\n\n        this._hostElement.value = server.host;\n        this._userIdElement.value = dropboxStorage.userId;\n    }\n}\n","import * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nexport default class Thumbnail {\n    \n    private _element: HTMLDivElement;\n    private _imageUrl: string;\n    private _overlayUrl: string;\n    \n    get path() { return this._element.id; }\n    set imageUrl(src: string){\n        this._imageUrl = src;\n        this._element.style.opacity = \"1\";\n        this.updateBackgroundImages();\n    }\n    set overlayUrl(src: string){\n        this._overlayUrl = src;\n        this.updateBackgroundImages();\n    }\n\n    constructor(parent: HTMLElement, path: string, onImageSelected: Function | undefined) {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        this._element = element;\n        element.id = path;\n        element.classList.add(\"thumbnail\");\n        this._element.style.opacity = \"0\";\n        \n        // Utils.addLongClick(element, () => {\n        //     if (!this._image || !PeerToPeer.instance || !PeerToPeer.instance.loggedIn || PeerToPeer.instance.peerList.length < 2){\n        //         return;\n        //     }\n        //\n        //     Utils.imageToBlob(this._image)\n        //         .then(blob => {\n        //             const peerName = PeerToPeer.instance.peerList[1];\n        //             PeerToPeer.instance.sendData(peerName, blob);\n        //         });\n        // });\n        \n        Utils.addClick(element, () => {\n            if (onImageSelected) {\n                onImageSelected(path);\n            }\n        }, true);\n\n        imageStorage.addChangeListener((change: string, path: string) => {\n            if (path == this.path || path == imageStorage.getOverlayPath(this.path)) {\n                this.loadImage();\n            }\n        });\n        \n        parent.appendChild(element);\n        this.loadImage();\n    }\n\n    remove() {\n        this._element.remove();\n    }\n    \n    private isHidden() {\n        return (this._element.offsetParent === null)\n    }\n\n    private loadImage() {\n        imageStorage.loadImageUrl(this.path)\n            .then(url => {\n                this.imageUrl = url;\n            });\n        imageStorage.loadImageUrl(imageStorage.getOverlayPath(this.path))\n            .then(url => {\n                this.overlayUrl = url;\n            });\n    }\n\n    private updateBackgroundImages() {\n        let urls = [];\n        if (this._overlayUrl){\n            urls.push(`url(${this._overlayUrl})`);\n        }\n        if (this._imageUrl){\n            urls.push(`url(${this._imageUrl})`);\n        }\n        this._element.style.backgroundImage = urls.join(\",\");\n    }\n}","export class View {\n\n\tprotected _element: HTMLDivElement;\n\n\tconstructor(id: string) {\n\t\tthis._element = <HTMLDivElement>document.getElementById(id);\n\t\tif (!this._element){\n\t\t\tconsole.error(`Could not find element with id ${id}`);\n\t\t}\n\t\tthis.hide();\n\t}\n\n\tclear(){\n\t\twhile (this._element.hasChildNodes()) {\n\t\t\tthis._element.removeChild(<HTMLElement>this._element.firstChild);\n\t\t}\n\t}\n\n\tshow():void {\n\t\tthis._element.classList.remove(\"hidden\");\n\t}\n\n\thide():void {\n\t\tthis._element.classList.add(\"hidden\");\n\t}\n\t\n\tsetVisible(visible: boolean){\n\t\tthis._element.classList.toggle(\"hidden\", !visible);\n\t}\n\n\tisVisible(): boolean {\n\t\treturn !this._element.classList.contains(\"hidden\");\n\t}\n}\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"* {\\n  -webkit-touch-callout: none;\\n  -webkit-user-select: none;\\n  user-select: none;\\n  touch-action: none;\\n  /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n  -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody {\\n  margin: 0;\\n  width: 100%;\\n  height: 100%;\\n  position: fixed;\\n  font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px) {\\n  html,\\nbody {\\n    font-size: 28px;\\n  }\\n}\\nbody {\\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\\n  font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n  line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n  font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n  line-height: 1.5rem;\\n}\\n\\n.button {\\n  width: 1.5rem;\\n  height: 1.5rem;\\n  line-height: 1.5rem;\\n  text-align: center;\\n  font-size: 0.75rem;\\n  border-radius: 30%;\\n  cursor: pointer;\\n  background: rgba(255, 255, 255, 0.5);\\n  color: black;\\n  transition: transform 0.25s;\\n}\\n\\n.button.down {\\n  transform: scale(0.9);\\n}\\n\\n.button i {\\n  line-height: 1.5rem;\\n}\\n\\n.button .fa-stack {\\n  height: 1em;\\n  width: 1em;\\n}\\n\\n.button .fa-stack.fa-fw {\\n  width: 1.25em;\\n}\\n\\n#dropbox-button {\\n  border-radius: 3px;\\n  background-color: #007ee5;\\n  border: none;\\n  color: #fff;\\n  font-size: 16px;\\n  padding: 10px 15px;\\n  text-decoration: none;\\n  height: 24px;\\n}\\n\\n.view {\\n  display: flex;\\n  position: fixed;\\n  width: 100%;\\n  height: 100%;\\n  background: #BBB;\\n  overflow: hidden;\\n}\\n\\n.dropbox-auth {\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.view.book {\\n  flex-wrap: wrap;\\n  align-content: flex-start;\\n  justify-content: center;\\n  overflow-y: auto;\\n  -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n  touch-action: pan-y;\\n}\\n\\n.view.settings {\\n  font-size: 0.4rem;\\n  display: block;\\n  box-sizing: border-box;\\n  line-height: 1.5em;\\n  color: #444;\\n}\\n\\n.view.settings .left-panel {\\n  width: 40%;\\n  padding: 1.2rem 0.25rem;\\n  box-sizing: border-box;\\n}\\n\\n.view.settings input {\\n  font-size: 0.5rem;\\n  line-height: 1em;\\n  border: none;\\n  width: 100%;\\n  border-radius: 0.5em;\\n  box-sizing: border-box;\\n  padding: 0.5em;\\n  -webkit-user-select: initial;\\n}\\n\\n.view.settings .button {\\n  width: 1rem;\\n  height: 1rem;\\n  line-height: 1rem;\\n}\\n\\n.view.settings .button.text {\\n  width: auto;\\n  border-radius: 0.5em;\\n  padding: 0 0.5em;\\n  margin-bottom: 0.5em;\\n  text-align: left;\\n  overflow: hidden;\\n  font-size: 0.5rem;\\n  background: #58b0ff;\\n  color: white;\\n}\\n\\n.view.settings label {\\n  display: block;\\n  color: grey;\\n}\\n\\n.view.settings #log {\\n  width: 60%;\\n  background: #272727;\\n  color: #c7c7c7;\\n  overflow: scroll;\\n  -webkit-overflow-scrolling: touch;\\n  touch-action: pan-y;\\n  height: 100vh;\\n  padding: 0;\\n  font-family: monospace;\\n  font-size: 12px;\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  margin: 0;\\n  line-height: 20px;\\n}\\n\\n#log li {\\n  border-bottom: #444444 solid 1px;\\n  padding: 0 1em;\\n}\\n\\n.thumbnail {\\n  margin: 0.3rem;\\n  color: #CCC;\\n  background: white;\\n  border-radius: 0.1rem;\\n  font-size: 5.6rem;\\n  width: 1em;\\n  height: 0.75em;\\n  background-size: contain;\\n  cursor: pointer;\\n  transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n  transform: scale(0.9);\\n}\\n\\n.paint {\\n  align-items: center;\\n}\\n\\n.paint #sheet {\\n  font-size: 1px;\\n  width: 1024em;\\n  height: 768em;\\n  margin: auto;\\n  overflow: auto;\\n  position: fixed;\\n  object-fit: contain;\\n  left: 0;\\n  top: 0;\\n  bottom: 0;\\n  right: 0;\\n}\\n\\n.layer {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  background: none;\\n}\\n\\n#base-layer {\\n  background: white;\\n}\\n\\n.layer.floating {\\n  outline: 2px dashed black;\\n}\\n\\n#stamp-layer {\\n  opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n  .paint #sheet {\\n    transform: rotate(-90deg);\\n    overflow-x: hidden;\\n  }\\n}\\n.button.back {\\n  position: absolute;\\n  top: 0.25rem;\\n  left: 0.25rem;\\n  z-index: 100;\\n}\\n\\n.button.settings {\\n  position: absolute;\\n  right: 0.25rem;\\n  top: 0.25rem;\\n  z-index: 100;\\n}\\n\\n.button a {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  color: black;\\n}\\n\\n.button#stamp-button {\\n  font-size: 1.25rem;\\n  position: absolute;\\n  top: 0.25rem;\\n  right: 0.25rem;\\n  width: 2rem;\\n  height: 2rem;\\n  z-index: 100;\\n  line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n  display: flex;\\n  background: lightgray;\\n  border-radius: 0.5rem;\\n  z-index: 100;\\n  position: absolute;\\n}\\n\\n.toolbar.left {\\n  flex-direction: column;\\n  left: 0.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n  flex-direction: column;\\n  right: 0.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n  flex-direction: row;\\n  left: 50%;\\n  top: 0.25em;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n  flex-direction: row;\\n  left: 50%;\\n  bottom: 0.25em;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar .button {\\n  /*display: inline-block;*/\\n  background: transparent;\\n}\\n\\n.toolbar .spacer {\\n  width: 1.5em;\\n  height: 1.5em;\\n}\\n\\n.palette {\\n  position: relative;\\n  transition: transform 0.25s;\\n  display: inline-block;\\n  float: left;\\n  text-align: center;\\n  z-index: 100;\\n}\\n\\n.palette .option i {\\n  font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options {\\n  position: absolute;\\n  display: flex;\\n  flex-wrap: wrap;\\n  background: lightgray;\\n  border-radius: 0.5rem;\\n  padding: 0.25rem;\\n  transition: transform 0.15s;\\n  top: 2.25rem;\\n  left: 50%;\\n  transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n  width: 1em;\\n  height: 1em;\\n  line-height: 0.75em;\\n  display: inline-block;\\n  margin: 0.25em;\\n  float: left;\\n  transition: transform 0.25s;\\n  background-size: contain;\\n  background-repeat: no-repeat;\\n  background-position: center;\\n}\\n\\n.palette.button .option {\\n  width: 1.5rem;\\n  height: 1.5rem;\\n  line-height: 1.5rem;\\n  margin: 0;\\n}\\n\\n.palette .options .option {\\n  margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n  transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  font-size: 0.25rem;\\n  top: -2em;\\n  left: 50%;\\n  margin-left: -1em;\\n  border-left: 1em solid transparent;\\n  border-right: 1em solid transparent;\\n  border-bottom: 2em solid lightgray;\\n  border-top: none;\\n}\\n\\n#send-palette .options {\\n  width: auto !important;\\n}\\n\\n#send-palette .options .option {\\n  width: auto;\\n  font-size: 0.75rem;\\n  line-height: 1rem;\\n  height: 1rem;\\n}\\n\\n.toolbar.left .palette .options {\\n  left: 2.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n  top: initial;\\n  left: -2em;\\n  top: 50%;\\n  margin-top: -1em;\\n  border-top: 1em solid transparent;\\n  border-bottom: 1em solid transparent;\\n  border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options {\\n  left: initial;\\n  right: 2.25rem;\\n  top: 50%;\\n  transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n  left: initial;\\n  top: initial;\\n  right: -2em;\\n  top: 50%;\\n  margin-top: -1em;\\n  border-top: 1em solid transparent;\\n  border-bottom: 1em solid transparent;\\n  border-left: 2em solid lightgray;\\n  border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options {\\n  left: 50%;\\n  top: initial;\\n  bottom: 2.25rem;\\n  transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n  top: initial;\\n  bottom: -2em;\\n  left: 50%;\\n  margin-left: -1em;\\n  border-left: 1em solid transparent;\\n  border-right: 1em solid transparent;\\n  border-top: 2em solid lightgray;\\n  border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n  transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n  transform: translateX(-50%) scale(0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n  transform: translateY(-50%) scale(0);\\n}\\n\\n#stamp-palette.palette .options {\\n  font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px) {\\n  #stamp-palette.palette .options {\\n    font-size: 1rem;\\n  }\\n}\\n.line-width {\\n  background: black;\\n  height: 100%;\\n  margin: auto;\\n  border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n  border-radius: 40%;\\n}\\n\\n.hidden {\\n  display: none !important;\\n}\\n\\n.disabled {\\n  opacity: 0.25;\\n}\\n\\n.selected {\\n  background: #58b0ff !important;\\n  color: white;\\n}\\n\\n.bounce {\\n  animation-duration: 0.8s;\\n  animation-name: bounce;\\n  animation-iteration-count: 1;\\n  animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes bounce {\\n  0% {\\n    transform: scale(1);\\n  }\\n  30% {\\n    transform: scale(2);\\n  }\\n  100% {\\n    transform: scale(1);\\n  }\\n}\\n.shake {\\n  animation-duration: 1s;\\n  animation-name: shake;\\n  animation-iteration-count: 1;\\n  animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes shake {\\n  0% {\\n    transform: rotate(0);\\n  }\\n  15% {\\n    transform: rotate(45deg);\\n  }\\n  50% {\\n    transform: rotate(-45deg);\\n  }\\n  85% {\\n    transform: rotate(45deg);\\n  }\\n  100% {\\n    transform: rotate(0);\\n  }\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./painter.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"* {\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    user-select: none;\\n    touch-action: none; /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n    -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody{\\n    margin: 0;\\n    width: 100%;\\n    height: 100%;\\n    position: fixed;\\n    font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    html,\\n    body{\\n        font-size: 28px;\\n    }   \\n}\\n\\nbody {\\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\n.button {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    text-align: center;\\n    font-size: 0.75rem;\\n    border-radius: 30%;\\n    cursor: pointer;\\n    background: rgba(255, 255, 255, 0.5);\\n    color: black;\\n    transition: transform 0.25s;\\n}\\n\\n.button.down {\\n    transform: scale(0.9);\\n}\\n\\n.button i{\\n    line-height: 1.5rem;\\n}\\n\\n.button .fa-stack{\\n    height: 1em;\\n    width: 1em;    \\n}\\n\\n.button .fa-stack.fa-fw{\\n    width: 1.25em;    \\n}\\n\\n#dropbox-button{\\n    border-radius: 3px;\\n    background-color: #007ee5;\\n    border: none;\\n    color: #fff;\\n    font-size: 16px;\\n    padding: 10px 15px;\\n    text-decoration: none;\\n    height: 24px;\\n}\\n\\n.view {\\n    display: flex;\\n    position: fixed;\\n    width: 100%;\\n    height: 100%;\\n    background: #BBB;\\n    overflow: hidden;\\n}\\n\\n.dropbox-auth{\\n    align-items: center;\\n    justify-content: center;\\n}\\n\\n.view.book {\\n    flex-wrap: wrap;\\n    align-content: flex-start;\\n    justify-content: center;\\n    overflow-y: auto;\\n    -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n    touch-action: pan-y;\\n}\\n\\n.view.settings {\\n    font-size: .4rem;\\n    display: block;\\n    box-sizing: border-box;\\n    line-height: 1.5em;\\n    color: #444;\\n}\\n\\n.view.settings .left-panel{\\n    width: 40%;\\n    padding: 1.2rem .25rem;\\n    box-sizing: border-box;\\n}\\n\\n.view.settings input{\\n    font-size: 0.5rem;\\n    line-height: 1em;\\n    border: none;\\n    width: 100%;\\n    border-radius: 0.5em;\\n    box-sizing: border-box;\\n    padding: 0.5em;\\n    -webkit-user-select: initial;\\n}\\n\\n.view.settings .button{\\n    width: 1rem;\\n    height: 1rem;\\n    line-height: 1rem;\\n}\\n\\n.view.settings .button.text {\\n    width: auto;\\n    border-radius: .5em;\\n    padding: 0 .5em;\\n    margin-bottom: .5em;\\n    text-align: left;\\n    overflow: hidden;\\n    font-size: 0.5rem;\\n    background: #58b0ff;\\n    color: white;\\n}\\n\\n.view.settings label{\\n    display: block;\\n    color: grey;\\n}\\n\\n.view.settings #log {\\n    width: 60%;\\n    background: #272727;\\n    color: #c7c7c7;\\n    overflow: scroll;\\n    -webkit-overflow-scrolling: touch;\\n    touch-action: pan-y;\\n    height: 100vh;\\n    padding: 0;\\n    font-family: monospace;\\n    font-size: 12px;\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    margin: 0;\\n    line-height: 20px;\\n}\\n\\n#log li {\\n    border-bottom: #444444 solid 1px;\\n    padding: 0 1em;\\n}\\n\\n.thumbnail {\\n    margin: 0.3rem;\\n    color: #CCC;\\n    background: white;\\n    border-radius: 0.1rem;\\n    font-size: 5.6rem;\\n    width: 1em;\\n    height: 0.75em;\\n    background-size: contain;\\n    cursor: pointer;\\n    transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n    transform: scale(0.9);\\n}\\n\\n.paint{\\n    align-items: center;\\n}\\n\\n.paint #sheet {\\n    font-size: 1px;\\n    width: 1024em;\\n    height: 768em;\\n    margin: auto;\\n    overflow: auto;\\n    position: fixed;\\n    object-fit: contain;\\n    left: 0;\\n    top: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.layer {\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    background: none;\\n}\\n\\n#base-layer {\\n    background: white;\\n}\\n\\n.layer.floating{\\n    outline: 2px dashed black;\\n}\\n\\n#stamp-layer{\\n    opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n    .paint #sheet {\\n        transform: rotate(-90deg);\\n        overflow-x: hidden;\\n    }\\n}\\n\\n\\n.button.back {\\n    position: absolute;\\n    top: 0.25rem;\\n    left: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button.settings {\\n    position: absolute;\\n    right: 0.25rem;\\n    top: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button a{\\n    width: 100%;\\n    height: 100%;\\n    display: block;\\n    color: black;    \\n}\\n\\n.button#stamp-button{\\n    font-size: 1.25rem;\\n    position: absolute;\\n    top: 0.25rem;\\n    right: 0.25rem;\\n    width: 2rem;\\n    height: 2rem;\\n    z-index: 100;\\n    line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n    display: flex;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    z-index: 100;\\n    position: absolute;\\n}\\n\\n.toolbar.left {\\n    flex-direction: column;\\n    left: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n    flex-direction: column;\\n    right: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n    flex-direction: row;\\n    left: 50%;\\n    top: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n    flex-direction: row;\\n    left: 50%;\\n    bottom: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n\\n.toolbar .button {\\n    /*display: inline-block;*/\\n    background: transparent;\\n}\\n\\n.toolbar .spacer {\\n    width: 1.5em;\\n    height: 1.5em;\\n}\\n\\n.palette {\\n    position: relative;\\n    transition: transform 0.25s;\\n    display: inline-block;\\n    float: left;\\n    text-align: center;\\n    z-index: 100;\\n}\\n\\n.palette .option i {\\n    font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options{\\n    position: absolute;\\n    display: flex;\\n    flex-wrap: wrap;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    padding: 0.25rem;\\n    transition: transform 0.15s;\\n    top: 2.25rem;\\n    left: 50%;\\n    transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n    width: 1em;\\n    height: 1em;\\n    line-height: 0.75em;\\n    display: inline-block;\\n    margin: 0.25em;\\n    float: left;\\n    transition: transform 0.25s;\\n    background-size: contain;\\n    background-repeat: no-repeat;\\n    background-position: center;\\n}\\n.palette.button .option {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    margin: 0;\\n}\\n\\n.palette .options .option {\\n    margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n    transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n    position: absolute;\\n    width: 0;\\n    height: 0;\\n    font-size: 0.25rem;\\n    top: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-bottom: 2em solid lightgray;\\n    border-top: none;\\n}\\n\\n#send-palette .options{\\n    width: auto!important;\\n}\\n\\n#send-palette .options .option{\\n    width: auto;\\n    font-size: 0.75rem;\\n    line-height: 1rem;\\n    height: 1rem;\\n}\\n\\n.toolbar.left .palette .options{\\n    left: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n    top: initial;\\n    left: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options{\\n    left: initial;\\n    right: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n    left: initial;\\n    top: initial;\\n    right: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-left: 2em solid lightgray;\\n    border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options{\\n    left: 50%;\\n    top: initial;\\n    bottom: 2.25rem;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n    top: initial;\\n    bottom: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-top: 2em solid lightgray;\\n    border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n    transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n    transform: translateX(-50%) scale(0.0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n    transform: translateY(-50%) scale(0.0);\\n}\\n\\n#stamp-palette.palette .options{\\n    font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    #stamp-palette.palette .options{\\n        font-size: 1rem;\\n    }\\n}\\n\\n.line-width{\\n    background: black;\\n    height: 100%;\\n    margin: auto;\\n    border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n    border-radius: 40%;\\n}\\n\\n.hidden {\\n    display: none!important;\\n}\\n\\n.disabled {\\n    opacity: 0.25;\\n}\\n\\n.selected {\\n    background: #58b0ff!important;\\n    color: white;\\n}\\n\\n.bounce {\\n    animation-duration: 0.8s;\\n    animation-name: bounce;\\n    animation-iteration-count: 1;\\n    animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes bounce {\\n    0% { transform: scale(1); }\\n    30% { transform: scale(2); }\\n    100% { transform: scale(1); }\\n}\\n\\n.shake {\\n    animation-duration: 1s;\\n    animation-name: shake;\\n    animation-iteration-count: 1;\\n    animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes shake {\\n    0% { transform: rotate(0); }\\n    15% { transform: rotate(45deg); }\\n    50% { transform: rotate(-45deg); }\\n    85% { transform: rotate(45deg); }\\n    100% { transform: rotate(0); }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/resolve-url-loader/index.js!../../node_modules/sass-loader/dist/cjs.js!./painter.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","/* (ignored) */","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n// It's empty as some runtime module handles the default behavior\n__webpack_require__.x = function() {};\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t\"main\": 0\n};\n\nvar deferredModules = [\n\t[\"./src/ts/app.ts\",\"vendors-node_modules_fortawesome_fontawesome-svg-core_index_es_js-node_modules_fortawesome_fr-359767\"]\n];\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = function() {};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb_paint\"] = self[\"webpackChunkweb_paint\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = function() {};\n\t}\n\treturn result;\n}\nvar startup = __webpack_require__.x;\n__webpack_require__.x = function() {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = startup || (function() {});\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};","// run startup\n__webpack_require__.x();\n"],"sourceRoot":""}