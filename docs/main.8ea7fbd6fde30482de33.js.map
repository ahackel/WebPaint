{"version":3,"sources":["webpack://web-paint/./src/ts/views/View.ts","webpack://web-paint/./src/ts/config.ts","webpack://web-paint/./src/ts/utils/Rect.ts","webpack://web-paint/./src/ts/math/Vector.ts","webpack://web-paint/./src/ts/utils/Utils.ts","webpack://web-paint/./src/ts/storage/LocalForageAdapter.ts","webpack://web-paint/./src/ts/storage/ImageStorage.ts","webpack://web-paint/./src/ts/views/Thumbnail.ts","webpack://web-paint/./src/ts/views/BookView.ts","webpack://web-paint/./src/ts/palettes/Palette.ts","webpack://web-paint/./src/ts/palettes/ColorPalette.ts","webpack://web-paint/./src/ts/palettes/SizePalette.ts","webpack://web-paint/./src/ts/tools/Tool.ts","webpack://web-paint/./src/ts/tools/PenTool.ts","webpack://web-paint/./src/ts/palettes/ShapePalette.ts","webpack://web-paint/./src/ts/Layer.ts","webpack://web-paint/./src/ts/CanvasLayer.ts","webpack://web-paint/./src/ts/ImageLayer .ts","webpack://web-paint/./src/ts/palettes/SendPalette.ts","webpack://web-paint/./src/ts/utils/FileSync.ts","webpack://web-paint/./src/ts/storage/DropboxStorage.ts","webpack://web-paint/./src/ts/tools/SelectionTool.ts","webpack://web-paint/./src/ts/Toolbar.ts","webpack://web-paint/./src/ts/History.ts","webpack://web-paint/./src/ts/palettes/GiftPalette.ts","webpack://web-paint/./src/ts/views/PaintView.ts","webpack://web-paint/./src/ts/storage/Server.ts","webpack://web-paint/./src/ts/views/SettingsView.ts","webpack://web-paint/./src/ts/app.ts","webpack://web-paint/./src/css/painter.css","webpack://web-paint/./src/css/painter.css?effd","webpack://web-paint/webpack/bootstrap","webpack://web-paint/webpack/runtime/compat get default export","webpack://web-paint/webpack/runtime/define property getters","webpack://web-paint/webpack/runtime/global","webpack://web-paint/webpack/runtime/hasOwnProperty shorthand","webpack://web-paint/webpack/runtime/make namespace object","webpack://web-paint/webpack/runtime/jsonp chunk loading","webpack://web-paint/webpack/startup"],"names":["View","id","this","_element","document","getElementById","console","error","hide","hasChildNodes","removeChild","firstChild","classList","remove","add","visible","toggle","contains","config","Rect","x","y","width","height","Vector","v","Math","round","minX","minY","maxX","maxY","Utils","s","invScalar","sqrt","divideScalar","length","dx","dy","distanceToSq","alpha","upload","accept","Promise","resolve","input","createElement","type","onchange","files","file","click","pointerEventsSupported","window","PointerEvent","log","message","optionalParams","addClick","element","callback","scrollStartX","scrollStartY","isTracking","startTimeStamp","scrolled","supportScrolling","mouseUp","event","preventDefault","stopPropagation","call","target","touchStart","touches","touch","changedTouches","identifier","pageX","pageY","timeStamp","addEventListener","touchMove","passive","touchEnd","elementFromPoint","abs","removeEventListener","addLongClick","timer","caller","called","down","setTimeout","up","stopImmediatePropagation","clearTimeout","lerp","a","b","clamp","lower","upper","n","min","max","require","LocalForageAdapter","_imageStore","localforage","name","getItem","value","setItem","removeItem","keys","param","iterate","clear","imageStorage","hasChanges","loadFileMeta","_adapter","migrate","_urls","includes","loadImageUrl","url","img","Image","src","decode","onload","urls","loadBlob","blob","URL","createObjectURL","adapter","hash","generateContentHash","setHash","revokeObjectURL","dispatchChangeEvent","then","filter","_changeListeners","push","change","changeListener","count","zip","JSZip","fetch","r","generateAsync","zipFile","forEach","path","async","buffer","Blob","saveImage","oldId","newId","data","migrateLooseFilesIntoFolders","startsWith","renameImage","replace","amount","size","_fileMeta","substring","lastIndexOf","i","String","padStart","imageId","getFilenameFromPath","p","BLOCK_SIZE","tempBuffer","Uint8Array","ceil","tempPos","slice","arrayBuffer","buf","crypto","subtle","digest","hashBuffer","set","hashArray","Array","from","hashHex2","map","toString","join","Thumbnail","parent","onImageSelected","style","opacity","getOverlayPath","loadImage","appendChild","_imageUrl","updateBackgroundImages","_overlayUrl","offsetParent","imageUrl","overlayUrl","backgroundImage","BookView","onSettingsClicked","getElementsByClassName","updateImages","_thumbnails","getImagePath","thumbnail","Palette","options","hideWhenEmpty","_options","_optionElements","_selectedIndex","createOptions","show","collapse","_expandedPalette","updateSelectedOption","index","indexOf","selectedIndex","addSelectedOption","addOptionElements","collapseAll","isCollapsed","expand","addOptionElement","updateOptionsWidth","splice","recreateOptions","_selectedElement","offsetWidth","_optionsElement","addArrowElement","option","dataset","optionLongClicked","optionClicked","updateOptionElement","onSelectionChanged","updateSelectedOptionElement","selectedOption","ColorPalette","background","SizePalette","innerHTML","Tool","painter","buttonId","_painter","_buttonElement","color","lineWidth","brushCanvas","_bufferCtx","getContext","imageSmoothingQuality","imageSmoothingEnabled","createBufferCtx","delta","PenTool","operation","_operation","createBrushCtx","_brushCtx","captureAutoMask","position","clone","_points","getWidth","pressure","speed","_widths","_startIndex","ctx","baseLayer","fillStyle","strokeStyle","globalCompositeOperation","requestDrawPath","recordHistoryState","_drawPathRequested","drawPath","drawConnectedLines","points","widths","pointCount","lineCap","lineJoin","start","startWidth","beginPath","arc","PI","fill","lineTo","stroke","radius","drawImage","canvas","newPoints","interpolatePoints","concat","numSegments","lastWidth","maxWidthDifference","newPoint","segmentLength","end","dist","distanceTo","control","previous","tangent","subtract","normalize","multiplyScalar","pointOnQuadraticCurve","f1","f2","f3","autoMaskCtx","getBufferCtx","ShapePalette","_shapeIds","addShapes","addShape","listFolder","shapesPaths","addOption","deleteShape","stampId","removeOption","Layer","tag","_startScale","_startRotation","_position","_scale","_rotation","_lastTouchStartTime","_pointers","_index","_width","_height","pointerEvents","transform","bindEventListeners","scale","rotation","addEventListeners","removeEventListeners","setPositionAndSize","save","setTransform","rotate","translate","restore","pointerDown","onDoubleTap","setPointerCapture","pointerId","addPointerEvent","doubleTap","pointerMove","pointerUp","_pinchCenter","altKey","p1","clientToPixel","p2","pinchStart","dragStart","findIndex","move","releasePointerCapture","removePointerEvent","pointers","pinchMove","dragMove","outlineWidth","outlineOffset","bind","_localDragPosition","center","_pinchStartDist","_pinchStartRotation","atan2","distance","angleChange","position1","rect","parentElement","getBoundingClientRect","isPortraitOrientation","nx","clientX","left","ny","clientY","top","CanvasLayer","_ctx","getImageData","putImageData","image","clearRect","ImageLayer","resize","naturalWidth","naturalHeight","SendPalette","addRecipients","userId","receipients","receipient","innerText","FileSync","filesA","filesB","status","resolveConflict","_filesA","_filesB","_status","_resolveConflict","getAllFiles","syncFile","itemId","has","handleModification","delete","modified","copyTo","getHash","hashA","hashB","statusHashes","get","allFiles","Set","getAll","FileSet","load","_files","clientFileSet","_rootPath","ids","Map","content","deleteImage","serverFileSet","dbx","_dbx","_cursor","serverRootPath","clientRootPath","_serverRoot","_clientRoot","filesListFolder","recursive","res","addServerEntries","result","entries","has_more","filesListFolderContinue","cursor","endsWith","serverToClientPath","path_display","content_hash","serverPath","clientPath","contents","clientToServerPath","filesUpload","mode","filesDeleteV2","filesDownload","fileBlob","FileSyncStatus","loadEntries","_entries","pairs","dropboxStorage","_isAuthorized","_isSyncing","_lastSyncDate","SYNC_BOTH","SYNC_UPLOAD","SYNC_DOWNLOAD","init","_userId","token","getAccessTokenFromUrl","authorize","startSync","DropboxAuth","clientId","getAuthenticationUrl","location","href","sync","longPoll","stopSync","isAuthorized","syncFolder","clientFiles","setPath","serverFiles","fileSyncStatus","fileSync","syncFiles","saveEntries","getCursor","filesListFolderLongpoll","timeout","changes","backoff","parseQueryString","access_token","str","ret","Object","create","trim","split","parts","key","shift","val","undefined","decodeURIComponent","isArray","Date","now","getGiftCount","Dropbox","accessToken","authTokenRevoke","SelectionTool","selectionLayerId","_selection","Empty","_deleteButton","clearSelection","_stampButton","paintSelectionToCanvas","_saveButton","saveSelectionAsNewShape","_downloadButton","selectionLayer","toBlob","saveAs","_sendPalette","sendGift","bounce","shake","hasFloatingSelection","getLayer","_hasFloatingSelection","toggleFloatingSelectionButtons","_isInShapesPalette","setVisible","createSelectionLayer","isInShapesPalette","destroySelectionLayer","getClampedPosition","startNewSelection","requestDrawSelectionOutline","cutSelection","floating","_startPosition","setLineDash","_drawSelectionOutlineRequested","updateSelectionAndDrawOutline","code","setImage","setImageUrl","strokeRect","removeLayer","addCanvasLayer","pixels","cy","cx","selection","isEmpty","drawToCanvas","Toolbar","History","_states","canUndo","canRedo","GIFT_PATH","GiftPalette","addGifts","addGift","removeGift","paths","PaintView","onBackClicked","_history","_sheet","createButtons","createToolbar","createPalettes","createTools","_color","_shape","_opacity","_lineWidth","_autoMaskCtx","_layers","_undoButton","undo","_redoButton","redo","_importImageButton","setTool","selectionTool","layer","addLayer","overlayLayer","removeOverlay","createOverlay","penButton","markerTool","eraserButton","eraserTool","selectionButton","selectAll","_tools","addTool","tool","_mainToolbar","_contextToolbar","_sizePalette","_colorPalette","_shapePalette","shape","stamp","_giftPalette","setImagePath","_currentTool","disable","enable","keyDown","cancelable","isVisible","isPrimary","buttons","_currentTouchId","getPointerEventPosition","screenToSheet","getNormalizedPointerPressure","isPressed","pointerType","touchType","force","targetTouches","getTouchEventPosition","radiusX","radiusY","getNormalizedTouchPressure","findTouch","_lastPointerData","fillRect","updateUndoButtons","recordState","getData","setDirty","putData","getCurrentState","_imageId","setOverlay","ResetHistory","_isDirty","_lastSaveTimestamp","_autoMaskCaptured","requestAnimationFrame","tick","_tickTimeStamp","imageData","screen","scaleFactor","server","_host","localStorage","downloadDefaultAssets","uploadUserContent","createDirectory","host","fileName","postImage","getPathInfo","ok","json","info","isFile","downloadImage","directoryName","method","headers","body","ConsoleLogHTML","SettingsView","querySelector","_hostElement","onblur","_userIdElement","_connectButton","_disconnectButton","updateButtons","_syncButton","generateBackupArchive","zipBlob","importBackupArchive","updateInfo","confirm","reload","connect","isSyncing","bytes","decimals","k","dm","sizes","floor","parseFloat","pow","toFixed","library","fas","dom","App","socketInit","_settingsView","openView","_bookView","OnResize","_paintView","ontouchmove","test","navigator","platform","appVersion","match","parseInt","docWidth","documentElement","clientWidth","docHeight","clientHeight","portrait","isLargeScreen","viewWidth","viewHeight","horizontalPixelSize","verticalPixelSize","virtualPixelSize","fontSize","view","_activeView","_socket","ioclient","on","msg","emit","app","localForage","___CSS_LOADER_EXPORT___","module","__webpack_module_cache__","__webpack_require__","moduleId","exports","__webpack_modules__","m","getter","__esModule","d","definition","o","defineProperty","enumerable","g","globalThis","Function","e","obj","prop","prototype","hasOwnProperty","Symbol","toStringTag","installedChunks","179","deferredModules","checkDeferredModules","webpackJsonpCallback","parentChunkLoadingFunction","chunkId","chunkIds","moreModules","runtime","executeModules","resolves","apply","chunkLoadingGlobal","self","checkDeferredModulesImpl","deferredModule","fulfilled","j","depId","startup"],"mappings":"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","file":"main.8ea7fbd6fde30482de33.js","sourcesContent":["export class View {\n\n\tprotected _element: HTMLDivElement;\n\n\tconstructor(id: string) {\n\t\tthis._element = <HTMLDivElement>document.getElementById(id);\n\t\tif (!this._element){\n\t\t\tconsole.error(`Could not find element with id ${id}`);\n\t\t}\n\t\tthis.hide();\n\t}\n\n\tclear(){\n\t\twhile (this._element.hasChildNodes()) {\n\t\t\tthis._element.removeChild(<HTMLElement>this._element.firstChild);\n\t\t}\n\t}\n\n\tshow():void {\n\t\tthis._element.classList.remove(\"hidden\");\n\t}\n\n\thide():void {\n\t\tthis._element.classList.add(\"hidden\");\n\t}\n\t\n\tsetVisible(visible: boolean){\n\t\tthis._element.classList.toggle(\"hidden\", !visible);\n\t}\n\n\tisVisible(): boolean {\n\t\treturn !this._element.classList.contains(\"hidden\");\n\t}\n}\n","interface IImageConfig{\n    overlay: string;\n}\n\ninterface IAppConfig{\n    debug: boolean;\n    doubleTapDelay: number;\n    longClickDelay: number;\n    minScrollDistance: number;\n    maxScrollDelay: number;\n    maxShapeCount: number;\n    usePointerEvents: boolean;\n    fullScreenCanvas: boolean;\n    pixelPerfect: boolean;\n    imageSmoothing: boolean;\n    useAutoMask: boolean;\n    maxUndoSteps: number;\n    saveInterval: number;\n    width: number;\n    height: number;\n    imageCount: number;\n    useHtmlLog: boolean;\n    dropboxSyncInterval: number;\n}\n\nexport const config: IAppConfig = {\n    debug: true,\n    doubleTapDelay: 400,\n    longClickDelay: 1000,\n    minScrollDistance: 30,\n    maxScrollDelay: 500,\n    maxShapeCount: 64,\n    usePointerEvents: true,\n    fullScreenCanvas: true, // If true fills the whole screen with the canvas, if false makes sure the whole canvas fits on the screen\n    pixelPerfect: false,   // Make sure to perform painting operations on rounded pixel positions\n    imageSmoothing: true,  // Whether to use smooth pixel filtering or to draw hard pixel edges\n    useAutoMask: false,\n    maxUndoSteps: 10,\n    saveInterval: 5000,\n    width: 1024,\n    height: 768,\n    imageCount: 32,\n    useHtmlLog: true,\n    dropboxSyncInterval: 30\n};","export default class Rect {\n    public x: number;\n    public y: number;\n    public width: number;\n    public height: number;\n    \n    get minX() { return this.x; }\n    get minY() { return this.y; }\n    get maxX() { return this.x + this.width; }\n    get maxY() { return this.y + this.height; }\n\n    constructor(x: number, y: number, width: number, height: number) {\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n    }\n    \n    isEmpty(): boolean{\n        return this.width <= 0 || this.height <= 0;\n    }\n    \n    static Empty(): Rect{\n        return new Rect(0, 0, 0, 0);\n    }\n}","import * as Utils from \"../utils/Utils\";\n\nexport default class Vector {\n    public x: number;\n    public y: number;\n\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    \n    set(x = 0, y = x){\n        this.x = x;\n        this.y = y;\n        return this;\n    }\n\n    clone(): Vector{\n        return new Vector(this.x, this.y);\n    }\n\n    add(v: Vector){\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    }\n\n    subtract(v: Vector){\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    }\n\n    round(){\n        this.x = Math.round(this.x);\n        this.y = Math.round(this.y);\n        return this;\n    }\n    \n    clamp(minX: number, minY: number, maxX: number, maxY: number){\n        this.x = Utils.clamp(minX, maxX, this.x);\n        this.y = Utils.clamp(minY, maxY, this.y);\n        return this;\n    }\n\n    invert() {\n        this.x *= -1;\n        this.y *= -1;\n        return this;\n    };\n\n    multiplyScalar(s: number) {\n        this.x *= s;\n        this.y *= s;\n        return this;\n    };\n\n    divideScalar(s: number) {\n        if(s === 0) {\n            this.x = 0;\n            this.y = 0;\n        } else {\n            var invScalar = 1 / s;\n            this.x *= invScalar;\n            this.y *= invScalar;\n        }\n        return this;\n    };\n    \n    length(): number {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    } \n    \n    normalize() {\n        return this.divideScalar(this.length());\n    }\n\n    distanceToSq(v: Vector) {\n        const dx = this.x - v.x, dy = this.y - v.y;\n        return dx * dx + dy * dy;\n    }\n    \n    distanceTo(v: Vector) {\n        return Math.sqrt(this.distanceToSq(v));\n    }\n\n    lerp(v: Vector, alpha: number) {\n        this.x += (v.x - this.x) * alpha;\n        this.y += (v.y - this.y) * alpha;\n        return this;\n    };\n}","import {config} from \"../config\";\nimport Rect from \"./Rect\";\nimport Vector from \"../math/Vector\";\nconst Pressure = require('pressure');\n\n// source:\n// https://stackoverflow.com/questions/15900485/correct-way-to-convert-size-in-bytes-to-kb-mb-gb-in-javascript\nexport function formatBytes(bytes: number, decimals = 2) {\n    if (bytes === 0) return '0 Bytes';\n\n    const k = 1024;\n    const dm = decimals < 0 ? 0 : decimals;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nexport async function upload(accept: string): Promise<Blob> {\n    return new Promise(resolve => {\n        const input = document.createElement('input');\n        input.type = \"file\";\n        input.accept = accept; \n        input.onchange = () => {\n            if (input.files.length == 0){\n                return;\n            }\n            let file = input.files[0];\n            resolve(file);\n            input.remove();\n        }\n        input.click();\n    });\n}\n\nexport function imageToBlob(image: HTMLImageElement){\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"imageToCanvas\";\n    canvas.width = image.naturalWidth;\n    canvas.height = image.naturalHeight;\n    const ctx = <CanvasRenderingContext2D>canvas.getContext(\"2d\", {alpha: true});\n    ctx.drawImage(image, 0 ,0);\n    return new Promise(resolve => {\n        canvas.toBlob(blob => resolve(blob));\n    })\n}\n\nexport function pointerEventsSupported(): boolean {\n    return window.PointerEvent != null;\n}\n\nexport function log(message?: any, ...optionalParams: any[]){\n    if (!config.debug){\n        return;\n    }\n    console.log(message, optionalParams);\n}\n\n\nexport function addClick(element: HTMLElement, callback: (this: HTMLElement, event: any) => any,\n                       supportScrolling: boolean = false){\n    \n    let scrollStartX: number;\n    let scrollStartY: number;\n    let touchId: number;\n    let isTracking: boolean;\n    let startTimeStamp: number;\n    let scrolled: boolean;\n    \n    element.addEventListener(\"touchstart\", touchStart, {passive: supportScrolling});\n    element.addEventListener(\"mouseup\", mouseUp);\n    \n    function mouseUp(event: Event){\n        event.preventDefault();\n        event.stopPropagation();\n        callback.call(event.target, event);\n    }\n    \n    function touchStart(event: TouchEvent){\n        if (!supportScrolling){\n            event.preventDefault();\n        }\n        \n        if (isTracking || event.touches.length > 1){\n            return;\n        }\n        const touch = event.changedTouches[0];\n\n        isTracking = true;\n        touchId = touch.identifier;\n        scrolled = false;\n        scrollStartX = touch.pageX;\n        scrollStartY = touch.pageY;\n        startTimeStamp = event.timeStamp;\n        element.classList.add(\"down\");\n\n        element.addEventListener(\"touchmove\", touchMove, {passive: supportScrolling});\n        element.addEventListener(\"touchend\", touchEnd);\n    }\n\n    function touchMove(event: TouchEvent){\n        if (!supportScrolling){\n            event.preventDefault();\n        }\n\n        if (!isTracking){\n            return;\n        }\n        const touch = event.changedTouches[0];\n        \n        // user dragged out of the element:\n        if (document.elementFromPoint(touch.pageX,touch.pageY) != event.target){\n            isTracking = false;\n            element.classList.remove(\"down\");\n        }\n\n        if (scrolled || event.timeStamp < startTimeStamp + config.maxScrollDelay){\n            if (supportScrolling &&\n                (Math.abs(touch.pageX - scrollStartX) > config.minScrollDistance ||\n                    Math.abs(touch.pageY - scrollStartY) > config.minScrollDistance)){\n                isTracking = false;\n                element.classList.remove(\"down\");\n            }\n        }\n\n        // After tapping and holding for a while the element does not start scrolling any more.\n        // In that case we don't want perform the scroll check above any more:\n        if (event.timeStamp < startTimeStamp + config.maxScrollDelay){\n            if (Math.abs(touch.pageX - scrollStartX) > 2 ||\n                Math.abs(touch.pageY - scrollStartY) > 2){\n                scrolled = true;\n            }\n        }\n    }\n\n    function touchEnd(event: TouchEvent){\n        event.preventDefault();\n        element.removeEventListener(\"touchmove\", touchMove);\n        element.removeEventListener(\"touchend\", touchEnd);\n        element.classList.remove(\"down\");\n        \n        if (!isTracking){\n            return;\n        }\n        isTracking = false;\n        touchId = null;\n\n        callback.call(event.target, event);\n    }\n}\n\nexport function addLongClick(element: HTMLElement, callback: (this: HTMLElement, event: any) => any){\n    let timer: any;\n    let caller = this;\n    let called: boolean = false;\n\n    element.addEventListener(\"touchstart\", down,{passive: true});\n    element.addEventListener(\"touchend\", up);\n    element.addEventListener(\"mousedown\", down);\n    element.addEventListener(\"mouseup\", up);\n\n    function down(event: Event) {\n        called = false;\n        timer = setTimeout(() => {\n            callback.call(caller, event);\n            called = true;\n        }, config.longClickDelay);\n    }\n\n    function up(event: Event) {\n        if (called) {\n            event.stopImmediatePropagation();\n            element.classList.remove(\"down\");\n            called = false;\n        } else {\n            clearTimeout(timer);\n        }\n    }\n}\n\nexport function createNewImageId(): string {\n    return Date.now().toString();\n}\n\nexport function lerp(a: number, b: number, alpha: number): number{\n    return a * (1 - alpha) + b * alpha;\n}\n\nexport function clamp(lower: number, upper: number, n: number): number{\n    return Math.min(upper, Math.max(lower, n));\n}\n\nexport function lerpColor(color1: number, color2: number, alpha: number): number{\n    if (alpha == 0){\n        return color1;\n    }\n\n    if (alpha == 1){\n        return color2;\n    }\n\n    const aa = (color1 & 0xff000000) >> 24;\n    const ba = (color1 & 0x00ff0000) >> 16;\n    const ga = (color1 & 0x0000ff00) >> 8;\n    const ra = (color1 & 0x000000ff);\n\n    const ab = (color2 & 0xff000000) >> 24;\n    const bb = (color2 & 0x00ff0000) >> 16;\n    const gb = (color2 & 0x0000ff00) >> 8;\n    const rb = (color2 & 0x000000ff);\n\n    const r = Math.floor(lerp(ra, rb, alpha));\n    const g = Math.floor(lerp(ga, gb, alpha));\n    const b = Math.floor(lerp(ba, bb, alpha));\n    const a = 255; //Math.floor(Utils.lerp(aa, ab, alpha));\n\n    return r + (g << 8) + (b << 16) + 0xFF000000;\n}\n\nexport function lerpCanvas(ctxA: CanvasRenderingContext2D, ctxB: CanvasRenderingContext2D, ctxMask: CanvasRenderingContext2D) {\n    const width = ctxA.canvas.width;\n    const height = ctxA.canvas.height;\n    const dataA = ctxA.getImageData(0, 0, width, height);\n    const dataB = ctxB.getImageData(0, 0, width, height);\n    const dataMask = ctxMask.getImageData(0, 0, width, height);\n\n    const a32 = new Uint8ClampedArray(dataA.data.buffer);\n    const b32 = new Uint8ClampedArray(dataB.data.buffer);\n    const m32 = new Uint8ClampedArray(dataMask.data.buffer);\n\n    for (let i = 0; i < width * height; i++){\n        const a = m32[i * 4 + 3] / 255;\n        a32[i * 4 + 0] = (1 - a) * a32[i * 4 + 0] + a * b32[i * 4 + 0];\n        a32[i * 4 + 1] = (1 - a) * a32[i * 4 + 1] + a * b32[i * 4 + 1];\n        a32[i * 4 + 2] = (1 - a) * a32[i * 4 + 2] + a * b32[i * 4 + 2];\n        a32[i * 4 + 3] = (1 - a) * a32[i * 4 + 3] + a * b32[i * 4 + 3];\n    }\n    ctxA.putImageData(dataA, 0, 0);\n}\n\nexport function stringToColor(h: string): number {\n    let r = 0, g = 0, b = 0;\n\n    if (h.length == 4) {\n        r = parseInt(h[1] + h[1], 16);\n        g = parseInt(h[2] + h[2], 16);\n        b = parseInt(h[3] + h[3], 16);\n    } \n    else  {\n        r = parseInt(h[1] + h[2], 16);\n        g = parseInt(h[3] + h[4], 16);\n        b = parseInt(h[5] + h[6], 16);\n    }\n\n    return 0xFF000000 + r + (g << 8) + (b << 16);\n}\n\nexport function floodFill(sourceCtx: CanvasRenderingContext2D, mask: Uint8ClampedArray,  startPosition: Vector, color: string) {\n    const threshold = 0.5;\n    const width = sourceCtx.canvas.width;\n    const height = sourceCtx.canvas.height;\n    \n    const sourceData = sourceCtx.getImageData(0, 0, width, height);\n    const sourcePixels = sourceData.data;\n\n    startPosition = startPosition.clone().round();\n    const startIndex: number = startPosition.x + startPosition.y * width;\n    \n    // const startR = sourcePixels[startIndex * 4];\n    // const startG = sourcePixels[startIndex * 4 + 1];\n    // const startB = sourcePixels[startIndex * 4 + 2];\n    // const startA = sourcePixels[startIndex * 4 + 3];\n\n    const startR = parseInt(color[1] + color[2], 16);\n    const startG = parseInt(color[3] + color[4], 16);\n    const startB = parseInt(color[5] + color[6], 16);\n\n    // take into account that transparent pixels appear white (due to white bg) but their rgb value is 0:\n    // const startBrightness = startA < 5 ? 255 : 0.333 * (startR + startG + startB);\n    const startBrightness = 0.333 * (startR + startG + startB);\n    \n    // clear alpha channel:\n    for (let i = 0; i < width * height; i++) {\n        mask[i * 4 + 3] = 0;\n    }\n\n    // start at multiple positions around start position:\n    let stack: Vector[] = [];\n    stack.push(startPosition);\n    if (startPosition.x > 1){\n        stack.push(new Vector(startPosition.x - 2, startPosition.y));\n    }\n    if (startPosition.x < width - 2){\n        stack.push(new Vector(startPosition.x + 2, startPosition.y));\n    }\n    if (startPosition.y > 1){\n        stack.push(new Vector(startPosition.x, startPosition.y - 2));\n    }\n    if (startPosition.y < height - 2){\n        stack.push(new Vector(startPosition.x, startPosition.y + 2));\n    }\n\n    while (stack.length > 0)\n    {\n        let pos = stack.pop();\n\n        if (isBorderPixel(pos.x, pos.y, false)){\n            continue;\n        }\n        \n        const minX = scanLeft(pos.x, pos.y);\n        const maxX = scanRight(pos.x, pos.y);\n        addToStack(minX, maxX, pos.y - 1);\n        addToStack(minX, maxX, pos.y + 1);\n    }\n\n    function scanLeft(x: number, y: number): number\n    {\n        let minX = x;\n        while (minX >= 0)\n        {\n            if (isBorderPixel(minX, y, true)){\n                break;\n            }\n            minX -= 1;\n        }\n        return minX + 1;\n    }\n\n    function scanRight(x: number, y: number): number\n    {\n        let maxX: number = x + 1;\n        while (maxX < width)\n        {\n            if (isBorderPixel(maxX, y, true)){\n                break;\n            }\n            maxX += 1;\n        }\n        return maxX - 1;\n    }\n    \n    function addToStack(minX: number, maxX: number, y: number)\n    {\n        if (y < 0 || y >= height)\n        {\n            return;\n        }\n\n        for (let x = minX; x <= maxX; x++)\n        {\n            if (isBorderPixel(x, y, false)){\n                continue;\n            }\n            stack.push(new Vector(x, y));\n        }\n\n    }\n\n    function isBorderPixel(x: number, y: number, setValue: boolean): boolean {\n        const index = (x + y * width) * 4;\n        const indexA = index + 3;\n        if (mask[indexA]){\n            return true;\n        }\n\n        const r = sourcePixels[index];\n        const g = sourcePixels[index + 1];\n        const b = sourcePixels[index + 2];\n        const a = sourcePixels[index + 3];\n        //\n        // let difference = Math.max(\n        //     Math.abs(r - startR),\n        //     Math.abs(g - startG),\n        //     Math.abs(b - startB),\n        //     Math.abs(a - startA)\n        // ) / 255;\n        const brightness = 0.333 * (r + g + b);\n        \n        if (a < 250 || brightness >= startBrightness){\n            if (setValue){\n                mask[indexA] = 255;\n            }\n            return false;               \n        }\n        \n        // if (difference < threshold){\n        //     if (setValue){\n        //         mask[indexA] = 255;\n        //     }\n        //     return false;\n        // }\n\n        // if (setValue) {\n        //     mask[indexA] = (1 - difference) * 255;\n        // }\n        return true;\n    }\n}\n\nexport function getVisiblePixelFrame(ctx: CanvasRenderingContext2D, rect: Rect): Rect {\n    let {x, y, width, height} = rect;\n\n    if (width <= 0 || height <= 0){\n        return Rect.Empty();\n    }\n    \n    const data = ctx.getImageData(x, y, width, height);\n    const pixels = data.data;\n    \n    let minX = width;\n    let maxX = 0;\n    let minY = height;\n    let maxY = 0;\n\n    for (let cy = 0; cy < height; cy++) {\n        for (let cx = 0; cx < width; cx++) {\n            if (pixels[(cx + cy * width) * 4 + 3]){\n                minX = cx < minX ? cx : minX;\n                maxX = cx > maxX ? cx : maxX;\n                minY = cy < minY ? cy : minY;\n                maxY = cy > maxY ? cy : maxY;\n            }\n        }\n    }\n    \n    x += minX;\n    y += minY;\n    width = Math.max(0, maxX - minX + 1);\n    height = Math.max(0, maxY - minY + 1);\n    return new Rect(x, y, width, height); \n}\n\nexport function dilateMask(pixels: Uint8ClampedArray, width: number, height: number) {\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width - 1; x++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4]){\n                pixels[i] = 255;\n            }\n        }\n        for (let x = width - 1; x > 0; x--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4]){\n                pixels[i] = 255;\n            }\n        }\n    }\n    for (let x = 0; x < width; x++) {\n        for (let y = 0; y < height - 1; y++) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i + 4 * width]){\n                pixels[i] = 255;\n            }\n        }\n        for (let y = height - 1; y > 0; y--) {\n            const i = (x + y * width) * 4 + 3;\n            if (pixels[i - 4 * width]){\n                pixels[i] = 255;\n            }\n        }\n    }\n}","import localforage from 'localforage';\nimport StorageAdapter from \"./StorageAdapter\";\n\nexport default class LocalForageAdapter extends StorageAdapter{\n\n    private _imageStore = localforage.createInstance({name: \"ImageStore\"});\n\n    getItem(id: string): Promise<unknown> {\n        return this._imageStore.getItem(id);\n    }\n\n    setItem(id: string, value: unknown): Promise<unknown> {\n        return this._imageStore.setItem(id, value);\n    }\n    \n    removeItem(id: string): Promise<unknown> {\n        return this._imageStore.removeItem(id);\n    }\n\n    keys(): Promise<unknown> {\n        return this._imageStore.keys()\n    }\n\n    iterate(param: (blob: Blob, id: string, iteration: number) => void): Promise<unknown> {\n        return this._imageStore.iterate(param)\n    }\n    \n    clear() {\n        return this._imageStore.clear();\n    }\n}","import 'whatwg-fetch';\nimport LocalForageAdapter from \"./LocalForageAdapter\";\nimport StorageAdapter from \"./StorageAdapter\";\nimport JSZip from \"jszip\";\n\ninterface IFileMeta {\n\thash: string;\n}\n\ntype IFileMetaList = { [id: string]: IFileMeta };\n\nclass ImageStorage {\n\n\tprivate _adapter: StorageAdapter;\n\tprivate _changeListeners: Function[];\n\tprivate _urls: { [id: string]: string }\n\tprivate _fileMeta: IFileMetaList\n\thasChanges: boolean = false;\n\t\n\tconstructor() {\n\t\tthis.loadFileMeta();\n\t}\n\t\n\tpublic get adapter() {\n\t\tif (!this._adapter) {\n\t\t\tthis._adapter = new LocalForageAdapter();\n\t\t\tthis.migrate();\n\t\t}\n\t\treturn this._adapter \n\t}\n\t\n\tpublic get urls(){\n\t\tif (!this._urls){\n\t\t\tthis._urls = {};\n\t\t}\n\t\treturn this._urls;\n\t}\n\t\n\tasync ContainsImage(id: string){\n\t\tvar keys = <string[]> await this.keys();\n\t\treturn keys.includes(id);\n\t}\n\n\tpublic async loadImage(id: string): Promise<HTMLImageElement> {\n\t\tconst url: string = await this.loadImageUrl(id);\n\t\t\n\t\tif (!url){\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tconst img = new Image();\n\t\timg.id = id;\n\t\timg.src = url;\n\n\t\tif (img.decode != null) {\n\t\t\tawait img.decode();\n\t\t\treturn img;\n\t\t}\n\n\t\treturn new Promise(resolve => {\n\t\t\timg.onload = () => resolve(img);\n\t\t});\n\t}\n\t\n\n\tpublic async loadImageUrl(id: string): Promise<string> {\n\t\tif (id in this.urls){\n\t\t\treturn this.urls[id];\n\t\t}\n\t\t\n\t\tconst blob = await this.loadBlob(id);\n\t\tif (!blob){\n\t\t\treturn null;\n\t\t}\n\n\t\tconst url = URL.createObjectURL(blob);\n\t\tthis.urls[id] = url;\n\t\treturn url;\n\t}\n\n\tprivate loadBlob(id: string): Promise<Blob> {\n\t\treturn <Promise<Blob>>this.adapter.getItem(id)\n\t}\n\n\tpublic async saveImage(id: string, blob: Blob, hash?: string){\n\t\ttry{\n\t\t\tawait this.adapter.setItem(id, blob);\n\t\t\tawait this.setHash(id, hash ?? await this.generateContentHash(blob));\n\t\t\tthis.hasChanges = true;\n\t\t}\n\t\tcatch (e) {\n\t\t}\n\t\t\n\t\tif (id in this.urls){\n\t\t\tURL.revokeObjectURL(this.urls[id]);\n\t\t}\n\t\tthis.urls[id] = URL.createObjectURL(blob);\n\t\t\n\t\tthis.dispatchChangeEvent(\"save\", id);\n\t}\n\t\n\tpublic deleteImage(id: string){\n\t\treturn this.adapter.removeItem(id)\n\t\t\t.then(() => {\n\t\t\t\tif (id in this.urls){\n\t\t\t\t\tURL.revokeObjectURL(this.urls[id]);\n\t\t\t\t\tdelete this.urls[id];\n\t\t\t\t}\n\t\t\t\tthis.dispatchChangeEvent(\"delete\", id);\n\t\t\t})\t\t\n\t}\n\n\tasync keys(): Promise<string[]> {\n\t\tvar keys = <string[]>await this.adapter.keys();\n\t\treturn keys.filter(x => x != \"file-meta\")\n\t}\n\n\tpublic addChangeListener(callback: Function){\n\t\tthis._changeListeners = this._changeListeners || [];\n\t\tthis._changeListeners.push(callback);\n\t}\n\n\tprivate dispatchChangeEvent(change: string, id: string) {\n\t\tfor (let changeListener of this._changeListeners) {\n\t\t\tchangeListener(change, id);\n\t\t}\n\t}\n\t\n\tpublic clear(){\n\t\tthis.adapter.clear();\n\t}\n\t\n\tpublic async generateBackupArchive(): Promise<Blob> {\n\t\tlet count = 0;\n\t\tvar keys = <string[]> await this.keys();\n\t\tvar zip = new JSZip();\n\t\t\n\t\tfor (let id of keys) {\n\t\t\tconst url = await this.loadImageUrl(id);\n\t\t\tconst blob = await fetch(url).then(r => r.blob());\n\t\t\tif (!blob){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tzip.file(id, blob);\n\t\t\tcount += 1;\n\t\t}\n\t\t\n\t\tif (count == 0){\n\t\t\treturn;\n\t\t}\n\t\t\n\t\treturn zip.generateAsync({type:\"blob\"});\n\t}\n\t\n\tpublic async importBackupArchive(zipFile: Blob) {\n\t\tconst zip = await JSZip.loadAsync(zipFile);\n\t\t\n\t\tzip.forEach(async (path, file) => {\n\t\t\tconst buffer = await file.async(\"arraybuffer\");\n\t\t\tconst blob = new Blob([buffer], {\"type\": \"image/png\"});\n\t\t\tthis.saveImage(file.name, blob);\n\t\t})\n\t}\n\t\n\tprivate async renameImage(oldId: string, newId: string){\n\t\tconst data = <Blob>await this.adapter.getItem(oldId);\n\t\tif (!data){\n\t\t\treturn;\n\t\t}\n\t\tawait this.adapter.setItem(newId, data);\n\t\tawait this.adapter.removeItem(oldId);\n\t}\n\t\n\tprivate async migrate(){\n\t\tvar keys = <string[]> await this.keys();\n\n\t\tfor (let id of keys) {\n\t\t\tif (!id.includes(\"/\")) {\n\t\t\t\tawait this.migrateLooseFilesIntoFolders(id);\n\t\t\t}\n\t\t\tif (id.startsWith(\"images/\") ||\n\t\t\t\tid.startsWith(\"shapes/\")){\n\t\t\t\tawait this.renameImage(id, \"user/\" + id);\n\t\t\t}\n\t\t\tif (id.startsWith(\"overlays/\")){\n\t\t\t\tawait this.renameImage(id, \"default/\" + id);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async migrateLooseFilesIntoFolders(id: string) {\n\t\tif (id.startsWith(\"image\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"image\", \"user/images/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"shape-\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"shape-\", \"user/shapes/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"shape\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"shape\", \"user/shapes/\"));\n\t\t\treturn true;\n\t\t}\n\t\tif (id.startsWith(\"overlay-image\")) {\n\t\t\tawait this.renameImage(id, id.replace(\"overlay-image\", \"default/overlays/\"));\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic async getStorageUsed(): Promise<number> {\n\t\tlet amount = 0;\n\t\tvar keys = <string[]> await this.keys();\n\t\tfor (let id of keys) {\n\t\t\tconst url = await this.loadImageUrl(id);\n\t\t\tconst blob = await fetch(url).then(r => r.blob());\n\t\t\tif (!blob){\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tamount += blob.size;\n\t\t}\n\t\treturn amount;\n\t}\n\n\tprivate async loadFileMeta() {\n\t\tthis._fileMeta = <IFileMetaList> await this.adapter.getItem(\"file-meta\") ?? {};\n\t}\n\n\tgetFilenameFromPath(path: string): string{\n\t\treturn path.substring(path.lastIndexOf('/')+1);\n\t}\t\t\n\t\n\tgetImagePath(i: number): string {\n\t\treturn \"user/images/\" + String(i + 1).padStart(2, \"0\") + \".png\";\n\t}\n\n\tgetOverlayPath(imageId: string): string {\n\t\treturn \"default/overlays/\" + this.getFilenameFromPath(imageId);\n\t}\n\t\n\tasync listFolder(path: string): Promise<string[]> {\n\t\tconst keys = <string[]>await this.adapter.keys();\n\t\treturn keys.filter(x => x.startsWith(path + \"/\"));\n\t}\t\n\n\tasync getHash(id: string): Promise<string> {\n\t\tif (id in this._fileMeta){\n\t\t\treturn this._fileMeta[id].hash;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate async setHash(id: string, hash: string) {\n\t\tthis._fileMeta[id] = { hash: hash };\n\t\tawait this.adapter.setItem(\"file-meta\", this._fileMeta);\n\t}\n\n\tpublic async generateContentHash(blob: Blob): Promise<string> {\n\t\tconst BLOCK_SIZE = 4 * 1024 * 1024;\n\t\t\n\t\tconst tempBuffer = new Uint8Array(Math.ceil(blob.size / BLOCK_SIZE) * 32);\n\t\tlet tempPos = 0;\n\t\t\n\t\tfor (let p = 0; p < blob.size; p += BLOCK_SIZE) {\n\t\t\tconst blobChunk = blob.slice(p, p + BLOCK_SIZE);\n\t\t\tconst buf = await blob.arrayBuffer();\n\t\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', buf);\n\t\t\ttempBuffer.set(new Uint8Array(hashBuffer), tempPos);\n\t\t\ttempPos += 32;\n\t\t}\n\n\t\tconst hashBuffer = await crypto.subtle.digest('SHA-256', tempBuffer);\n\t\tconst hashArray = Array.from(new Uint8Array(hashBuffer));\n\t\tconst hashHex2 = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n\t\t\n\t\treturn hashHex2;\n\t}\n}\n\nexport const imageStorage = new ImageStorage();\n","import * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nexport default class Thumbnail {\n    \n    private _element: HTMLDivElement;\n    private _imageUrl: string;\n    private _overlayUrl: string;\n    \n    get path() { return this._element.id; }\n    set imageUrl(src: string){\n        this._imageUrl = src;\n        this._element.style.opacity = \"1\";\n        this.updateBackgroundImages();\n    }\n    set overlayUrl(src: string){\n        this._overlayUrl = src;\n        this.updateBackgroundImages();\n    }\n\n    constructor(parent: HTMLElement, path: string, onImageSelected: Function | undefined) {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        this._element = element;\n        element.id = path;\n        element.classList.add(\"thumbnail\");\n        this._element.style.opacity = \"0\";\n        \n        // Utils.addLongClick(element, () => {\n        //     if (!this._image || !PeerToPeer.instance || !PeerToPeer.instance.loggedIn || PeerToPeer.instance.peerList.length < 2){\n        //         return;\n        //     }\n        //\n        //     Utils.imageToBlob(this._image)\n        //         .then(blob => {\n        //             const peerName = PeerToPeer.instance.peerList[1];\n        //             PeerToPeer.instance.sendData(peerName, blob);\n        //         });\n        // });\n        \n        Utils.addClick(element, () => {\n            if (onImageSelected) {\n                onImageSelected(path);\n            }\n        }, true);\n\n        imageStorage.addChangeListener((change: string, path: string) => {\n            if (path == this.path || path == imageStorage.getOverlayPath(this.path)) {\n                this.loadImage();\n            }\n        });\n        \n        parent.appendChild(element);\n        this.loadImage();\n    }\n\n    remove() {\n        this._element.remove();\n    }\n    \n    private isHidden() {\n        return (this._element.offsetParent === null)\n    }\n\n    private loadImage() {\n        imageStorage.loadImageUrl(this.path)\n            .then(url => {\n                this.imageUrl = url;\n            });\n        imageStorage.loadImageUrl(imageStorage.getOverlayPath(this.path))\n            .then(url => {\n                this.overlayUrl = url;\n            });\n    }\n\n    private updateBackgroundImages() {\n        let urls = [];\n        if (this._overlayUrl){\n            urls.push(`url(${this._overlayUrl})`);\n        }\n        if (this._imageUrl){\n            urls.push(`url(${this._imageUrl})`);\n        }\n        this._element.style.backgroundImage = urls.join(\",\");\n    }\n}","import {View} from \"./View\";\nimport {config} from \"../config\";\nimport Thumbnail from \"./Thumbnail\";\nimport PeerToPeer from \"../PeerToPeer\";\nimport * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\n\nexport default class BookView extends View {\n\n    public onImageSelected: Function | undefined;\n    private _thumbnails: Thumbnail[];\n    \n    constructor(id: string, onSettingsClicked: Function) {\n        super(id);\n        let settingsButton = <HTMLDivElement>this._element.getElementsByClassName(\"button settings\")[0];\n        Utils.addClick(settingsButton, () => onSettingsClicked());\n    }\n\n    show(): void {\n        super.show();\n        this.updateImages();\n        \n        // PeerToPeer.instance.onDataReceived = (data: ArrayBuffer) => {\n        //     this._thumbnails[0].setImageSrc(URL.createObjectURL(new Blob([data])));\n        // }\n    }\n\n    private updateImages() {\n        if (this._thumbnails){\n            return;\n        }\n        \n        this._thumbnails = [];\n        \n        for (let i=0; i<config.imageCount; i++) {\n            const imageId = imageStorage.getImagePath(i);\n            let thumbnail = new Thumbnail(this._element, imageId, (id: string) => this.onImageSelected(id))\n            this._thumbnails.push(thumbnail);\n        }\n    }\n}\n","import {View} from \"../views/View\";\nimport * as Utils from \"../utils/Utils\";\n\n// base class for palettes\nexport class Palette extends View {\n    public hideWhenEmpty: boolean = true;\n    public onSelectionChanged: Function | undefined;\n    private _selectedElement: HTMLDivElement;\n    private _optionsElement: HTMLDivElement;\n    private _optionElements: HTMLDivElement[];\n    private _selectedIndex: number;\n    protected _options: any[];\n    \n    private static _expandedPalette: Palette;\n\n    get selectedIndex(){ return this._selectedIndex }\n    set selectedIndex(value){\n        this._selectedIndex = Math.max(0, Math.min(this._options.length - 1, value));\n        this.updateSelectedOption();\n    }\n    \n    get selectedOption(){ return this._options[this._selectedIndex] }\n    set selectedOption(value){\n        let index = this._options.indexOf(value);\n        if (index === -1){\n            return;\n        }\n        this.selectedIndex = index;\n    }\n    \n    get isCollapsed(){ return this._element.classList.contains(\"collapsed\") }\n\n    constructor(id: string, options: any[], rightAlign: boolean = false) {\n        super(id);\n        this._options = options;\n        this._optionElements = [];\n        this._selectedIndex = 0;\n        this.createOptions();\n        this.show();\n        this.collapse();\n    }\n    \n    static collapseAll() {\n        if (Palette._expandedPalette){\n            Palette._expandedPalette.collapse();\n        }\n    }\n    \n    private createOptions(){\n        this.addSelectedOption();\n        this.addOptionElements();\n    }\n    \n    recreateOptions(){\n        this.clear();\n        this.createOptions();\n    }\n\n    collapse() {\n        this._element.classList.add(\"collapsed\");\n        if (Palette._expandedPalette == this){\n            Palette._expandedPalette = null;\n        }\n    }\n\n    expand() {\n        Palette.collapseAll();\n        if (this._options.length == 0){\n            return;\n        }\n        this._element.classList.remove(\"collapsed\");\n        Palette._expandedPalette = this;\n    }\n\n    toggle() {\n        if (this.isCollapsed){\n            this.expand();\n        }\n        else {\n            this.collapse();\n        }\n    }\n    \n    addOption(value: any): number {\n        this._options.push(value);\n        let index = this._options.length - 1;\n        this.addOptionElement(index, value);\n        this.updateOptionsWidth();\n        this.updateSelectedOption();\n        return index;\n    }\n\n    removeOption(index: number){\n        this._options.splice(index, 1);\n        this._optionElements[index].remove();\n        this._optionElements.splice(index, 1);\n        \n        // update the index assigned to each element:\n        this.recreateOptions();\n        if (this._options.length == 0){\n            this.collapse();\n        }\n        this.updateSelectedOption();\n    }\n    \n    bounce(){\n        this._selectedElement.classList.remove(\"bounce\");\n        void this._selectedElement.offsetWidth;\n        this._selectedElement.classList.add(\"bounce\");\n    }\n\n    shake(){\n        this._selectedElement.classList.remove(\"shake\");\n        void this._selectedElement.offsetWidth;\n        this._selectedElement.classList.add(\"shake\");\n    }\n\n    private addSelectedOption() {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"option\");\n        this._selectedElement = element;\n        Utils.addClick(element, () => this.toggle());\n        this.updateSelectedOption();\n        this._element.appendChild(element);\n    }\n    \n    private addOptionElements(){\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"options\");\n        this._optionsElement = element;\n        this.addArrowElement();\n\n        let i: number = 0;\n        for (let option of this._options){\n            this.addOptionElement(i, option);\n            i ++;\n        }\n        this.updateOptionsWidth();\n        this._element.appendChild(element);\n    }\n\n    private updateOptionsWidth() {\n        this._optionsElement.style.width = Math.min(8, this._options.length) * 1.25 + \"em\";\n    }\n\n    private addArrowElement(){\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"arrow\");\n        this._optionsElement.appendChild(element);\n    }\n\n    private addOptionElement(index: number, option: any) {\n        let element = <HTMLDivElement>document.createElement(\"div\");\n        element.classList.add(\"option\");\n        element.dataset.index = `${index}`;\n        Utils.addLongClick(element, event => this.optionLongClicked(event, option, index));\n        Utils.addClick(element, event => this.optionClicked(event, option, index));\n        this.updateOptionElement(element, option);\n        this._optionsElement.appendChild(element);\n        this._optionElements[index] = element;\n    }\n    \n    protected optionClicked(event: Event, option: any, index: number){\n        this.selectedIndex = index;\n        this.collapse();\n        if (this.onSelectionChanged) {\n            this.onSelectionChanged(option, index);\n        }        \n    }\n\n    protected optionLongClicked(event: Event, option: any, index: number){\n    }\n\n    protected updateOptionElement(element: HTMLDivElement, option: any){\n    }\n\n    protected updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        this.updateOptionElement(element, option);\n    }\n    \n    protected updateSelectedOption() {\n        this.updateSelectedOptionElement(this._selectedElement, this.selectedOption);\n        if (this.hideWhenEmpty){\n            this._element.classList.toggle('hidden', this._options.length == 0);\n        }\n    }\n}","import {Palette} from \"./Palette\";\n\nexport default class ColorPalette extends Palette {\n\n    get color() { return this.selectedOption }\n    set color(value: string) { this.selectedOption = value }\n\n    constructor(id: string){\n        // 16 color Mac palette\n        // https://en.wikipedia.org/wiki/List_of_software_palettes#Apple_Macintosh_default_16-color_palette\n        // let colors: string[] = [\n        //     \"#FFFFFF\", \"#f5f60d\", \"#f5650a\", \"#d50406\",\n        //     \"#f50695\", \"#330496\", \"#0306c5\", \"#0692f0\",\n        //     \"#06a606\", \"#026405\", \"#643403\", \"#946434\",\n        //     \"#b5b5b5\", \"#848484\", \"#444444\", \"#030303\",\n        // ];\n\n        // 32 color palette\n        // https://github.com/geoffb/dawnbringer-palettes\n        let colors: string[] = [\n            \"#000000\", \"#222034\", \"#45283c\", \"#663931\",\n            \"#8f563b\", \"#df7126\", \"#d9a066\", \"#eec39a\",\n            \"#fbf236\", \"#99e550\", \"#6abe30\", \"#37946e\",\n            \"#4b692f\", \"#524b24\", \"#323c39\", \"#3f3f74\",\n            \"#306082\", \"#5b6ee1\", \"#639bff\", \"#5fcde4\",\n            \"#cbdbfc\", \"#ffffff\", \"#9badb7\", \"#847e87\",\n            \"#696a6a\", \"#595652\", \"#76428a\", \"#ac3232\",\n            \"#d95763\", \"#d77bba\", \"#8f974a\", \"#8a6f30\",\n        ];\n\n        super(id, colors);\n        this.selectedIndex = 15;\n    }\n    \n    updateOptionElement(element: HTMLDivElement, option: string) {\n        element.style.background = option;\n    }\n}","import {Palette} from \"./Palette\";\n\nexport default class SizePalette extends Palette {\n\n    get size() { return this.selectedOption }\n    set size(value: number) { this.selectedOption = value }\n\n    constructor(id: string){\n        let sizes: number[] = [2, 8, 24, 40];\n        super(id, sizes, true);\n        this.selectedIndex = 1;\n    }\n\n    updateOptionElement(element: HTMLDivElement, option: any) {\n        const width = option / 40;\n        element.innerHTML = '<div class=\"line-width\" style=\"width:' + width + 'em\"></div>';\n    }\n}","import {PaintView, IPointerData} from \"../views/PaintView\";\n\n// Base class for all tools\nexport default abstract class Tool {\n    protected _painter: PaintView;\n    \n    get color() { return this._painter.color };\n    get opacity() { return this._painter.opacity }\n    get lineWidth() { return this._painter.lineWidth };\n    \n    private static _bufferCtx: CanvasRenderingContext2D;\n    protected _buttonElement: HTMLElement; \n\n    constructor(painter: PaintView, buttonId: string) {\n        this._painter = painter;\n        this._buttonElement = document.getElementById(buttonId);\n    }\n\n    // creates a context to draw the current stroke to so we can draw the complete stroke with a different\n    // operation. The buffer can be shared by different tools.\n    private createBufferCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"buffer\";\n        brushCanvas.width = this._painter.width;\n        brushCanvas.height = this._painter.height;\n        Tool._bufferCtx = <CanvasRenderingContext2D>brushCanvas.getContext(\"2d\", {alpha: true});\n        Tool._bufferCtx.imageSmoothingQuality = \"high\";\n        Tool._bufferCtx.imageSmoothingEnabled = true;\n    }\n\n    protected getBufferCtx(){\n        if (Tool._bufferCtx == null){\n            this.createBufferCtx();\n        }\n        return Tool._bufferCtx;\n    }\n\n    enable(): void {\n        this._buttonElement.classList.add(\"selected\");\n    }\n    disable(): void {\n        this._buttonElement.classList.remove(\"selected\");\n    }\n    down(data: IPointerData): void {}\n\n    move(data: IPointerData): void {}\n    \n    up(data: IPointerData): void {}\n    \n    pressureChanged(): void {}\n    tick(delta: number): void {}\n    keyDown(event: KeyboardEvent): void {}\n}","import Tool from \"./Tool\";\nimport Vector from \"../math/Vector\";\nimport {PaintView, IPointerData} from \"../views/PaintView\";\nimport * as Utils from \"../utils/Utils\";\n\n// @ts-ignore\nimport brushPath from \"url:../../img/brush.png\";\nimport Layer from \"../Layer\";\n\n// Paints lines with varying stroke width\nexport default class PenTool extends Tool {\n\n    private _startIndex: number;\n    private _points: Vector[];\n    private _widths: number[];\n    private _drawPathRequested: boolean;\n    private _brushCtx: CanvasRenderingContext2D;\n    \n    private readonly _operation: string;\n\n    constructor(painter: PaintView, buttonId: string, operation: string = \"darken\") {\n        super(painter, buttonId);\n        this._operation = operation;\n        this.createBrushCtx();\n    }\n\n    private createBrushCtx() {\n        let brushCanvas = document.createElement(\"canvas\");\n        brushCanvas.id = \"brush\";\n        brushCanvas.width = 64;\n        brushCanvas.height = 64;\n        this._brushCtx = <CanvasRenderingContext2D>brushCanvas.getContext(\"2d\", {alpha: true});\n        this._brushCtx.imageSmoothingQuality = \"high\";\n        this._brushCtx.imageSmoothingEnabled = true;\n    }\n\n    down(data: IPointerData): void {\n        this._painter.captureAutoMask(data.position.clone().round());\n        \n        this._points = [data.position];\n        const width = this.getWidth(data.pressure, data.speed);\n        this._widths = [width];\n        this._startIndex = 0;\n\n        let ctx = this._painter.baseLayer.ctx;\n        ctx.fillStyle = this.color;\n        ctx.strokeStyle = this.color;\n\n\n        // let ctx = this._brushCtx;\n        // let brushWidth = ctx.canvas.width;\n        // ctx.clearRect(0, 0, brushWidth, brushWidth);\n        // ctx.fillStyle = this.color;\n        // let radius = brushWidth * 0.5;\n        // ctx.beginPath();\n        // ctx.arc(radius, radius, radius - 1, 0, 2 * Math.PI);\n        // ctx.fill();  \n        this._painter.baseLayer.ctx.globalCompositeOperation = this._operation;\n\n        this.requestDrawPath();\n    }\n    \n    up(): void{\n        this._painter.recordHistoryState();\n    }\n    \n    tick(delta: number) {\n        if (this._drawPathRequested){\n            this.drawPath();\n            this._drawPathRequested = false;\n        }\n    }\n\n    requestDrawPath(){\n        this._drawPathRequested = true;\n    }\n\n    drawPath(){\n        if (this._points.length == 0) {\n            return;\n        }\n\n        let ctx = this._painter.baseLayer.ctx;\n        this.drawConnectedLines(ctx, this._points.slice(this._startIndex), this._widths.slice(this._startIndex));\n        \n        // if (this._points.length - this._startIndex == 1){\n        //     const p = this._points[this._startIndex];\n        //     this.drawBrush(ctx, p.x, p.y, this._widths[this._startIndex]);\n        //     return;\n        // }\n        //\n        // for (let i = this._startIndex; i < this._points.length - 1; i++) {\n        //     const p1 = this._points[i];\n        //     const p2 = this._points[i+1];\n        //    \n        //     const w1 = this._widths[i];\n        //     const w2 = this._widths[i+1];\n        //\n        //     const dist = Vector.distance(p1, p2);\n        //     const step = Math.max(1, 0.125 * Math.min(w1, w2, 64));\n        //     for (let d = 0; d <= dist; d += step){\n        //         const a = d / dist;\n        //         const p = Vector.lerp(p1, p2, a);\n        //         const w = Utils.lerp(w1, w2, a);\n        //         this.drawBrush(ctx, p.x, p.y, w);\n        //     }\n        // }\n        this._startIndex = Math.max(0, this._points.length - 1);\n    }\n    \n    drawConnectedLines(ctx: CanvasRenderingContext2D, points: Vector[], widths: number[]){\n        const pointCount = points.length;\n        if (pointCount == 0){\n            return;\n        }\n        \n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        let start = points[0];\n        let startWidth = widths[0] * this.lineWidth;\n\n        if (pointCount == 1){\n            // single dot\n            ctx.beginPath();\n            ctx.arc(start.x, start.y, 0.5 * startWidth, 0, 2 * Math.PI);\n            ctx.fill();\n        }\n\n        for (let i = 1; i < pointCount; i++) {\n            ctx.beginPath();\n            ctx.lineWidth = widths[i] * this.lineWidth;\n            ctx.lineTo(points[i-1].x, points[i-1].y);\n            ctx.lineTo(points[i].x, points[i].y);\n            ctx.stroke();\n        }\n    }\n    \n    \n    drawBrush(ctx: CanvasRenderingContext2D, x: number, y: number, width: number){\n        let radius = width * 0.5;\n        x -= radius;\n        y -= radius;\n        // x = Math.floor(x - radius);\n        // y = Math.floor(y - radius);\n        // width = Math.ceil(width);\n        ctx.drawImage(this._brushCtx.canvas, x, y, width, width);\n    }\n\n    move(data: IPointerData): void {\n        let newPoints = this.interpolatePoints(data.position);\n\n        this._points = this._points.concat(newPoints);\n        const numSegments = newPoints.length;\n\n        let width = this.getWidth(data.pressure, data.speed);\n        const lastWidth = this._widths[this._widths.length - 1];\n        const maxWidthDifferencePerSegment = 2;\n        const maxWidthDifference = maxWidthDifferencePerSegment * numSegments;\n        width = Utils.clamp(lastWidth - maxWidthDifference, lastWidth + maxWidthDifference, width);\n\n        for (let i = 0; i < numSegments; i++) {\n            this._widths.push(Utils.lerp(lastWidth, width, i / numSegments));\n        }\n\n        this.requestDrawPath();\n    }\n\n    private interpolatePoints(newPoint: Vector): Vector[] {\n        const segmentLength = Math.max(4, 0.1 * this.lineWidth);\n        const points: Vector[] = [];\n        \n        if (this._points.length == 0){\n            return;\n        }\n        \n        const start = this._points[this._points.length - 1];\n        const end = newPoint;\n        const dist = start.distanceTo(end);\n\n        if (dist < segmentLength){\n            return points;\n        }\n\n        let control = start;\n        if (this._points.length > 1){\n            const previous = this._points[this._points.length - 2];\n            const tangent = start.clone().subtract(previous).normalize();\n            control = start.clone().add(tangent.clone().multiplyScalar(0.3 * dist));\n        }\n        \n        const a = segmentLength / dist;\n        for (let i = a; i <= 1; i += a) {\n            const Vector = this.pointOnQuadraticCurve(start, control, end, i);\n            points.push(Vector);\n        }\n        return points;\n    }\n\n    private pointOnQuadraticCurve(start : Vector, control: Vector, end: Vector, a: number): Vector {\n        const f1 = (1 - a) * (1 - a);\n        const f2 = 2 * a * (1 - a);\n        const f3 = a * a;\n        \n        return new Vector(\n            start.x * f1 + control.x * f2 + end.x * f3,\n            start.y * f1 + control.y * f2 + end.y * f3);\n    }\n\n    pressureChanged(){\n        this.requestDrawPath();\n    }\n\n    getWidth(pressure: number, speed: number){\n        speed = Utils.clamp(1, 2, speed);\n        return pressure / speed; // range: 0.5 - 1\n    }\n\n    private applyAutoMask() {\n        if (!this._painter.autoMaskCtx){\n            return;\n        }\n        \n        let ctx = this.getBufferCtx();\n        ctx.globalCompositeOperation = \"destination-in\";\n        ctx.drawImage(this._painter.autoMaskCtx.canvas, 0, 0);\n        ctx.globalCompositeOperation = \"source-over\";\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nexport default class ShapePalette extends Palette {\n\n    private _shapeIds: { [id : string] : string };\n    \n    get stamp() { return this.selectedOption }\n    \n    constructor(id: string) {\n        super(id, [], true);\n        this._shapeIds = {};\n        this.selectedIndex = 0;\n        this.addShapes();\n\n        imageStorage.addChangeListener((change: string, id: string) => {\n            if (change == \"save\" && id.startsWith(\"user/shapes/\")) {\n                this.addShape(id);\n            }\n        });\n    }\n\n    private async addShapes() {\n        const shapesPaths = await imageStorage.listFolder(\"user/shapes\");\n        for (let path of shapesPaths) {\n            await this.addShape(path);\n        }\n    }\n\n    private async addShape(path: string) {\n        const url = await imageStorage.loadImageUrl(path);\n        this._shapeIds[url] = path;\n        this.addOption(url);\n    }\n\n    protected optionLongClicked(event: TouchEvent, option: any, index: number) {\n        this.deleteShape(index);\n    }\n\n    updateOptionElement(element: HTMLDivElement, option: string) {\n        element.style.backgroundImage = `url(\"${option}\")`;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-shapes\"></i>';\n    }\n\n    private deleteShape(index: number) {\n        let option = this._options[index];\n        let stampId = this._shapeIds[option];\n        if (!stampId){\n            return;\n        }\n        imageStorage.deleteImage(stampId)\n            .then(() => {\n                delete this._shapeIds[option];\n                this.removeOption(index);\n                if (this.selectedIndex == index){\n                    // select the following item that now has the same index\n                    this.selectedIndex = index;\n                }\n            })\n    }\n}","import {config} from \"./config\";\nimport * as Utils from \"./utils/Utils\";\nimport Vector from \"./math/Vector\";\nimport ILayer from \"./ILayer\";\n\ninterface IPointer {\n    clientX: number,\n    clientY: number\n}\n\ninterface IPointerList {\n    readonly length: number;\n    [index: number]: IPointer;\n}\n\nexport default abstract class Layer<T extends HTMLImageElement | HTMLCanvasElement> implements ILayer {\n\n    public onDoubleTap: Function | undefined;\n    \n    protected _element: T;\n    private _index: number;\n    private _pinchCenter: Vector;\n    private _localDragPosition: Vector;\n    private _pinchStartDist: number;\n    private _pinchStartRotation: number;\n    private _startScale: number = 1;\n    private _startRotation: number = 0;\n    private _position: Vector = new Vector(0, 0);\n    private _scale: number = 1;\n    private _rotation: number = 0;\n    private _lastTouchStartTime: number = 0;\n    private _pointers: PointerEvent[] = [];\n    private _width: number;\n    private _height: number;\n    \n    get id(): string { return this._element.id; }\n    get index(): number { return this._index; }\n    set index(v: number) {\n        this._index = v;\n        this.transform(this.position, this.scale, this.rotation);\n    }\n    get width(): number { return this._width; };\n    get height(): number { return this._height; };\n    get position() { return this._position; }\n    get rotation() { return this._rotation; }\n    get scale() { return this._scale; }\n    get floating(): boolean { return this._element.classList.contains(\"floating\"); }\n    \n    set floating(value: boolean) { \n        this._element.classList.toggle(\"floating\", value);\n        this._element.style.pointerEvents = value ? \"auto\" : \"none\";\n        if (value){\n            this.addEventListeners();\n        }\n        else {\n            this.removeEventListeners();\n        }\n    }\n\n    constructor(parent: HTMLElement, tag: string, id: string, x: number, y: number, width: number, height: number) {\n        this._element = <T>document.createElement(tag);\n        this._element.id = id;\n        this._element.classList.add(\"layer\");\n        this._index = 0;\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this._element.style.pointerEvents = \"none\";\n            \n        parent.appendChild(this._element);\n        this.transform(new Vector(x, y), 1, 0);\n        this.bindEventListeners();\n    }\n    \n    remove() {\n        this._element.remove();\n    }\n\n    resize(width: number, height: number) {\n        const x = this.position.x + 0.5 * (this.width - width);\n        const y = this.position.y + 0.5 * (this.height - height);\n\n        this.setPositionAndSize(x, y, width, height);\n    }\n\n    setPositionAndSize(x: number, y: number, width: number, height: number) {\n        this._width = width;\n        this._height = height;\n        this._element.width = width;\n        this._element.height = height;\n        this._element.style.width = `${width}em`;\n        this._element.style.height = `${height}em`;\n        this.transform(new Vector(x, y), this.scale, this.rotation);\n    }\n\n    drawToCanvas(ctx: CanvasRenderingContext2D) {\n        ctx.save();\n        let x = this._position.x + 0.5 * this.width;\n        let y = this._position.y + 0.5 * this.height;\n        ctx.setTransform(this._scale, 0, 0, this._scale, x, y);\n        ctx.rotate(this._rotation);\n        ctx.translate(-0.5 * this.width, -0.5 * this.height);\n        ctx.drawImage(this._element, 0, 0);\n        ctx.restore();\n    }\n\n    private addEventListeners() {\n        // pinch gesture handling inspired by https://codepen.io/hanseklund/pen/izloq\n        \n        this._element.addEventListener('click', this.preventDefault);\n\n        if (Utils.pointerEventsSupported()){\n            this._element.addEventListener('touchstart', this.preventDefault);\n            this._element.addEventListener('pointerdown', this.pointerDown);\n        }\n        else{\n            this._element.addEventListener('touchstart', this.touchStart);\n        }\n    }\n    \n    private removeEventListeners() {\n        this._element.removeEventListener('click', this.preventDefault);\n\n        if (Utils.pointerEventsSupported()){\n            this._element.removeEventListener('touchstart', this.preventDefault);\n            this._element.removeEventListener('pointerdown', this.pointerDown);\n        }\n        else{\n            this._element.removeEventListener('touchstart', this.touchStart);\n        }\n    }\n    \n    private preventDefault(event: Event) {\n        event.preventDefault();\n    }\n    \n    private doubleTap(event: TouchEvent | PointerEvent) {\n        if (this.onDoubleTap){\n            this.onDoubleTap(event);\n        }\n    }\n    \n    private pointerDown(event: PointerEvent){\n        event.preventDefault();\n        this._element.setPointerCapture(event.pointerId);\n        this.addPointerEvent(event);\n\n        if (this._pointers.length === 1){\n            if (event.timeStamp < this._lastTouchStartTime + config.doubleTapDelay){\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n\n            this._element.addEventListener(\"pointermove\", this.pointerMove);\n            this._element.addEventListener(\"pointerup\", this.pointerUp);\n\n            this._pinchCenter = new Vector(\n                this._position.x + 0.5 * this.width,\n                this._position.y + 0.5 * this.height);\n\n            if (event.altKey){\n                let p1 = this.clientToPixel(this._pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else{\n                this.dragStart(this.clientToPixel(this._pointers[0]));\n            }\n        }\n        \n        if (this._pointers.length === 2 ){\n            this.pinchStart(this.clientToPixel(this._pointers[0]), this.clientToPixel(this._pointers[1]));\n        }  \n    }\n\n    private addPointerEvent(event: PointerEvent) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index < 0) {\n            this._pointers.push(event);\n        } else {\n            this._pointers[index] = event;\n        }\n    }\n\n    private removePointerEvent(event: PointerEvent) {\n        const index = this._pointers.findIndex(x => x.pointerId == event.pointerId);\n        if (index >= 0) {\n            this._pointers.splice(index, 1);\n        }\n    }\n\n    private pointerMove(event: PointerEvent) {\n        event.preventDefault();\n        this.addPointerEvent(event);\n        this.move(this._pointers, event.altKey);\n    }\n\n    private pointerUp(event: PointerEvent) {\n        event.preventDefault();\n        this._element.releasePointerCapture(event.pointerId);\n        this.removePointerEvent(event);\n\n        if (this._pointers.length == 1) {\n            this.dragStart(this.clientToPixel(this._pointers[0]));\n        }\n\n        if (this._pointers.length == 0){\n            this._element.removeEventListener(\"pointermove\", this.pointerMove);\n            this._element.removeEventListener(\"pointerup\", this.pointerUp);\n        }\n    }\n\n    private touchStart(event: TouchEvent) {\n        event.preventDefault();\n\n        if (event.touches.length === 1){\n            if (event.timeStamp < this._lastTouchStartTime + config.doubleTapDelay){\n                this.doubleTap(event);\n            }\n            this._lastTouchStartTime = event.timeStamp;\n            \n            this._element.addEventListener('touchmove', this.touchMove);\n            this._element.addEventListener('touchend', this.touchEnd);\n\n            this._pinchCenter = new Vector(\n                this._position.x + 0.5 * this.width,\n                this._position.y + 0.5 * this.height);\n\n            if (event.altKey){\n                let p1 = this.clientToPixel(event.touches[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchStart(p1, p2);\n            }\n            else{\n                this.dragStart(this.clientToPixel(event.touches[0]));\n            }\n        }\n        \n        if (event.touches.length === 2){\n            this.pinchStart(this.clientToPixel(event.touches[0]), this.clientToPixel(event.touches[1]));\n        }\n    }\n\n    private touchMove(event: TouchEvent) {\n        event.preventDefault();\n        this.move(event.touches, event.altKey);\n    }\n\n    private move(pointers: IPointerList, altKey: boolean) {\n        if (pointers.length === 1) {\n            if (altKey) {\n                let p1 = this.clientToPixel(pointers[0]);\n                let p2 = this._pinchCenter.clone().multiplyScalar(2).subtract(p1);\n                this.pinchMove(p1, p2);\n            } else {\n                this.dragMove(this.clientToPixel(pointers[0]));\n            }\n        }\n        if (pointers.length === 2) {\n            this.pinchMove(this.clientToPixel(pointers[0]), this.clientToPixel(pointers[1]));\n        }\n    }\n\n    private touchEnd (event: TouchEvent) {\n        event.preventDefault();\n        this._element.removeEventListener('touchmove', this.touchMove);\n        this._element.addEventListener('touchend', this.touchEnd);\n    }\n\n    transform(position: Vector, scale: number, rotation: number) {\n        this._position = position;\n        this._rotation = rotation;\n        this._scale = scale;\n        const index = this._index;\n        this._element.style.transform = `translate(${position.x}em, ${position.y}em) rotate(${rotation}rad) scale(${scale}) translateZ(${index}px)`;\n        this._element.style.outlineWidth = `${2 / scale}em`;\n        this._element.style.outlineOffset = `-${2 / scale}em`;\n    }\n\n    private bindEventListeners() {\n        \n        // TODO: Find a better way. This is ugly:\n        this.touchStart = this.touchStart.bind(this);\n        this.touchMove = this.touchMove.bind(this);\n        this.touchEnd = this.touchEnd.bind(this);\n\n        this.pointerDown = this.pointerDown.bind(this);\n        this.pointerMove = this.pointerMove.bind(this);\n        this.pointerUp = this.pointerUp.bind(this);\n    }\n\n    private dragStart(position: Vector) {\n        this._localDragPosition = position.clone().subtract(this.position);\n    }\n\n    private dragMove(position: Vector) {\n        position.subtract(this._localDragPosition);\n        this.transform(position, this._scale, this._rotation);\n    }\n\n    private pinchStart(p1: Vector, p2: Vector) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        this._pinchStartDist = p1.distanceTo(p2);\n        this._pinchStartRotation = Math.atan2(p1.y - center.y, p1.x - center.x);\n        this._startRotation = this._rotation;\n        this._startScale = this._scale;       \n    }\n\n    private pinchMove(p1: Vector, p2: Vector) {\n        let center = p1.clone().add(p2).multiplyScalar(0.5);\n        let distance = p1.distanceTo(p2);\n        let angle = Math.atan2(p1.y - center.y, p1.x - center.x);\n        let angleChange = angle - this._pinchStartRotation;\n\n        let scale = this._startScale * (distance / this._pinchStartDist);\n        scale = Utils.clamp(0.1, 10, scale);\n        let position = p1.clone().add(p2).multiplyScalar(0.5);\n        position.x -= 0.5 * this.width;\n        position.y -= 0.5 * this.height;\n\n        let rotation = this._startRotation + angleChange;\n        this.transform(position, scale, rotation);\n    }\n\n    private clientToPixel(position1: IPointer){\n        let parent = this._element.parentElement;\n        let rect = parent.getBoundingClientRect();\n\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (position1.clientX - rect.left) / rect.width;\n        let ny = (position1.clientY - rect.top) / rect.height;\n\n        let x = (isPortraitOrientation ? 1 - ny : nx) * config.width;\n        let y = (isPortraitOrientation ? nx : ny) * config.height;\n\n        return new Vector(x, y);\n    }\n}","import {config} from \"./config\";\nimport Layer from \"./Layer\";\nimport Rect from \"./utils/Rect\";\n\nexport default class CanvasLayer extends Layer<HTMLCanvasElement> {\n\n    protected _ctx: CanvasRenderingContext2D;\n    \n    get canvas() { return this._element; }\n    get ctx() { return this._ctx; }\n\n    constructor(parent: HTMLElement, id: string, x: number, y: number, width: number, height: number) {\n        super(parent, \"canvas\", id, x, y, width, height);\n        this._ctx = <CanvasRenderingContext2D>this.canvas.getContext(\"2d\", {alpha: true});\n        this._ctx.imageSmoothingQuality = \"high\";\n        this._ctx.imageSmoothingEnabled = config.imageSmoothing;\n    }\n    \n    getData(): ImageData {\n        return this._ctx.getImageData(0, 0, this.width, this.height);\n    }\n\n    putData(data: ImageData) {\n        this._ctx.putImageData(data, 0, 0);\n    }\n    \n    drawImage(image: HTMLImageElement | HTMLCanvasElement, rect?: Rect){\n        const {x, y, width, height} = rect || {x:0, y:0, width:this.width, height:this.height};\n        this._ctx.drawImage(image, x, y, width, height);\n    }\n    \n    clear(rect?: Rect){\n        const {x, y, width, height} = rect || {x:0, y:0, width:this.width, height:this.height};\n        this._ctx.clearRect(x, y, width, height);\n    }\n}","import Layer from \"./Layer\";\n\nexport default class ImageLayer extends Layer<HTMLImageElement> {\n\n    get image(): HTMLImageElement { return this._element; }\n\n    constructor(parent: HTMLElement, id: string, x: number, y: number, width: number, height: number) {\n        super(parent, \"img\", id, x, y, width, height);\n        this._element.onload = () => {\n            // if this.image.completed\n            this.resize(this.image.naturalWidth, this.image.naturalHeight);\n        }\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport localforage from \"localforage\";\n\nexport default class SendPalette extends Palette {\n\n    constructor(id: string) {\n        super(id, [], true);\n        this.hideWhenEmpty = false;\n        this.selectedIndex = 0;\n        this.addRecipients();\n    }\n\n    private async addRecipients() {\n        const userId = await localforage.getItem<string>(\"user-id\") ?? \"\";\n        const receipients = [\"Andreas\", \"Juri\", \"Jutta\", \"Lila\"].filter(x => x != userId);\n\n        for (let receipient of receipients) {\n            this.addOption(receipient);\n        }\n    }\n\n    async updateOptionElement(element: HTMLDivElement, receipient: string) {\n        element.innerText = receipient;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-paper-plane\"></i>';\n        element.classList.toggle('hidden', this._options.length == 0);\n    }\n}","export interface IFileSet {\n    has(itemId: string): boolean;\n    delete(itemId: string): Promise<void>;\n    copyTo(itemId: string, filesB: IFileSet): Promise<void>;\n    getHash(itemId: string): string;\n    getAll(): IterableIterator<string>;\n}\n\nexport interface IFileStatusEntry {\n    hashA: string;\n    hashB: string;\n}\n\nexport interface IFileSyncStatus {\n    has(itemId: string): boolean;\n    delete(itemId: string): Promise<void>;\n    set(itemId: string, hashA: string, hashB: string): Promise<void>;\n    get(itemId: string): IFileStatusEntry;\n    getAll(): IterableIterator<string>;\n}\n\nexport interface ISyncConflictResolver {\n    (itemId: string): Promise<void>;\n}\n\n// inspiration: https://unterwaditzer.net/2016/sync-algorithm.html\nexport class FileSync{\n    private readonly _filesA: IFileSet;\n    private readonly _filesB: IFileSet;\n    private readonly _status: IFileSyncStatus;\n    private readonly _resolveConflict: ISyncConflictResolver;\n    modified: boolean;\n    \n    constructor(filesA: IFileSet, filesB: IFileSet, status: IFileSyncStatus, resolveConflict: ISyncConflictResolver){\n        this._filesA = filesA;\n        this._filesB = filesB;\n        this._status = status;\n        this._resolveConflict = resolveConflict;\n    }\n\n    async syncFiles(): Promise<void>{\n        let changed: boolean = false;\n        const files = this.getAllFiles();\n        for (let file of files) {\n            await this.syncFile(file)\n        }\n    }\n\n    private async syncFile(itemId: string): Promise<void>{\n        const filesA = this._filesA;\n        const filesB = this._filesB;\n        const status = this._status;\n\n        if (status.has(itemId)){\n            if (filesA.has(itemId)){\n                if (filesB.has(itemId)){\n                    // check modification\n                    await this.handleModification(itemId);\n                }\n                else {\n                    // file has been deleted from B\n                    await filesA.delete(itemId);\n                    await status.delete(itemId);\n                    this.modified = true;\n                }\n            }\n            else\n            {\n                if (filesB.has(itemId)){\n                    // file has been deleted from A\n                    await filesB.delete(itemId);\n                    await status.delete(itemId);\n                    this.modified = true;\n                }\n                else {\n                    // neither on A nor B\n                    await status.delete(itemId);\n                }\n            }\n        }\n        else\n            // not on status\n        {\n            if (filesA.has(itemId)){\n                if (filesB.has(itemId)) {\n                    // is on A and B but not on status. We cannot compare the hashes so we need to\n                    console.log(\"not on status: \", itemId)\n\n                    await this._resolveConflict(itemId);\n                    this.modified = true;\n                }\n                else {\n                    // only on A\n                    console.log(\"only on A\")\n                    await filesA.copyTo(itemId, filesB);\n                    await status.set(itemId, filesA.getHash(itemId), filesA.getHash(itemId));\n                    this.modified = true;\n                }\n            }\n            else\n            {\n                if (filesB.has(itemId)){\n                    console.log(\"only on B\")\n                    // only on B\n                    await filesB.copyTo(itemId, filesA);\n                    await status.set(itemId, filesB.getHash(itemId), filesB.getHash(itemId));\n                    this.modified = true;\n                }\n                // else it's on none\n            }\n        }\n    }\n    \n    private async handleModification(itemId: string) {\n        const filesA = this._filesA;\n        const filesB = this._filesB;\n        const status = this._status;\n\n        const hashA = filesA.getHash(itemId);\n        const hashB = filesB.getHash(itemId);\n        const statusHashes = status.get(itemId);\n        \n        // console.log(\"handleModification \", itemId)\n        // console.log(\"hashA \", hashA)\n        // console.log(\"hashB \", hashB)\n\n        // nothing changed\n        if (hashA == statusHashes.hashA && hashB == statusHashes.hashB) {\n            return;\n        }\n\n        // changed on A but not on B\n        if (hashA != statusHashes.hashA && hashB == statusHashes.hashB) {\n            console.log(\"changed on A but not on B\", hashA, statusHashes.hashA)\n            await filesA.copyTo(itemId, filesB);\n            await status.set(itemId, filesA.getHash(itemId), filesA.getHash(itemId));\n            this.modified = true;\n        }\n        // changed on B but not on A\n        else if (hashA == statusHashes.hashA && hashB != statusHashes.hashB) {\n            console.log(\"changed on B but not on A\", hashB, statusHashes.hashB)\n            await filesB.copyTo(itemId, filesA);\n            await status.set(itemId, filesB.getHash(itemId), filesB.getHash(itemId));\n            this.modified = true;\n        }\n        // changed on both\n        else if (hashA != statusHashes.hashA && hashB != statusHashes.hashB) {\n            await this._resolveConflict(itemId);\n            this.modified = true;\n        }\n    }\n\n    private getAllFiles(): string[] {\n        const allFiles = new Set(this._status.getAll());\n        const filesA = this._filesA.getAll();\n        const filesB = this._filesB.getAll();\n\n        for (let file of filesA) {\n            allFiles.add(file);\n        }\n        for (let file of filesB) {\n            allFiles.add(file);\n        }\n        return Array.from(allFiles);\n    }\n}","import {Dropbox, DropboxAuth, DropboxResponse, files} from \"dropbox\";\nimport localforage from \"localforage\";\nimport {imageStorage} from \"./ImageStorage\";\nimport {config} from \"../config\";\nimport {FileSync, IFileSet, IFileStatusEntry, IFileSyncStatus} from \"../utils/FileSync\";\nimport ILayer from \"../ILayer\";\n\nconst CLIENT_ID = 'dyfw7wk3nb2utzo';\n\n\ninterface IFile {\n    hash: string\n}\n\nabstract class FileSet implements IFileSet {\n    protected _files: Map<string, IFile>;\n    \n    async copyTo(itemId: string, filesB: IFileSet): Promise<void>{\n        await (<FileSet>filesB).add(itemId, await this.load(itemId), this.getHash(itemId));\n    }\n\n    abstract load(id: string): Promise<Blob>;\n    \n    abstract add(id: string, content: Blob, hash: string): Promise<void>;\n\n    abstract delete(id: string): Promise<void>;\n\n    getHash(id: string): string {\n        return this._files.get(id)?.hash;\n    }\n\n    has(id: string): boolean {\n        return this._files.has(id);\n    }\n\n    getAll(): IterableIterator<string>{\n        return this._files.keys();\n    }\n}\n\nclass clientFileSet extends FileSet {\n    private _rootPath: string;\n\n    async setPath(path: string){\n        this._rootPath = path;\n        const ids = await imageStorage.listFolder(path);\n        this._files = new Map<string, IFile>();\n        for (let id of ids) {\n            this._files.set(id, {hash: await imageStorage.getHash(id)});\n        }\n    }\n    \n    async add(id: string, content: Blob, hash: string): Promise<void> {\n        console.log(\"save \" + id);\n        await imageStorage.saveImage(id, content, hash);\n    }\n\n    async delete(id: string): Promise<void> {\n        console.log(\"delete \" + id);\n        await imageStorage.deleteImage(id);\n    }\n\n    async load(id: string): Promise<Blob> {\n        const url = await imageStorage.loadImageUrl(id);\n        return fetch(url).then(r => r.blob());\n    }\n}\n\nclass serverFileSet extends FileSet {\n    private _dbx: Dropbox;\n    private _serverRoot: string;\n    private _clientRoot: string;\n    private _cursor: string;\n    \n    constructor(dbx: Dropbox) {\n        super();\n        this._dbx = dbx;\n    }\n    \n    getCursor(){\n        return this._cursor;\n    }\n    \n    async setPath(serverRootPath: string, clientRootPath: string){\n        this._serverRoot = \"/\" + serverRootPath;\n        this._clientRoot = clientRootPath;\n        this._files = new Map<string, IFile>();\n\n        let res = await this._dbx.filesListFolder({\n            path: this._serverRoot,\n            recursive: true,\n        });\n        this.addServerEntries(<files.FileMetadataReference[]><unknown>res.result.entries);\n\n        while (res.result.has_more){\n            console.log(\"more\")\n            res = await this._dbx.filesListFolderContinue({\n                cursor: res.result.cursor\n            });\n            this.addServerEntries(<files.FileMetadataReference[]><unknown>res.result.entries);\n        }\n        \n        this._cursor = res.result.cursor;\n    }\n\n    private addServerEntries(entries: files.FileMetadataReference[]) {\n        const serverFiles: files.FileMetadataReference[] = entries\n            .filter(x => x.name.endsWith(\".png\") && x[\".tag\"] == \"file\");\n\n        for (let file of serverFiles) {\n            const itemId = this.serverToClientPath(file.path_display);\n            this._files.set(itemId, {hash: file.content_hash});\n        }\n    }\n    \n    private serverToClientPath(serverPath: string){\n        return serverPath.replace(this._serverRoot, this._clientRoot);\n    }\n\n    private clientToServerPath(clientPath: string){\n        return clientPath.replace(this._clientRoot, this._serverRoot);\n    }\n\n    async add(itemId: string, contents: Blob, hash: string): Promise<void> {\n        console.log(\"upload \" + itemId);\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"upload \" + itemId + \" > \" + serverPath);\n        await this._dbx.filesUpload({path: serverPath, contents: contents, mode: { \".tag\": \"overwrite\" }})\n    }\n    \n    async delete(itemId: string): Promise<void> {\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"delete \" + serverPath + \" from dropbox\");\n        await this._dbx.filesDeleteV2({path: serverPath});\n    }\n\n    async load(itemId: string): Promise<Blob> {\n        const serverPath = this.clientToServerPath(itemId);\n        console.log(\"download \" + serverPath + \" > \" + itemId);\n        const res = await this._dbx.filesDownload({path: serverPath});\n        if (res.status == 200) {\n            // @ts-ignore\n            return res.result.fileBlob;\n        }\n    }\n}\n\nclass FileSyncStatus implements IFileSyncStatus{\n    private _entries: Map<string, IFileStatusEntry>;\n    private _rootPath: string;\n    \n    async setPath(path: string){\n        this._rootPath = path;\n        await this.loadEntries();\n    }\n\n    async set(itemId: string, hashA: string, hashB: string): Promise<void> {\n        this._entries.set(itemId, {hashA: hashA, hashB: hashB});\n    }\n\n    async delete(itemId: string): Promise<void> {\n        this._entries.delete(itemId);\n    }\n\n    get(itemId: string): IFileStatusEntry {\n        return this._entries.get(itemId);\n    }\n\n    has(itemId: string): boolean {\n        return this._entries.has(itemId);\n    }\n\n    private async loadEntries() {\n        const pairs: [string, IFileStatusEntry][] = await localforage.getItem(\"file-sync-status-\" + this._rootPath) ?? [];\n        this._entries = new Map(pairs);\n    }\n\n    public async saveEntries() {\n        const pairs = [...this._entries];\n        await localforage.setItem(\"file-sync-status-\" + this._rootPath, pairs);\n    }\n\n    getAll(): IterableIterator<string> {\n        return this._entries.keys();\n    }\n}\n\nclass DropboxStorage {\n    \n    private _isAuthorized: boolean = false;\n    private _dbx: Dropbox;\n    private _userId: string;\n    private _isSyncing: boolean = false;\n    private _lastSyncDate: number = 0;\n    \n    SYNC_BOTH = 0;\n    SYNC_UPLOAD = 1;\n    SYNC_DOWNLOAD = 2;\n\n    get isAuthorized(): boolean {\n        return this._isAuthorized;\n    }\n    \n    get isSyncing(): boolean{\n        return this._isSyncing;\n    }\n    \n    get dbx(): Dropbox {\n        return this._dbx;\n    }\n\n    get userId(): string{\n        return this._userId;\n    }\n    \n    set userId(value: string){\n        this._userId = value;\n        localforage.setItem(\"user-id\", value);\n    }\n    \n    get lastSyncDate(): number{\n        return this._lastSyncDate;\n    }\n\n    set lastSyncDate(value: number){\n        this._lastSyncDate = value;\n        localforage.setItem(\"last-dropbox-sync\", value);\n    }\n    \n    constructor() {\n        this.init();\n    }\n\n    private async init() {\n        this._userId = await localforage.getItem<string>(\"user-id\") ?? \"\";\n        this._lastSyncDate = await localforage.getItem<number>(\"last-dropbox-sync\") ?? 0;\n        \n        let token = this.getAccessTokenFromUrl();\n        if (!token) {\n            token = await localforage.getItem<string>('dropbox-token')\n            if (!token) {\n                return;\n            }\n        }\n        this.authorize(token);\n        this.startSync();\n    }\n\n    getAuthenticationUrl(): string{\n        const auth = new DropboxAuth({ clientId: CLIENT_ID });\n        return auth.getAuthenticationUrl(location.href);\n    }\n    \n    async startSync(){\n        if (this._isSyncing){\n            return;\n        }\n\n        console.log(\"Starting Dropbox Sync.\");\n        this._isSyncing = true;\n        const cursor = await this.sync();\n        this.longPoll(cursor);\n    }\n    \n    stopSync(){\n        this._isSyncing = false;\n        console.log(\"Stopping Dropbox Sync.\");\n    }\n    \n    toggleSync(){\n        if (this._isSyncing){\n            this.stopSync();\n        } else {\n            this.startSync();\n        }\n    }\n\n    async sync(): Promise<string>{\n        if (!this.isAuthorized || !this.userId){\n            return;\n        }\n\n        await this.syncFolder(\"default\", \"default\");\n        const cursor = await this.syncFolder(this.userId, \"user\");\n        \n        return cursor;\n    }\n    \n    async syncFolder(serverPath: string, clientPath: string): Promise<string> {\n        console.log(\"Sync \" + serverPath + \" (Server) <-> \" + clientPath + \" (Client)\");\n        try{\n            const clientFiles = new clientFileSet();\n            await clientFiles.setPath(clientPath);\n            const serverFiles = new serverFileSet(this.dbx);\n            await serverFiles.setPath(serverPath, clientPath);\n            const fileSyncStatus = new FileSyncStatus();\n            await fileSyncStatus.setPath(clientPath);\n            \n            const fileSync = new FileSync(clientFiles, serverFiles, fileSyncStatus, async id => {\n                // in doubt keep the files of the client:\n                await clientFiles.copyTo(id, serverFiles);\n                await fileSyncStatus.set(id, clientFiles.getHash(id), clientFiles.getHash(id));\n            });\n            await fileSync.syncFiles();\n            await fileSyncStatus.saveEntries();\n            \n            let cursor = serverFiles.getCursor();\n            // if (fileSync.modified){\n            //     // refresh cursor because we don't want to get updates from dropbox about the files we just posted:\n            //     const res = await this.dbx.filesListFolderGetLatestCursor({path: \"/\" + path, recursive: true});\n            //     cursor = res.result.cursor;\n            // }\n            return cursor;\n        }\n        catch (error){\n            console.log(error);\n        }\n        return null;\n    }\n\n    private async longPoll(cursor: string) {\n        if (!this._isSyncing){\n            return;\n        }\n        \n        if (!cursor){\n            this.stopSync();\n            return;\n        }\n\n        console.log(\"Polling.\");\n        const res = await this.dbx.filesListFolderLongpoll({cursor: cursor, timeout: config.dropboxSyncInterval});\n\n        if (!this._isSyncing){\n            return;\n        }\n        \n        if (res.result.changes || imageStorage.hasChanges) {\n            cursor = await this.sync();\n            imageStorage.hasChanges = false;\n        }\n        const timeout = res.result.backoff ?? config.dropboxSyncInterval;\n        setTimeout(() => this.longPoll(cursor), timeout);\n    }\n    \n    private getAccessTokenFromUrl() {\n        return this.parseQueryString(window.location.hash).access_token;\n    }\n\n    private parseQueryString(str: string) {\n        const ret = Object.create(null);\n    \n        if (typeof str !== 'string') {\n            return ret;\n        }\n    \n        str = str.trim().replace(/^(\\?|#|&)/, '');\n    \n        if (!str) {\n            return ret;\n        }\n    \n        str.split('&').forEach((param) => {\n            const parts = param.replace(/\\+/g, ' ').split('=');\n            // Firefox (pre 40) decodes `%3D` to `=`\n            // https://github.com/sindresorhus/query-string/pull/37\n            let key = parts.shift();\n            let val = parts.length > 0 ? parts.join('=') : undefined;\n    \n            key = decodeURIComponent(key);\n    \n            // missing `=` should be `null`:\n            // http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters\n            val = val === undefined ? null : decodeURIComponent(val);\n    \n            if (ret[key] === undefined) {\n                ret[key] = val;\n            } else if (Array.isArray(ret[key])) {\n                ret[key].push(val);\n            } else {\n                ret[key] = [ret[key], val];\n            }\n        });\n    \n        return ret;\n    }\n    \n    async getGiftCount(receipient: string): Promise<number>{\n        try {\n            const res = await this._dbx.filesListFolder({path: \"/\" + receipient + \"/gifts\"});\n            return res.result.entries.length;\n        }\n        catch {\n            return 0;\n        }\n    }\n\n    async sendGift(blob: Blob, receipient: string): Promise<boolean> {\n        const id = Date.now().toString() + \".png\";\n        const path = \"/\" + receipient + \"/gifts/\" + id;\n\n        if (await this.getGiftCount(receipient) >= 10){\n            console.log(\"Cannot send gift to \" + path + \". Limit reached.\");\n            return false;\n        }\n        \n        console.log(\"Sending gift to \" + path);\n        try{\n            await this._dbx.filesUpload({path: path, contents: blob, mode: { \".tag\": \"overwrite\" }})\n            return true;\n        }\n        catch{\n            return false;\n        }\n    }\n\n    private authorize(token: string) {\n        this._isAuthorized = !!token;\n\n        if (this.isAuthorized){\n            this._dbx = new Dropbox({ accessToken: token });\n            localforage.setItem('dropbox-token', token);\n        }\n    }\n\n    unauthorize() {\n        if (!this.isAuthorized) {\n            return;\n        }\n        this.dbx.authTokenRevoke()\n            .then(() => {\n                this._isAuthorized = false;\n                localforage.removeItem('dropbox-token');\n            });\n    }\n}\n\nexport const dropboxStorage = new DropboxStorage();","import Tool from \"./Tool\";\nimport Vector from \"../math/Vector\";\nimport CanvasLayer from \"../CanvasLayer\";\nimport Rect from \"../utils/Rect\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport * as Utils from \"../utils/Utils\";\nimport {PaintView, IPointerData} from \"../views/PaintView\";\nimport {config} from \"../config\";\nimport {saveAs} from \"file-saver\";\nimport SendPalette from \"../palettes/SendPalette\";\nimport { dropboxStorage } from \"../storage/DropboxStorage\";\n\n// Provides a floating selection the user can manipulate \nexport default class SelectionTool extends Tool {\n    readonly selectionLayerId = \"selection-layer\";\n\n    get selectionLayer(): CanvasLayer { return <CanvasLayer>this._painter.getLayer(this.selectionLayerId) }\n    get selection(): Rect { return this._selection; }\n    get hasFloatingSelection(): boolean { return this._hasFloatingSelection; }\n    set hasFloatingSelection(value: boolean) { \n        this._hasFloatingSelection = value;\n        this.toggleFloatingSelectionButtons(value);\n    }\n    get isInShapesPalette(): boolean { return this._isInShapesPalette; }\n    set isInShapesPalette(value: boolean) { \n        this._isInShapesPalette = value;\n        this._saveButton.classList.toggle(\"disabled\", value);\n    }\n    \n    protected _position: Vector;\n    protected _startPosition: Vector;\n    protected _selection: Rect = Rect.Empty();\n    private _hasFloatingSelection: boolean;\n    private _drawSelectionOutlineRequested: boolean;\n    private _isInShapesPalette: boolean;\n    private _deleteButton: HTMLDivElement;\n    private _stampButton: HTMLDivElement;\n    private _saveButton: HTMLDivElement;\n    private _downloadButton: HTMLDivElement;\n    private _sendPalette: SendPalette;\n\n    constructor(painter: PaintView, buttonId: string) {\n        super(painter, buttonId);\n        this._deleteButton = <HTMLDivElement>document.getElementById(\"selection-delete-button\");\n        Utils.addClick(this._deleteButton, () => this.clearSelection());\n        this._stampButton = <HTMLDivElement>document.getElementById(\"selection-stamp-button\");\n        Utils.addClick(this._stampButton, () => this.paintSelectionToCanvas());\n        this._saveButton = <HTMLDivElement>document.getElementById(\"selection-save-button\");\n        Utils.addClick(this._saveButton, () => this.saveSelectionAsNewShape());\n        this._downloadButton = <HTMLDivElement>document.getElementById(\"selection-download-button\");\n        Utils.addClick(this._downloadButton, () => {\n            this.selectionLayer.canvas.toBlob(blob => saveAs(blob, \"image.png\"));\n        });\n        \n        this._sendPalette = new SendPalette(\"send-palette\");\n        this._sendPalette.onSelectionChanged = (receipient: string) => {\n            this.selectionLayer.canvas.toBlob(async blob => {\n                if (await dropboxStorage.sendGift(blob, receipient)){\n                    this._sendPalette.bounce();\n                } else {\n                    this._sendPalette.shake();\n                }\n            });\n        }\n        \n        this.hasFloatingSelection = false;\n        this._position = new Vector(0, 0);\n    }\n    \n    toggleFloatingSelectionButtons(visible: boolean){\n        this._deleteButton.classList.toggle(\"hidden\", !visible);\n        this._stampButton.classList.toggle(\"hidden\", !visible);\n        this._downloadButton.classList.toggle(\"hidden\", !visible);\n        this._saveButton.classList.toggle(\"hidden\", !visible);\n        this._sendPalette.setVisible(visible);\n    }\n\n    enable() {\n        super.enable();\n        this.createSelectionLayer();\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n    }\n\n    disable() {\n        super.disable();\n        this.paintSelectionToCanvas();\n        this.destroySelectionLayer();\n        this.hasFloatingSelection = false;\n    }\n    \n    down(data: IPointerData) {\n        this._position = this.getClampedPosition(data);\n        this.startNewSelection();\n    }\n\n    move(data: IPointerData): void {\n        this._position = this.getClampedPosition(data);\n        this.requestDrawSelectionOutline();\n    }\n\n    up(data: IPointerData): void {\n        this.cutSelection();\n    }\n\n    private startNewSelection() {\n        this.paintSelectionToCanvas();\n        this.selectionLayer.setPositionAndSize(0, 0, this._painter.width, this._painter.height);\n        this.selectionLayer.transform(new Vector(0, 0), 1, 0);\n        this.selectionLayer.floating = false;\n\n        this.hasFloatingSelection = false;\n        this.isInShapesPalette = false;\n        this._startPosition = this._position;\n        \n        let ctx = this.selectionLayer.ctx;\n        ctx.setTransform(1, 0, 0, 1, 0, 0);\n        ctx.strokeStyle = \"black\";\n        ctx.lineCap = \"round\";\n        ctx.lineJoin = \"round\";\n        ctx.lineWidth = 2;\n        ctx.setLineDash([5, 5]);\n        this.requestDrawSelectionOutline();\n    }\n\n    private getClampedPosition(data: IPointerData) {\n        return data.position.round().clamp(0, 0, this._painter.width - 1, this._painter.height - 1);\n    }\n\n    tick(delta: number) {\n        if (this._drawSelectionOutlineRequested) {\n            this.updateSelectionAndDrawOutline();\n            this._drawSelectionOutlineRequested = false;\n        }\n    }\n    \n    keyDown(event: KeyboardEvent) {\n        switch (event.code){\n            case 'Backspace':\n                this.clearSelection();\n                break;\n            // case 'KeyC':\n            //     if (event.metaKey){\n            //         this.copyToClipboard();\n            //     }\n            //     break;\n        }\n    }\n\n    private clearSelection() {\n        this.selectionLayer.clear();\n        this.startNewSelection();\n    }\n\n    setImage(image: HTMLImageElement){\n        this.hasFloatingSelection = true;\n        this.selectionLayer.resize(image.width, image.height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.drawImage(image);\n        this.isInShapesPalette = true;\n    }\n\n    async setImageUrl(url: string): Promise<HTMLImageElement>{\n        const img = new Image();\n        img.src = url;\n        return new Promise(resolve => {\n            img.onload = () => {\n                this.setImage(img);\n                resolve(img);\n            }\n        });\n    }\n\n    async setImagePath(path: string): Promise<HTMLImageElement>{\n        const url = await imageStorage.loadImageUrl(path);\n        return this.setImageUrl(url);\n    }\n\n    private requestDrawSelectionOutline() {\n        this._drawSelectionOutlineRequested = true;\n    }\n\n    private updateSelectionAndDrawOutline() {\n        if (this.hasFloatingSelection){\n            return;\n        }\n        this.selectionLayer.clear();\n        let ctx = this.selectionLayer.ctx;\n\n        const x = Math.min(this._startPosition.x, this._position.x);\n        const y = Math.min(this._startPosition.y, this._position.y);\n        const width = Math.abs(this._startPosition.x - this._position.x);\n        const height = Math.abs(this._startPosition.y - this._position.y);\n        this._selection = new Rect(x, y, width, height);\n\n        ctx.strokeRect(x, y, width, height);\n    }\n    \n    private destroySelectionLayer() {\n        this._painter.removeLayer(this.selectionLayer);\n    }\n\n    private createSelectionLayer() {\n        if (this.selectionLayer){\n            return;\n        }\n\n        this._painter.addCanvasLayer(this.selectionLayerId, 0, 0, this._painter.width, this._painter.height, false);\n        this.selectionLayer.onDoubleTap = (event: TouchEvent) => {\n            if (event.altKey){\n                this.saveSelectionAsNewShape();\n                return;\n            }\n            this.paintSelectionToCanvas();\n        }\n    }\n    \n    private cutSelection() {\n        this.selectionLayer.clear();\n        this._selection = Utils.getVisiblePixelFrame(this._painter.baseLayer.ctx, this.selection);\n        \n        if (this.selection.isEmpty()){\n            return;\n        }\n\n        this.hasFloatingSelection = true;\n        const {x, y, width, height} = this.selection;\n        \n        this.selectionLayer.setPositionAndSize(x, y, width, height);\n        this.selectionLayer.floating = true;\n        this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas, x, y, width, height, 0, 0, width, height);\n        this._painter.baseLayer.clear(this.selection);\n        this._painter.recordHistoryState();\n    }\n\n    private paintSelectionToCanvas() {\n        if (!this.hasFloatingSelection){\n            return;\n        }\n        this._painter.baseLayer.ctx.globalCompositeOperation = \"source-over\";\n        this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx);\n        this._painter.recordHistoryState();\n    }\n\n    private async saveSelectionAsNewShape() {\n        const shapes = await imageStorage.listFolder(\"user/shapes\");\n        if (shapes.length >= config.maxShapeCount){\n            console.log(\"Cannot save selection as shape because there are already too many in storage.\");\n            return;\n        }\n        \n        const path = `user/shapes/${Date.now()}.png`;\n        console.log(`Saving selection as: ${path}`);\n        this.selectionLayer.canvas.toBlob(blob => imageStorage.saveImage(path, blob as Blob));\n        this.isInShapesPalette = true;\n    }\n\n    // copyToClipboard(){\n    //     this.selectionLayer.canvas.toBlob(blob => navigator.clipboard.write([new ClipboardItem({'image/png': blob})]));\n    //     console.log(\"copied selection to clipboard\");\n    // }\n    //\n    // pasteFromClipboard() {\n    //     navigator.permissions.query({name: \"clipboard-read\"})\n    //         .then(result => {\n    //             if (!(result.state == \"granted\" || result.state == \"prompt\")) {\n    //                 return;\n    //             }\n    //             navigator.clipboard.read()\n    //                 .then(data => {\n    //                     for (let i = 0; i < data.length; i++) {\n    //                         if (!data[i].types.includes(\"image/png\")){\n    //                             continue;\n    //                         }\n    //                         data[i].getType(\"image/png\")\n    //                             .then(blob => {\n    //                                 this.setImageUrl(URL.createObjectURL(blob));\n    //                             })\n    //                     }\n    //                 });\n    //         });\n    // }\n\n    selectAll() {\n        this.startNewSelection();\n        this._selection = new Rect(0, 0, this._painter.width, this._painter.height);\n        this.cutSelection();\n    }\n}\n","import {View} from \"./views/View\";\n\nexport class Toolbar extends View {\n    constructor(id: string) {\n        super(id);\n        this.show();\n    }\n    \n    flip(){\n        if (this._element.classList.contains(\"left\") || this._element.classList.contains(\"right\")){\n            this._element.classList.toggle(\"left\");\n            this._element.classList.toggle(\"right\");\n        }\n        if (this._element.classList.contains(\"top\") || this._element.classList.contains(\"bottom\")){\n            this._element.classList.toggle(\"top\");\n            this._element.classList.toggle(\"bottom\");\n        }\n    }\n}","import {config} from \"./config\";\n\nexport class History {\n    \n    private _states: ImageData[] = [];\n    private _position: number = -1; \n    \n    get canUndo() { return this._position > 0 }\n    get canRedo() { return this._position < this._states.length - 1 }\n    \n    recordState(data: ImageData){\n        if (this._position == config.maxUndoSteps - 1){\n            this._states.shift();\n            this._position--;\n        }\n\n        // remove all future steps\n        this._states.splice(this._position + 1, this._states.length - this._position + 1);\n\n        this._position++;\n        this._states[this._position] = data;\n    }\n\n    undo(): ImageData{\n        if (!this.canUndo){\n            return null;\n        }\n\n        this._position--;\n        return this._states[this._position];\n    }\n\n    redo(): ImageData{\n        if (!this.canRedo){\n            return null;\n        }\n\n        this._position++;\n        return this._states[this._position];\n    }\n    \n    getCurrentState(): ImageData{\n        return this._position > -1 && this._position < this._states.length ? this._states[this._position] : null;\n    }\n\n    clear(){\n        this._states = [];\n        this._position = -1;\n    }\n}","import {Palette} from \"./Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\n\nconst GIFT_PATH = \"user/gifts\";\n\nexport default class GiftPalette extends Palette {\n    \n    constructor(id: string) {\n        super(id, [], true);\n        this.selectedIndex = 0;\n        this.addGifts();\n\n        imageStorage.addChangeListener((change: string, id: string) => {\n            if (id.startsWith(GIFT_PATH)){\n                if (change == \"save\") {\n                    this.addGift(id);\n                    this.bounce();\n                }\n                else if (change == \"delete\") {\n                    this.removeGift(id);\n                }\n            }\n        });\n    }\n\n    private async addGifts() {\n        const paths = await imageStorage.listFolder(GIFT_PATH);\n        for (let path of paths) {\n            await this.addGift(path);\n        }\n    }\n\n    private async addGift(path: string) {\n        this.addOption(path);\n    }\n\n    private removeGift(path: string) {\n        let index = this._options.indexOf(path);\n        if (index < 0){\n            return;\n        }\n        \n        this.removeOption(index);\n        if (this.selectedIndex == index){\n            // select the following item that now has the same index\n            this.selectedIndex = index;\n        }\n    }\n    \n    protected optionLongClicked(event: TouchEvent, option: any, index: number) {\n        imageStorage.deleteImage(this._options[index]);\n    }\n\n    async updateOptionElement(element: HTMLDivElement, path: string) {\n        const url = await imageStorage.loadImageUrl(path);\n        element.style.backgroundImage = `url(\"${url}\")`;\n    }\n\n    updateSelectedOptionElement(element: HTMLDivElement, option: any) {\n        element.innerHTML = '<i class=\"fas fa-gift\"></i>';\n    }\n}","import {View} from \"./View\";\nimport Tool from \"../tools/Tool\";\nimport ColorPalette from \"../palettes/ColorPalette\";\nimport ToolPalette from \"../palettes/ToolPalette\";\nimport SizePalette from \"../palettes/SizePalette\";\nimport * as Utils from \"../utils/Utils\";\nimport PenTool from \"../tools/PenTool\";\nimport PaintBucketTool from \"../tools/PaintBucketTool\";\nimport Vector from \"../math/Vector\";\nimport {Palette} from \"../palettes/Palette\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nimport {config} from \"../config\";\nimport RectangleTool from \"../tools/RectangleTool\";\nimport LineTool from \"../tools/LineTool\";\nimport ShapePalette from \"../palettes/ShapePalette\";\nimport Layer from \"../Layer\";\nimport ILayer from \"../ILayer\";\nimport CanvasLayer from \"../CanvasLayer\";\nimport ImageLayer from \"../ImageLayer \";\nimport SelectionTool from \"../tools/SelectionTool\";\nimport {Toolbar} from \"../Toolbar\";\nimport {History} from \"../History\";\nimport GiftPalette from \"../palettes/GiftPalette\";\nimport SendPalette from \"../palettes/SendPalette\";\n\n// var Pressure = require('pressure');\nexport interface IPointerData {\n    timeStamp: number;\n    position: Vector;\n    radius: Vector;\n    pressure: number;\n    speed: number;\n    isPressed: boolean;\n}\n\nexport class PaintView extends View {\n    public readonly scaleFactor = 1;\n    public readonly width: number;\n    public readonly height: number;\n\n    public brushTool: Tool;\n    public markerTool: Tool;\n    public eraserTool: Tool;\n    public selectionTool: SelectionTool;\n    public paintBucketTool: Tool;\n\n    private _currentTool: Tool;\n    private _imageId: string;\n    private _color: string;\n    private _opacity: number;\n    private _lineWidth: number;\n    private _autoMaskCtx: CanvasRenderingContext2D;\n    private _mainToolbar: Toolbar;\n    private _contextToolbar: Toolbar;\n    private _colorPalette: ColorPalette;\n    private _sizePalette: SizePalette;\n    private _shapePalette: ShapePalette;\n    private _giftPalette: GiftPalette;\n    private _tools: Tool[];\n    private _currentTouchId: number = 0;\n    private _history: History;\n    private _undoButton: HTMLDivElement;\n    private _redoButton: HTMLDivElement;\n    private _lastPointerData: IPointerData;\n    private _tickTimeStamp: number;\n    private _autoMaskCaptured: boolean;\n    private _shape: string;\n    private _layers: { [id : string] : ILayer } = {};\n    private _sheet: HTMLElement;\n    private _importImageButton: HTMLDivElement;\n    private _isDirty: boolean;\n    private _lastSaveTimestamp: number = 0;\n\n    get color(): string { return this._color; }\n    get shape(): string { return this._shape; }\n    get opacity(): number { return this._opacity; }\n    get lineWidth(): number { return this._lineWidth; }\n    get autoMaskCtx(): CanvasRenderingContext2D { return this._autoMaskCtx; }\n    //get layers(): Layer[] { return this._layers; }\n    get baseLayer(): CanvasLayer { return <CanvasLayer>this._layers[\"base-layer\"]; }\n    get overlayLayer(): ImageLayer { return <ImageLayer>this._layers[\"overlay-layer\"]; }\n\n    constructor(id: string, onBackClicked: Function) {\n        super(id);\n        \n        this._history = new History();\n        this._sheet = document.getElementById(\"sheet\");\n\n        this.width = config.width;\n        this.height = config.height;\n\n        this.addCanvasLayer(\"base-layer\", 0, 0, this.width, this.height,false);\n        this.addEventListeners();\n        this.createButtons(onBackClicked);\n        this.createToolbar();\n        this.createPalettes();\n        this.createTools();\n    }\n    \n    getLayer(id: string){\n        return this._layers[id];\n    }\n\n    private createButtons(onBackClicked: Function) {\n        let backButton = <HTMLDivElement>this._element.getElementsByClassName(\"button back\")[0];\n        Utils.addClick(backButton, () => onBackClicked());\n\n        this._undoButton = <HTMLDivElement>document.getElementById(\"undo-button\");\n        Utils.addClick(this._undoButton, () => this.undo());\n\n        this._redoButton = <HTMLDivElement>document.getElementById(\"redo-button\");\n        Utils.addClick(this._redoButton, () => this.redo());\n        \n        this._importImageButton = <HTMLDivElement>document.getElementById(\"import-image-button\");\n        Utils.addClick(this._importImageButton, async () => {\n            const blob = await Utils.upload(\"image/*\");\n            this.setTool(this.selectionTool);\n            const url = URL.createObjectURL(blob);\n            await this.selectionTool.setImageUrl(url);\n            URL.revokeObjectURL(url);\n        });\n    }\n\n    private addLayer(layer: ILayer): ILayer {\n        layer.index = Object.keys(this._layers).length;\n        this._layers[layer.id] = layer;\n        return layer;\n    }\n    \n    public addImageLayer(id: string, x: number, y: number, width: number, height: number, floating: boolean): ImageLayer{\n        const layer = new ImageLayer(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    \n    public addCanvasLayer(id: string, x: number, y: number, width: number, height: number, floating: boolean): CanvasLayer{\n        const layer = new CanvasLayer(this._sheet, id, x, y, width, height);\n        layer.floating = floating;\n        this.addLayer(layer);\n        return layer;\n    }\n    \n    public removeLayer(layer: ILayer) {\n        if (!layer){\n            return;\n        }\n        layer.remove();\n        delete this._layers[layer.id]\n    }\n    \n    public createOverlay(){\n        if (this.overlayLayer){\n            return;\n        }\n        this.addLayer(new ImageLayer(this._sheet, \"overlay-layer\", 0, 0, this.width, this.height));\n    }\n    \n    public removeOverlay(){\n        this.removeLayer(this.overlayLayer);\n    }\n    \n    public async setOverlay(id: string){\n        const url = await imageStorage.loadImageUrl(id);\n        \n        if (!url){\n            this.removeOverlay();\n            return;\n        }\n        this.createOverlay();\n        this.overlayLayer.image.src = url;\n                //this.processOverlay(this.overlay.ctx);\n\n                // show processed overlay:\n                // this._overlayCtx.canvas.toBlob(blob => {\n                //     this._overlay.src = URL.createObjectURL(blob);\n                // })\n    }\n    \n    private createTools() {\n        let penButton = document.getElementById(\"tool-pen\");\n        Utils.addLongClick(penButton, () => this.fill());\n        Utils.addClick(penButton, () => this.setTool(this.markerTool));\n        let eraserButton = document.getElementById(\"tool-eraser\");\n        Utils.addLongClick(eraserButton, () => this.clear(true));\n        Utils.addClick(eraserButton, () => this.setTool(this.eraserTool));\n        let selectionButton = document.getElementById(\"tool-selection\");\n        Utils.addClick(selectionButton, () => this.setTool(this.selectionTool));\n        Utils.addLongClick(selectionButton, () => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.selectAll();\n        });\n        \n        this._tools = [];\n        // this.brushTool = this.addTool(new PenTool(this, \"tool-\", \"source-over\"));\n        this.markerTool = this.addTool(new PenTool(this, \"tool-pen\", \"darken\"));\n        this.eraserTool = this.addTool(new PenTool(this, \"tool-eraser\", \"destination-out\"));\n        this.selectionTool = <SelectionTool>this.addTool(new SelectionTool(this, \"tool-selection\"));\n        // this.paintBucketTool = this.addTool(new PaintBucketTool(this));\n        // this._currentTool = this.brushTool;\n        this.setTool(this.markerTool);\n    }\n    \n    private addTool(tool: Tool){\n        this._tools.push(tool);\n        return tool;\n    }\n    \n    private createToolbar(){\n        this._mainToolbar = new Toolbar(\"main-toolbar\");\n\n        this._contextToolbar = new Toolbar(\"context-toolbar\");\n    }\n\n    private createPalettes() {\n        this._sizePalette = new SizePalette(\"size-palette\");\n        this._sizePalette.onSelectionChanged = (lineWidth: number) => {\n            this._lineWidth = lineWidth;\n        };\n        this._lineWidth = this._sizePalette.size;\n\n        this._colorPalette = new ColorPalette(\"color-palette\");\n        this._colorPalette.onSelectionChanged = (color: string) => this._color = color;\n        this._color = this._colorPalette.color;\n\n        this._shapePalette = new ShapePalette(\"shape-palette\");\n        this._shapePalette.onSelectionChanged = (shape: string) => {\n            this._shape = shape;\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImageUrl(this.shape);\n        }\n        this._shape = this._shapePalette.stamp;\n\n        this._giftPalette = new GiftPalette(\"gift-palette\");\n        this._giftPalette.onSelectionChanged = (path: string) => {\n            this.setTool(this.selectionTool);\n            this.selectionTool.setImagePath(path);\n            imageStorage.deleteImage(path);\n        }\n\n        this._opacity = 1;\n    }\n\n    private setTool(tool: Tool) {\n        if (this._currentTool == tool){\n            return;\n        }\n        \n        if (this._currentTool){\n            this._currentTool.disable();\n        }\n        this._currentTool = tool;\n        if (this._currentTool){\n            this._currentTool.enable();\n        }\n\n        this._colorPalette.setVisible(this._currentTool == this.markerTool);\n        this._sizePalette.setVisible(this._currentTool == this.markerTool || this._currentTool == this.eraserTool);\n        // this._shapePalette.setVisible(this._currentTool == this.selectionTool);\n        // this._importImageButton.classList.toggle(\"hidden\", this._currentTool != this.selectionTool);\n    }\n\n    private addEventListeners() {\n        let canvas = this.baseLayer.canvas;\n        canvas.style.pointerEvents = \"auto\";\n        //canvas.addEventListener('keydown', event => this.keyDown(event));\n        document.addEventListener('keydown', event => this.keyDown(event));\n        canvas.addEventListener('click', event => event.preventDefault());\n\n        if (config.usePointerEvents && window.PointerEvent != null){\n            // Required to prevent pointerDown events from being choked when tapping repeatedly: \n            canvas.addEventListener('touchstart', event => {\n                if (event.cancelable){\n                    event.preventDefault();\n                }\n            });\n            \n            canvas.addEventListener('pointerdown', event => this.pointerDown(event));\n            canvas.addEventListener('pointermove', event => this.pointerMove(event));\n            canvas.addEventListener('pointerup', event => this.pointerUp(event));\n            canvas.addEventListener('pointercancel', event => event.preventDefault());\n        }\n        else{\n            canvas.addEventListener('touchstart', event => this.touchStart(event));\n            canvas.addEventListener('touchmove', event => this.touchMove(event));\n            canvas.addEventListener('touchend', event => this.touchEnd(event));\n            canvas.addEventListener('touchcancel', event => event.preventDefault());\n        }\n        //canvas.addEventListener('touchforcechanged', event => this.pressureChanged(<TouchEvent>event))\n        // Pressure.set(canvas, {\n        //     change: (force: number, event: Event) => this.pressureChanged(force)\n        // })\n    }\n\n    private getPointerEventPosition(event: PointerEvent) {\n        let target = <HTMLElement>event.target;\n        let rect = target.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (event.clientX - rect.left) / rect.width;\n        let ny = (event.clientY - rect.top) / rect.height;\n        \n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height; \n\n        if (config.pixelPerfect){\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector(x, y);\n    }\n\n    private getTouchEventPosition(touch: Touch) {\n        let rect = this.baseLayer.canvas.getBoundingClientRect();\n        const isPortraitOrientation = rect.height > rect.width;\n\n        let nx = (touch.clientX - rect.left) / rect.width;\n        let ny = (touch.clientY - rect.top) / rect.height;\n\n        let x = (isPortraitOrientation ? 1 - ny : nx) * this.width;\n        let y = (isPortraitOrientation ? nx : ny) * this.height;\n\n        if (config.pixelPerfect){\n            x = Math.round(x);\n            y = Math.round(y);\n        }\n        return new Vector(x, y);\n    }\n    \n    private keyDown(event: KeyboardEvent){\n        if (!this.isVisible()){\n            return;\n        }\n        \n        switch (event.code){\n            // case 'KeyV':\n            //     if (event.metaKey){\n            //         this.setTool(this.selectionTool);\n            //         this.selectionTool.pasteFromClipboard();\n            //     }\n            //     break;\n        }\n        \n        if (!this._currentTool) {\n            return;\n        }\n        this._currentTool.keyDown(event);\n    }\n\n    pointerDown(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n\n        let target = <HTMLElement>event.target;\n        target.setPointerCapture(event.pointerId);\n        this._currentTouchId = event.pointerId;\n\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n     }\n\n    pointerMove(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary || event.buttons !== 1) {\n            return;\n        }\n\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: this.screenToSheet(new Vector(event.width, event.height)),\n            pressure: this.getNormalizedPointerPressure(event),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    getNormalizedPointerPressure(event: PointerEvent): number {\n        return event.pointerType == \"pen\" ? Utils.clamp(0.5, 2, event.pressure * 4) : 1;\n    }\n\n    getNormalizedTouchPressure(touch: Touch): number {\n        return touch.touchType == \"stylus\" ? Utils.clamp(0.5, 2, touch.force * 4) : 1;\n    }\n\n    pointerUp(event: PointerEvent) {\n        event.preventDefault();\n        if (!event.isPrimary){\n            return;\n        }\n\n        let target = <HTMLElement>event.target;\n        target.releasePointerCapture(event.pointerId);\n\n        this.up({\n            timeStamp: event.timeStamp,\n            position: this.getPointerEventPosition(event),\n            radius: new Vector(event.width, event.height),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n    \n    pressureChanged(force: number){\n        // let pressure = Utils.clamp(0.3, 1, force * 2);\n        // this._currentTool.pressure = Math.max(pressure, this._currentTool.pressure);\n        // this._currentTool.pressureChanged();\n    }\n\n    touchStart(event: TouchEvent) {\n        event.preventDefault();\n        if (this._currentTouchId !== 0){\n            return;\n        }\n        const touch = event.targetTouches[0];\n        this._currentTouchId = touch.identifier;\n        this.down({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    touchMove(event: TouchEvent) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch == null){\n            return;\n        }\n        console.log(touch.force)\n        this.move({\n            timeStamp: event.timeStamp,\n            position: this.getTouchEventPosition(touch),\n            radius: this.screenToSheet(new Vector(touch.radiusX, touch.radiusY)),\n            pressure: this.getNormalizedTouchPressure(touch),\n            speed: 1,\n            isPressed: true\n        });\n    }\n\n    touchEnd(event: TouchEvent) {\n        event.preventDefault();\n        let touch = PaintView.findTouch(event.targetTouches, this._currentTouchId);\n        if (touch != null){\n            // current touch is still in the list of target touches, this means it has not ended yet\n            return;\n        }\n        this.up({\n            timeStamp: event.timeStamp,\n            position: new Vector(0 ,0),\n            radius: new Vector(0 ,0),\n            pressure: 1,\n            speed: 1,\n            isPressed: false\n        });\n        this._currentTouchId = 0;\n    }\n\n    private static findTouch(touches: TouchList, id: number){\n        for (let i = 0; i < touches.length; i++) {\n            if (touches[i].identifier == id){\n                return touches[i];\n            }\n        }\n        return null;\n    }\n\n    private move(data: IPointerData) {\n        if (!this._currentTool) {\n            return;\n        }\n\n        let delta = this._lastPointerData.position.distanceTo(data.position);\n\n        if (delta <= 1) {\n            return;\n        }\n        \n        this._lastPointerData = this._lastPointerData || data;\n        let timeDelta = data.timeStamp - this._lastPointerData.timeStamp;\n        const speed = delta / timeDelta;\n        data.speed = Utils.lerp(this._lastPointerData.speed, speed, 0.2);\n        this._lastPointerData = data;\n        this._currentTool.move(data);\n    }\n\n    private down(data: IPointerData) {\n        Palette.collapseAll();\n\n        if (!this._currentTool) {\n            return;\n        }\n\n        this._lastPointerData = data;\n        this._currentTool.down(data);\n    }\n\n    private up(data: IPointerData) {\n        if (!this._currentTool) {\n            return;\n        }\n\n        this._lastPointerData = data;\n        this._currentTool.up(data);\n    }\n\n    clear(recordHistoryState: boolean = false) {\n        this.baseLayer.clear();\n        if (recordHistoryState){\n            this.recordHistoryState();\n        }\n    }\n\n    fill() {\n        this.baseLayer.ctx.fillStyle = this.color;\n        this.baseLayer.ctx.fillRect(0, 0, this.width, this.height);\n        this.recordHistoryState();\n    }\n\n    private ResetHistory() {\n        this._history.clear();\n        this.recordHistoryState();\n        this.updateUndoButtons();\n    }\n\n    recordHistoryState(){\n        this._history.recordState(this.baseLayer.getData());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n\n    updateUndoButtons(){\n        this._undoButton.classList.toggle(\"disabled\", !this._history.canUndo);\n        this._redoButton.classList.toggle(\"disabled\", !this._history.canRedo);\n    }\n\n    undo() {\n        if (!this._history.canUndo){\n            return;\n        }\n        this.baseLayer.putData(this._history.undo());\n        this.updateUndoButtons();\n        this.setDirty();\n    }\n    \n    redo() {\n        if (!this._history.canRedo){\n            return;\n        }\n        this.baseLayer.putData(this._history.redo());\n        this.updateUndoButtons()\n        this.setDirty();\n    }\n\n    restoreCurrentHistoryState(){\n        this.baseLayer.putData(this._history.getCurrentState());\n    }\n\n    loadImage(id: string) {\n        return imageStorage.loadImage(id)\n            .then(image => {\n                this._imageId = id;\n                this.clear();\n                if (image){\n                    this.baseLayer.drawImage(image);\n                }\n                \n                this.setOverlay(\"overlay-\" + id);\n                this.ResetHistory();\n                this._isDirty = false;\n            })\n    }\n\n    private saveImage() {\n        Utils.log(\"Saving \" + this._imageId);\n        this.baseLayer.canvas.toBlob(blob => imageStorage.saveImage(this._imageId, blob as Blob));\n        this._isDirty = false;\n        this._lastSaveTimestamp = Date.now();\n    }\n\n    setDirty() {\n        this._isDirty = true;\n    }\n\n    show(){\n        super.show();\n        this._currentTouchId = 0;\n        this._autoMaskCaptured = false;\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp))\n        this._currentTool.enable();\n    }\n    \n    hide(){\n        Palette.collapseAll();\n\n        if (this._currentTool){\n            this._currentTool.disable();\n        }\n        if (this._layers){\n            // Always save when closing the paint view in case we forgot to set the dirty flag somewhere:\n            this.saveImage();\n        }\n        if (this._history){\n            this._history.clear();\n        }\n        super.hide();\n    }\n\n    private tick(timeStamp: number) {\n        if (!this.isVisible()){\n            return;\n        }\n\n        window.requestAnimationFrame(timeStamp => this.tick(timeStamp))\n\n        let delta = timeStamp - this._tickTimeStamp;\n        this._tickTimeStamp = timeStamp;\n\n        if (this._currentTool) {\n            this._currentTool.tick(delta);\n            \n            // never save while painting to avoid lags:\n            if (this._lastPointerData && this._lastPointerData.isPressed){\n                return;\n            }\n        }\n        \n        if (this._isDirty && Date.now() > this._lastSaveTimestamp + config.saveInterval){\n            this.saveImage();\n        }\n    }\n\n    captureAutoMask(position: Vector) {\n        if (!config.useAutoMask){\n            return;\n        }\n        \n        this._autoMaskCaptured = true;\n        // if (!this.overlayLayer){\n        //     return;\n        // }\n\n        if (!this._autoMaskCtx){\n            let autoMaskCanvas = document.createElement(\"canvas\");\n            autoMaskCanvas.id = \"auto-mask\";\n            autoMaskCanvas.width = this.width;\n            autoMaskCanvas.height = this.height;\n            this._autoMaskCtx = <CanvasRenderingContext2D>autoMaskCanvas.getContext(\"2d\", {alpha: true});\n        }\n\n        let imageData = this._autoMaskCtx.getImageData(0, 0, this.width, this.height);\n\n        // avoid expensive floodfill:\n        const index = (position.x + position.y * this.width) * 4 + 3;\n        // if (this._autoMaskCaptured && imageData.data[index] > 0){\n        //     return;\n        // }\n\n        Utils.log(\"capturing auto mask\");\n        Utils.floodFill(this.baseLayer.ctx, imageData.data, position, this.color);\n        Utils.dilateMask(imageData.data, this.width, this.height);\n        this._autoMaskCtx.putImageData(imageData, 0, 0);\n    }\n\n    private processOverlay(ctx: CanvasRenderingContext2D) {\n        const imageData = ctx.getImageData(0, 0, this.width, this.height);\n        const pixels = imageData.data;\n        for (let i = pixels.length - 1; i >= 0; i--) {\n            pixels[i] = pixels[i] > 64 ? 255 : 0;\n        }\n        ctx.putImageData(imageData, 0, 0);\n    }\n\n    private screenToSheet(p: Vector): Vector {\n        return new Vector(p.x / screen.width * config.width, p.y / screen.height * config.height);\n    }\n}","import {imageStorage} from \"../storage/ImageStorage\";\n\ninterface IPathInfo {\n    atime: string\n    atimeMs: number\n    birthtime: string\n    birthtimeMs: number\n    blksize: number\n    blocks: number\n    ctime: string\n    ctimeMs: number\n    dev: number\n    gid: number\n    ino: number\n    isBlockDevice: boolean\n    isDirectory: boolean\n    isFIFO: boolean\n    isFile: boolean\n    isSocket: boolean\n    mode: number\n    mtime: string\n    mtimeMs: number\n    name: string\n    nlink: number\n    rdev: number\n    size: number\n    uid: number\n}\n\nclass Server {\n\n    private _host: string;\n    private _userId: string;\n    \n    get host(): string{\n        return this._host;\n    }\n\n    set host(value: string){\n        this._host = value;\n        localStorage.setItem(\"server-url\", value);\n    }\n    \n    get userId(): string{\n        return this._userId;\n    }\n    \n    set userId(value: string){\n        this._userId = value;\n        localStorage.setItem(\"user-id\", value);\n    }\n\n    constructor() {\n        this._host = localStorage.getItem(\"server-url\") ?? \"http://localhost:3000\";\n        this._userId = localStorage.getItem(\"user-id\") ?? \"\";\n    }\n\n    async sync(){\n        if (!this.userId){\n            console.error(\"Cannot sync without user id.\");\n            return;\n        }\n        \n        await this.downloadDefaultAssets();\n        await this.uploadUserContent();\n    }\n\n    private async uploadUserContent() {\n        this.createDirectory(this.host, this.userId);\n\n        var keys = <string[]>await imageStorage.keys();\n\n        for (let id of keys) {\n            const url = await imageStorage.loadImageUrl(id);\n            const blob = await fetch(url).then(r => r.blob());\n            if (!blob) {\n                continue;\n            }\n            let fileName = this.userId + \"/\" + id;\n            console.log(\"posting: \" + fileName);\n            this.postImage(this.host, blob, fileName);\n        }\n    }\n\n    async downloadDefaultAssets(){\n        var res = await this.getPathInfo(this.host, 'default');\n        if (!res.ok){\n            console.log('Could not download default assets.');\n            return;\n        }\n        var info: IPathInfo[] = await res.json();\n        for (let path of info) {\n            if (!path.isFile){\n                continue;\n            }\n            if (!path.name.endsWith(\".png\")){\n                continue;\n            }\n            \n            console.log(\"getting default asset: \" + path.name);\n            this.downloadImage(\"default/\" + path.name, path.name);\n        }\n    }\n\n    private async downloadImage(path: string, imageId: string) {\n        const url = this.host + \"/\" + path;\n        var res = await fetch(url);\n        if (res.ok){\n            var blob = await res.blob();\n            if (blob){\n                imageStorage.saveImage(imageId, blob);\n            }\n        }\n    }\n    \n    async getPathInfo(host: string, path: string){\n        const url = host + \"/\" + path + \"?type=json\";\n        return fetch(url);\n    }\n    \n    async createDirectory(host: string, directoryName: string){\n        const url = host + \"/\" + directoryName + \"?create=directory\";\n        return fetch(url, {\n            method: \"POST\"\n        })\n    }\n\n    async postImage(host: string, blob: Blob, fileName: string){\n        const url = host + \"/\" + fileName;\n        return fetch(url, {\n            method: \"PUT\",\n            headers: {\n                \"Accept\": \"image/png\",\n                \"Content-Type\": \"image/png\"\n            },\n            body: blob\n        })\n    }\n}\n\nexport const server = new Server();","import {View} from \"./View\";\nimport * as Utils from \"../utils/Utils\";\nimport {imageStorage} from \"../storage/ImageStorage\";\nconst version = \"1.0.0\" //require('/package').version;\nvar ConsoleLogHTML = require('console-log-html');\nimport { saveAs } from 'file-saver';\nimport {server} from \"../storage/Server\";\nimport {dropboxStorage} from \"../storage/DropboxStorage\";\nimport {config} from \"../config\";\n\nexport default class SettingsView extends View {\n    \n    private _hostElement: HTMLInputElement;\n    private _userIdElement: HTMLInputElement;\n    private _connectButton: HTMLDivElement;\n    private _disconnectButton: HTMLDivElement;\n    private _syncButton: HTMLDivElement;\n    \n    constructor(id: string, onBackClicked: Function) {\n        super(id);\n        let backButton = this._element.querySelector<HTMLDivElement>(\".button.back\");\n        Utils.addClick(backButton, () => onBackClicked());\n\n        this._hostElement = this._element.querySelector<HTMLInputElement>(\"#server-url\");\n        this._hostElement.onblur = () => server.host = this._hostElement.value;\n        \n        this._userIdElement = this._element.querySelector<HTMLInputElement>(\"#user-id\");\n        this._userIdElement.onblur = () => dropboxStorage.userId = this._userIdElement.value;\n\n        this._connectButton = this._element.querySelector<HTMLDivElement>(\".button.connect\");\n        Utils.addClick(this._connectButton, () => {\n            location.href = dropboxStorage.getAuthenticationUrl();\n        });\n\n        this._disconnectButton = this._element.querySelector<HTMLDivElement>(\".button.disconnect\");\n        Utils.addClick(this._disconnectButton, () => {\n            dropboxStorage.unauthorize();\n            this.updateButtons();\n        });\n\n        this._syncButton = this._element.querySelector<HTMLDivElement>(\".button.sync\");\n        Utils.addClick(this._syncButton, async () => {\n            dropboxStorage.toggleSync();\n            this.updateButtons();\n        });\n\n        let exportButton = this._element.querySelector<HTMLDivElement>(\".button.export\");\n        Utils.addClick(exportButton, async () => {\n            const zipBlob = await imageStorage.generateBackupArchive();\n            saveAs(zipBlob, \"web-paint-backup.zip\");\n        });\n\n        let importButton = this._element.querySelector<HTMLDivElement>(\".button.import\");\n        Utils.addClick(importButton, async () => {\n            imageStorage.importBackupArchive(await Utils.upload(\".zip\"));\n            this.updateInfo();\n        });\n\n        let clearButton = this._element.querySelector<HTMLDivElement>(\".button.clear\");\n        Utils.addClick(clearButton, () => {\n            if (confirm(\"Really clear all images?\")){\n                imageStorage.clear();\n                location.reload();\n            }\n        });\n\n        if (config.useHtmlLog){\n            ConsoleLogHTML.connect(document.getElementById(\"log\"), {}, true, true, true);\n        }\n    }\n\n    private updateButtons() {\n        this._connectButton.classList.toggle('hidden', dropboxStorage.isAuthorized);\n        this._disconnectButton.classList.toggle('hidden', !dropboxStorage.isAuthorized);\n        this._syncButton.classList.toggle(\"disabled\", !dropboxStorage.isAuthorized);\n        this._syncButton.innerHTML = '<i class=\"fas fa-sync fa-fw\"></i> ' + (dropboxStorage.isSyncing ? \"Stop Sync\" : \"Start Sync\");\n    }\n\n    show(){\n        super.show();\n        this.updateInfo();\n        this.updateButtons();\n    }\n\n    private updateInfo() {\n        const info = <HTMLParagraphElement>document.getElementById(\"info\");\n        info.innerText = `Version: ${version}`;\n        imageStorage.getStorageUsed().then(amount => {\n            info.innerText += `\\rStorage used: ${Utils.formatBytes(amount, 1)}`;\n        });\n\n        this._hostElement.value = server.host;\n        this._userIdElement.value = dropboxStorage.userId;\n    }\n}\n","import localforage from \"localforage\";\n\nrequire('../css/painter.css');\nimport {library, dom} from '@fortawesome/fontawesome-svg-core'\nimport { fas } from '@fortawesome/free-solid-svg-icons'\nrequire('blueimp-canvas-to-blob/js/canvas-to-blob');\n\nlibrary.add(fas)\ndom.watch();\n\n// required to make 'async' work on old devices: \nimport \"core-js/stable\";\nimport \"regenerator-runtime/runtime\";\n\nimport {View} from \"./views/View\";\nimport BookView from \"./views/BookView\";\nimport {PaintView} from \"./views/PaintView\";\nimport DropboxAuthView from \"./views/DropboxAuthView\";\nimport {config} from \"./config\";\nimport PeerToPeer from \"./PeerToPeer\";\nimport SettingsView from \"./views/SettingsView\";\nimport { imageStorage } from \"./storage/ImageStorage\";\nimport ioclient from \"socket.io-client\";\n\nclass App {\n    private _activeView: View;\n    private _bookView: BookView;\n    private _paintView: PaintView;\n    private _settingsView: SettingsView;\n    private dropboxAuthView: DropboxAuthView;\n    private _sheet: HTMLElement;\n    _socket: SocketIOClient.Socket;\n\n    constructor() {\n        this.socketInit();\n        \n        // App.preventOverScroll();\n        \n        //PeerToPeer.createInstance();\n\n        this._settingsView = new SettingsView(\"settings\",() => {\n            this.openView(this._bookView);\n        });\n        \n        this._sheet = document.getElementById(\"sheet\")\n        window.addEventListener('resize', event => {\n            this.OnResize();\n        });\n        this.OnResize();\n        \n        this._bookView = new BookView(\"book\", async () => {\n            this.openView(this._settingsView);\n        });\n        this._bookView.onImageSelected = (id: string) => {\n            this._paintView.loadImage(id)\n                .then(() => {\n                    this.openView(this._paintView);\n                });\n        }\n\n        this._paintView = new PaintView(\"paint\",() => {\n            this.openView(this._bookView);\n        });\n\n\n        // Dropbox integration is not working yet:\n        // this.dropboxAuthView = new DropboxAuthView(\"dropbox-auth\");\n        // this.openView(ImageStorage.adapter.isAuthenticated ? this.bookView : this.dropboxAuthView);\n\n        this.openView(this._bookView);\n    }\n\n    getIOSVersion(): number[] {\n        if (/iP(hone|od|ad)/.test(navigator.platform)) {\n            // supports iOS 2.0 and later: <http://bit.ly/TJjs1V>\n            var v = (navigator.appVersion).match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n            return [parseInt(v[1], 10), parseInt(v[2], 10), parseInt(v[3] || \"0\", 10)];\n        }\n    }\n\n    private OnResize() {\n        const docWidth = document.documentElement.clientWidth;\n        const docHeight = document.documentElement.clientHeight;\n        \n        const portrait = docWidth < docHeight;\n        const isLargeScreen = docWidth > 1024;\n        \n        const viewWidth = Math.max(docWidth, docHeight);\n        const viewHeight = Math.min(docWidth, docHeight);\n        \n        const horizontalPixelSize = viewWidth / config.width;\n        const verticalPixelSize = viewHeight / config.height;\n        \n        const virtualPixelSize = config.fullScreenCanvas && !isLargeScreen ?\n            Math.max(horizontalPixelSize, verticalPixelSize) :\n            Math.min(horizontalPixelSize, verticalPixelSize);\n\n        this._sheet.style.fontSize = `${virtualPixelSize}px`;\n        this._sheet.style.left = `${portrait ? 0.5 * (docWidth - virtualPixelSize * config.width) : 0}px`;\n    }\n\n    private static preventOverScroll() {\n        document.ontouchmove = event => { event.preventDefault();}\n    }\n\n    openView(view: View){\n        if (this._activeView){\n            this._activeView.hide();\n        }\n        this._activeView = view;\n        this._activeView.show();\n    }\n    \n    socketInit(){\n//        this._socket = io(\"http://192.168.178.20:3002\");\n        this._socket = ioclient(\"https://nas.andreashackel.de:3005\");\n        this._socket.on(\"TestMsg\", (msg: string) => console.log(msg));\n    }\n\n    socketTest(){\n        this._socket.emit(\"TestMsg\", \"Test\");\n    }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n    // @ts-ignore\n    window.app = new App();\n    // @ts-ignore\n    window.localForage = localforage;\n});\n\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"*{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:none}textarea{-webkit-user-select:initial}html,body{margin:0;width:100%;height:100%;position:fixed;font-size:40px}@media(max-width: 400px),(max-height: 400px){html,body{font-size:28px}}body{-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\";line-height:1.5rem}body,input,textarea{font-family:-apple-system,BlinkMacSystemFont,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\",\\\"Segoe UI Symbol\\\";line-height:1.5rem}.button{width:1.5rem;height:1.5rem;line-height:1.5rem;text-align:center;font-size:.75rem;border-radius:30%;cursor:pointer;background:rgba(255,255,255,.5);color:#000;transition:transform .25s}.button.down{transform:scale(0.9)}.button i{line-height:1.5rem}.button .fa-stack{height:1em;width:1em}.button .fa-stack.fa-fw{width:1.25em}#dropbox-button{border-radius:3px;background-color:#007ee5;border:none;color:#fff;font-size:16px;padding:10px 15px;text-decoration:none;height:24px}.view{display:flex;position:fixed;width:100%;height:100%;background:#bbb;overflow:hidden}.dropbox-auth{align-items:center;justify-content:center}.view.book{flex-wrap:wrap;align-content:flex-start;justify-content:center;overflow-y:auto;-webkit-overflow-scrolling:touch}.view.book,.view.book *{touch-action:pan-y}.view.settings{font-size:.4rem;display:block;box-sizing:border-box;line-height:1.5em;color:#444}.view.settings .left-panel{width:40%;padding:1.2rem .25rem;box-sizing:border-box}.view.settings input{font-size:.5rem;line-height:1em;border:none;width:100%;border-radius:.5em;box-sizing:border-box;padding:.5em;-webkit-user-select:initial}.view.settings .button{width:1rem;height:1rem;line-height:1rem}.view.settings .button.text{width:auto;border-radius:.5em;padding:0 .5em;margin-bottom:.5em;text-align:left;overflow:hidden;font-size:.5rem;background:#58b0ff;color:#fff}.view.settings label{display:block;color:gray}.view.settings #log{width:60%;background:#272727;color:#c7c7c7;overflow:scroll;-webkit-overflow-scrolling:touch;touch-action:pan-y;height:100vh;padding:0;font-family:monospace;font-size:12px;position:fixed;top:0;right:0;margin:0;line-height:20px}#log li{border-bottom:#444 solid 1px;padding:0 1em}.thumbnail{margin:.3rem;color:#ccc;background:#fff;border-radius:.1rem;font-size:5.6rem;width:1em;height:.75em;background-size:contain;cursor:pointer;transition:opacity 1s}.thumbnail.down{transform:scale(0.9)}.paint{align-items:center}.paint #sheet{font-size:1px;width:1024em;height:768em;margin:auto;overflow:auto;position:fixed;object-fit:contain;left:0;top:0;bottom:0;right:0}.layer{position:absolute;left:0;top:0;background:none}#base-layer{background:#fff}.layer.floating{outline:2px dashed #000}#stamp-layer{opacity:.2}@media(orientation: portrait){.paint #sheet{transform:rotate(-90deg);overflow-x:hidden}}.button.back{position:absolute;top:.25rem;left:.25rem;z-index:100}.button.settings{position:absolute;right:.25rem;top:.25rem;z-index:100}.button a{width:100%;height:100%;display:block;color:#000}.button#stamp-button{font-size:1.25rem;position:absolute;top:.25rem;right:.25rem;width:2rem;height:2rem;z-index:100;line-height:1.85rem}.toolbar{display:flex;background:#d3d3d3;border-radius:.5rem;z-index:100;position:absolute}.toolbar.left{flex-direction:column;left:.25rem;top:50%;transform:translateY(-50%)}.toolbar.right{flex-direction:column;right:.25rem;top:50%;transform:translateY(-50%)}.toolbar.top{flex-direction:row;left:50%;top:.25em;transform:translateX(-50%)}.toolbar.bottom{flex-direction:row;left:50%;bottom:.25em;transform:translateX(-50%)}.toolbar .button{background:transparent}.toolbar .spacer{width:1.5em;height:1.5em}.palette{position:relative;transition:transform .25s;display:inline-block;float:left;text-align:center;z-index:100}.palette .option i{font-size:.75em}.palette .options{position:absolute;display:flex;flex-wrap:wrap;background:#d3d3d3;border-radius:.5rem;padding:.25rem;transition:transform .15s;top:2.25rem;left:50%;transform:translateX(-50%)}.palette .option{width:1em;height:1em;line-height:.75em;display:inline-block;margin:.25em;float:left;transition:transform .25s;background-size:contain;background-repeat:no-repeat;background-position:center}.palette.button .option{width:1.5rem;height:1.5rem;line-height:1.5rem;margin:0}.palette .options .option{margin:.125em}.palette .option:active{transform:scale(0.9)}.palette .options .arrow{position:absolute;width:0;height:0;font-size:.25rem;top:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-bottom:2em solid #d3d3d3;border-top:none}#send-palette .options{width:auto !important}#send-palette .options .option{width:auto;font-size:.75rem;line-height:1rem;height:1rem}.toolbar.left .palette .options{left:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.left .palette .options .arrow{top:initial;left:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-right:2em solid #d3d3d3}.toolbar.right .palette .options{left:initial;right:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.right .palette .options .arrow{left:initial;top:initial;right:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-left:2em solid #d3d3d3;border-right:0}.toolbar.bottom .palette .options{left:50%;top:initial;bottom:2.25rem;transform:translateX(-50%)}.toolbar.bottom .palette .options .arrow{top:initial;bottom:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-top:2em solid #d3d3d3;border-bottom:none}.palette.collapsed:active{transform:scale(0.9)}.toolbar.top .palette.collapsed .options,.toolbar.bottom .palette.collapsed .options{transform:translateX(-50%) scale(0)}.toolbar.left .palette.collapsed .options,.toolbar.right .palette.collapsed .options{transform:translateY(-50%) scale(0)}#stamp-palette.palette .options{font-size:1.5rem}@media(max-width: 400px),(max-height: 400px){#stamp-palette.palette .options{font-size:1rem}}.line-width{background:#000;height:100%;margin:auto;border-radius:.15em}#color-palette .option{border-radius:40%}.hidden{display:none !important}.disabled{opacity:.25}.selected{background:#58b0ff !important;color:#fff}.bounce{animation-duration:.8s;animation-name:bounce;animation-iteration-count:1;animation-timing-function:ease-in-out}@keyframes bounce{0%{transform:scale(1)}30%{transform:scale(2)}100%{transform:scale(1)}}.shake{animation-duration:1s;animation-name:shake;animation-iteration-count:1;animation-timing-function:ease-in-out}@keyframes shake{0%{transform:rotate(0)}15%{transform:rotate(45deg)}50%{transform:rotate(-45deg)}85%{transform:rotate(45deg)}100%{transform:rotate(0)}}\", \"\",{\"version\":3,\"sources\":[\"webpack://./painter.css\"],\"names\":[],\"mappings\":\"AAAA,EACI,0BAAA,CACA,wBAAA,CACA,gBAAA,CACA,iBAAA,CAGJ,SACI,2BAAA,CAGJ,UAEI,QAAA,CACA,UAAA,CACA,WAAA,CACA,cAAA,CACA,cAAA,CAGJ,6CACI,UAEI,cAAA,CAAA,CAIR,KACI,yCAAA,CACA,gJAAA,CACA,kBAAA,CAGJ,oBACI,gJAAA,CACA,kBAAA,CAGJ,QACI,YAAA,CACA,aAAA,CACA,kBAAA,CACA,iBAAA,CACA,gBAAA,CACA,iBAAA,CACA,cAAA,CACA,+BAAA,CACA,UAAA,CACA,yBAAA,CAGJ,aACI,oBAAA,CAGJ,UACI,kBAAA,CAGJ,kBACI,UAAA,CACA,SAAA,CAGJ,wBACI,YAAA,CAGJ,gBACI,iBAAA,CACA,wBAAA,CACA,WAAA,CACA,UAAA,CACA,cAAA,CACA,iBAAA,CACA,oBAAA,CACA,WAAA,CAGJ,MACI,YAAA,CACA,cAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,eAAA,CAGJ,cACI,kBAAA,CACA,sBAAA,CAGJ,WACI,cAAA,CACA,wBAAA,CACA,sBAAA,CACA,eAAA,CACA,gCAAA,CAGJ,wBACI,kBAAA,CAGJ,eACI,eAAA,CACA,aAAA,CACA,qBAAA,CACA,iBAAA,CACA,UAAA,CAGJ,2BACI,SAAA,CACA,qBAAA,CACA,qBAAA,CAGJ,qBACI,eAAA,CACA,eAAA,CACA,WAAA,CACA,UAAA,CACA,kBAAA,CACA,qBAAA,CACA,YAAA,CACA,2BAAA,CAGJ,uBACI,UAAA,CACA,WAAA,CACA,gBAAA,CAGJ,4BACI,UAAA,CACA,kBAAA,CACA,cAAA,CACA,kBAAA,CACA,eAAA,CACA,eAAA,CACA,eAAA,CACA,kBAAA,CACA,UAAA,CAGJ,qBACI,aAAA,CACA,UAAA,CAGJ,oBACI,SAAA,CACA,kBAAA,CACA,aAAA,CACA,eAAA,CACA,gCAAA,CACA,kBAAA,CACA,YAAA,CACA,SAAA,CACA,qBAAA,CACA,cAAA,CACA,cAAA,CACA,KAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CAGJ,QACI,4BAAA,CACA,aAAA,CAGJ,WACI,YAAA,CACA,UAAA,CACA,eAAA,CACA,mBAAA,CACA,gBAAA,CACA,SAAA,CACA,YAAA,CACA,uBAAA,CACA,cAAA,CACA,qBAAA,CAGJ,gBACI,oBAAA,CAGJ,OACI,kBAAA,CAGJ,cACI,aAAA,CACA,YAAA,CACA,YAAA,CACA,WAAA,CACA,aAAA,CACA,cAAA,CACA,kBAAA,CACA,MAAA,CACA,KAAA,CACA,QAAA,CACA,OAAA,CAGJ,OACI,iBAAA,CACA,MAAA,CACA,KAAA,CACA,eAAA,CAGJ,YACI,eAAA,CAGJ,gBACI,uBAAA,CAGJ,aACI,UAAA,CAGJ,8BACI,cACI,wBAAA,CACA,iBAAA,CAAA,CAKR,aACI,iBAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CAGJ,iBACI,iBAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CAGJ,UACI,UAAA,CACA,WAAA,CACA,aAAA,CACA,UAAA,CAGJ,qBACI,iBAAA,CACA,iBAAA,CACA,UAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,SACI,YAAA,CACA,kBAAA,CACA,mBAAA,CACA,WAAA,CACA,iBAAA,CAGJ,cACI,qBAAA,CACA,WAAA,CACA,OAAA,CACA,0BAAA,CAGJ,eACI,qBAAA,CACA,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,aACI,kBAAA,CACA,QAAA,CACA,SAAA,CACA,0BAAA,CAGJ,gBACI,kBAAA,CACA,QAAA,CACA,YAAA,CACA,0BAAA,CAIJ,iBAEI,sBAAA,CAGJ,iBACI,WAAA,CACA,YAAA,CAGJ,SACI,iBAAA,CACA,yBAAA,CACA,oBAAA,CACA,UAAA,CACA,iBAAA,CACA,WAAA,CAGJ,mBACI,eAAA,CAIJ,kBACI,iBAAA,CACA,YAAA,CACA,cAAA,CACA,kBAAA,CACA,mBAAA,CACA,cAAA,CACA,yBAAA,CACA,WAAA,CACA,QAAA,CACA,0BAAA,CAGJ,iBACI,SAAA,CACA,UAAA,CACA,iBAAA,CACA,oBAAA,CACA,YAAA,CACA,UAAA,CACA,yBAAA,CACA,uBAAA,CACA,2BAAA,CACA,0BAAA,CAEJ,wBACI,YAAA,CACA,aAAA,CACA,kBAAA,CACA,QAAA,CAGJ,0BACI,aAAA,CAGJ,wBACI,oBAAA,CAGJ,yBACI,iBAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CACA,QAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,+BAAA,CACA,eAAA,CAGJ,uBACI,qBAAA,CAGJ,+BACI,UAAA,CACA,gBAAA,CACA,gBAAA,CACA,WAAA,CAGJ,gCACI,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,uCACI,WAAA,CACA,SAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,8BAAA,CAGJ,iCACI,YAAA,CACA,aAAA,CACA,OAAA,CACA,0BAAA,CAGJ,wCACI,YAAA,CACA,WAAA,CACA,UAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,6BAAA,CACA,cAAA,CAGJ,kCACI,QAAA,CACA,WAAA,CACA,cAAA,CACA,0BAAA,CAGJ,yCACI,WAAA,CACA,WAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,4BAAA,CACA,kBAAA,CAGJ,0BACI,oBAAA,CAGJ,qFACI,mCAAA,CAGJ,qFACI,mCAAA,CAGJ,gCACI,gBAAA,CAGJ,6CACI,gCACI,cAAA,CAAA,CAIR,YACI,eAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,uBACI,iBAAA,CAGJ,QACI,uBAAA,CAGJ,UACI,WAAA,CAGJ,UACI,6BAAA,CACA,UAAA,CAGJ,QACI,sBAAA,CACA,qBAAA,CACA,2BAAA,CACA,qCAAA,CAGJ,kBACI,GAAA,kBAAA,CACA,IAAA,kBAAA,CACA,KAAA,kBAAA,CAAA,CAGJ,OACI,qBAAA,CACA,oBAAA,CACA,2BAAA,CACA,qCAAA,CAGJ,iBACI,GAAA,mBAAA,CACA,IAAA,uBAAA,CACA,IAAA,wBAAA,CACA,IAAA,uBAAA,CACA,KAAA,mBAAA,CAAA\",\"sourcesContent\":[\"* {\\n    -webkit-touch-callout: none;\\n    -webkit-user-select: none;\\n    user-select: none;\\n    touch-action: none; /* prevent pinch zoom in whole app */\\n}\\n\\ntextarea {\\n    -webkit-user-select: initial;\\n}\\n\\nhtml,\\nbody{\\n    margin: 0;\\n    width: 100%;\\n    height: 100%;\\n    position: fixed;\\n    font-size: 40px;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    html,\\n    body{\\n        font-size: 28px;\\n    }   \\n}\\n\\nbody {\\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\nbody, input, textarea {\\n    font-family: -apple-system, BlinkMacSystemFont, \\\"Segoe UI\\\", Roboto, Helvetica, Arial, sans-serif, \\\"Apple Color Emoji\\\", \\\"Segoe UI Emoji\\\", \\\"Segoe UI Symbol\\\";\\n    line-height: 1.5rem;\\n}\\n\\n.button {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    text-align: center;\\n    font-size: 0.75rem;\\n    border-radius: 30%;\\n    cursor: pointer;\\n    background: rgba(255, 255, 255, 0.5);\\n    color: black;\\n    transition: transform 0.25s;\\n}\\n\\n.button.down {\\n    transform: scale(0.9);\\n}\\n\\n.button i{\\n    line-height: 1.5rem;\\n}\\n\\n.button .fa-stack{\\n    height: 1em;\\n    width: 1em;    \\n}\\n\\n.button .fa-stack.fa-fw{\\n    width: 1.25em;    \\n}\\n\\n#dropbox-button{\\n    border-radius: 3px;\\n    background-color: #007ee5;\\n    border: none;\\n    color: #fff;\\n    font-size: 16px;\\n    padding: 10px 15px;\\n    text-decoration: none;\\n    height: 24px;\\n}\\n\\n.view {\\n    display: flex;\\n    position: fixed;\\n    width: 100%;\\n    height: 100%;\\n    background: #BBB;\\n    overflow: hidden;\\n}\\n\\n.dropbox-auth{\\n    align-items: center;\\n    justify-content: center;\\n}\\n\\n.view.book {\\n    flex-wrap: wrap;\\n    align-content: flex-start;\\n    justify-content: center;\\n    overflow-y: auto;\\n    -webkit-overflow-scrolling: touch;\\n}\\n\\n.view.book, .view.book * {\\n    touch-action: pan-y;\\n}\\n\\n.view.settings {\\n    font-size: .4rem;\\n    display: block;\\n    box-sizing: border-box;\\n    line-height: 1.5em;\\n    color: #444;\\n}\\n\\n.view.settings .left-panel{\\n    width: 40%;\\n    padding: 1.2rem .25rem;\\n    box-sizing: border-box;\\n}\\n\\n.view.settings input{\\n    font-size: 0.5rem;\\n    line-height: 1em;\\n    border: none;\\n    width: 100%;\\n    border-radius: 0.5em;\\n    box-sizing: border-box;\\n    padding: 0.5em;\\n    -webkit-user-select: initial;\\n}\\n\\n.view.settings .button{\\n    width: 1rem;\\n    height: 1rem;\\n    line-height: 1rem;\\n}\\n\\n.view.settings .button.text {\\n    width: auto;\\n    border-radius: .5em;\\n    padding: 0 .5em;\\n    margin-bottom: .5em;\\n    text-align: left;\\n    overflow: hidden;\\n    font-size: 0.5rem;\\n    background: #58b0ff;\\n    color: white;\\n}\\n\\n.view.settings label{\\n    display: block;\\n    color: grey;\\n}\\n\\n.view.settings #log {\\n    width: 60%;\\n    background: #272727;\\n    color: #c7c7c7;\\n    overflow: scroll;\\n    -webkit-overflow-scrolling: touch;\\n    touch-action: pan-y;\\n    height: 100vh;\\n    padding: 0;\\n    font-family: monospace;\\n    font-size: 12px;\\n    position: fixed;\\n    top: 0;\\n    right: 0;\\n    margin: 0;\\n    line-height: 20px;\\n}\\n\\n#log li {\\n    border-bottom: #444444 solid 1px;\\n    padding: 0 1em;\\n}\\n\\n.thumbnail {\\n    margin: 0.3rem;\\n    color: #CCC;\\n    background: white;\\n    border-radius: 0.1rem;\\n    font-size: 5.6rem;\\n    width: 1em;\\n    height: 0.75em;\\n    background-size: contain;\\n    cursor: pointer;\\n    transition: opacity 1s;\\n}\\n\\n.thumbnail.down {\\n    transform: scale(0.9);\\n}\\n\\n.paint{\\n    align-items: center;\\n}\\n\\n.paint #sheet {\\n    font-size: 1px;\\n    width: 1024em;\\n    height: 768em;\\n    margin: auto;\\n    overflow: auto;\\n    position: fixed;\\n    object-fit: contain;\\n    left: 0;\\n    top: 0;\\n    bottom: 0;\\n    right: 0;\\n}\\n\\n.layer {\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    background: none;\\n}\\n\\n#base-layer {\\n    background: white;\\n}\\n\\n.layer.floating{\\n    outline: 2px dashed black;\\n}\\n\\n#stamp-layer{\\n    opacity: 0.2;\\n}\\n\\n@media (orientation: portrait) {\\n    .paint #sheet {\\n        transform: rotate(-90deg);\\n        overflow-x: hidden;\\n    }\\n}\\n\\n\\n.button.back {\\n    position: absolute;\\n    top: 0.25rem;\\n    left: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button.settings {\\n    position: absolute;\\n    right: 0.25rem;\\n    top: 0.25rem;\\n    z-index: 100;\\n}\\n\\n.button a{\\n    width: 100%;\\n    height: 100%;\\n    display: block;\\n    color: black;    \\n}\\n\\n.button#stamp-button{\\n    font-size: 1.25rem;\\n    position: absolute;\\n    top: 0.25rem;\\n    right: 0.25rem;\\n    width: 2rem;\\n    height: 2rem;\\n    z-index: 100;\\n    line-height: 1.85rem;\\n}\\n\\n.toolbar {\\n    display: flex;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    z-index: 100;\\n    position: absolute;\\n}\\n\\n.toolbar.left {\\n    flex-direction: column;\\n    left: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right {\\n    flex-direction: column;\\n    right: 0.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.top {\\n    flex-direction: row;\\n    left: 50%;\\n    top: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom {\\n    flex-direction: row;\\n    left: 50%;\\n    bottom: 0.25em;\\n    transform: translateX(-50%);\\n}\\n\\n\\n.toolbar .button {\\n    /*display: inline-block;*/\\n    background: transparent;\\n}\\n\\n.toolbar .spacer {\\n    width: 1.5em;\\n    height: 1.5em;\\n}\\n\\n.palette {\\n    position: relative;\\n    transition: transform 0.25s;\\n    display: inline-block;\\n    float: left;\\n    text-align: center;\\n    z-index: 100;\\n}\\n\\n.palette .option i {\\n    font-size: 0.75em;\\n}\\n\\n/* down direction is default: */\\n.palette .options{\\n    position: absolute;\\n    display: flex;\\n    flex-wrap: wrap;\\n    background: lightgray;\\n    border-radius: 0.5rem;\\n    padding: 0.25rem;\\n    transition: transform 0.15s;\\n    top: 2.25rem;\\n    left: 50%;\\n    transform: translateX(-50%);\\n}\\n\\n.palette .option {\\n    width: 1em;\\n    height: 1em;\\n    line-height: 0.75em;\\n    display: inline-block;\\n    margin: 0.25em;\\n    float: left;\\n    transition: transform 0.25s;\\n    background-size: contain;\\n    background-repeat: no-repeat;\\n    background-position: center;\\n}\\n.palette.button .option {\\n    width: 1.5rem;\\n    height: 1.5rem;\\n    line-height: 1.5rem;\\n    margin: 0;\\n}\\n\\n.palette .options .option {\\n    margin: 0.125em;\\n}\\n\\n.palette .option:active {\\n    transform: scale(0.9);\\n}\\n\\n.palette .options .arrow {\\n    position: absolute;\\n    width: 0;\\n    height: 0;\\n    font-size: 0.25rem;\\n    top: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-bottom: 2em solid lightgray;\\n    border-top: none;\\n}\\n\\n#send-palette .options{\\n    width: auto!important;\\n}\\n\\n#send-palette .options .option{\\n    width: auto;\\n    font-size: 0.75rem;\\n    line-height: 1rem;\\n    height: 1rem;\\n}\\n\\n.toolbar.left .palette .options{\\n    left: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.left .palette .options .arrow {\\n    top: initial;\\n    left: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-right: 2em solid lightgray;\\n}\\n\\n.toolbar.right .palette .options{\\n    left: initial;\\n    right: 2.25rem;\\n    top: 50%;\\n    transform: translateY(-50%);\\n}\\n\\n.toolbar.right .palette .options .arrow {\\n    left: initial;\\n    top: initial;\\n    right: -2em;\\n    top: 50%;\\n    margin-top: -1em;\\n    border-top: 1em solid transparent;\\n    border-bottom: 1em solid transparent;\\n    border-left: 2em solid lightgray;\\n    border-right: 0;\\n}\\n\\n.toolbar.bottom .palette .options{\\n    left: 50%;\\n    top: initial;\\n    bottom: 2.25rem;\\n    transform: translateX(-50%);\\n}\\n\\n.toolbar.bottom .palette .options .arrow {\\n    top: initial;\\n    bottom: -2em;\\n    left: 50%;\\n    margin-left: -1em;\\n    border-left: 1em solid transparent;\\n    border-right: 1em solid transparent;\\n    border-top: 2em solid lightgray;\\n    border-bottom: none;\\n}\\n\\n.palette.collapsed:active {\\n    transform: scale(0.9);\\n}\\n\\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\\n    transform: translateX(-50%) scale(0.0);\\n}\\n\\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\\n    transform: translateY(-50%) scale(0.0);\\n}\\n\\n#stamp-palette.palette .options{\\n    font-size: 1.5rem;\\n}\\n\\n@media (max-width: 400px), (max-height: 400px){\\n    #stamp-palette.palette .options{\\n        font-size: 1rem;\\n    }\\n}\\n\\n.line-width{\\n    background: black;\\n    height: 100%;\\n    margin: auto;\\n    border-radius: 0.15em;\\n}\\n\\n#color-palette .option {\\n    border-radius: 40%;\\n}\\n\\n.hidden {\\n    display: none!important;\\n}\\n\\n.disabled {\\n    opacity: 0.25;\\n}\\n\\n.selected {\\n    background: #58b0ff!important;\\n    color: white;\\n}\\n\\n.bounce {\\n    animation-duration: 0.8s;\\n    animation-name: bounce;\\n    animation-iteration-count: 1;\\n    animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes bounce {\\n    0% { transform: scale(1); }\\n    30% { transform: scale(2); }\\n    100% { transform: scale(1); }\\n}\\n\\n.shake {\\n    animation-duration: 1s;\\n    animation-name: shake;\\n    animation-iteration-count: 1;\\n    animation-timing-function: ease-in-out;\\n}\\n\\n@keyframes shake {\\n    0% { transform: rotate(0); }\\n    15% { transform: rotate(45deg); }\\n    50% { transform: rotate(-45deg); }\\n    85% { transform: rotate(45deg); }\\n    100% { transform: rotate(0); }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/resolve-url-loader/index.js!../../node_modules/sass-loader/dist/cjs.js!./painter.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n// It's empty as some runtime module handles the default behavior\n__webpack_require__.x = function() {};\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// Promise = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t179: 0\n};\n\nvar deferredModules = [\n\t[5293,356]\n];\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\nvar checkDeferredModules = function() {};\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n\tvar [chunkIds, moreModules, runtime, executeModules] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0, resolves = [];\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tresolves.push(installedChunks[chunkId][0]);\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\tfor(moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\twhile(resolves.length) {\n\t\tresolves.shift()();\n\t}\n\n\t// add entry modules from loaded chunk to deferred list\n\tif(executeModules) deferredModules.push.apply(deferredModules, executeModules);\n\n\t// run deferred modules when all chunks ready\n\treturn checkDeferredModules();\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkweb_paint\"] = self[\"webpackChunkweb_paint\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n\nfunction checkDeferredModulesImpl() {\n\tvar result;\n\tfor(var i = 0; i < deferredModules.length; i++) {\n\t\tvar deferredModule = deferredModules[i];\n\t\tvar fulfilled = true;\n\t\tfor(var j = 1; j < deferredModule.length; j++) {\n\t\t\tvar depId = deferredModule[j];\n\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferredModules.splice(i--, 1);\n\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n\t\t}\n\t}\n\tif(deferredModules.length === 0) {\n\t\t__webpack_require__.x();\n\t\t__webpack_require__.x = function() {};\n\t}\n\treturn result;\n}\nvar startup = __webpack_require__.x;\n__webpack_require__.x = function() {\n\t// reset startup function so it can be called again when more startup code is added\n\t__webpack_require__.x = startup || (function() {});\n\treturn (checkDeferredModules = checkDeferredModulesImpl)();\n};","// run startup\n__webpack_require__.x();\n"],"sourceRoot":""}