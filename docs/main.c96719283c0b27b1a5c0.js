!function(){"use strict";var t={4583:function(t,e,i){var n=i(4015),o=i.n(n),s=i(3645),a=i.n(s)()(o());a.push([t.id,'*{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;touch-action:none}textarea{-webkit-user-select:initial}html,body{margin:0;width:100%;height:100%;position:fixed;font-size:40px}@media(max-width: 400px),(max-height: 400px){html,body{font-size:28px}}body{-webkit-tap-highlight-color:rgba(0,0,0,0);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5rem}body,input,textarea{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5rem}.button{width:1.5rem;height:1.5rem;line-height:1.5rem;text-align:center;font-size:.75rem;border-radius:30%;cursor:pointer;background:rgba(255,255,255,.5);color:#000;transition:transform .25s}.button.down{transform:scale(0.9)}.button i{line-height:1.5rem}#dropbox-button{border-radius:3px;background-color:#007ee5;border:none;color:#fff;font-size:16px;padding:10px 15px;text-decoration:none;height:24px}.view{display:flex;position:fixed;width:100%;height:100%;background:#bbb;overflow:hidden}.dropbox-auth{align-items:center;justify-content:center}.view.book{flex-wrap:wrap;align-content:flex-start;justify-content:center;overflow-y:auto;-webkit-overflow-scrolling:touch}.view.book,.view.book *{touch-action:pan-y}.view.settings{font-size:.5rem;padding:2rem;display:block;box-sizing:border-box;padding-right:52%;line-height:1.4em}.view.settings .button.text{width:auto;border-radius:.5em;padding:0 .5em;margin-right:.5em;margin-bottom:.5em}.view.settings label{display:block;text-transform:uppercase;color:gray}.view.settings #log{width:50vw;background:#272727;color:#c7c7c7;overflow:scroll;-webkit-overflow-scrolling:touch;touch-action:pan-y;height:100vh;padding:0;font-family:monospace;font-size:12px;position:fixed;top:0;right:0;margin:0;line-height:20px}#log li{border-bottom:#444 solid 1px;padding:0 1em}.thumbnail{margin:.3rem;color:#ccc;background:#fff;border-radius:.1rem;font-size:5.6rem;width:1em;height:.75em;background-size:contain;cursor:pointer;transition:opacity 1s}.thumbnail.down{transform:scale(0.9)}.paint{align-items:center}.paint #sheet{font-size:1px;width:1024em;height:768em;margin:auto;overflow:auto;position:fixed;object-fit:contain;left:0;top:0;bottom:0;right:0}.layer{position:absolute;left:0;top:0;background:none}#base-layer{background:#fff}.layer.floating{outline:2px dashed #000}#stamp-layer{opacity:.2}@media(orientation: portrait){.paint #sheet{transform:rotate(-90deg);overflow-x:hidden}}.button.back{position:absolute;top:.25rem;left:.25rem;z-index:100}.button.settings{position:absolute;right:.25rem;top:.25rem;z-index:100}.button a{width:100%;height:100%;display:block;color:#000}.button#stamp-button{font-size:1.25rem;position:absolute;top:.25rem;right:.25rem;width:2rem;height:2rem;z-index:100;line-height:1.85rem}.toolbar{display:flex;background:#d3d3d3;border-radius:.5rem;z-index:100;position:absolute}.toolbar.left{flex-direction:column;left:.25rem;top:50%;transform:translateY(-50%)}.toolbar.right{flex-direction:column;right:.25rem;top:50%;transform:translateY(-50%)}.toolbar.top{flex-direction:row;left:50%;top:.25em;transform:translateX(-50%)}.toolbar.bottom{flex-direction:row;left:50%;bottom:.25em;transform:translateX(-50%)}.toolbar .button{background:transparent}.toolbar .spacer{width:1.5em;height:1.5em}.palette{position:relative;transition:transform .25s;display:inline-block;float:left;text-align:center;z-index:100}.palette .option i{font-size:.75em}.palette .options{position:absolute;display:flex;flex-wrap:wrap;background:#d3d3d3;border-radius:.5rem;padding:.25rem;transition:transform .15s;top:2.25rem;left:50%;transform:translateX(-50%)}.palette .option{width:1em;height:1em;line-height:.75em;display:inline-block;margin:.25em;float:left;transition:transform .25s;background-size:contain;background-repeat:no-repeat;background-position:center}.palette .options .option{margin:.125em}.palette .option:active{transform:scale(0.9)}.palette .options .arrow{position:absolute;width:0;height:0;font-size:.25rem;top:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-bottom:2em solid #d3d3d3;border-top:none}.toolbar.left .palette .options{left:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.left .palette .options .arrow{top:initial;left:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-right:2em solid #d3d3d3}.toolbar.right .palette .options{left:initial;right:2.25rem;top:50%;transform:translateY(-50%)}.toolbar.right .palette .options .arrow{left:initial;top:initial;right:-2em;top:50%;margin-top:-1em;border-top:1em solid transparent;border-bottom:1em solid transparent;border-left:2em solid #d3d3d3;border-right:0}.toolbar.bottom .palette .options{left:50%;top:initial;bottom:2.25rem;transform:translateX(-50%)}.toolbar.bottom .palette .options .arrow{top:initial;bottom:-2em;left:50%;margin-left:-1em;border-left:1em solid transparent;border-right:1em solid transparent;border-top:2em solid #d3d3d3;border-bottom:none}.palette.collapsed:active{transform:scale(0.9)}.toolbar.top .palette.collapsed .options,.toolbar.bottom .palette.collapsed .options{transform:translateX(-50%) scale(0)}.toolbar.left .palette.collapsed .options,.toolbar.right .palette.collapsed .options{transform:translateY(-50%) scale(0)}#stamp-palette.palette .options{font-size:1.5rem}@media(max-width: 400px),(max-height: 400px){#stamp-palette.palette .options{font-size:1rem}}.line-width{background:#000;height:100%;margin:auto;border-radius:.15em}#color-palette .option{border-radius:40%}.hidden{display:none !important}.disabled{opacity:.25}.selected{background:#58b0ff !important;color:#fff}',"",{version:3,sources:["webpack://./painter.css"],names:[],mappings:"AAAA,EACI,0BAAA,CACA,wBAAA,CACA,gBAAA,CACA,iBAAA,CAGJ,SACI,2BAAA,CAGJ,UAEI,QAAA,CACA,UAAA,CACA,WAAA,CACA,cAAA,CACA,cAAA,CAGJ,6CACI,UAEI,cAAA,CAAA,CAIR,KACI,yCAAA,CACA,gJAAA,CACA,kBAAA,CAGJ,oBACI,gJAAA,CACA,kBAAA,CAGJ,QACI,YAAA,CACA,aAAA,CACA,kBAAA,CACA,iBAAA,CACA,gBAAA,CACA,iBAAA,CACA,cAAA,CACA,+BAAA,CACA,UAAA,CACA,yBAAA,CAGJ,aACI,oBAAA,CAGJ,UACI,kBAAA,CAGJ,gBACI,iBAAA,CACA,wBAAA,CACA,WAAA,CACA,UAAA,CACA,cAAA,CACA,iBAAA,CACA,oBAAA,CACA,WAAA,CAGJ,MACI,YAAA,CACA,cAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,eAAA,CAGJ,cACI,kBAAA,CACA,sBAAA,CAGJ,WACI,cAAA,CACA,wBAAA,CACA,sBAAA,CACA,eAAA,CACA,gCAAA,CAGJ,wBACI,kBAAA,CAGJ,eACI,eAAA,CACA,YAAA,CACA,aAAA,CACA,qBAAA,CACA,iBAAA,CACA,iBAAA,CAGJ,4BACI,UAAA,CACA,kBAAA,CACA,cAAA,CACA,iBAAA,CACA,kBAAA,CAGJ,qBACI,aAAA,CACA,wBAAA,CACA,UAAA,CAGJ,oBACI,UAAA,CACA,kBAAA,CACA,aAAA,CACA,eAAA,CACA,gCAAA,CACA,kBAAA,CACA,YAAA,CACA,SAAA,CACA,qBAAA,CACA,cAAA,CACA,cAAA,CACA,KAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CAGJ,QACI,4BAAA,CACA,aAAA,CAGJ,WACI,YAAA,CACA,UAAA,CACA,eAAA,CACA,mBAAA,CACA,gBAAA,CACA,SAAA,CACA,YAAA,CACA,uBAAA,CACA,cAAA,CACA,qBAAA,CAGJ,gBACI,oBAAA,CAGJ,OACI,kBAAA,CAGJ,cACI,aAAA,CACA,YAAA,CACA,YAAA,CACA,WAAA,CACA,aAAA,CACA,cAAA,CACA,kBAAA,CACA,MAAA,CACA,KAAA,CACA,QAAA,CACA,OAAA,CAGJ,OACI,iBAAA,CACA,MAAA,CACA,KAAA,CACA,eAAA,CAGJ,YACI,eAAA,CAGJ,gBACI,uBAAA,CAGJ,aACI,UAAA,CAGJ,8BACI,cACI,wBAAA,CACA,iBAAA,CAAA,CAKR,aACI,iBAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CAGJ,iBACI,iBAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CAGJ,UACI,UAAA,CACA,WAAA,CACA,aAAA,CACA,UAAA,CAGJ,qBACI,iBAAA,CACA,iBAAA,CACA,UAAA,CACA,YAAA,CACA,UAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,SACI,YAAA,CACA,kBAAA,CACA,mBAAA,CACA,WAAA,CACA,iBAAA,CAGJ,cACI,qBAAA,CACA,WAAA,CACA,OAAA,CACA,0BAAA,CAGJ,eACI,qBAAA,CACA,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,aACI,kBAAA,CACA,QAAA,CACA,SAAA,CACA,0BAAA,CAGJ,gBACI,kBAAA,CACA,QAAA,CACA,YAAA,CACA,0BAAA,CAIJ,iBAEI,sBAAA,CAGJ,iBACI,WAAA,CACA,YAAA,CAGJ,SACI,iBAAA,CACA,yBAAA,CACA,oBAAA,CACA,UAAA,CACA,iBAAA,CACA,WAAA,CAGJ,mBACI,eAAA,CAIJ,kBACI,iBAAA,CACA,YAAA,CACA,cAAA,CACA,kBAAA,CACA,mBAAA,CACA,cAAA,CACA,yBAAA,CACA,WAAA,CACA,QAAA,CACA,0BAAA,CAGJ,iBACI,SAAA,CACA,UAAA,CACA,iBAAA,CACA,oBAAA,CACA,YAAA,CACA,UAAA,CACA,yBAAA,CACA,uBAAA,CACA,2BAAA,CACA,0BAAA,CAGJ,0BACI,aAAA,CAGJ,wBACI,oBAAA,CAGJ,yBACI,iBAAA,CACA,OAAA,CACA,QAAA,CACA,gBAAA,CACA,QAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,+BAAA,CACA,eAAA,CAGJ,gCACI,YAAA,CACA,OAAA,CACA,0BAAA,CAGJ,uCACI,WAAA,CACA,SAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,8BAAA,CAGJ,iCACI,YAAA,CACA,aAAA,CACA,OAAA,CACA,0BAAA,CAGJ,wCACI,YAAA,CACA,WAAA,CACA,UAAA,CACA,OAAA,CACA,eAAA,CACA,gCAAA,CACA,mCAAA,CACA,6BAAA,CACA,cAAA,CAGJ,kCACI,QAAA,CACA,WAAA,CACA,cAAA,CACA,0BAAA,CAGJ,yCACI,WAAA,CACA,WAAA,CACA,QAAA,CACA,gBAAA,CACA,iCAAA,CACA,kCAAA,CACA,4BAAA,CACA,kBAAA,CAGJ,0BACI,oBAAA,CAGJ,qFACI,mCAAA,CAGJ,qFACI,mCAAA,CAGJ,gCACI,gBAAA,CAGJ,6CACI,gCACI,cAAA,CAAA,CAIR,YACI,eAAA,CACA,WAAA,CACA,WAAA,CACA,mBAAA,CAGJ,uBACI,iBAAA,CAGJ,QACI,uBAAA,CAGJ,UACI,WAAA,CAGJ,UACI,6BAAA,CACA,UAAA",sourcesContent:['* {\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    user-select: none;\n    touch-action: none; /* prevent pinch zoom in whole app */\n}\n\ntextarea {\n    -webkit-user-select: initial;\n}\n\nhtml,\nbody{\n    margin: 0;\n    width: 100%;\n    height: 100%;\n    position: fixed;\n    font-size: 40px;\n}\n\n@media (max-width: 400px), (max-height: 400px){\n    html,\n    body{\n        font-size: 28px;\n    }   \n}\n\nbody {\n    -webkit-tap-highlight-color: rgba(0,0,0,0);\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    line-height: 1.5rem;\n}\n\nbody, input, textarea {\n    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    line-height: 1.5rem;\n}\n\n.button {\n    width: 1.5rem;\n    height: 1.5rem;\n    line-height: 1.5rem;\n    text-align: center;\n    font-size: 0.75rem;\n    border-radius: 30%;\n    cursor: pointer;\n    background: rgba(255, 255, 255, 0.5);\n    color: black;\n    transition: transform 0.25s;\n}\n\n.button.down {\n    transform: scale(0.9);\n}\n\n.button i{\n    line-height: 1.5rem;\n}\n\n#dropbox-button{\n    border-radius: 3px;\n    background-color: #007ee5;\n    border: none;\n    color: #fff;\n    font-size: 16px;\n    padding: 10px 15px;\n    text-decoration: none;\n    height: 24px;\n}\n\n.view {\n    display: flex;\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    background: #BBB;\n    overflow: hidden;\n}\n\n.dropbox-auth{\n    align-items: center;\n    justify-content: center;\n}\n\n.view.book {\n    flex-wrap: wrap;\n    align-content: flex-start;\n    justify-content: center;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n}\n\n.view.book, .view.book * {\n    touch-action: pan-y;\n}\n\n.view.settings {\n    font-size: 0.5rem;\n    padding: 2rem;\n    display: block;\n    box-sizing: border-box;\n    padding-right: 52%;\n    line-height: 1.4em;\n}\n\n.view.settings .button.text {\n    width: auto;\n    border-radius: 0.5em;\n    padding: 0 0.5em;\n    margin-right: 0.5em;\n    margin-bottom: 0.5em;\n}\n\n.view.settings label{\n    display: block;\n    text-transform: uppercase;\n    color: grey;\n}\n\n.view.settings #log {\n    width: 50vw;\n    background: #272727;\n    color: #c7c7c7;\n    overflow: scroll;\n    -webkit-overflow-scrolling: touch;\n    touch-action: pan-y;\n    height: 100vh;\n    padding: 0;\n    font-family: monospace;\n    font-size: 12px;\n    position: fixed;\n    top: 0;\n    right: 0;\n    margin: 0;\n    line-height: 20px;\n}\n\n#log li {\n    border-bottom: #444444 solid 1px;\n    padding: 0 1em;\n}\n\n.thumbnail {\n    margin: 0.3rem;\n    color: #CCC;\n    background: white;\n    border-radius: 0.1rem;\n    font-size: 5.6rem;\n    width: 1em;\n    height: 0.75em;\n    background-size: contain;\n    cursor: pointer;\n    transition: opacity 1s;\n}\n\n.thumbnail.down {\n    transform: scale(0.9);\n}\n\n.paint{\n    align-items: center;\n}\n\n.paint #sheet {\n    font-size: 1px;\n    width: 1024em;\n    height: 768em;\n    margin: auto;\n    overflow: auto;\n    position: fixed;\n    object-fit: contain;\n    left: 0;\n    top: 0;\n    bottom: 0;\n    right: 0;\n}\n\n.layer {\n    position: absolute;\n    left: 0;\n    top: 0;\n    background: none;\n}\n\n#base-layer {\n    background: white;\n}\n\n.layer.floating{\n    outline: 2px dashed black;\n}\n\n#stamp-layer{\n    opacity: 0.2;\n}\n\n@media (orientation: portrait) {\n    .paint #sheet {\n        transform: rotate(-90deg);\n        overflow-x: hidden;\n    }\n}\n\n\n.button.back {\n    position: absolute;\n    top: 0.25rem;\n    left: 0.25rem;\n    z-index: 100;\n}\n\n.button.settings {\n    position: absolute;\n    right: 0.25rem;\n    top: 0.25rem;\n    z-index: 100;\n}\n\n.button a{\n    width: 100%;\n    height: 100%;\n    display: block;\n    color: black;    \n}\n\n.button#stamp-button{\n    font-size: 1.25rem;\n    position: absolute;\n    top: 0.25rem;\n    right: 0.25rem;\n    width: 2rem;\n    height: 2rem;\n    z-index: 100;\n    line-height: 1.85rem;\n}\n\n.toolbar {\n    display: flex;\n    background: lightgray;\n    border-radius: 0.5rem;\n    z-index: 100;\n    position: absolute;\n}\n\n.toolbar.left {\n    flex-direction: column;\n    left: 0.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.right {\n    flex-direction: column;\n    right: 0.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.top {\n    flex-direction: row;\n    left: 50%;\n    top: 0.25em;\n    transform: translateX(-50%);\n}\n\n.toolbar.bottom {\n    flex-direction: row;\n    left: 50%;\n    bottom: 0.25em;\n    transform: translateX(-50%);\n}\n\n\n.toolbar .button {\n    /*display: inline-block;*/\n    background: transparent;\n}\n\n.toolbar .spacer {\n    width: 1.5em;\n    height: 1.5em;\n}\n\n.palette {\n    position: relative;\n    transition: transform 0.25s;\n    display: inline-block;\n    float: left;\n    text-align: center;\n    z-index: 100;\n}\n\n.palette .option i {\n    font-size: 0.75em;\n}\n\n/* down direction is default: */\n.palette .options{\n    position: absolute;\n    display: flex;\n    flex-wrap: wrap;\n    background: lightgray;\n    border-radius: 0.5rem;\n    padding: 0.25rem;\n    transition: transform 0.15s;\n    top: 2.25rem;\n    left: 50%;\n    transform: translateX(-50%);\n}\n\n.palette .option {\n    width: 1em;\n    height: 1em;\n    line-height: 0.75em;\n    display: inline-block;\n    margin: 0.25em;\n    float: left;\n    transition: transform 0.25s;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n}\n\n.palette .options .option {\n    margin: 0.125em;\n}\n\n.palette .option:active {\n    transform: scale(0.9);\n}\n\n.palette .options .arrow {\n    position: absolute;\n    width: 0;\n    height: 0;\n    font-size: 0.25rem;\n    top: -2em;\n    left: 50%;\n    margin-left: -1em;\n    border-left: 1em solid transparent;\n    border-right: 1em solid transparent;\n    border-bottom: 2em solid lightgray;\n    border-top: none;\n}\n\n.toolbar.left .palette .options{\n    left: 2.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.left .palette .options .arrow {\n    top: initial;\n    left: -2em;\n    top: 50%;\n    margin-top: -1em;\n    border-top: 1em solid transparent;\n    border-bottom: 1em solid transparent;\n    border-right: 2em solid lightgray;\n}\n\n.toolbar.right .palette .options{\n    left: initial;\n    right: 2.25rem;\n    top: 50%;\n    transform: translateY(-50%);\n}\n\n.toolbar.right .palette .options .arrow {\n    left: initial;\n    top: initial;\n    right: -2em;\n    top: 50%;\n    margin-top: -1em;\n    border-top: 1em solid transparent;\n    border-bottom: 1em solid transparent;\n    border-left: 2em solid lightgray;\n    border-right: 0;\n}\n\n.toolbar.bottom .palette .options{\n    left: 50%;\n    top: initial;\n    bottom: 2.25rem;\n    transform: translateX(-50%);\n}\n\n.toolbar.bottom .palette .options .arrow {\n    top: initial;\n    bottom: -2em;\n    left: 50%;\n    margin-left: -1em;\n    border-left: 1em solid transparent;\n    border-right: 1em solid transparent;\n    border-top: 2em solid lightgray;\n    border-bottom: none;\n}\n\n.palette.collapsed:active {\n    transform: scale(0.9);\n}\n\n.toolbar.top .palette.collapsed .options, .toolbar.bottom .palette.collapsed .options {\n    transform: translateX(-50%) scale(0.0);\n}\n\n.toolbar.left .palette.collapsed .options, .toolbar.right .palette.collapsed .options {\n    transform: translateY(-50%) scale(0.0);\n}\n\n#stamp-palette.palette .options{\n    font-size: 1.5rem;\n}\n\n@media (max-width: 400px), (max-height: 400px){\n    #stamp-palette.palette .options{\n        font-size: 1rem;\n    }\n}\n\n.line-width{\n    background: black;\n    height: 100%;\n    margin: auto;\n    border-radius: 0.15em;\n}\n\n#color-palette .option {\n    border-radius: 40%;\n}\n\n.hidden {\n    display: none!important;\n}\n\n.disabled {\n    opacity: 0.25;\n}\n\n.selected {\n    background: #58b0ff!important;\n    color: white;\n}\n'],sourceRoot:""}]),e.Z=a},920:function(t,e,i){i.r(e);var n=i(3379),o=i.n(n),s=i(4583);o()(s.Z,{insert:"head",singleton:!1}),e.default=s.Z.locals||{}},4554:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(6705),s=n(i(8226));class a extends s.default{constructor(t,e,i,n,s,a){super(t,"canvas",e,i,n,s,a),this._ctx=this.canvas.getContext("2d",{alpha:!0}),this._ctx.imageSmoothingQuality="high",this._ctx.imageSmoothingEnabled=o.config.imageSmoothing}get canvas(){return this._element}get ctx(){return this._ctx}getData(){return this._ctx.getImageData(0,0,this.width,this.height)}putData(t){this._ctx.putImageData(t,0,0)}drawImage(t,e){const{x:i,y:n,width:o,height:s}=e||{x:0,y:0,width:this.width,height:this.height};this._ctx.drawImage(t,i,n,o,s)}clear(t){const{x:e,y:i,width:n,height:o}=t||{x:0,y:0,width:this.width,height:this.height};this._ctx.clearRect(e,i,n,o)}}e.default=a},3803:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.History=void 0;const n=i(6705);e.History=class{constructor(){this._states=[],this._position=-1}get canUndo(){return this._position>0}get canRedo(){return this._position<this._states.length-1}recordState(t){this._position==n.config.maxUndoSteps-1&&(this._states.shift(),this._position--),this._states.splice(this._position+1,this._states.length-this._position+1),this._position++,this._states[this._position]=t}undo(){return this.canUndo?(this._position--,this._states[this._position]):null}redo(){return this.canRedo?(this._position++,this._states[this._position]):null}getCurrentState(){return this._position>-1&&this._position<this._states.length?this._states[this._position]:null}clear(){this._states=[],this._position=-1}}},179:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(8226));class s extends o.default{get image(){return this._element}constructor(t,e,i,n,o,s){super(t,"img",e,i,n,o,s),this._element.onload=()=>{this.resize(this.image.naturalWidth,this.image.naturalHeight)}}}e.default=s},8226:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(6705),l=s(i(9989)),h=a(i(4327));e.default=class{constructor(t,e,i,n,o,s,a){this._startScale=1,this._startRotation=0,this._position=new h.default(0,0),this._scale=1,this._rotation=0,this._lastTouchStartTime=0,this._pointers=[],this._element=document.createElement(e),this._element.id=i,this._element.classList.add("layer"),this._index=0,this._width=s,this._height=a,this._element.width=s,this._element.height=a,this._element.style.width=`${s}em`,this._element.style.height=`${a}em`,this._element.style.pointerEvents="none",t.appendChild(this._element),this.transform(new h.default(n,o),1,0),this.bindEventListeners()}get id(){return this._element.id}get index(){return this._index}set index(t){this._index=t,this.transform(this.position,this.scale,this.rotation)}get width(){return this._width}get height(){return this._height}get position(){return this._position}get rotation(){return this._rotation}get scale(){return this._scale}get floating(){return this._element.classList.contains("floating")}set floating(t){this._element.classList.toggle("floating",t),this._element.style.pointerEvents=t?"auto":"none",t?this.addEventListeners():this.removeEventListeners()}remove(){this._element.remove()}resize(t,e){const i=this.position.x+.5*(this.width-t),n=this.position.y+.5*(this.height-e);this.setPositionAndSize(i,n,t,e)}setPositionAndSize(t,e,i,n){this._width=i,this._height=n,this._element.width=i,this._element.height=n,this._element.style.width=`${i}em`,this._element.style.height=`${n}em`,this.transform(new h.default(t,e),this.scale,this.rotation)}drawToCanvas(t){t.save();let e=this._position.x+.5*this.width,i=this._position.y+.5*this.height;t.setTransform(this._scale,0,0,this._scale,e,i),t.rotate(this._rotation),t.translate(-.5*this.width,-.5*this.height),t.drawImage(this._element,0,0),t.restore()}addEventListeners(){this._element.addEventListener("click",this.preventDefault),l.pointerEventsSupported()?(this._element.addEventListener("touchstart",this.preventDefault),this._element.addEventListener("pointerdown",this.pointerDown)):this._element.addEventListener("touchstart",this.touchStart)}removeEventListeners(){this._element.removeEventListener("click",this.preventDefault),l.pointerEventsSupported()?(this._element.removeEventListener("touchstart",this.preventDefault),this._element.removeEventListener("pointerdown",this.pointerDown)):this._element.removeEventListener("touchstart",this.touchStart)}preventDefault(t){t.preventDefault()}doubleTap(t){this.onDoubleTap&&this.onDoubleTap(t)}pointerDown(t){if(t.preventDefault(),this._element.setPointerCapture(t.pointerId),this.addPointerEvent(t),1===this._pointers.length)if(t.timeStamp<this._lastTouchStartTime+r.config.doubleTapDelay&&this.doubleTap(t),this._lastTouchStartTime=t.timeStamp,this._element.addEventListener("pointermove",this.pointerMove),this._element.addEventListener("pointerup",this.pointerUp),this._pinchCenter=new h.default(this._position.x+.5*this.width,this._position.y+.5*this.height),t.altKey){let t=this.clientToPixel(this._pointers[0]),e=this._pinchCenter.clone().multiplyScalar(2).subtract(t);this.pinchStart(t,e)}else this.dragStart(this.clientToPixel(this._pointers[0]));2===this._pointers.length&&this.pinchStart(this.clientToPixel(this._pointers[0]),this.clientToPixel(this._pointers[1]))}addPointerEvent(t){const e=this._pointers.findIndex((e=>e.pointerId==t.pointerId));e<0?this._pointers.push(t):this._pointers[e]=t}removePointerEvent(t){const e=this._pointers.findIndex((e=>e.pointerId==t.pointerId));e>=0&&this._pointers.splice(e,1)}pointerMove(t){t.preventDefault(),this.addPointerEvent(t),this.move(this._pointers,t.altKey)}pointerUp(t){t.preventDefault(),this._element.releasePointerCapture(t.pointerId),this.removePointerEvent(t),1==this._pointers.length&&this.dragStart(this.clientToPixel(this._pointers[0])),0==this._pointers.length&&(this._element.removeEventListener("pointermove",this.pointerMove),this._element.removeEventListener("pointerup",this.pointerUp))}touchStart(t){if(t.preventDefault(),1===t.touches.length)if(t.timeStamp<this._lastTouchStartTime+r.config.doubleTapDelay&&this.doubleTap(t),this._lastTouchStartTime=t.timeStamp,this._element.addEventListener("touchmove",this.touchMove),this._element.addEventListener("touchend",this.touchEnd),this._pinchCenter=new h.default(this._position.x+.5*this.width,this._position.y+.5*this.height),t.altKey){let e=this.clientToPixel(t.touches[0]),i=this._pinchCenter.clone().multiplyScalar(2).subtract(e);this.pinchStart(e,i)}else this.dragStart(this.clientToPixel(t.touches[0]));2===t.touches.length&&this.pinchStart(this.clientToPixel(t.touches[0]),this.clientToPixel(t.touches[1]))}touchMove(t){t.preventDefault(),this.move(t.touches,t.altKey)}move(t,e){if(1===t.length)if(e){let e=this.clientToPixel(t[0]),i=this._pinchCenter.clone().multiplyScalar(2).subtract(e);this.pinchMove(e,i)}else this.dragMove(this.clientToPixel(t[0]));2===t.length&&this.pinchMove(this.clientToPixel(t[0]),this.clientToPixel(t[1]))}touchEnd(t){t.preventDefault(),this._element.removeEventListener("touchmove",this.touchMove),this._element.addEventListener("touchend",this.touchEnd)}transform(t,e,i){this._position=t,this._rotation=i,this._scale=e;const n=this._index;this._element.style.transform=`translate(${t.x}em, ${t.y}em) rotate(${i}rad) scale(${e}) translateZ(${n}px)`,this._element.style.outlineWidth=2/e+"em",this._element.style.outlineOffset=`-${2/e}em`}bindEventListeners(){this.touchStart=this.touchStart.bind(this),this.touchMove=this.touchMove.bind(this),this.touchEnd=this.touchEnd.bind(this),this.pointerDown=this.pointerDown.bind(this),this.pointerMove=this.pointerMove.bind(this),this.pointerUp=this.pointerUp.bind(this)}dragStart(t){this._localDragPosition=t.clone().subtract(this.position)}dragMove(t){t.subtract(this._localDragPosition),this.transform(t,this._scale,this._rotation)}pinchStart(t,e){let i=t.clone().add(e).multiplyScalar(.5);this._pinchStartDist=t.distanceTo(e),this._pinchStartRotation=Math.atan2(t.y-i.y,t.x-i.x),this._startRotation=this._rotation,this._startScale=this._scale}pinchMove(t,e){let i=t.clone().add(e).multiplyScalar(.5),n=t.distanceTo(e),o=Math.atan2(t.y-i.y,t.x-i.x)-this._pinchStartRotation,s=this._startScale*(n/this._pinchStartDist);s=l.clamp(.1,10,s);let a=t.clone().add(e).multiplyScalar(.5);a.x-=.5*this.width,a.y-=.5*this.height;let r=this._startRotation+o;this.transform(a,s,r)}clientToPixel(t){let e=this._element.parentElement.getBoundingClientRect();const i=e.height>e.width;let n=(t.clientX-e.left)/e.width,o=(t.clientY-e.top)/e.height,s=(i?1-o:n)*r.config.width,a=(i?n:o)*r.config.height;return new h.default(s,a)}}},2056:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.Toolbar=void 0;const n=i(7180);class o extends n.View{constructor(t){super(t),this.show()}flip(){(this._element.classList.contains("left")||this._element.classList.contains("right"))&&(this._element.classList.toggle("left"),this._element.classList.toggle("right")),(this._element.classList.contains("top")||this._element.classList.contains("bottom"))&&(this._element.classList.toggle("top"),this._element.classList.toggle("bottom"))}}e.Toolbar=o},5866:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),i(920);const s=i(8947),a=i(1436);s.library.add(a.fas),s.dom.watch(),i(6124);const r=o(i(9263)),l=i(8523),h=i(6705),d=o(i(8124));class c{constructor(){this._settingsView=new d.default("settings",(()=>{this.openView(this._bookView)})),this._sheet=document.getElementById("sheet"),window.addEventListener("resize",(t=>{this.OnResize()})),this.OnResize(),this._bookView=new r.default("book",(()=>n(this,void 0,void 0,(function*(){this.openView(this._settingsView)})))),this._bookView.onImageSelected=t=>{this._paintView.loadImage(t).then((()=>{this.openView(this._paintView)}))},this._paintView=new l.PaintView("paint",(()=>{this.openView(this._bookView)})),this.openView(this._bookView)}getIOSVersion(){if(/iP(hone|od|ad)/.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||"0",10)]}}OnResize(){const t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,i=t<e,n=t>1024,o=Math.max(t,e),s=Math.min(t,e),a=o/h.config.width,r=s/h.config.height,l=h.config.fullScreenCanvas&&!n?Math.max(a,r):Math.min(a,r);this._sheet.style.fontSize=`${l}px`,this._sheet.style.left=(i?.5*(t-l*h.config.width):0)+"px"}static preventOverScroll(){document.ontouchmove=t=>{t.preventDefault()}}openView(t){this._activeView&&this._activeView.hide(),this._activeView=t,this._activeView.show()}}document.addEventListener("DOMContentLoaded",(()=>{window.app=new c}))},6705:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.config=void 0;const i=["img/stamps/star.png","img/stamps/unicorn.png","img/stamps/snowman.png","img/stamps/dolphin.png","img/stamps/snail.png"];e.config={debug:!0,doubleTapDelay:400,longClickDelay:1e3,minScrollDistance:30,maxScrollDelay:500,maxShapeCount:64-i.length,usePointerEvents:!0,fullScreenCanvas:!0,pixelPerfect:!1,imageSmoothing:!0,useAutoMask:!1,maxUndoSteps:10,saveInterval:5e3,width:1024,height:768,defaultShapes:i,imageCount:32,images:{"image01.png":{overlay:"./img/overlays/spirit.png"},"image02.png":{overlay:"./img/overlays/spirit2.png"},"image03.png":{overlay:"./img/overlays/spirit3.png"},"image04.png":{overlay:"./img/overlays/santa.png"}}}},4327:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(9989));class r{constructor(t=0,e=0){this.x=t,this.y=e}set(t=0,e=t){return this.x=t,this.y=e,this}clone(){return new r(this.x,this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}clamp(t,e,i,n){return this.x=a.clamp(t,i,this.x),this.y=a.clamp(e,n,this.y),this}invert(){return this.x*=-1,this.y*=-1,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divideScalar(t){if(0===t)this.x=0,this.y=0;else{var e=1/t;this.x*=e,this.y*=e}return this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){return this.divideScalar(this.length())}distanceToSq(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}distanceTo(t){return Math.sqrt(this.distanceToSq(t))}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}}e.default=r},6121:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(4146);class o extends n.Palette{get color(){return this.selectedOption}set color(t){this.selectedOption=t}constructor(t){super(t,["#000000","#222034","#45283c","#663931","#8f563b","#df7126","#d9a066","#eec39a","#fbf236","#99e550","#6abe30","#37946e","#4b692f","#524b24","#323c39","#3f3f74","#306082","#5b6ee1","#639bff","#5fcde4","#cbdbfc","#ffffff","#9badb7","#847e87","#696a6a","#595652","#76428a","#ac3232","#d95763","#d77bba","#8f974a","#8a6f30"]),this.selectedIndex=15}updateOptionElement(t,e){t.style.background=e}}e.default=o},4146:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.Palette=void 0;const a=i(7180),r=s(i(9989));class l extends a.View{constructor(t,e,i=!1){super(t),this._options=e,this._optionElements=[],this._selectedIndex=0,this.createOptions(),this.show(),this.collapse()}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){this._selectedIndex=Math.max(0,Math.min(this._options.length-1,t)),this.updateSelectedOptionElement(this._selectedElement,this.selectedOption)}get selectedOption(){return this._options[this._selectedIndex]}set selectedOption(t){let e=this._options.indexOf(t);-1!==e&&(this.selectedIndex=e)}get isCollapsed(){return this._element.classList.contains("collapsed")}static collapseAll(){l._expandedPalette&&l._expandedPalette.collapse()}createOptions(){this.addSelectedOption(),this.addOptionElements()}recreateOptions(){this.clear(),this.createOptions()}collapse(){this._element.classList.add("collapsed"),l._expandedPalette==this&&(l._expandedPalette=null)}expand(){l.collapseAll(),this._element.classList.remove("collapsed"),l._expandedPalette=this}toggle(){this.isCollapsed?this.expand():this.collapse()}addOption(t){this._options.push(t),this.addOptionElement(this._options.length-1,t),this.updateOptionsWidth()}removeOption(t){this._options.splice(t,1),this._optionElements[t].remove(),this._optionElements.splice(t,1),this.recreateOptions()}addSelectedOption(){let t=document.createElement("div");t.classList.add("option"),this._selectedElement=t,r.addClick(t,(()=>this.toggle())),this.updateSelectedOptionElement(t,this.selectedOption),this._element.appendChild(t)}addOptionElements(){let t=document.createElement("div");t.classList.add("options"),this._optionsElement=t,this.addArrowElement();let e=0;for(let t of this._options)this.addOptionElement(e,t),e++;this.updateOptionsWidth(),this._element.appendChild(t)}updateOptionsWidth(){this._optionsElement.style.width=1.25*Math.min(8,this._options.length)+"em"}addArrowElement(){let t=document.createElement("div");t.classList.add("arrow"),this._optionsElement.appendChild(t)}addOptionElement(t,e){let i=document.createElement("div");i.classList.add("option"),i.dataset.index=`${t}`,r.addLongClick(i,(i=>this.optionLongClicked(i,e,t))),r.addClick(i,(i=>this.optionClicked(i,e,t))),this.updateOptionElement(i,e),this._optionsElement.appendChild(i),this._optionElements[t]=i}optionClicked(t,e,i){this.selectedIndex=i,this.collapse(),this.onSelectionChanged&&this.onSelectionChanged(e,i)}optionLongClicked(t,e,i){}updateOptionElement(t,e){}updateSelectedOptionElement(t,e){this.updateOptionElement(t,e)}}e.Palette=l},845:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(4146),o=i(2415),s=i(6705);class a extends n.Palette{constructor(t){super(t,s.config.defaultShapes,!0),this._shapeIds={},this.selectedIndex=0,o.imageStorage.keys().then((t=>{const e=t.filter((t=>t.startsWith("shape")));for(let t of e)this.addShapeFromImageId(t)})),o.imageStorage.addChangeListener(((t,e)=>{"save"==t&&e.startsWith("shape")&&this.addShapeFromImageId(e)}))}get stamp(){return this.selectedOption}addShapeFromImageId(t){o.imageStorage.loadImageUrl(t).then((e=>{this._shapeIds[e]=t,this.addOption(e)}))}optionLongClicked(t,e,i){this.deleteShape(i)}updateOptionElement(t,e){t.style.backgroundImage=`url("${e}")`}updateSelectedOptionElement(t,e){t.innerHTML='<i class="fas fa-shapes"></i>'}deleteShape(t){let e=this._options[t],i=this._shapeIds[e];i&&o.imageStorage.deleteImage(i).then((()=>{delete this._shapeIds[e],this.removeOption(t),this.selectedIndex==t&&(this.selectedIndex=t)}))}}e.default=a},5071:function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(4146);class o extends n.Palette{get size(){return this.selectedOption}set size(t){this.selectedOption=t}constructor(t){super(t,[2,8,24,40],!0),this.selectedIndex=1}updateOptionElement(t,e){const i=e/40;t.innerHTML='<div class="line-width" style="width:'+i+'em"></div>'}}e.default=o},2415:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.imageStorage=void 0,i(7147);const s=o(i(913)),a=o(i(6085));e.imageStorage=new class{get adapter(){return this._adapter||(this._adapter=new s.default,this.migrate()),this._adapter}get urls(){return this._urls||(this._urls={}),this._urls}loadImage(t){return n(this,void 0,void 0,(function*(){const e=yield this.loadImageUrl(t);if(!e)return null;const i=new Image;return i.id=t,i.src=e,null!=i.decode?(yield i.decode(),i):new Promise((t=>{i.onload=()=>t(i)}))}))}loadImageUrl(t){return n(this,void 0,void 0,(function*(){if(t in this.urls)return this.urls[t];const e=yield this.loadBlob(t);if(!e)return null;const i=URL.createObjectURL(e);return this.urls[t]=i,i}))}loadBlob(t){return this.adapter.getItem(t)}saveImage(t,e){return n(this,void 0,void 0,(function*(){try{yield this.adapter.setItem(t,e)}catch(t){}t in this.urls&&URL.revokeObjectURL(this.urls[t]),this.urls[t]=URL.createObjectURL(e),this.dispatchChangeEvent("save",t)}))}deleteImage(t){return this.adapter.removeItem(t).then((()=>{t in this.urls&&(URL.revokeObjectURL(this.urls[t]),delete this.urls[t]),this.dispatchChangeEvent("delete",t)}))}keys(){return this.adapter.keys()}addChangeListener(t){this._changeListeners=this._changeListeners||[],this._changeListeners.push(t)}dispatchChangeEvent(t,e){for(let i of this._changeListeners)i(t,e)}clear(){this.adapter.clear()}generateBackupArchive(){return n(this,void 0,void 0,(function*(){let t=0;var e=yield this.keys(),i=new a.default;for(let n of e){const e=yield this.loadImageUrl(n),o=yield fetch(e).then((t=>t.blob()));o&&(i.file(n,o),t+=1)}if(0!=t)return i.generateAsync({type:"blob"})}))}importBackupArchive(t){return n(this,void 0,void 0,(function*(){(yield a.default.loadAsync(t)).forEach(((t,e)=>n(this,void 0,void 0,(function*(){const t=yield e.async("arraybuffer"),i=new Blob([t],{type:"image/png"});this.saveImage(e.name,i)}))))}))}migrate(){return n(this,void 0,void 0,(function*(){let t=!1;var e=yield this.keys();for(let i of e){if(!i.startsWith("image")&&!i.startsWith("Shape"))continue;if(i.endsWith(".png"))continue;const e=i.replace("Shape","shape")+".png",n=yield this.adapter.getItem(i);yield this.adapter.setItem(e,n),yield this.adapter.removeItem(i),console.log(`Migrated ${i} to ${e}.`),t=!0}t&&location.reload()}))}getStorageUsed(){return n(this,void 0,void 0,(function*(){let t=0;var e=yield this.keys();for(let i of e){const e=yield this.loadImageUrl(i),n=yield fetch(e).then((t=>t.blob()));n&&(t+=n.size)}return t}))}}},913:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(i(9483)),s=n(i(7331));class a extends s.default{constructor(){super(...arguments),this._imageStore=o.default.createInstance({name:"ImageStore"})}getItem(t){return this._imageStore.getItem(t)}setItem(t,e){return this._imageStore.setItem(t,e)}removeItem(t){return this._imageStore.removeItem(t)}keys(){return this._imageStore.keys()}iterate(t){return this._imageStore.iterate(t)}clear(){return this._imageStore.clear()}}e.default=a},7331:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{}},3965:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=a(i(7540)),l=a(i(4327)),h=s(i(9989));class d extends r.default{constructor(t,e,i="darken"){super(t,e),this._operation=i,this.createBrushCtx()}createBrushCtx(){let t=document.createElement("canvas");t.id="brush",t.width=64,t.height=64,this._brushCtx=t.getContext("2d",{alpha:!0}),this._brushCtx.imageSmoothingQuality="high",this._brushCtx.imageSmoothingEnabled=!0}down(t){this._painter.captureAutoMask(t.position.clone().round()),this._points=[t.position];const e=this.getWidth(t.pressure,t.speed);this._widths=[e],this._startIndex=0;let i=this._painter.baseLayer.ctx;i.fillStyle=this.color,i.strokeStyle=this.color,this._painter.baseLayer.ctx.globalCompositeOperation=this._operation,this.requestDrawPath()}up(){this._painter.recordHistoryState()}tick(t){this._drawPathRequested&&(this.drawPath(),this._drawPathRequested=!1)}requestDrawPath(){this._drawPathRequested=!0}drawPath(){if(0==this._points.length)return;let t=this._painter.baseLayer.ctx;this.drawConnectedLines(t,this._points.slice(this._startIndex),this._widths.slice(this._startIndex)),this._startIndex=Math.max(0,this._points.length-1)}drawConnectedLines(t,e,i){const n=e.length;if(0==n)return;t.lineCap="round",t.lineJoin="round";let o=e[0],s=i[0]*this.lineWidth;1==n&&(t.beginPath(),t.arc(o.x,o.y,.5*s,0,2*Math.PI),t.fill());for(let o=1;o<n;o++)t.beginPath(),t.lineWidth=i[o]*this.lineWidth,t.lineTo(e[o-1].x,e[o-1].y),t.lineTo(e[o].x,e[o].y),t.stroke()}drawBrush(t,e,i,n){let o=.5*n;e-=o,i-=o,t.drawImage(this._brushCtx.canvas,e,i,n,n)}move(t){let e=this.interpolatePoints(t.position);this._points=this._points.concat(e);const i=e.length;let n=this.getWidth(t.pressure,t.speed);const o=this._widths[this._widths.length-1],s=2*i;n=h.clamp(o-s,o+s,n);for(let t=0;t<i;t++)this._widths.push(h.lerp(o,n,t/i));this.requestDrawPath()}interpolatePoints(t){const e=Math.max(4,.1*this.lineWidth),i=[];if(0==this._points.length)return;const n=this._points[this._points.length-1],o=t,s=n.distanceTo(o);if(s<e)return i;let a=n;if(this._points.length>1){const t=this._points[this._points.length-2],e=n.clone().subtract(t).normalize();a=n.clone().add(e.clone().multiplyScalar(.3*s))}const r=e/s;for(let t=r;t<=1;t+=r){const e=this.pointOnQuadraticCurve(n,a,o,t);i.push(e)}return i}pointOnQuadraticCurve(t,e,i,n){const o=(1-n)*(1-n),s=2*n*(1-n),a=n*n;return new l.default(t.x*o+e.x*s+i.x*a,t.y*o+e.y*s+i.y*a)}pressureChanged(){this.requestDrawPath()}getWidth(t,e){return t/h.clamp(1,2,e)}applyAutoMask(){if(!this._painter.autoMaskCtx)return;let t=this.getBufferCtx();t.globalCompositeOperation="destination-in",t.drawImage(this._painter.autoMaskCtx.canvas,0,0),t.globalCompositeOperation="source-over"}}e.default=d},442:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const l=r(i(7540)),h=r(i(4327)),d=r(i(5640)),c=i(2415),u=s(i(9989)),A=i(6705),p=i(3162);class m extends l.default{constructor(t,e){super(t,e),this.selectionLayerId="selection-layer",this._selection=d.default.Empty(),this._deleteButton=document.getElementById("selection-delete-button"),u.addClick(this._deleteButton,(()=>this.clearSelection())),this._stampButton=document.getElementById("selection-stamp-button"),u.addClick(this._stampButton,(()=>this.paintSelectionToCanvas())),this._saveButton=document.getElementById("selection-save-button"),u.addClick(this._saveButton,(()=>this.saveSelectionAsNewStamp())),this._downloadButton=document.getElementById("selection-download-button"),u.addClick(this._downloadButton,(()=>{this.selectionLayer.canvas.toBlob((t=>p.saveAs(t,"image.png")))})),this.hasFloatingSelection=!1,this._position=new h.default(0,0)}get selectionLayer(){return this._painter.getLayer(this.selectionLayerId)}get selection(){return this._selection}get hasFloatingSelection(){return this._hasFloatingSelection}set hasFloatingSelection(t){this._hasFloatingSelection=t,this.toggleFloatingSelectionButtons(t)}get isInShapesPalette(){return this._isInShapesPalette}set isInShapesPalette(t){this._isInShapesPalette=t,this._saveButton.classList.toggle("disabled",t)}toggleFloatingSelectionButtons(t){this._deleteButton.classList.toggle("hidden",!t),this._stampButton.classList.toggle("hidden",!t),this._downloadButton.classList.toggle("hidden",!t),this._saveButton.classList.toggle("hidden",!t)}enable(){super.enable(),this.createSelectionLayer(),this.hasFloatingSelection=!1,this.isInShapesPalette=!1}disable(){super.disable(),this.paintSelectionToCanvas(),this.destroySelectionLayer(),this.hasFloatingSelection=!1}down(t){this._position=this.getClampedPosition(t),this.startNewSelection()}move(t){this._position=this.getClampedPosition(t),this.requestDrawSelectionOutline()}up(t){this.cutSelection()}startNewSelection(){this.paintSelectionToCanvas(),this.selectionLayer.setPositionAndSize(0,0,this._painter.width,this._painter.height),this.selectionLayer.transform(new h.default(0,0),1,0),this.selectionLayer.floating=!1,this.hasFloatingSelection=!1,this.isInShapesPalette=!1,this._startPosition=this._position;let t=this.selectionLayer.ctx;t.setTransform(1,0,0,1,0,0),t.strokeStyle="black",t.lineCap="round",t.lineJoin="round",t.lineWidth=2,t.setLineDash([5,5]),this.requestDrawSelectionOutline()}getClampedPosition(t){return t.position.round().clamp(0,0,this._painter.width-1,this._painter.height-1)}tick(t){this._drawSelectionOutlineRequested&&(this.updateSelectionAndDrawOutline(),this._drawSelectionOutlineRequested=!1)}keyDown(t){switch(t.code){case"Backspace":this.clearSelection()}}clearSelection(){this.selectionLayer.clear(),this.startNewSelection()}setImage(t){this.hasFloatingSelection=!0,this.selectionLayer.resize(t.width,t.height),this.selectionLayer.floating=!0,this.selectionLayer.drawImage(t),this.isInShapesPalette=!0}setImageUrl(t){return a(this,void 0,void 0,(function*(){const e=new Image;return e.src=t,new Promise((t=>{e.onload=()=>{this.setImage(e),t(e)}}))}))}requestDrawSelectionOutline(){this._drawSelectionOutlineRequested=!0}updateSelectionAndDrawOutline(){if(this.hasFloatingSelection)return;this.selectionLayer.clear();let t=this.selectionLayer.ctx;const e=Math.min(this._startPosition.x,this._position.x),i=Math.min(this._startPosition.y,this._position.y),n=Math.abs(this._startPosition.x-this._position.x),o=Math.abs(this._startPosition.y-this._position.y);this._selection=new d.default(e,i,n,o),t.strokeRect(e,i,n,o)}destroySelectionLayer(){this._painter.removeLayer(this.selectionLayer)}createSelectionLayer(){this.selectionLayer||(this._painter.addCanvasLayer(this.selectionLayerId,0,0,this._painter.width,this._painter.height,!1),this.selectionLayer.onDoubleTap=t=>{t.altKey?this.saveSelectionAsNewStamp():this.paintSelectionToCanvas()})}cutSelection(){if(this.selectionLayer.clear(),this._selection=u.getVisiblePixelFrame(this._painter.baseLayer.ctx,this.selection),this.selection.isEmpty())return;this.hasFloatingSelection=!0;const{x:t,y:e,width:i,height:n}=this.selection;this.selectionLayer.setPositionAndSize(t,e,i,n),this.selectionLayer.floating=!0,this.selectionLayer.ctx.drawImage(this._painter.baseLayer.canvas,t,e,i,n,0,0,i,n),this._painter.baseLayer.clear(this.selection),this._painter.recordHistoryState()}paintSelectionToCanvas(){this.hasFloatingSelection&&(this._painter.baseLayer.ctx.globalCompositeOperation="source-over",this.selectionLayer.drawToCanvas(this._painter.baseLayer.ctx),this._painter.recordHistoryState())}saveSelectionAsNewStamp(){c.imageStorage.keys().then((t=>{if(t.filter((t=>t.startsWith("Shape"))).length>=A.config.maxShapeCount)return void console.log("Cannot save selection as shape because there are already too many in storage.");const e=`shape${Date.now()}.png`;console.log(`Saving selection as: ${e}`),this.selectionLayer.canvas.toBlob((t=>c.imageStorage.saveImage(e,t))),this.isInShapesPalette=!0}))}selectAll(){this.startNewSelection(),this._selection=new d.default(0,0,this._painter.width,this._painter.height),this.cutSelection()}}e.default=m},7540:function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this._painter=t,this._buttonElement=document.getElementById(e)}get color(){return this._painter.color}get opacity(){return this._painter.opacity}get lineWidth(){return this._painter.lineWidth}createBufferCtx(){let t=document.createElement("canvas");t.id="buffer",t.width=this._painter.width,t.height=this._painter.height,i._bufferCtx=t.getContext("2d",{alpha:!0}),i._bufferCtx.imageSmoothingQuality="high",i._bufferCtx.imageSmoothingEnabled=!0}getBufferCtx(){return null==i._bufferCtx&&this.createBufferCtx(),i._bufferCtx}enable(){this._buttonElement.classList.add("selected")}disable(){this._buttonElement.classList.remove("selected")}down(t){}move(t){}up(t){}pressureChanged(){}tick(t){}keyDown(t){}}e.default=i},5640:function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}get minX(){return this.x}get minY(){return this.y}get maxX(){return this.x+this.width}get maxY(){return this.y+this.height}isEmpty(){return this.width<=0||this.height<=0}static Empty(){return new i(0,0,0,0)}}e.default=i},9989:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.dilateMask=e.getVisiblePixelFrame=e.floodFill=e.stringToColor=e.lerpCanvas=e.lerpColor=e.clamp=e.lerp=e.createNewImageId=e.addLongClick=e.addClick=e.log=e.getImageOverlayUrl=e.pointerEventsSupported=e.imageToBlob=e.upload=e.formatBytes=void 0;const s=i(6705),a=o(i(5640)),r=o(i(4327));function l(t,e,i){return t*(1-i)+e*i}i(7107),e.formatBytes=function(t,e=2){if(0===t)return"0 Bytes";const i=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(i))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},e.upload=function(t){return n(this,void 0,void 0,(function*(){return new Promise((e=>{const i=document.createElement("input");i.type="file",i.accept=t,i.onchange=()=>{if(0==i.files.length)return;let t=i.files[0];e(t),i.remove()},i.click()}))}))},e.imageToBlob=function(t){const e=document.createElement("canvas");return e.id="imageToCanvas",e.width=t.naturalWidth,e.height=t.naturalHeight,e.getContext("2d",{alpha:!0}).drawImage(t,0,0),new Promise((t=>{e.toBlob((e=>t(e)))}))},e.pointerEventsSupported=function(){return null!=window.PointerEvent},e.getImageOverlayUrl=function(t){var e;return null===(e=s.config.images[t])||void 0===e?void 0:e.overlay},e.log=function(t,...e){s.config.debug&&console.log(t,e)},e.addClick=function(t,e,i=!1){let n,o,a,r,l,h;function d(e){if(i||e.preventDefault(),!r)return;const a=e.changedTouches[0];document.elementFromPoint(a.pageX,a.pageY)!=e.target&&(r=!1,t.classList.remove("down")),(h||e.timeStamp<l+s.config.maxScrollDelay)&&i&&(Math.abs(a.pageX-n)>s.config.minScrollDistance||Math.abs(a.pageY-o)>s.config.minScrollDistance)&&(r=!1,t.classList.remove("down")),e.timeStamp<l+s.config.maxScrollDelay&&(Math.abs(a.pageX-n)>2||Math.abs(a.pageY-o)>2)&&(h=!0)}function c(i){i.preventDefault(),t.removeEventListener("touchmove",d),t.removeEventListener("touchend",c),t.classList.remove("down"),r&&(r=!1,a=null,e.call(i.target,i))}t.addEventListener("touchstart",(function(e){if(i||e.preventDefault(),r||e.touches.length>1)return;const s=e.changedTouches[0];r=!0,a=s.identifier,h=!1,n=s.pageX,o=s.pageY,l=e.timeStamp,t.classList.add("down"),t.addEventListener("touchmove",d),t.addEventListener("touchend",c)})),t.addEventListener("mouseup",(function(t){t.preventDefault(),t.stopPropagation(),e.call(t.target,t)}))},e.addLongClick=function(t,e){let i,n=this,o=!1;function a(t){o=!1,i=setTimeout((()=>{e.call(n,t),o=!0}),s.config.longClickDelay)}function r(e){o?(e.stopImmediatePropagation(),t.classList.remove("down"),o=!1):clearTimeout(i)}t.addEventListener("touchstart",a),t.addEventListener("touchend",r),t.addEventListener("mousedown",a),t.addEventListener("mouseup",r)},e.createNewImageId=function(){return Date.now().toString()},e.lerp=l,e.clamp=function(t,e,i){return Math.min(e,Math.max(t,i))},e.lerpColor=function(t,e,i){if(0==i)return t;if(1==i)return e;const n=(16711680&t)>>16,o=(65280&t)>>8,s=255&t,a=(16711680&e)>>16,r=(65280&e)>>8,h=255&e;return Math.floor(l(s,h,i))+(Math.floor(l(o,r,i))<<8)+(Math.floor(l(n,a,i))<<16)+4278190080},e.lerpCanvas=function(t,e,i){const n=t.canvas.width,o=t.canvas.height,s=t.getImageData(0,0,n,o),a=e.getImageData(0,0,n,o),r=i.getImageData(0,0,n,o),l=new Uint8ClampedArray(s.data.buffer),h=new Uint8ClampedArray(a.data.buffer),d=new Uint8ClampedArray(r.data.buffer);for(let t=0;t<n*o;t++){const e=d[4*t+3]/255;l[4*t+0]=(1-e)*l[4*t+0]+e*h[4*t+0],l[4*t+1]=(1-e)*l[4*t+1]+e*h[4*t+1],l[4*t+2]=(1-e)*l[4*t+2]+e*h[4*t+2],l[4*t+3]=(1-e)*l[4*t+3]+e*h[4*t+3]}t.putImageData(s,0,0)},e.stringToColor=function(t){let e=0,i=0,n=0;return 4==t.length?(e=parseInt(t[1]+t[1],16),i=parseInt(t[2]+t[2],16),n=parseInt(t[3]+t[3],16)):(e=parseInt(t[1]+t[2],16),i=parseInt(t[3]+t[4],16),n=parseInt(t[5]+t[6],16)),4278190080+e+(i<<8)+(n<<16)},e.floodFill=function(t,e,i,n){const o=t.canvas.width,s=t.canvas.height,a=t.getImageData(0,0,o,s).data,l=((i=i.clone().round()).x,i.y,.333*(parseInt(n[1]+n[2],16)+parseInt(n[3]+n[4],16)+parseInt(n[5]+n[6],16)));for(let t=0;t<o*s;t++)e[4*t+3]=0;let h=[];for(h.push(i),i.x>1&&h.push(new r.default(i.x-2,i.y)),i.x<o-2&&h.push(new r.default(i.x+2,i.y)),i.y>1&&h.push(new r.default(i.x,i.y-2)),i.y<s-2&&h.push(new r.default(i.x,i.y+2));h.length>0;){let t=h.pop();if(A(t.x,t.y,!1))continue;const e=d(t.x,t.y),i=c(t.x,t.y);u(e,i,t.y-1),u(e,i,t.y+1)}function d(t,e){let i=t;for(;i>=0&&!A(i,e,!0);)i-=1;return i+1}function c(t,e){let i=t+1;for(;i<o&&!A(i,e,!0);)i+=1;return i-1}function u(t,e,i){if(!(i<0||i>=s))for(let n=t;n<=e;n++)A(n,i,!1)||h.push(new r.default(n,i))}function A(t,i,n){const s=4*(t+i*o),r=s+3;if(e[r])return!0;const h=a[s],d=a[s+1],c=a[s+2];return!(a[s+3]<250||.333*(h+d+c)>=l)||(n&&(e[r]=255),!1)}},e.getVisiblePixelFrame=function(t,e){let{x:i,y:n,width:o,height:s}=e;if(o<=0||s<=0)return a.default.Empty();const r=t.getImageData(i,n,o,s).data;let l=o,h=0,d=s,c=0;for(let t=0;t<s;t++)for(let e=0;e<o;e++)r[4*(e+t*o)+3]&&(l=e<l?e:l,h=e>h?e:h,d=t<d?t:d,c=t>c?t:c);return i+=l,n+=d,o=Math.max(0,h-l+1),s=Math.max(0,c-d+1),new a.default(i,n,o,s)},e.dilateMask=function(t,e,i){for(let n=0;n<i;n++){for(let i=0;i<e-1;i++){const o=4*(i+n*e)+3;t[o+4]&&(t[o]=255)}for(let i=e-1;i>0;i--){const o=4*(i+n*e)+3;t[o-4]&&(t[o]=255)}}for(let n=0;n<e;n++){for(let o=0;o<i-1;o++){const i=4*(n+o*e)+3;t[i+4*e]&&(t[i]=255)}for(let o=i-1;o>0;o--){const i=4*(n+o*e)+3;t[i-4*e]&&(t[i]=255)}}}},9263:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=i(7180),l=i(6705),h=a(i(5627)),d=s(i(9989));class c extends r.View{constructor(t,e){super(t);let i=this._element.getElementsByClassName("button settings")[0];d.addClick(i,(()=>e()))}show(){super.show(),this.updateImages()}updateImages(){if(!this._thumbnails){this._thumbnails=[];for(let t=0;t<l.config.imageCount;t++){const e=`image${(""+(t+1)).padStart(2,"0")}.png`;let i=new h.default(this._element,e,(t=>this.onImageSelected(t)));this._thumbnails.push(i)}}}}e.default=c},8523:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.PaintView=void 0;const l=i(7180),h=r(i(6121)),d=r(i(5071)),c=s(i(9989)),u=r(i(3965)),A=r(i(4327)),p=i(4146),m=i(2415),g=i(6705),f=r(i(845)),C=r(i(4554)),_=r(i(179)),b=r(i(442)),y=i(2056),v=i(3803);class w extends l.View{constructor(t,e){super(t),this.scaleFactor=1,this._currentTouchId=0,this._layers={},this._lastSaveTimestamp=0,this._history=new v.History,this._sheet=document.getElementById("sheet"),this.width=g.config.width,this.height=g.config.height,c.log(`Setting PaintView size to ${this.width} x ${this.height}`),this.addCanvasLayer("base-layer",0,0,this.width,this.height,!1),this.addEventListeners(),this.createButtons(e),this.createToolbar(),this.createPalettes(),this.createTools()}get color(){return this._color}get stamp(){return this._stamp}get opacity(){return this._opacity}get lineWidth(){return this._lineWidth}get autoMaskCtx(){return this._autoMaskCtx}get baseLayer(){return this._layers["base-layer"]}get overlayLayer(){return this._layers["overlay-layer"]}getLayer(t){return this._layers[t]}createButtons(t){let e=this._element.getElementsByClassName("button back")[0];c.addClick(e,(()=>t())),this._undoButton=document.getElementById("undo-button"),c.addClick(this._undoButton,(()=>this.undo())),this._redoButton=document.getElementById("redo-button"),c.addClick(this._redoButton,(()=>this.redo())),this._importImageButton=document.getElementById("import-image-button"),c.addClick(this._importImageButton,(()=>a(this,void 0,void 0,(function*(){const t=yield c.upload("image/*");this.setTool(this.selectionTool);const e=URL.createObjectURL(t);yield this.selectionTool.setImageUrl(e),URL.revokeObjectURL(e)}))))}addLayer(t){return t.index=Object.keys(this._layers).length,this._layers[t.id]=t,t}addImageLayer(t,e,i,n,o,s){const a=new _.default(this._sheet,t,e,i,n,o);return a.floating=s,this.addLayer(a),a}addCanvasLayer(t,e,i,n,o,s){const a=new C.default(this._sheet,t,e,i,n,o);return a.floating=s,this.addLayer(a),a}removeLayer(t){t&&(t.remove(),delete this._layers[t.id])}createOverlay(){this.overlayLayer||this.addLayer(new _.default(this._sheet,"overlay-layer",0,0,this.width,this.height))}removeOverlay(){this.removeLayer(this.overlayLayer)}setOverlay(t){t?(this.createOverlay(),this.overlayLayer.image.src=t):this.removeOverlay()}createTools(){let t=document.getElementById("tool-pen");c.addLongClick(t,(()=>this.fill())),c.addClick(t,(()=>this.setTool(this.markerTool)));let e=document.getElementById("tool-eraser");c.addLongClick(e,(()=>this.clear(!0))),c.addClick(e,(()=>this.setTool(this.eraserTool)));let i=document.getElementById("tool-selection");c.addClick(i,(()=>this.setTool(this.selectionTool))),c.addLongClick(i,(()=>{this.setTool(this.selectionTool),this.selectionTool.selectAll()})),this._tools=[],this.markerTool=this.addTool(new u.default(this,"tool-pen","darken")),this.eraserTool=this.addTool(new u.default(this,"tool-eraser","destination-out")),this.selectionTool=this.addTool(new b.default(this,"tool-selection")),this.setTool(this.markerTool)}addTool(t){return this._tools.push(t),t}createToolbar(){this._mainToolbar=new y.Toolbar("main-toolbar"),this._contextToolbar=new y.Toolbar("context-toolbar")}createPalettes(){this._sizePalette=new d.default("size-palette"),this._sizePalette.onSelectionChanged=t=>{this._lineWidth=t},this._lineWidth=this._sizePalette.size,this._colorPalette=new h.default("color-palette"),this._colorPalette.onSelectionChanged=t=>this._color=t,this._color=this._colorPalette.color,this._shapePalette=new f.default("stamp-palette"),this._shapePalette.onSelectionChanged=t=>{this._stamp=t,this.setTool(this.selectionTool),this.selectionTool.setImageUrl(this.stamp)},this._stamp=this._shapePalette.stamp,this._opacity=1}setTool(t){this._currentTool!=t&&(this._currentTool&&this._currentTool.disable(),this._currentTool=t,this._currentTool&&this._currentTool.enable(),this._colorPalette.setVisible(this._currentTool==this.markerTool),this._sizePalette.setVisible(this._currentTool==this.markerTool||this._currentTool==this.eraserTool))}addEventListeners(){let t=this.baseLayer.canvas;t.style.pointerEvents="auto",document.addEventListener("keydown",(t=>this.keyDown(t))),t.addEventListener("click",(t=>t.preventDefault())),g.config.usePointerEvents&&null!=window.PointerEvent?(t.addEventListener("touchstart",(t=>{t.cancelable&&t.preventDefault()})),t.addEventListener("pointerdown",(t=>this.pointerDown(t))),t.addEventListener("pointermove",(t=>this.pointerMove(t))),t.addEventListener("pointerup",(t=>this.pointerUp(t))),t.addEventListener("pointercancel",(t=>t.preventDefault()))):(t.addEventListener("touchstart",(t=>this.touchStart(t))),t.addEventListener("touchmove",(t=>this.touchMove(t))),t.addEventListener("touchend",(t=>this.touchEnd(t))),t.addEventListener("touchcancel",(t=>t.preventDefault())))}getPointerEventPosition(t){let e=t.target.getBoundingClientRect();const i=e.height>e.width;let n=(t.clientX-e.left)/e.width,o=(t.clientY-e.top)/e.height,s=(i?1-o:n)*this.width,a=(i?n:o)*this.height;return g.config.pixelPerfect&&(s=Math.round(s),a=Math.round(a)),new A.default(s,a)}getTouchEventPosition(t){let e=this.baseLayer.canvas.getBoundingClientRect();const i=e.height>e.width;let n=(t.clientX-e.left)/e.width,o=(t.clientY-e.top)/e.height,s=(i?1-o:n)*this.width,a=(i?n:o)*this.height;return g.config.pixelPerfect&&(s=Math.round(s),a=Math.round(a)),new A.default(s,a)}keyDown(t){this.isVisible()&&(t.code,this._currentTool&&this._currentTool.keyDown(t))}pointerDown(t){t.preventDefault(),t.isPrimary&&1===t.buttons&&(t.target.setPointerCapture(t.pointerId),this._currentTouchId=t.pointerId,this.down({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:this.screenToSheet(new A.default(t.width,t.height)),pressure:this.getNormalizedPointerPressure(t),speed:1,isPressed:!0}))}pointerMove(t){t.preventDefault(),t.isPrimary&&1===t.buttons&&this.move({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:this.screenToSheet(new A.default(t.width,t.height)),pressure:this.getNormalizedPointerPressure(t),speed:1,isPressed:!0})}getNormalizedPointerPressure(t){return"pen"==t.pointerType?c.clamp(.5,2,4*t.pressure):1}getNormalizedTouchPressure(t){return"stylus"==t.touchType?c.clamp(.5,2,4*t.force):1}pointerUp(t){t.preventDefault(),t.isPrimary&&(t.target.releasePointerCapture(t.pointerId),this.up({timeStamp:t.timeStamp,position:this.getPointerEventPosition(t),radius:new A.default(t.width,t.height),pressure:1,speed:1,isPressed:!1}),this._currentTouchId=0)}pressureChanged(t){}touchStart(t){if(t.preventDefault(),0!==this._currentTouchId)return;const e=t.targetTouches[0];this._currentTouchId=e.identifier,this.down({timeStamp:t.timeStamp,position:this.getTouchEventPosition(e),radius:this.screenToSheet(new A.default(e.radiusX,e.radiusY)),pressure:this.getNormalizedTouchPressure(e),speed:1,isPressed:!0})}touchMove(t){t.preventDefault();let e=w.findTouch(t.targetTouches,this._currentTouchId);null!=e&&(console.log(e.force),this.move({timeStamp:t.timeStamp,position:this.getTouchEventPosition(e),radius:this.screenToSheet(new A.default(e.radiusX,e.radiusY)),pressure:this.getNormalizedTouchPressure(e),speed:1,isPressed:!0}))}touchEnd(t){t.preventDefault(),null==w.findTouch(t.targetTouches,this._currentTouchId)&&(this.up({timeStamp:t.timeStamp,position:new A.default(0,0),radius:new A.default(0,0),pressure:1,speed:1,isPressed:!1}),this._currentTouchId=0)}static findTouch(t,e){for(let i=0;i<t.length;i++)if(t[i].identifier==e)return t[i];return null}move(t){if(!this._currentTool)return;let e=this._lastPointerData.position.distanceTo(t.position);if(e<=1)return;this._lastPointerData=this._lastPointerData||t;const i=e/(t.timeStamp-this._lastPointerData.timeStamp);t.speed=c.lerp(this._lastPointerData.speed,i,.2),this._lastPointerData=t,this._currentTool.move(t)}down(t){p.Palette.collapseAll(),this._currentTool&&(this._lastPointerData=t,this._currentTool.down(t))}up(t){this._currentTool&&(this._lastPointerData=t,this._currentTool.up(t))}clear(t=!1){this.baseLayer.clear(),t&&this.recordHistoryState()}fill(){this.baseLayer.ctx.fillStyle=this.color,this.baseLayer.ctx.fillRect(0,0,this.width,this.height),this.recordHistoryState()}ResetHistory(){this._history.clear(),this.recordHistoryState(),this.updateUndoButtons()}recordHistoryState(){this._history.recordState(this.baseLayer.getData()),this.updateUndoButtons(),this.setDirty()}updateUndoButtons(){this._undoButton.classList.toggle("disabled",!this._history.canUndo),this._redoButton.classList.toggle("disabled",!this._history.canRedo)}undo(){this._history.canUndo&&(this.baseLayer.putData(this._history.undo()),this.updateUndoButtons(),this.setDirty())}redo(){this._history.canRedo&&(this.baseLayer.putData(this._history.redo()),this.updateUndoButtons(),this.setDirty())}restoreCurrentHistoryState(){this.baseLayer.putData(this._history.getCurrentState())}loadImage(t){return m.imageStorage.loadImage(t).then((e=>{this._imageId=t,this.clear(),e&&this.baseLayer.drawImage(e),this.setOverlay(c.getImageOverlayUrl(t)),this.ResetHistory(),this._isDirty=!1}))}saveImage(){c.log("Saving image"),this.baseLayer.canvas.toBlob((t=>m.imageStorage.saveImage(this._imageId,t))),this._isDirty=!1,this._lastSaveTimestamp=Date.now()}setDirty(){this._isDirty=!0}show(){super.show(),this._currentTouchId=0,this._autoMaskCaptured=!1,window.requestAnimationFrame((t=>this.tick(t))),this._currentTool.enable()}hide(){p.Palette.collapseAll(),this._currentTool&&this._currentTool.disable(),this._layers&&this.saveImage(),this._history&&this._history.clear(),super.hide()}tick(t){if(!this.isVisible())return;window.requestAnimationFrame((t=>this.tick(t)));let e=t-this._tickTimeStamp;this._tickTimeStamp=t,this._currentTool&&(this._currentTool.tick(e),this._lastPointerData&&this._lastPointerData.isPressed)||this._isDirty&&Date.now()>this._lastSaveTimestamp+g.config.saveInterval&&this.saveImage()}captureAutoMask(t){if(!g.config.useAutoMask)return;if(this._autoMaskCaptured=!0,!this._autoMaskCtx){let t=document.createElement("canvas");t.id="auto-mask",t.width=this.width,t.height=this.height,this._autoMaskCtx=t.getContext("2d",{alpha:!0})}let e=this._autoMaskCtx.getImageData(0,0,this.width,this.height);t.x,t.y,this.width,c.log("capturing auto mask"),c.floodFill(this.baseLayer.ctx,e.data,t,this.color),c.dilateMask(e.data,this.width,this.height),this._autoMaskCtx.putImageData(e,0,0)}processOverlay(t){const e=t.getImageData(0,0,this.width,this.height),i=e.data;for(let t=i.length-1;t>=0;t--)i[t]=i[t]>64?255:0;t.putImageData(e,0,0)}screenToSheet(t){return new A.default(t.x/screen.width*g.config.width,t.y/screen.height*g.config.height)}}e.PaintView=w},8124:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e},a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function a(t){try{l(n.next(t))}catch(t){s(t)}}function r(t){try{l(n.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const r=i(7180),l=s(i(9989)),h=i(2415);var d=i(8966);const c=i(3162);class u extends r.View{constructor(t,e){super(t);let i=this._element.getElementsByClassName("button back")[0];l.addClick(i,(()=>e()));let n=this._element.getElementsByClassName("button export")[0];l.addClick(n,(()=>a(this,void 0,void 0,(function*(){const t=yield h.imageStorage.generateBackupArchive();c.saveAs(t,"web-paint-backup.zip")}))));let o=this._element.getElementsByClassName("button import")[0];l.addClick(o,(()=>a(this,void 0,void 0,(function*(){h.imageStorage.importBackupArchive(yield l.upload(".zip")),this.updateInfo()}))));let s=this._element.getElementsByClassName("button clear")[0];l.addClick(s,(()=>{confirm("Really clear all iamges?")&&(h.imageStorage.clear(),location.reload())})),d.connect(document.getElementById("log"),{},!0,!0,!0)}show(){super.show(),this.updateInfo()}updateInfo(){const t=document.getElementById("info");t.innerText="Version: 1.0.0",h.imageStorage.getStorageUsed().then((e=>{t.innerText+=`\rStorage used: ${l.formatBytes(e,1)}`}))}}e.default=u},5627:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),o=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&n(e,t,i);return o(e,t),e};Object.defineProperty(e,"__esModule",{value:!0});const a=s(i(9989)),r=i(2415);e.default=class{constructor(t,e,i){let n=document.createElement("div");this._element=n,n.id=e,n.classList.add("thumbnail"),this._element.style.opacity="0",a.addClick(n,(()=>{i&&i(e)}),!0),r.imageStorage.addChangeListener(((t,e)=>{"save"==t&&e==this.id&&this.loadImage()})),this.overlayUrl=a.getImageOverlayUrl(e),t.appendChild(n),this.loadImage()}get id(){return this._element.id}set imageUrl(t){this._imageUrl=t,this._element.style.opacity="1",this.updateBackgroundImages()}set overlayUrl(t){this._overlayUrl=t,this.updateBackgroundImages()}remove(){this._element.remove()}isHidden(){return null===this._element.offsetParent}loadImage(){r.imageStorage.loadImageUrl(this.id).then((t=>{this.imageUrl=t}))}updateBackgroundImages(){let t=[];this._overlayUrl&&t.push(`url(${this._overlayUrl})`),this._imageUrl&&t.push(`url(${this._imageUrl})`),this._element.style.backgroundImage=t.join(",")}}},7180:function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.View=void 0,e.View=class{constructor(t){this._element=document.getElementById(t),this._element||console.error(`Could not find element with id ${t}`),this.hide()}clear(){for(;this._element.hasChildNodes();)this._element.removeChild(this._element.firstChild)}show(){this._element.classList.remove("hidden")}hide(){this._element.classList.add("hidden")}setVisible(t){this._element.classList.toggle("hidden",!t)}isVisible(){return!this._element.classList.contains("hidden")}}}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={id:n,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}i.m=t,i.x=function(){},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,{a:e}),e},i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},function(){var t={179:0},e=[[5866,195]],n=function(){},o=function(o,s){for(var a,r,l=s[0],h=s[1],d=s[2],c=s[3],u=0,A=[];u<l.length;u++)r=l[u],i.o(t,r)&&t[r]&&A.push(t[r][0]),t[r]=0;for(a in h)i.o(h,a)&&(i.m[a]=h[a]);for(d&&d(i),o&&o(s);A.length;)A.shift()();return c&&e.push.apply(e,c),n()},s=self.webpackChunkweb_paint=self.webpackChunkweb_paint||[];function a(){for(var n,o=0;o<e.length;o++){for(var s=e[o],a=!0,r=1;r<s.length;r++){var l=s[r];0!==t[l]&&(a=!1)}a&&(e.splice(o--,1),n=i(i.s=s[0]))}return 0===e.length&&(i.x(),i.x=function(){}),n}s.forEach(o.bind(null,0)),s.push=o.bind(null,s.push.bind(s));var r=i.x;i.x=function(){return i.x=r||function(){},(n=a)()}}(),i.x()}();
//# sourceMappingURL=main.c96719283c0b27b1a5c0.js.map